<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Kingdom of DS Hacking</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">Guides</li><li class="chapter-item "><div>Generation IV</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Diamond and Pearl</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen4/guides/field/owsprites.html">Overworld Sprites Replacement</a></li></ol></li><li class="chapter-item "><div>Platinum</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen4/guides/field/owsprites.html">Overworld Sprites Replacement</a></li><li class="chapter-item "><a href="gen4/guides/field/pt_hgss-pokemarts.html">Adding New Poké Marts</a></li><li class="chapter-item "><a href="gen4/guides/field/pt_hgss-script_weather.html">Setting the Weather from a Script</a></li><li class="chapter-item "><a href="gen4/guides/field/pt_hgss-reusabletms.html">Making TMs Reusable</a></li><li class="chapter-item "><a href="gen4/guides/field/pt_reusable_repel.html">Making Repels Reusable</a></li><li class="chapter-item "><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html">Changing the HP Bar Speed</a></li></ol></li><li class="chapter-item "><div>Heartgold and SoulSilver</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen4/guides/field/owsprites.html">Overworld Sprites Replacement</a></li><li class="chapter-item "><a href="gen4/guides/field/pt_hgss-pokemarts.html">Adding New Poké Marts</a></li><li class="chapter-item "><a href="gen4/guides/interface/hgss-town_map.html">Editing the Town Map</a></li><li class="chapter-item "><a href="gen4/guides/field/pt_hgss-script_weather.html">Setting the Weather from a Script</a></li><li class="chapter-item "><a href="gen4/guides/field/pt_hgss-reusabletms.html">Making TMs Reusable</a></li><li class="chapter-item "><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html">Changing the HP Bar Speed</a></li></ol></li></ol></li><li class="chapter-item "><div>Generation V</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Black and White</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen5/guides/misc/bw_b2w2-code_injection.html">Code Injection</a></li><li class="chapter-item "><a href="gen5/guides/field/bw_b2w2-map_insertion.html">Map Insertion</a></li><li class="chapter-item "><a href="gen5/guides/field/bw_b2w2-buildings.html">Exporting and Importing Buildings</a></li></ol></li><li class="chapter-item "><div>Black 2 and White 2</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen5/guides/misc/bw_b2w2-code_injection.html">Code Injection</a></li><li class="chapter-item "><a href="gen5/guides/misc/b2w2-fairy.html">Fairy Type Insertion</a></li><li class="chapter-item "><a href="gen5/guides/field/bw_b2w2-map_insertion.html">Map Insertion</a></li><li class="chapter-item "><a href="gen5/guides/field/bw_b2w2-buildings.html">Exporting and Importing Buildings</a></li></ol></li></ol></li><li class="chapter-item "><div>Universal</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/guides/code_injection/code_injection.html">Code Injection</a></li><li class="chapter-item "><a href="universal/guides/sprite_indexing/indexing.html">Sprite Indexing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html">Sprite Indexing with GIMP</a></li></ol></li><li class="chapter-item "><a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html">NCER Sprite Editing</a></li><li class="chapter-item "><a href="universal/guides/hex_editing/hex_editing.html">Hex Editing</a></li><li class="chapter-item "><a href="universal/guides/nsbtp_creation/nsbtp_tutorial.html">Texture Flipbook (NSBTP) Creation</a></li><li class="chapter-item "><a href="universal/guides/knarc/knarc.html">Packing and Unpacking NARC files with Knarc</a></li></ol></li><li class="chapter-item "><li class="part-title">Resources</li><li class="chapter-item "><div>Generation IV</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Diamond and Pearl</div></li><li class="chapter-item "><div>Platinum</div></li><li class="chapter-item "><div>Heartgold and SoulSilver</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen4/resources/interface/hgss-town_map_spots.html">Town Map Structures</a></li></ol></li></ol></li><li class="chapter-item "><div>Generation V</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Black and White</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen5/resources/field/bw_b2w2-maps.html">Maps</a></li><li class="chapter-item "><a href="gen5/resources/field/bw_b2w2-zone_entities.html">Zone Entities</a></li></ol></li><li class="chapter-item "><div>Black 2 and White 2</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="gen5/resources/field/b2w2-area_data.html">Area Data</a></li><li class="chapter-item "><a href="gen5/resources/field/bw_b2w2-maps.html">Maps</a></li><li class="chapter-item "><a href="gen5/resources/field/bw_b2w2-zone_entities.html">Zone Entities</a></li></ol></li></ol></li><li class="chapter-item "><a href="universal/resources/nitro/nitro_overview.html">Nitro</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/file_system/file_narc.html">Nitro Archive (NARC)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/file_system/section_fatb.html">File Allocation Table (FATB)</a></li><li class="chapter-item "><a href="universal/resources/nitro/file_system/section_fntb.html">File Name Table (FNTB)</a></li><li class="chapter-item "><a href="universal/resources/nitro/file_system/section_fimg.html">File Image (FIMG)</a></li></ol></li><li class="chapter-item "><div>G2D</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime (NANR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_abnk.html">Animation Bank (ABNK)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_labl.html">Label (LABL)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_uext.html">User Extension (UEXT)</a></li></ol></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/file_nclr.html">Nitro Color Runtime (NCLR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_pltt.html">Palette (PLTT)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_pcmp.html">Palette Count Map (PCMP)</a></li></ol></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime (NCER)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_cebk.html">Cell Bank (CEBK)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_labl.html">Label (LABL)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_uext.html">User Extension (UEXT)</a></li></ol></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/file_ncgr.html">Nitro Graphics Runtime (NCGR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_char.html">Character (CHAR)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_cpos.html">Character Position (CPOS)</a></li></ol></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/file_nmar.html">Nitro Multicell Animation Runtime (NMAR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_abnk.html">Animation Bank (ABNK)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_labl.html">Label (LABL)</a></li></ol></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/file_nmcr.html">Nitro Multicell Runtime (NMCR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_mcbk.html">Multicell Bank (MCBK)</a></li></ol></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/file_nscr.html">Nitro Screen Runtime (NSCR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_2d/section_scrn.html">Screen (SCRN)</a></li></ol></li></ol></li><li class="chapter-item "><div>G3D</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="universal/resources/nitro/graphics_3d/file_bta0.html">Nitro System Binary Texture Animation (NSBTA)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_3d/file_bmd0.html">Nitro System Binary Model (NSBMD)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_3d/file_btx0.html">Nitro System Binary Texture (NSBTX)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_3d/file_btp0.html">Nitro System Binary Texture Pattern (NSBTP)</a></li><li class="chapter-item "><a href="universal/resources/nitro/graphics_3d/file_bca0.html">Nitro System Binary Character Skeleton Animation (NSBCA)</a></li></ol></li><li class="chapter-item "><div>Sound</div></li></ol></li><li class="chapter-item "><li class="part-title">Contributing</li><li class="chapter-item "><a href="contribution_guide.html">Contribution Guide</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Kingdom of DS Hacking</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="home"><a class="header" href="#home">Home</a></h1>
<p><a href="README.html">Home</a></p>
<h1 id="guides"><a class="header" href="#guides">Guides</a></h1>
<hr />
<details>
<summary>Generation IV</summary>
<br>
<br>
<details>
<summary>Diamond and Pearl</summary>
<br>
<p><a href="gen4/guides/field/owsprites.html">Overworld Sprites Replacement</a></p>
</details>
<details>
<summary>Platinum</summary>
<br>
<p><a href="gen4/guides/field/owsprites.html">Overworld Sprites Replacement</a></p>
<p><a href="gen4/guides/field/pt_hgss-pokemarts.html">Adding New Poké Marts</a></p>
<p><a href="gen4/guides/field/pt_hgss-script_weather.html">Setting the Weather from a Script</a></p>
<p><a href="gen4/guides/field/pt_hgss-reusabletms.html">Making TMs Reusable</a></p>
<p><a href="gen4/guides/field/pt_reusable_repel.html">Making Repels Reusable</a></p>
<p><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html">Changing the HP Bar Speed</a></p>
</details>
<details>
<summary>Heartgold and SoulSilver</summary>
<br>
<p><a href="gen4/guides/field/owsprites.html">Overworld Sprites Replacement</a></p>
<p><a href="gen4/guides/field/pt_hgss-pokemarts.html">Adding New Poké Marts</a></p>
<p><a href="gen4/guides/interface/hgss-town_map.html">Editing the Town Map</a></p>
<p><a href="gen4/guides/field/pt_hgss-script_weather.html">Setting the Weather from a Script</a></p>
<p><a href="gen4/guides/field/pt_hgss-reusabletms.html">Making TMs Reusable</a></p>
<p><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html">Changing the HP Bar Speed</a></p>
</details>
<br>
</details>
<hr />
<details>
<summary>Generation V</summary>
<br>
<br>
<details>
<summary>Black and White</summary>
<br>
<p><a href="gen5/guides/misc/bw_b2w2-code_injection.html">Code Injection</a></p>
<p><a href="gen5/guides/field/bw_b2w2-map_insertion.html">Map Insertion</a></p>
<p><a href="gen5/guides/field/bw_b2w2-buildings.html">Exporting and Importing Buildings</a></p>
</details>
<details>
<summary>Black 2 and White 2</summary>
<br>
<p><a href="gen5/guides/misc/bw_b2w2-code_injection.html">Code Injection</a></p>
<p><a href="gen5/guides/misc/b2w2-fairy.html">Fairy Type Insertion</a></p>
<p><a href="gen5/guides/field/bw_b2w2-map_insertion.html">Map Insertion</a></p>
<p><a href="gen5/guides/field/bw_b2w2-buildings.html">Exporting and Importing Buildings</a></p>
</details>
<br>
</details>
<hr />
<details>
<summary>Universal</summary>
<br>
<br>
<p><a href="universal/guides/code_injection/code_injection.html">Code Injection</a></p>
<p><a href="universal/guides/sprite_indexing/indexing.html">Sprite Indexing</a></p>
<ul>
<li><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html">Sprite Indexing with GIMP</a></li>
</ul>
<p><a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html">NCER Sprite Editing</a></p>
<p><a href="universal/guides/hex_editing/hex_editing.html">Hex Editing</a></p>
<p><a href="universal/guides/nsbtp_creation/nsbtp_tutorial.html">Texture Flipbook (NSBTP) Creation</a></p>
<p><a href="universal/guides/knarc/knarc.html">Packing and Unpacking NARC files with Knarc</a></p>
<br>
</details>
<hr />
<h1 id="resources"><a class="header" href="#resources">Resources</a></h1>
<hr />
<details>
<summary>Generation IV</summary>
<br>
<br>
<details>
<summary>Diamond and Pearl</summary>
<br>
</details>
<details>
<summary>Platinum</summary>
<br>
</details>
<details>
<summary>Heartgold and SoulSilver</summary>
<br>
<p><a href="gen4/resources/interface/hgss-town_map_spots.html">Town Map Structures</a></p>
</details>
<br>
</details>
<hr />
<details>
<summary>Generation V</summary>
<br>
<br>
<details>
<summary>Black and White</summary>
<br>
<p><a href="gen5/resources/field/bw_b2w2-maps.html">Maps</a></p>
<p><a href="gen5/resources/field/bw_b2w2-zone_entities.html">Zone Entities</a></p>
</details>
<details>
<summary>Black 2 and White 2</summary>
<br>
<p><a href="gen5/resources/field/b2w2-area_data.html">Area Data</a></p>
<p><a href="gen5/resources/field/bw_b2w2-maps.html">Maps</a></p>
<p><a href="gen5/resources/field/bw_b2w2-zone_entities.html">Zone Entities</a></p>
</details>
<br>
</details>
<hr />
<h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<hr />
<p><a href="contribution_guide.html">Contribution Guide</a></p>
<hr />
<div style="break-before: page; page-break-before: always;"></div><h1 id="overworld-sprite-replacement-guide"><a class="header" href="#overworld-sprite-replacement-guide">Overworld Sprite Replacement Guide</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago. Credits to the <a href="https://docs.google.com/document/d/1_nRfhDEoNFbvYP-yjx4oAWmgGXxvqFBvLwYANFehxUU/edit">Known Sprite Locations document</a> and BagBoy for the OW tables research.</p>
</blockquote>
<p>This is a guide on how to extract, replace, change the properties and make your own overworld sprites.
The necessary tools are Tinke 0.9.2 and BTX Editor 2.0</p>
<p>In addition for the Sprite Properties section you will need DSPRE and an Hex Editor like HxD as well.</p>
<hr />
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/owsprites.html#section">Extracting the Sprite</a></li>
<li><a href="gen4/guides/field/owsprites.html#section-2">Making your own Sprite</a></li>
<li><a href="gen4/guides/field/owsprites.html#section-3">Replacing</a>
<ul>
<li><a href="gen4/guides/field/owsprites.html#subsection">Unused Sprites</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/owsprites.html#section-4">Changing the Sprite Properties</a>
<ul>
<li><a href="gen4/guides/field/owsprites.html#subsection-2">Platinum</a></li>
<li><a href="gen4/guides/field/owsprites.html#subsection-3">HGSS</a></li>
</ul>
</li>
</ul>
<h2 id="extracting-the-sprite"><a class="header" href="#extracting-the-sprite">Extracting the Sprite</a></h2>
<p>Overworld sprites are contained in BTX files, start by opening your ROM with Tinke and then navigating to the following filepath depending on your game:</p>
<ul>
<li><strong>DPPt</strong>: mmodel/mmodel.narc</li>
<li><strong>HGSS</strong>: a/0/8/1</li>
</ul>
<p>Once you've navigated to this directory in Tinke, select the narc file and click unpack to see see all the BTX files. 
You can select one and click the &quot;View&quot; button to see the spritesheet. Select the one you want to replace and click Extract, so that you will obtain the BTX file.</p>
<p><img src="gen4/guides/field/resources/owsprites/tinke.PNG" alt="" /></p>
<p>You can load this file in the BTX Editor 2.0 to either extract the spritesheet itself in a .png format or import your own spritesheet.</p>
<p><img src="gen4/guides/field/resources/owsprites/btxeditor.PNG" alt="" /></p>
<details>
 <summary>Where to find all Player Character Sprites.</summary>
 <p>
   Diamond and Pearl
   Lucas:
		90 - Walking/Running
		92 - Bike
		155 - Pull out Pokeball
		157 - Water flower
		159 - Surf
164 - Tux
166 - Fishing
363 - Aerobics
365 - Save
367 - Pokecenter
<p>Heroine:
91 - Walking/Running
93 - Bike
156 - Pull out Pokeball
158 - Water flower
160 - Surf
165 - Dress
167 - Fishing
364 - Aerobics
366 - Save
368 - Pokecenter</p>
</p>
</details>
<h2 id="making-your-own-sprite"><a class="header" href="#making-your-own-sprite">Making your own Sprite</a></h2>
<p>Before proceeding you should be familiar with Sprite Indexing, as all the sprites must have at most 16 color, with the background color being indexed to the first slot of the palette.
See <a href="gen4/guides/field/kingdom-of-ds-hacking.github.io/tree/main/src/universal/guides/sprite_indexing">Sprite Indexing</a> for more information.</p>
<p>First you want to load the png spritesheet you previously extracted in the graphic editing software of your choice, to either make edits to it or use it as a base for your spritesheet. 
You may also want to enable some kind of grid visualization in order to view the proper position of each frame. In Aseprite you can do so by clicking View&gt;Grid&gt;Grid Settings.</p>
<p>If you're making your own sprite from scratch, remember that all the frames you draw must be in the same position as the ones in the original sprite, otherwise the movement in game will look wrong; for example the following image is not a correct spritesheet since the three walking frames aren't in the same position as the original one:</p>
<p><img src="gen4/guides/field/resources/owsprites/wrongsprite.PNG" alt="" /></p>
<p>Once you're done, you can open the BTX you previously extracted in BTX Editor 2.0 and click import, then import the spritesheet you made, and save the BTX.</p>
<h2 id="replacing-the-sprite"><a class="header" href="#replacing-the-sprite">Replacing the Sprite</a></h2>
<p>Replacing the sprite simply consists in just clicking the &quot;Change File&quot; button in Tinke on the BTX file you want to replace, and then select the BTX you either extracted or obtained from BTX Editor. Don't forget to <strong>click the Pack button on the narc file</strong> after you've replaced the BTX. Now you can save the ROM.</p>
<p>Just remember that the sprite you're inserting must have the same size and number of frames as the one you're replacing, otherwise you will have to change its properties to get the movement working correctly even if it's the same size. Single-frame sprites with the same dimension as the original won't have the issue however.</p>
<h3 id="unused-sprites"><a class="header" href="#unused-sprites">Unused Sprites</a></h3>
<p>Adding new overworld sprites would require ASM but luckily there are a number of unused sprites that may be useful to you:</p>
<p><img src="gen4/guides/field/resources/owsprites/unusedsprites.png" alt="" /></p>
<h2 id="changing-the-sprite-properties"><a class="header" href="#changing-the-sprite-properties">Changing the Sprite Properties</a></h2>
<p>If you've replaced a sprite with one having a different number of frames or a different size, the sprite will either not display correctly in game or not display at all if it has a different size. 
Unless your sprite is only made of one frame and has the same size the original one, you will need to fix this by hex editing each sprite properties. If you haven't already open your ROM in DSPRE so you can easily access the necessary overlay files in the folder created by DSPRE, which will be named <em>YourROMName</em>_DSPRE_Contents/overlay. </p>
<p>All the offsets listed are based on the US version of the ROM and it has not been tested on other versions.</p>
<h3 id="platinum"><a class="header" href="#platinum">Platinum</a></h3>
<p>In Platinum there are two tables we need to look up for changing sprite properties, both are in Overlay 5.</p>
<p>First we need to find the ID number of the sprite we previously replaced. For my example I'll use the unused Rotom Oven, whose model number is 406, and I have replaced it with a 64x64 Ho-Oh Sprite ripped from HGSS, having two frames:</p>
<p><img src="gen4/guides/field/resources/owsprites/hooh64x64.png" alt="" /></p>
<p>The first table is at 0x2BC34 and will look like this:</p>
<p><img src="gen4/guides/field/resources/owsprites/pt_owtable1.PNG" alt="" /></p>
<p>Each entry is made of 8 bytes, the first 4 in red for the ID number and the latter 4 in blue for the mmodel number. We already know the model number, which in little endian is 96 01, so we just need to search those bytes using HxD search hex values function with the search direction being set to &quot;forward&quot;, then click Search All.
Since my mmodel number is greater than 255, I'll get a single result, being the two bytes corresponding to the model number, the next 2 bytes are going to be 00 00 and the next 4 bytes are the ID number we are looking for, in my case F4 00 00 00.</p>
<p>If your model number was less than or equal to 255, <strong>you need to look at the second result in the results tab</strong>.</p>
<p>With this information we can go to the second table at 0x2CA08, which is structured like this:</p>
<p><img src="gen4/guides/field/resources/owsprites/pt_owtable2.PNG" alt="" /></p>
<p>Each row is an entry, the bytes in the red columns are the ID numbers of each sprites and the bytes in green are the sprite properties. You can scroll down until you see the ID number from the 1st table in the red columns. The bytes you want to edit are right before the ID number, in my case it will be which is a standard 32x32 16 frames NPC.</p>
<p>The bytes you want to replace for this are going to be depending on which Sprite Property you want to have:</p>
<div class="table-wrapper"><table><thead><tr><th>Byte Sequence</th><th>Corresponding Property</th><th>Example</th></tr></thead><tbody>
<tr><td>00 00 00 00 00 00 00 00 C0 B2 1F 02</td><td>32x32 Sprite with 16 frames</td><td>Regular NPCs</td></tr>
<tr><td>05 00 00 00 00 00 00 00 C0 B2 1F 02</td><td>64x64 Sprite with 2 frames</td><td>DPPt larger Legendaries like Palkia and Dialga</td></tr>
<tr><td>0B 00 00 00 15 00 00 00 64 B1 1F 02</td><td>128x64 Sprite with 2 frames</td><td>DPPt Giratina Distortion World sprite</td></tr>
</tbody></table>
</div>
<p>You can paste them with Ctrl+B in the green section of the row shown above. Then, save the overlay and save the ROM from DSPRE. If you have done the process correctly, it will show up in game.
If the two frames are different you can set the OW movement to <em>20-Running Up, Down</em> in DSPRE event editor to have the animation play out costantly.</p>
<h3 id="hgss"><a class="header" href="#hgss">HGSS</a></h3>
<p>Fortunately in HGSS there is only one table, it's at offset <code>0x21BA8</code> in Overlay 1.
The Overlay 1 needs to be uncompressed, so you either have to use blz to decompress it or apply the <em>Configure Overlay 1 as uncompressed</em> patch from DSPRE's toolbox.
I will be replacing the glitched bulbasaur sprite with a standard 32x32 NPC, so first I need to find the correspondent ID number.
The table will look like this: </p>
<p><img src="gen4/guides/field/resources/owsprites/hgss_owtable.PNG" alt="" /></p>
<p>There are 6 bytes for each entry, with the first two bytes (red) are the Overworld ID, the following two bytes (blue) for the number of the BTX filename in the a/0/8/1 narc, and the last two bytes (green) for the sprite properties.</p>
<p>The glitched Bulbasaur sprite I'm replacing is 1_201.BTX0, so in little endian the filename number I'm looking for is <code>C9 00</code>. We can find the corresponding result by searching those bytes with HxD search function, with search direction set <em>forward</em> and clicking <em>Search All</em>, and we have to look for the 2nd result if it exists (regardless if the number is smaller or greather than 255), which will be at <code>0x22EC4</code> in my case. The bytes I'm looking for are the next two, so at <code>0x22EC6</code>, and you will need to replace them with <code>00 00</code> for the standard 32x32 NPC.</p>
<p>So I will replace the <code>25 4E</code> bytes with <code>00 00</code>. You can save the overlay 1, and then save the ROM in DSPRE. If you did all the steps correctly the sprite you replaced will show up correctly in game.
The other two offsets to fix the remaining bulbasaur glitched sprites (1_202.BTX0 and 1_203.BTX0) are respectively at <code>0x22ECC</code> and <code>0x22ED2</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overworld-sprite-replacement-guide-1"><a class="header" href="#overworld-sprite-replacement-guide-1">Overworld Sprite Replacement Guide</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago. Credits to the <a href="https://docs.google.com/document/d/1_nRfhDEoNFbvYP-yjx4oAWmgGXxvqFBvLwYANFehxUU/edit">Known Sprite Locations document</a> and BagBoy for the OW tables research.</p>
</blockquote>
<p>This is a guide on how to extract, replace, change the properties and make your own overworld sprites.
The necessary tools are Tinke 0.9.2 and BTX Editor 2.0</p>
<p>In addition for the Sprite Properties section you will need DSPRE and an Hex Editor like HxD as well.</p>
<hr />
<h2 id="table-of-contents-1"><a class="header" href="#table-of-contents-1">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/owsprites.html#section">Extracting the Sprite</a></li>
<li><a href="gen4/guides/field/owsprites.html#section-2">Making your own Sprite</a></li>
<li><a href="gen4/guides/field/owsprites.html#section-3">Replacing</a>
<ul>
<li><a href="gen4/guides/field/owsprites.html#subsection">Unused Sprites</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/owsprites.html#section-4">Changing the Sprite Properties</a>
<ul>
<li><a href="gen4/guides/field/owsprites.html#subsection-2">Platinum</a></li>
<li><a href="gen4/guides/field/owsprites.html#subsection-3">HGSS</a></li>
</ul>
</li>
</ul>
<h2 id="extracting-the-sprite-1"><a class="header" href="#extracting-the-sprite-1">Extracting the Sprite</a></h2>
<p>Overworld sprites are contained in BTX files, start by opening your ROM with Tinke and then navigating to the following filepath depending on your game:</p>
<ul>
<li><strong>DPPt</strong>: mmodel/mmodel.narc</li>
<li><strong>HGSS</strong>: a/0/8/1</li>
</ul>
<p>Once you've navigated to this directory in Tinke, select the narc file and click unpack to see see all the BTX files. 
You can select one and click the &quot;View&quot; button to see the spritesheet. Select the one you want to replace and click Extract, so that you will obtain the BTX file.</p>
<p><img src="gen4/guides/field/resources/owsprites/tinke.PNG" alt="" /></p>
<p>You can load this file in the BTX Editor 2.0 to either extract the spritesheet itself in a .png format or import your own spritesheet.</p>
<p><img src="gen4/guides/field/resources/owsprites/btxeditor.PNG" alt="" /></p>
<details>
 <summary>Where to find all Player Character Sprites.</summary>
 <p>
   Diamond and Pearl
   Lucas:
		90 - Walking/Running
		92 - Bike
		155 - Pull out Pokeball
		157 - Water flower
		159 - Surf
164 - Tux
166 - Fishing
363 - Aerobics
365 - Save
367 - Pokecenter
<p>Heroine:
91 - Walking/Running
93 - Bike
156 - Pull out Pokeball
158 - Water flower
160 - Surf
165 - Dress
167 - Fishing
364 - Aerobics
366 - Save
368 - Pokecenter</p>
</p>
</details>
<h2 id="making-your-own-sprite-1"><a class="header" href="#making-your-own-sprite-1">Making your own Sprite</a></h2>
<p>Before proceeding you should be familiar with Sprite Indexing, as all the sprites must have at most 16 color, with the background color being indexed to the first slot of the palette.
See <a href="gen4/guides/field/kingdom-of-ds-hacking.github.io/tree/main/src/universal/guides/sprite_indexing">Sprite Indexing</a> for more information.</p>
<p>First you want to load the png spritesheet you previously extracted in the graphic editing software of your choice, to either make edits to it or use it as a base for your spritesheet. 
You may also want to enable some kind of grid visualization in order to view the proper position of each frame. In Aseprite you can do so by clicking View&gt;Grid&gt;Grid Settings.</p>
<p>If you're making your own sprite from scratch, remember that all the frames you draw must be in the same position as the ones in the original sprite, otherwise the movement in game will look wrong; for example the following image is not a correct spritesheet since the three walking frames aren't in the same position as the original one:</p>
<p><img src="gen4/guides/field/resources/owsprites/wrongsprite.PNG" alt="" /></p>
<p>Once you're done, you can open the BTX you previously extracted in BTX Editor 2.0 and click import, then import the spritesheet you made, and save the BTX.</p>
<h2 id="replacing-the-sprite-1"><a class="header" href="#replacing-the-sprite-1">Replacing the Sprite</a></h2>
<p>Replacing the sprite simply consists in just clicking the &quot;Change File&quot; button in Tinke on the BTX file you want to replace, and then select the BTX you either extracted or obtained from BTX Editor. Don't forget to <strong>click the Pack button on the narc file</strong> after you've replaced the BTX. Now you can save the ROM.</p>
<p>Just remember that the sprite you're inserting must have the same size and number of frames as the one you're replacing, otherwise you will have to change its properties to get the movement working correctly even if it's the same size. Single-frame sprites with the same dimension as the original won't have the issue however.</p>
<h3 id="unused-sprites-1"><a class="header" href="#unused-sprites-1">Unused Sprites</a></h3>
<p>Adding new overworld sprites would require ASM but luckily there are a number of unused sprites that may be useful to you:</p>
<p><img src="gen4/guides/field/resources/owsprites/unusedsprites.png" alt="" /></p>
<h2 id="changing-the-sprite-properties-1"><a class="header" href="#changing-the-sprite-properties-1">Changing the Sprite Properties</a></h2>
<p>If you've replaced a sprite with one having a different number of frames or a different size, the sprite will either not display correctly in game or not display at all if it has a different size. 
Unless your sprite is only made of one frame and has the same size the original one, you will need to fix this by hex editing each sprite properties. If you haven't already open your ROM in DSPRE so you can easily access the necessary overlay files in the folder created by DSPRE, which will be named <em>YourROMName</em>_DSPRE_Contents/overlay. </p>
<p>All the offsets listed are based on the US version of the ROM and it has not been tested on other versions.</p>
<h3 id="platinum-1"><a class="header" href="#platinum-1">Platinum</a></h3>
<p>In Platinum there are two tables we need to look up for changing sprite properties, both are in Overlay 5.</p>
<p>First we need to find the ID number of the sprite we previously replaced. For my example I'll use the unused Rotom Oven, whose model number is 406, and I have replaced it with a 64x64 Ho-Oh Sprite ripped from HGSS, having two frames:</p>
<p><img src="gen4/guides/field/resources/owsprites/hooh64x64.png" alt="" /></p>
<p>The first table is at 0x2BC34 and will look like this:</p>
<p><img src="gen4/guides/field/resources/owsprites/pt_owtable1.PNG" alt="" /></p>
<p>Each entry is made of 8 bytes, the first 4 in red for the ID number and the latter 4 in blue for the mmodel number. We already know the model number, which in little endian is 96 01, so we just need to search those bytes using HxD search hex values function with the search direction being set to &quot;forward&quot;, then click Search All.
Since my mmodel number is greater than 255, I'll get a single result, being the two bytes corresponding to the model number, the next 2 bytes are going to be 00 00 and the next 4 bytes are the ID number we are looking for, in my case F4 00 00 00.</p>
<p>If your model number was less than or equal to 255, <strong>you need to look at the second result in the results tab</strong>.</p>
<p>With this information we can go to the second table at 0x2CA08, which is structured like this:</p>
<p><img src="gen4/guides/field/resources/owsprites/pt_owtable2.PNG" alt="" /></p>
<p>Each row is an entry, the bytes in the red columns are the ID numbers of each sprites and the bytes in green are the sprite properties. You can scroll down until you see the ID number from the 1st table in the red columns. The bytes you want to edit are right before the ID number, in my case it will be which is a standard 32x32 16 frames NPC.</p>
<p>The bytes you want to replace for this are going to be depending on which Sprite Property you want to have:</p>
<div class="table-wrapper"><table><thead><tr><th>Byte Sequence</th><th>Corresponding Property</th><th>Example</th></tr></thead><tbody>
<tr><td>00 00 00 00 00 00 00 00 C0 B2 1F 02</td><td>32x32 Sprite with 16 frames</td><td>Regular NPCs</td></tr>
<tr><td>05 00 00 00 00 00 00 00 C0 B2 1F 02</td><td>64x64 Sprite with 2 frames</td><td>DPPt larger Legendaries like Palkia and Dialga</td></tr>
<tr><td>0B 00 00 00 15 00 00 00 64 B1 1F 02</td><td>128x64 Sprite with 2 frames</td><td>DPPt Giratina Distortion World sprite</td></tr>
</tbody></table>
</div>
<p>You can paste them with Ctrl+B in the green section of the row shown above. Then, save the overlay and save the ROM from DSPRE. If you have done the process correctly, it will show up in game.
If the two frames are different you can set the OW movement to <em>20-Running Up, Down</em> in DSPRE event editor to have the animation play out costantly.</p>
<h3 id="hgss-1"><a class="header" href="#hgss-1">HGSS</a></h3>
<p>Fortunately in HGSS there is only one table, it's at offset <code>0x21BA8</code> in Overlay 1.
The Overlay 1 needs to be uncompressed, so you either have to use blz to decompress it or apply the <em>Configure Overlay 1 as uncompressed</em> patch from DSPRE's toolbox.
I will be replacing the glitched bulbasaur sprite with a standard 32x32 NPC, so first I need to find the correspondent ID number.
The table will look like this: </p>
<p><img src="gen4/guides/field/resources/owsprites/hgss_owtable.PNG" alt="" /></p>
<p>There are 6 bytes for each entry, with the first two bytes (red) are the Overworld ID, the following two bytes (blue) for the number of the BTX filename in the a/0/8/1 narc, and the last two bytes (green) for the sprite properties.</p>
<p>The glitched Bulbasaur sprite I'm replacing is 1_201.BTX0, so in little endian the filename number I'm looking for is <code>C9 00</code>. We can find the corresponding result by searching those bytes with HxD search function, with search direction set <em>forward</em> and clicking <em>Search All</em>, and we have to look for the 2nd result if it exists (regardless if the number is smaller or greather than 255), which will be at <code>0x22EC4</code> in my case. The bytes I'm looking for are the next two, so at <code>0x22EC6</code>, and you will need to replace them with <code>00 00</code> for the standard 32x32 NPC.</p>
<p>So I will replace the <code>25 4E</code> bytes with <code>00 00</code>. You can save the overlay 1, and then save the ROM in DSPRE. If you did all the steps correctly the sprite you replaced will show up correctly in game.
The other two offsets to fix the remaining bulbasaur glitched sprites (1_202.BTX0 and 1_203.BTX0) are respectively at <code>0x22ECC</code> and <code>0x22ED2</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-new-poké-marts-platinumhgss"><a class="header" href="#adding-new-poké-marts-platinumhgss">Adding New Poké Marts <sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago.</p>
</blockquote>
<p>This is a guide on how to add and display new Poké Marts in Platinum and HGSS.
All offsets mentioned are based on the US version of the ROMs. </p>
<hr />
<h2 id="table-of-contents-2"><a class="header" href="#table-of-contents-2">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#section">Adding a new Poké Mart</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#subsection">Editing Item prices</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#section-2">Displaying the new Poké Mart</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#subsection-2">Using Script Registers</a></li>
</ul>
</li>
</ul>
<h2 id="adding-a-new-poké-mart"><a class="header" href="#adding-a-new-poké-mart">Adding a new Poké Mart</a></h2>
<p>If you haven't already, you'll have to perform the ARM9 expansion since that's were the new Poké Mart(s) will be written to. 
You can do so by clicking &quot;Expand ARM9&quot; in DSPRE toolbox, then go to Unpacked/SynthOverlay in your DSPRE project folder (which will be named ROMname_DSPRE_contents, and will be in the same folder of your ROM) and using your hex editor of choice open either file 0009 if you're on Platinum or 0000 for HGSS.</p>
<p>You can write at whatever offset you want as long as it's empty, I will be writing my Poké Mart at 0x100. You need to sum <code>0x023C8000</code> to this offset, and write it down since you'll need it later to display the mart in game. In my case it will be <code>0x023C8100</code>.</p>
<p>Poké Mart are loaded in the RAM as a list of bytes of the items index numbers, with <code>FF FF</code> at the end of each mart, each item taking up two bytes.
Refer to <a href="https://bulbapedia.bulbagarden.net/wiki/List_of_items_by_index_number_(Generation_IV)">Bulbapedia's list of items by index number</a>. 
Keep in mind the bytes must be written in little endian, so the order of bytes has to be swapped.</p>
<p>In this tutorial I will be adding a Poké Mart that sells Rare Candies and Focus Sashes, their index numbers are respectively <code>0x32</code> and <code>0x113</code>.
So I will be writing <code>32 00 13 01 FF FF</code> at 0x100. Once you've added all your marts and wrote down their offsets you can save the file and close the hex editor.</p>
<h3 id="editing-item-prices"><a class="header" href="#editing-item-prices">Editing item prices</a></h3>
<p>Item prices aren't stored in the Poké Marts, instead they are part of item data, meaning an item will always have the same price regardless of the Poké Mart it's being sold at.
Item data is stored in the narc <code>pl_item_data</code> (Platinum) / <code>a/0/1/7</code> (HGSS). The file you're looking will have the item index number as its name.</p>
<p>The price is stored in the first two bytes in each file, so for example if I want to have Rare Candyies to be sold at 10,000 Pokèdollars (<code>0x2710</code>), I will have to extract 50.bin and change the first two bytes to <code>10 27</code>. Once you've reinserted the file remember to pack the narc before saving the ROM!</p>
<h2 id="displaying-the-new-poké-mart"><a class="header" href="#displaying-the-new-poké-mart">Displaying the new Poké Mart</a></h2>
<p>The easiest way new Poké Marts can be displayed (without overwriting existing ones) is by using a script to change the pointer of an existing Poké Mart trough the <code>AdrsValueSet</code> command, normally accessing the Poké Mart, and once you're done changing the pointer back.
I'll use the offset of <code>SpMartScreen 0</code>, the pointer normally being <code>0x020EB978</code> (Platinum) / <code>020FBA54</code> (HGSS) and is found at <code>0x02100B1C</code> (Platinum) / <code>0x0210FA3C</code> (HGSS) in the RAM.
Since I'm using HGSS, the relevant part of my script will look like this:</p>
<pre><code>AdrsValueSet 0x0210FA3C 0x00
AdrsValueSet 0x0210FA3D 0x81
AdrsValueSet 0x0210FA3E 0x3C
SpMartScreen 0
AdrsValueSet 0x0210FA3C 0x54
AdrsValueSet 0x0210FA3D 0xBA
AdrsValueSet 0x0210FA3E 0x0F
</code></pre>
<p>The first three commands change the original pointer to the new one in the synthetic overlay, then the Mart is opened like normal with <code>SpMartScreen 0</code>, and with the last three commands the original pointer is restored. Only 3 bytes are changed instead of 4 since RAM offsets always start with 02. Again the pointers are written in little endian, so <code>0x023C8100</code> will look like <code>00 81 3C 02</code> in the RAM.
You can save the script and test the game now.
Note that in Platinum the pointer will have to be changed back to <code>0x20EB978</code> instead.
This is what my full script 19 looks like, I assigned it to a NPC which will show the new Pokè Mart when talked to:</p>
<p><img src="gen4/guides/field/resources/pt_hgss-pokemarts/pokemart_script1.PNG" alt="" /></p>
<h3 id="using-script-registers"><a class="header" href="#using-script-registers">Using Script Registers</a></h3>
<p>To avoid using the AdrsValueSet three times in a row, it's possible to do the same process using the script register commands <code>RegDataSet</code> and <code>AdrsRegSet</code>, so that my earlier script will instead look like this:</p>
<pre><code>RegDataSet 0 0x023C8100
AdrsRegSet 0x0210FA3C 0
SpMartScreen 0
RegDataSet 0 0x020FBA54
AdrsRegSet 0x0210FA3C 0
</code></pre>
<p>The only caveat is that the script is normally &quot;broken&quot; and only writes one byte into memory, so to fix it you have to hex edit the arm9 at <code>0x3F7CA</code> (Platinum) / <code>0x40996</code> (HGSS) and change <code>01 70</code> to <code>01 60</code>. Thanks to AdAstra for having looked into this issue.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-the-weather-from-a-script-platinumhgss"><a class="header" href="#setting-the-weather-from-a-script-platinumhgss">Setting the Weather From a Script <sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This tutorial was written by <a href="https://www.romhacking.net/community/6532/">RefinedPlat</a></p>
</blockquote>
<p>The goal of this tutorial is to use <code>AdrsValueSet</code> to alter a value related to the <code>DefogAnimation/FlashAnimation</code> command to make it update to an arbitrary weather of the scripter's choice.</p>
<p>First off, have a bit of context. Technically, the Generation 4 games have a command dubbed <code>ChangeWeather</code> that would alter the weather currently loaded by the area. Sadly, this command is dummied out, and will not work. However, the games do feature a pair of commands that set the weather to a specific value - <code>DefogAnimation</code><sup><em>Platinum</em></sup> and <code>FlashAnimation</code><sup><em>Heartgold</em></sup>. This, combined with a debug command called <code>AdrsValueSet</code> which allows for free editing of values in the RAM, means that these commands can be altered to change the weather to entirely different values, allowing for free control over the weather within a script with certain caveats.</p>
<blockquote>
<p>The following scripts change the weather <code>Defog</code><sup><em>Platinum</em></sup> or <code>Flash</code><sup><em>Heartgold</em></sup> set to your desired value. It then runs the <code>DefogAnimation</code>/<code>FlashAnimation</code> command to update the weather, and afterwards reverts the weather back to normal and finally sets it back to <code>0x0</code>/<code>0xC</code> so Defog/Flash work properly after the fact. This affects both in-battle and overworld weather. Obviously, if the default weather in an area is different, you'll have to make another <code>AdrsValueSet</code> to change it to that weather before setting the changed value back to default.
By doing a <code>TrainerBattle</code> command after triggering the shift, and then doing a <code>DefogAnimation</code> right afterwards, you can set weather for the duration of a battle and turn it off afterwards.</p>
<blockquote>
<p>Note that this does not show any unique animation or sound effect, and only updates the weather.</p>
</blockquote>
</blockquote>
<p>Keep in mind that the default value for Defog weather is 0x0 while Flash weather is 0xC.</p>
<hr />
<h2 id="important-limitations"><a class="header" href="#important-limitations">Important limitations:</a></h2>
<ul>
<li>You cannot run <code>FlashAnimation</code> or <code>DefogAnimation</code> in a Level Script while in a loading zone. This generates a null reference pointer and causes the game to crash on real hardware.
<ul>
<li>This basically means any screen transitions where you fade to black are off-limits, but ones where you simply move across the same matrix are okay. This includes very few areas in vanilla, however.</li>
</ul>
</li>
<li>Certain weather particles are on the same layer as the battle intro nametags. Consequently, having sandstorm weather when fighting Bertha will make her name move with the particles. This is how weather works in general and not specific to this tutorial.</li>
</ul>
<p>The <code>AdrsValueSet</code> value you want to change depends on the game and region. It uses absolute offsets within the RAM, so if you have changed the arm9's length you may need to find it again. Here is how to find the offsets of the values that this tutorial uses:</p>
<ul>
<li>
<p>Platinum:</p>
<ul>
<li><code>70 BD 38 B5 04 1C XX XX XX XX C0 68 F7 F7 XX XX XX XX 00 21 XX XX XX XX 28 1C F7 F7 BC FD 80 34 01 1C 20 68 40 68 C0 68 XX XX XX XX 01 20 38 BD</code></li>
</ul>
</li>
<li>
<p>Heart Gold: </p>
<ul>
<li><code>70 BD 38 B5 04 1C XX XX XX XX C0 68 F8 F7 XX XX XX XX 0C 21 XX XX XX XX 28 1C F8 F7 52 F9 80 34 01 1C 20 68 40 68 C0 68 XX XX XX XX 01 20 38 BD</code></li>
</ul>
</li>
</ul>
<p><br><br></p>
<p>For this tutorial there are a few offsets used: </p>
<ul>
<li>USA Platinum uses <code>0x2042BF8</code></li>
<li>USA Heartgold uses <code>0x20436D4</code></li>
</ul>
<details>
  <summary> Sample Script 1 - USA Platinum, Set Weather </summary>
<pre><code class="language-asm">Script 1:
	AdrsValueSet 0x2042BF8 0x##
	DefogAnimation
	AdrsValueSet 0x2042BF8 0x0
End
</code></pre>
</details>
<details>
  <summary> Sample Script 2 - USA Heartgold, Set Low Light </summary>
<pre><code class="language-asm">Script 1:
	AdrsValueSet 0x20436D4 0xD
	FlashAnimation
	AdrsValueSet 0x20436D4 0xC
End
</code></pre>
</details>
<details>
  <summary> Sample Script 3 - USA Heartgold, Temporary Weather</summary>
<pre><code class="language-asm">Script 2:
  AdrsValueSet 0x20436D4 0x##
	FlashAnimation
	AdrsValueSet 0x20436D4 0x0
	[Script Contents]
	FlashAnimation
	AdrsValueSet 0x20436D4 0xC
End
</code></pre>
</details>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-make-tms-reusableplatinumhgss"><a class="header" href="#how-to-make-tms-reusableplatinumhgss">How to make TMs Reusable<sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This guide was originally written by Drayano and formatted for this wiki by SpagoAsparago.</p>
</blockquote>
<blockquote>
<p>The Research was made by Mikelan98 with help from NextWorld and Bagboy.
Mikelan98 has requested that you give credit to him if you implement this in your hack.</p>
</blockquote>
<p>This is a guide on how to implement reusable TMs in Platinum and HGSS. The US versions of those games are used, so offsets may be not be the same if you're using a different version.</p>
<p>The tools required are an hex editor and Tinke 0.9.2, or instead CrystalTile2 if you're using HGSS.</p>
<hr />
<h2 id="table-of-contents-3"><a class="header" href="#table-of-contents-3">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#section">Extracting the files</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-1">Platinum</a></li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-2">HGSS</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#section-2">Hex Editing</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-1">Making TMs infinte</a></li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-2">Removing the TM item count</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#section-3">Reinserting the files</a></li>
</ul>
<h2 id="extracting-the-files"><a class="header" href="#extracting-the-files">Extracting the files</a></h2>
<p>First you need to extract the relative files in order to perform the hex editing</p>
<h3 id="platinum-2"><a class="header" href="#platinum-2">Platinum</a></h3>
<p>For Platinum the files you need are <em>arm9.bin</em> and <em>overaly9_84</em>.</p>
<p>Open your ROM in Tinke, search the file, select it and click the extract button.</p>
<h3 id="hgss-2"><a class="header" href="#hgss-2">HGSS</a></h3>
<p>For HGSS you need to extract <em>arm9.bin</em> and <em>overlay_0015.bin</em>, but they are compressed unlike in Platinum hence the need for CystalTile2.
Open CrystalTile2 and then select File&gt;Open and select your ROM. Then click the NDS icon in the top bar, which should open a window called <em>NDS filesystem information</em>:</p>
<p><img src="gen4/guides/field/resources/pt_hgss-reusabletms/tms_ct2screen.PNG" alt="" /></p>
<p>Select the file you want to export, right click and click <em>Extract (U)</em>, and save it somewhere.
You can also use the arm9.bin from your DSPRE project folder, which is already uncompressed.</p>
<h2 id="hex-editing"><a class="header" href="#hex-editing">Hex Editing</a></h2>
<p>Load the files you extracted in a hex editor, then change the bytes according to the following steps, then save the files.</p>
<h3 id="making-tms-infinite"><a class="header" href="#making-tms-infinite">Making TMs infinite</a></h3>
<ul>
<li>For Platinum, at offset <code>0x865EB</code> in the arm9.bin change <code>D1</code> to <code>E0</code></li>
<li>For HGSS, at <code>0x825A7</code> in the arm9.bin change <code>D1</code> to <code>E0</code> </li>
</ul>
<h3 id="removing-the-tm-item-count"><a class="header" href="#removing-the-tm-item-count">Removing the TM item count</a></h3>
<ul>
<li>For Platinum, at <code>0x4372</code> in overlay 84 change <code>FF F7 83 FF</code> to <code>00 00 00 00</code></li>
<li>For HGSS,  at <code>0x6239</code> in overlay 15 change <code>D3</code> to <code>E0</code></li>
</ul>
<h2 id="reinserting-the-files"><a class="header" href="#reinserting-the-files">Reinserting the files</a></h2>
<ul>
<li>
<p>For Platinum just open your ROM in Tinke again, search the files you previously extracted, select them and click the <em>Change File</em> button to replace them with the ones you hex edited. Then save the ROM.</p>
</li>
<li>
<p>For HGSS, in the NDS filesystem information window, you can select the files you previously extracted, right click and this time click <em>Compression</em> and select your own hex edited files. If you're using the arm9 from DSPRE project folder, you only need to click <em>Import</em> instead. After you're done you can use <code>File&gt;Build ROM...</code> to save your ROM.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reusable-repelplatinum"><a class="header" href="#reusable-repelplatinum">Reusable Repel<sup><em>(Platinum)</em></sup></a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago. Credits to BluRose for helping with the ASM and to brahulus for the Repel AR Code.</p>
</blockquote>
<p>This is a tutorial on how to implement the reusable repel in Platinum.
When the repel runs out, a prompt will appear, from which the player can choose to use another repel:</p>
<p><img src="gen4/guides/field/resources/pt_reusable_repel/pt_reusable_repel.png" alt="" /></p>
<p>The options only appear if the player has the appropriate repel item(s) in the bag</p>
<p>You'll need to use <a href="https://github.com/AdAstra-LD/DS-Pokemon-Rom-Editor/releases">DSPRE</a> and a Hex Editor. If you don't know how to hex edit, check out the <a href="gen4/guides/field/../../../universal/guides/hex_editing/hex_editing.html">Hex Editing Guide</a></p>
<p>This <strong>only works on the US Version of the game</strong>. Attempting to replace the same bytes on a different language game will not work.</p>
<hr />
<h2 id="table-of-contents-4"><a class="header" href="#table-of-contents-4">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/pt_reusable_repel.html#section">DSPRE</a>
<ul>
<li><a href="gen4/guides/field/pt_reusable_repel.html#subsection">Scripting</a></li>
<li><a href="gen4/guides/field/pt_reusable_repel.html#subsection-1">Text</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/pt_reusable_repel.html#section-2">Hex Editing</a></li>
</ul>
<h2 id="dspre"><a class="header" href="#dspre">DSPRE</a></h2>
<p>If you don't have one already, create a new project by loading your ROM in DSPRE. Then go to the <em>Scripting</em> tab.</p>
<h3 id="scripting"><a class="header" href="#scripting">Scripting</a></h3>
<p>Go to <code>Script 33</code> replace it with the following:</p>
<details>
<summary>Script 33</summary>
<pre><code>Script 33:
	PlayFanfare 1500
	LockAll 
  CheckPlayerHasItem 79 1 0x800C
	CompareVarValue 0x800C 1
	JumpIf EQUAL Function#177
	CheckPlayerHasItem 76 1 0x800C
	CompareVarValue 0x800C 1
	JumpIf EQUAL Function#177
	CheckPlayerHasItem 77 1 0x800C
	CompareVarValue 0x800C 1
	JumpIf EQUAL Function#177
	Message 79
	WaitAB 
	CloseMessage 
	ReleaseAll 
End 
</code></pre>
</details>
<p>Next go to the <em>Functions</em> tab and add the following functions. If the functions 177+ already exist, adjust the new function IDs accordingly so that no functions are replaced.</p>
<details>
<summary>Functions</summary>
<pre><code>Function 177:
  Message 75
	YesNoBox 0x800C
	CompareVarValue 0x800C 0
	JumpIf EQUAL Function#178
	CloseMessage 
	ReleaseAll 
End
 
Function 178:
  CloseMessage 
	MultiStandardText 1 1 0 1 0x800C
	CheckPlayerHasItem 79 1 0x8000
	CompareVarValue 0x8000 1
	CallIf EQUAL Function#179
	CheckPlayerHasItem 76 1 0x8000
	CompareVarValue 0x8000 1
	CallIf EQUAL Function#180
	CheckPlayerHasItem 77 1 0x8000
	CompareVarValue 0x8000 1
	CallIf EQUAL Function#181
	ShowMulti 
	CompareVarValue 0x800C 0
	JumpIf EQUAL Function#182
	CompareVarValue 0x800C 1
	JumpIf EQUAL Function#183
	CompareVarValue 0x800C 2
	JumpIf EQUAL Function#184
	ReleaseAll 
End
 
Function 179:
    AddMultiOption 30 0
Return
 
Function 180:
    AddMultiOption 31 1
Return
 
Function 181:
    AddMultiOption 32 2
Return
 
Function 182:
  AdrsValueSet 0x023DFF28 100
	DummyTakeTrap 
  TakeItem 79 1 0x8000
	TextPlayerName 0
	TextItem 1 79
	Message 72
	WaitButton 
	CloseMessage
Return
 
Function 183:
    AdrsValueSet 0x023DFF28 150
	DummyTakeTrap 
    TakeItem 76 1 0x8000
	TextPlayerName 0
	TextItem 1 76
	Message 72
	WaitButton 
	CloseMessage
Return
 
Function 184:
  AdrsValueSet 0x023DFF28 250
	DummyTakeTrap 
  TakeItem 77 1 0x8000
	TextPlayerName 0
	TextItem 1 77
	Message 72
	WaitButton 
	CloseMessage 
Return
</code></pre>
</details>
<p>Save the script file.</p>
<h3 id="text"><a class="header" href="#text">Text</a></h3>
<p>Go to the <em>Text Editor</em> tab. Remember to save each Text Archive before moving on to the next one.</p>
<ul>
<li>Open <code>Text Archive 361</code>, and replace messages 30, 31 and 32 respectively with:
<ul>
<li>Repel</li>
<li>Super Repel</li>
<li>Max Repel</li>
</ul>
</li>
<li>Open <code>Text Archive 213</code>, and replace message 72 with:
<ul>
<li><em>Repel’s effect wore off...\nWould you like to use another one?</em></li>
</ul>
</li>
<li>Open <code>Text Archive 213</code>, and replace message 75 with:
<ul>
<li><em>\v0103ぁ\x0000\x0000 used the\n\v0108ぁ\x0001\x0000.\rWild Pokémon will be repelled.</em></li>
</ul>
</li>
</ul>
<h2 id="hex-editing-1"><a class="header" href="#hex-editing-1">Hex Editing</a></h2>
<p>If you haven't already, you need to expand the arm9 trough DSPRE's ROM Toolbox. You can do so by clicking the Explorer Kit Icon in the top bar and applying the <em>ARM9 Expansion</em> patch.</p>
<p>In the folder where your ROM is located, DSPRE should have created a folder name yourROMname_DSPRE_Contents. Inside that you'll find a file called <code>arm9.bin</code>, open it in your hex editor of choice.</p>
<p>Go to the offset <code>0x4EAE8</code> and replace all the bytes from this offset with the following sequence:</p>
<pre><code>0B 48 01 68 0B 48 09 18 0B 48 02 78 0A 70 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 70 47 40 1D 10 02 87 80 00 00 28 FF 3D 02
</code></pre>
<p>Do <strong>not</strong> add new bytes. In HxD you can paste without replacing with the Ctrl+B shortcut. Save the file.</p>
<p>Now you can load DSPRE again and save the ROM. Remember to <strong>not</strong> re-extract the contents, otherwise your hex editing will be lost!</p>
<p>The custom command works by setting the repel counter at the byte written at 15FEE in weather_sys_9.bin, so remember to don't write anything at this offset!</p>
<details>
 <summary>Detailed Explanation for the Custom Command and Repel Counter</summary>
<p>The repel counter is a dynamic offset located at (Address at 0x02101D40) + (0x8087). This is only valid for the US version, hence my code won't work on other regionswithout writing a new custom command.</p>
<p>When the repel counter runs out, the game will automatically execut Script 33 in Script File 211. </p>
<p>After the scripting and hex edits performed, now Script 33 will:</p>
<ol>
<li>Check if the player has any repel item in their bag</li>
<li>If they do, ask if they wants to use anothe repel</li>
<li>If they want to, create a popup window containing all the available repel items</li>
<li>Remove the repel item that has been chosen from the bag</li>
<li>Use the <code>AdrsValueSet</code> command to write a byte at the offset 0x023DFF28, containing the number of steps of the selected repel</li>
<li>Trough the <code>DummyTakeTrap</code>, the repel counter is increased by the previously set value</li>
</ol>
<p>The <code>DummyTakeTrap</code> command is otherwise unused, so it's been replaced with a custom one in order to access the dynamic offset of the repel counter, and set the counter to the new value. 
This is the raw assembly code:</p>
<details>
 <summary>ASM Code</summary>
<pre><code>ldr r0, =0x02101D40
ldr r1, [r0]
ldr r0, =0x8087
add r1, r0
ldr r0, =0x023DDFEE
ldrb r2, [r0]
strb r2, [r1]
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
bx lr
</code></pre>
</details>
This part of the code:
<pre><code>ldr r0, =0x02101D40
ldr r1, [r0]
ldr r0, =0x8087
add r1, r0
</code></pre>
<p>Is used to calculate the dynamic offset by loading the address at 0x2101D40 and then adding 0x8087 to it, storing the repel counter offset in the R1 register.</p>
<p>The following part:</p>
<pre><code>ldr r0, =0x023DDFEE
ldrb r2, [r0]
strb r2, [r1]
</code></pre>
<p>Is used to read the byte previously written at 0x023DDFEE by the <code>AdrsValueSet</code> command, and updating the repel counter with it.
The 0x023DDFEE offset is at a region in the RAM otherwise unused, but costantly loaded trough the syntehtic overlay.</p>
<p>The remaining <code>nop</code> commands are there to maintain the original command dimension and prevent the script command table from being read incorrectly.</p>
</details>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-change-the-hp-bar-speedplatinumhgss"><a class="header" href="#how-to-change-the-hp-bar-speedplatinumhgss">How to change the HP Bar speed<sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This guide was written by AdAstra, formatted for this wiki by SpagoAsparago.
Research: AdAstra, Mikelan98 and Nitram</p>
</blockquote>
<p>This is a tutorial on how to change the HP Bar speed in gen 4 games.</p>
<hr />
<h2 id="table-of-contents-5"><a class="header" href="#table-of-contents-5">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#section">Cy's Hex Macros</a></li>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#section-2">Hex Editing</a>
<ul>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#subsection">Extracting the files</a></li>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#subsection-1">Changing the Speed</a></li>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#subsection-2">Reinserting the files</a></li>
</ul>
</li>
</ul>
<h2 id="cys-hex-macros"><a class="header" href="#cys-hex-macros">Cy's Hex Macros</a></h2>
<p>For Platinum, if 2x speed is enough for your needs, you can use <a href="https://github.com/dev-cyw/Cy-s-Hex-Macros/releases/tag/v1.2">Cy's Hex Macros</a>.</p>
<p>Run the program and select the arm9.bin in your DSPRE's extracted folder, then click the appropriate button. 
When you load your project in DSPRE in order to export the ROM, remember to <strong>not</strong> re-extract it.</p>
<h2 id="hex-editing-2"><a class="header" href="#hex-editing-2">Hex Editing</a></h2>
<p>If you're using HGSS or want a different speed for Platinum, you need to hex edit the appropriate files. All offsets provided are based on the US ROM(s) and might be different on another version.</p>
<h3 id="extracting-the-files-1"><a class="header" href="#extracting-the-files-1">Extracting the files</a></h3>
<ul>
<li>
<p>Platinum:
Since Platinum overlays aren't compressed, you can just use the <em>overlay_0016.bin</em> file in the <em>YourROMNAme_DSPRE_contents/overlay</em> folder generated by DSPRE. Alternatively you can extract it with Tinke by searching <em>verlay_9_16</em> and clicking <em>Extract</em>.</p>
</li>
<li>
<p>HGSS:
HGSS overlays are compressed instead, so you can use CrystalTile2 to extract them already decompressed.
After you've loaded your ROM, click the NDS icon in the top bar, it should open a window called <em>NDS filesystem information</em>. From there, select <em>overlay_0022.bin</em>, right click and select <em>Extract (U)</em></p>
</li>
</ul>
<h3 id="changing-the-speed"><a class="header" href="#changing-the-speed">Changing the Speed</a></h3>
<p>Open the overlay in a hex editor, then go to the following offset:</p>
<ul>
<li>HGSS: <code>0x2E17A</code></li>
<li>Platinum: <code>0x2D046</code></li>
</ul>
<p>Then, replace the bytes at this offset with the following sequence, depending on the speed you want to have:</p>
<details> 
 <summary>HGSS</summary>
<div class="table-wrapper"><table><thead><tr><th>Byte Sequence</th><th>Speed</th></tr></thead><tbody>
<tr><td>80 01</td><td>x0.25</td></tr>
<tr><td>C0 01</td><td>x0.5</td></tr>
<tr><td>40 02</td><td>x2</td></tr>
<tr><td>80 02</td><td>x4</td></tr>
<tr><td>C0 02</td><td>x8</td></tr>
</tbody></table>
</div>
<p>If you want a speed that is not listed above:</p>
<details> 
 <summary>HGSS - Custom Speed</summary>
<ol>
<li>You'll need to use either <a href="https://shell-storm.org/online/Online-Assembler-and-Disassembler/">Shell-storm online assembler and disassembler</a> or an assembler like <a href="https://github.com/Kingcom/armips">Armips</a></li>
<li>Assemble the instruction <code>LSLS R0, R0, #yourNumber</code>, with the default <code>#yourNumber</code> being 8, which means the base speed is <code>2^8 = 256</code>.</li>
<li>Paste the assembled bytes in the overlay</li>
</ol>
</details>
</details>
<details> 
 <summary>Platinum</summary>
<div class="table-wrapper"><table><thead><tr><th>Byte Sequence</th><th>Speed</th></tr></thead><tbody>
<tr><td>88 1E</td><td>x2</td></tr>
<tr><td>C8 1E</td><td>x3</td></tr>
<tr><td>08 1F</td><td>x4</td></tr>
<tr><td>48 1F</td><td>x5</td></tr>
<tr><td>88 1F</td><td>x6</td></tr>
<tr><td>C8 1F</td><td>x7</td></tr>
</tbody></table>
</div></details>
<p>If you want to fine-tune the speed Animation:</p>
<details><summary>How to fine-tune the speed Animation (HGSS only):</summary>
<ol>
<li>
<p>If you haven't already, you need to expand the arm9 using DSPRE's toolbox</p>
</li>
<li>
<p>Paste this at 0x14FF0 of your synthetic overlay file:</p>
</li>
</ol>
<pre><code>2D 2D 48 50 20 42 41 52 20 53 50 45 45 44 2D 2D 
80 21 49 00 48 43 11 1C 70 47 C0 46 FF FF FF FF
</code></pre>
<ul>
<li>
<p>The first byte of the second row (default is <code>0x80</code>) represents the speed &quot;fine control&quot;.</p>
</li>
<li>
<p><code>80 21 49 00</code> means the speed is 128*2 = 256. [x1]</p>
</li>
<li>
<p><code>A0 21 49 00</code> means the speed is 160*2 = 320. [x1.25]</p>
</li>
<li>
<p><code>C0 21 49 00</code> means the speed is 192*2 = 384. [x1.5]</p>
</li>
<li>
<p>...up to <code>FF 21 49 00</code>, which means the speed is 255*2 = 510. [x1.9921]</p>
</li>
<li>
<p>The third byte of the second row (default is <code>0x49</code>) acts as a cumulative multiplier, or &quot;coarse control&quot;. </p>
</li>
<li>
<p>Increasing that value will allow you to set the speed even higher.</p>
</li>
<li>
<p><code>60 21 89 00</code> means the speed is 96*4 = 384. [x1.5]</p>
</li>
<li>
<p><code>80 21 89 00</code> means the speed is 128*4 = 512. [x2]</p>
</li>
<li>
<p><code>EC 21 89 00</code> means the speed is 236*4 = 944. [x3.6875]</p>
</li>
<li>
<p>...up to <code>FF 21 89 00</code>, which means the speed is 255*4 = 1020. [x3.9843]</p>
</li>
</ul>
<ol start="3">
<li>Paste <code>77 F1 D1 FA</code> at <code>0x2E17A</code> offset of uncompressed overlay12.</li>
</ol>
</details>
<h3 id="reinserting-the-files-1"><a class="header" href="#reinserting-the-files-1">Reinserting the files</a></h3>
<ul>
<li>For Platinum, if you edited the overlay in DSPRE's content folder, just load your ROM in DSPRE and export it. Remember to <strong>not</strong> re-extract the contents. If you extracted the overlay with Tinke, just do the same steps you did for extracting it, but this time use the <em>Change File</em> button and select your extracted overlay you modified.</li>
<li>For HGSS, in CrystalTile's NDS filesystem information window, you can select the overlay you previously extracted, right click and this time click <em>Compression</em>, then select your own hex edited overlay. After you're done you can use <code>File&gt;Build ROM...</code> to save your ROM.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overworld-sprite-replacement-guide-2"><a class="header" href="#overworld-sprite-replacement-guide-2">Overworld Sprite Replacement Guide</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago. Credits to the <a href="https://docs.google.com/document/d/1_nRfhDEoNFbvYP-yjx4oAWmgGXxvqFBvLwYANFehxUU/edit">Known Sprite Locations document</a> and BagBoy for the OW tables research.</p>
</blockquote>
<p>This is a guide on how to extract, replace, change the properties and make your own overworld sprites.
The necessary tools are Tinke 0.9.2 and BTX Editor 2.0</p>
<p>In addition for the Sprite Properties section you will need DSPRE and an Hex Editor like HxD as well.</p>
<hr />
<h2 id="table-of-contents-6"><a class="header" href="#table-of-contents-6">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/owsprites.html#section">Extracting the Sprite</a></li>
<li><a href="gen4/guides/field/owsprites.html#section-2">Making your own Sprite</a></li>
<li><a href="gen4/guides/field/owsprites.html#section-3">Replacing</a>
<ul>
<li><a href="gen4/guides/field/owsprites.html#subsection">Unused Sprites</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/owsprites.html#section-4">Changing the Sprite Properties</a>
<ul>
<li><a href="gen4/guides/field/owsprites.html#subsection-2">Platinum</a></li>
<li><a href="gen4/guides/field/owsprites.html#subsection-3">HGSS</a></li>
</ul>
</li>
</ul>
<h2 id="extracting-the-sprite-2"><a class="header" href="#extracting-the-sprite-2">Extracting the Sprite</a></h2>
<p>Overworld sprites are contained in BTX files, start by opening your ROM with Tinke and then navigating to the following filepath depending on your game:</p>
<ul>
<li><strong>DPPt</strong>: mmodel/mmodel.narc</li>
<li><strong>HGSS</strong>: a/0/8/1</li>
</ul>
<p>Once you've navigated to this directory in Tinke, select the narc file and click unpack to see see all the BTX files. 
You can select one and click the &quot;View&quot; button to see the spritesheet. Select the one you want to replace and click Extract, so that you will obtain the BTX file.</p>
<p><img src="gen4/guides/field/resources/owsprites/tinke.PNG" alt="" /></p>
<p>You can load this file in the BTX Editor 2.0 to either extract the spritesheet itself in a .png format or import your own spritesheet.</p>
<p><img src="gen4/guides/field/resources/owsprites/btxeditor.PNG" alt="" /></p>
<details>
 <summary>Where to find all Player Character Sprites.</summary>
 <p>
   Diamond and Pearl
   Lucas:
		90 - Walking/Running
		92 - Bike
		155 - Pull out Pokeball
		157 - Water flower
		159 - Surf
164 - Tux
166 - Fishing
363 - Aerobics
365 - Save
367 - Pokecenter
<p>Heroine:
91 - Walking/Running
93 - Bike
156 - Pull out Pokeball
158 - Water flower
160 - Surf
165 - Dress
167 - Fishing
364 - Aerobics
366 - Save
368 - Pokecenter</p>
</p>
</details>
<h2 id="making-your-own-sprite-2"><a class="header" href="#making-your-own-sprite-2">Making your own Sprite</a></h2>
<p>Before proceeding you should be familiar with Sprite Indexing, as all the sprites must have at most 16 color, with the background color being indexed to the first slot of the palette.
See <a href="gen4/guides/field/kingdom-of-ds-hacking.github.io/tree/main/src/universal/guides/sprite_indexing">Sprite Indexing</a> for more information.</p>
<p>First you want to load the png spritesheet you previously extracted in the graphic editing software of your choice, to either make edits to it or use it as a base for your spritesheet. 
You may also want to enable some kind of grid visualization in order to view the proper position of each frame. In Aseprite you can do so by clicking View&gt;Grid&gt;Grid Settings.</p>
<p>If you're making your own sprite from scratch, remember that all the frames you draw must be in the same position as the ones in the original sprite, otherwise the movement in game will look wrong; for example the following image is not a correct spritesheet since the three walking frames aren't in the same position as the original one:</p>
<p><img src="gen4/guides/field/resources/owsprites/wrongsprite.PNG" alt="" /></p>
<p>Once you're done, you can open the BTX you previously extracted in BTX Editor 2.0 and click import, then import the spritesheet you made, and save the BTX.</p>
<h2 id="replacing-the-sprite-2"><a class="header" href="#replacing-the-sprite-2">Replacing the Sprite</a></h2>
<p>Replacing the sprite simply consists in just clicking the &quot;Change File&quot; button in Tinke on the BTX file you want to replace, and then select the BTX you either extracted or obtained from BTX Editor. Don't forget to <strong>click the Pack button on the narc file</strong> after you've replaced the BTX. Now you can save the ROM.</p>
<p>Just remember that the sprite you're inserting must have the same size and number of frames as the one you're replacing, otherwise you will have to change its properties to get the movement working correctly even if it's the same size. Single-frame sprites with the same dimension as the original won't have the issue however.</p>
<h3 id="unused-sprites-2"><a class="header" href="#unused-sprites-2">Unused Sprites</a></h3>
<p>Adding new overworld sprites would require ASM but luckily there are a number of unused sprites that may be useful to you:</p>
<p><img src="gen4/guides/field/resources/owsprites/unusedsprites.png" alt="" /></p>
<h2 id="changing-the-sprite-properties-2"><a class="header" href="#changing-the-sprite-properties-2">Changing the Sprite Properties</a></h2>
<p>If you've replaced a sprite with one having a different number of frames or a different size, the sprite will either not display correctly in game or not display at all if it has a different size. 
Unless your sprite is only made of one frame and has the same size the original one, you will need to fix this by hex editing each sprite properties. If you haven't already open your ROM in DSPRE so you can easily access the necessary overlay files in the folder created by DSPRE, which will be named <em>YourROMName</em>_DSPRE_Contents/overlay. </p>
<p>All the offsets listed are based on the US version of the ROM and it has not been tested on other versions.</p>
<h3 id="platinum-3"><a class="header" href="#platinum-3">Platinum</a></h3>
<p>In Platinum there are two tables we need to look up for changing sprite properties, both are in Overlay 5.</p>
<p>First we need to find the ID number of the sprite we previously replaced. For my example I'll use the unused Rotom Oven, whose model number is 406, and I have replaced it with a 64x64 Ho-Oh Sprite ripped from HGSS, having two frames:</p>
<p><img src="gen4/guides/field/resources/owsprites/hooh64x64.png" alt="" /></p>
<p>The first table is at 0x2BC34 and will look like this:</p>
<p><img src="gen4/guides/field/resources/owsprites/pt_owtable1.PNG" alt="" /></p>
<p>Each entry is made of 8 bytes, the first 4 in red for the ID number and the latter 4 in blue for the mmodel number. We already know the model number, which in little endian is 96 01, so we just need to search those bytes using HxD search hex values function with the search direction being set to &quot;forward&quot;, then click Search All.
Since my mmodel number is greater than 255, I'll get a single result, being the two bytes corresponding to the model number, the next 2 bytes are going to be 00 00 and the next 4 bytes are the ID number we are looking for, in my case F4 00 00 00.</p>
<p>If your model number was less than or equal to 255, <strong>you need to look at the second result in the results tab</strong>.</p>
<p>With this information we can go to the second table at 0x2CA08, which is structured like this:</p>
<p><img src="gen4/guides/field/resources/owsprites/pt_owtable2.PNG" alt="" /></p>
<p>Each row is an entry, the bytes in the red columns are the ID numbers of each sprites and the bytes in green are the sprite properties. You can scroll down until you see the ID number from the 1st table in the red columns. The bytes you want to edit are right before the ID number, in my case it will be which is a standard 32x32 16 frames NPC.</p>
<p>The bytes you want to replace for this are going to be depending on which Sprite Property you want to have:</p>
<div class="table-wrapper"><table><thead><tr><th>Byte Sequence</th><th>Corresponding Property</th><th>Example</th></tr></thead><tbody>
<tr><td>00 00 00 00 00 00 00 00 C0 B2 1F 02</td><td>32x32 Sprite with 16 frames</td><td>Regular NPCs</td></tr>
<tr><td>05 00 00 00 00 00 00 00 C0 B2 1F 02</td><td>64x64 Sprite with 2 frames</td><td>DPPt larger Legendaries like Palkia and Dialga</td></tr>
<tr><td>0B 00 00 00 15 00 00 00 64 B1 1F 02</td><td>128x64 Sprite with 2 frames</td><td>DPPt Giratina Distortion World sprite</td></tr>
</tbody></table>
</div>
<p>You can paste them with Ctrl+B in the green section of the row shown above. Then, save the overlay and save the ROM from DSPRE. If you have done the process correctly, it will show up in game.
If the two frames are different you can set the OW movement to <em>20-Running Up, Down</em> in DSPRE event editor to have the animation play out costantly.</p>
<h3 id="hgss-3"><a class="header" href="#hgss-3">HGSS</a></h3>
<p>Fortunately in HGSS there is only one table, it's at offset <code>0x21BA8</code> in Overlay 1.
The Overlay 1 needs to be uncompressed, so you either have to use blz to decompress it or apply the <em>Configure Overlay 1 as uncompressed</em> patch from DSPRE's toolbox.
I will be replacing the glitched bulbasaur sprite with a standard 32x32 NPC, so first I need to find the correspondent ID number.
The table will look like this: </p>
<p><img src="gen4/guides/field/resources/owsprites/hgss_owtable.PNG" alt="" /></p>
<p>There are 6 bytes for each entry, with the first two bytes (red) are the Overworld ID, the following two bytes (blue) for the number of the BTX filename in the a/0/8/1 narc, and the last two bytes (green) for the sprite properties.</p>
<p>The glitched Bulbasaur sprite I'm replacing is 1_201.BTX0, so in little endian the filename number I'm looking for is <code>C9 00</code>. We can find the corresponding result by searching those bytes with HxD search function, with search direction set <em>forward</em> and clicking <em>Search All</em>, and we have to look for the 2nd result if it exists (regardless if the number is smaller or greather than 255), which will be at <code>0x22EC4</code> in my case. The bytes I'm looking for are the next two, so at <code>0x22EC6</code>, and you will need to replace them with <code>00 00</code> for the standard 32x32 NPC.</p>
<p>So I will replace the <code>25 4E</code> bytes with <code>00 00</code>. You can save the overlay 1, and then save the ROM in DSPRE. If you did all the steps correctly the sprite you replaced will show up correctly in game.
The other two offsets to fix the remaining bulbasaur glitched sprites (1_202.BTX0 and 1_203.BTX0) are respectively at <code>0x22ECC</code> and <code>0x22ED2</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-new-poké-marts-platinumhgss-1"><a class="header" href="#adding-new-poké-marts-platinumhgss-1">Adding New Poké Marts <sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago.</p>
</blockquote>
<p>This is a guide on how to add and display new Poké Marts in Platinum and HGSS.
All offsets mentioned are based on the US version of the ROMs. </p>
<hr />
<h2 id="table-of-contents-7"><a class="header" href="#table-of-contents-7">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#section">Adding a new Poké Mart</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#subsection">Editing Item prices</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#section-2">Displaying the new Poké Mart</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-pokemarts.html#subsection-2">Using Script Registers</a></li>
</ul>
</li>
</ul>
<h2 id="adding-a-new-poké-mart-1"><a class="header" href="#adding-a-new-poké-mart-1">Adding a new Poké Mart</a></h2>
<p>If you haven't already, you'll have to perform the ARM9 expansion since that's were the new Poké Mart(s) will be written to. 
You can do so by clicking &quot;Expand ARM9&quot; in DSPRE toolbox, then go to Unpacked/SynthOverlay in your DSPRE project folder (which will be named ROMname_DSPRE_contents, and will be in the same folder of your ROM) and using your hex editor of choice open either file 0009 if you're on Platinum or 0000 for HGSS.</p>
<p>You can write at whatever offset you want as long as it's empty, I will be writing my Poké Mart at 0x100. You need to sum <code>0x023C8000</code> to this offset, and write it down since you'll need it later to display the mart in game. In my case it will be <code>0x023C8100</code>.</p>
<p>Poké Mart are loaded in the RAM as a list of bytes of the items index numbers, with <code>FF FF</code> at the end of each mart, each item taking up two bytes.
Refer to <a href="https://bulbapedia.bulbagarden.net/wiki/List_of_items_by_index_number_(Generation_IV)">Bulbapedia's list of items by index number</a>. 
Keep in mind the bytes must be written in little endian, so the order of bytes has to be swapped.</p>
<p>In this tutorial I will be adding a Poké Mart that sells Rare Candies and Focus Sashes, their index numbers are respectively <code>0x32</code> and <code>0x113</code>.
So I will be writing <code>32 00 13 01 FF FF</code> at 0x100. Once you've added all your marts and wrote down their offsets you can save the file and close the hex editor.</p>
<h3 id="editing-item-prices-1"><a class="header" href="#editing-item-prices-1">Editing item prices</a></h3>
<p>Item prices aren't stored in the Poké Marts, instead they are part of item data, meaning an item will always have the same price regardless of the Poké Mart it's being sold at.
Item data is stored in the narc <code>pl_item_data</code> (Platinum) / <code>a/0/1/7</code> (HGSS). The file you're looking will have the item index number as its name.</p>
<p>The price is stored in the first two bytes in each file, so for example if I want to have Rare Candyies to be sold at 10,000 Pokèdollars (<code>0x2710</code>), I will have to extract 50.bin and change the first two bytes to <code>10 27</code>. Once you've reinserted the file remember to pack the narc before saving the ROM!</p>
<h2 id="displaying-the-new-poké-mart-1"><a class="header" href="#displaying-the-new-poké-mart-1">Displaying the new Poké Mart</a></h2>
<p>The easiest way new Poké Marts can be displayed (without overwriting existing ones) is by using a script to change the pointer of an existing Poké Mart trough the <code>AdrsValueSet</code> command, normally accessing the Poké Mart, and once you're done changing the pointer back.
I'll use the offset of <code>SpMartScreen 0</code>, the pointer normally being <code>0x020EB978</code> (Platinum) / <code>020FBA54</code> (HGSS) and is found at <code>0x02100B1C</code> (Platinum) / <code>0x0210FA3C</code> (HGSS) in the RAM.
Since I'm using HGSS, the relevant part of my script will look like this:</p>
<pre><code>AdrsValueSet 0x0210FA3C 0x00
AdrsValueSet 0x0210FA3D 0x81
AdrsValueSet 0x0210FA3E 0x3C
SpMartScreen 0
AdrsValueSet 0x0210FA3C 0x54
AdrsValueSet 0x0210FA3D 0xBA
AdrsValueSet 0x0210FA3E 0x0F
</code></pre>
<p>The first three commands change the original pointer to the new one in the synthetic overlay, then the Mart is opened like normal with <code>SpMartScreen 0</code>, and with the last three commands the original pointer is restored. Only 3 bytes are changed instead of 4 since RAM offsets always start with 02. Again the pointers are written in little endian, so <code>0x023C8100</code> will look like <code>00 81 3C 02</code> in the RAM.
You can save the script and test the game now.
Note that in Platinum the pointer will have to be changed back to <code>0x20EB978</code> instead.
This is what my full script 19 looks like, I assigned it to a NPC which will show the new Pokè Mart when talked to:</p>
<p><img src="gen4/guides/field/resources/pt_hgss-pokemarts/pokemart_script1.PNG" alt="" /></p>
<h3 id="using-script-registers-1"><a class="header" href="#using-script-registers-1">Using Script Registers</a></h3>
<p>To avoid using the AdrsValueSet three times in a row, it's possible to do the same process using the script register commands <code>RegDataSet</code> and <code>AdrsRegSet</code>, so that my earlier script will instead look like this:</p>
<pre><code>RegDataSet 0 0x023C8100
AdrsRegSet 0x0210FA3C 0
SpMartScreen 0
RegDataSet 0 0x020FBA54
AdrsRegSet 0x0210FA3C 0
</code></pre>
<p>The only caveat is that the script is normally &quot;broken&quot; and only writes one byte into memory, so to fix it you have to hex edit the arm9 at <code>0x3F7CA</code> (Platinum) / <code>0x40996</code> (HGSS) and change <code>01 70</code> to <code>01 60</code>. Thanks to AdAstra for having looked into this issue.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="town-map-editing-hgss"><a class="header" href="#town-map-editing-hgss">Town Map Editing <sup><em>(HGSS)</em></sup></a></h1>
<blockquote>
<p>All research for this guide &amp; the writing was done by <a href="https://github.com/BluRosie">BluRose</a>.</p>
</blockquote>
<p>The Town Map in Heart Gold is located solely within the Poké Gear, a departure from some previous games where the Town Map is a key item that gets a very large area to mess around on.  Because of this, the region is actually relatively cramped to start out with--Kanto makes a few sacrifices to nicely fit into the 32x32 blocks that the game uses--every square that the town map has corresponds to a 32x32 grid block, hence the reason that glitches like tweaking work in Platinum to go out of bounds and access the islands for Shaymin, Darkrai, and Cresselia.</p>
<p>In this guide, I look to turn Johto &amp; a little of Kanto into Hoenn.  While the images are included here as examples of what you can do, I ask that you refrain from copying my images (at least while I am still an active hacker, actively developing for my own hack).  Otherwise, just let me know if you want to use resources and we can talk.</p>
<hr />
<h2 id="table-of-contents-8"><a class="header" href="#table-of-contents-8">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/interface/hgss-town_map.html#prerequisites">Prerequisites</a></li>
<li><a href="gen4/guides/interface/hgss-town_map.html#part-1---graphics">Part 1 - Graphics</a>
<ul>
<li><a href="gen4/guides/interface/hgss-town_map.html#protagonist-portraits">Protagonist Portraits</a></li>
<li><a href="gen4/guides/interface/hgss-town_map.html#town-previews">Town Previews</a></li>
<li><a href="gen4/guides/interface/hgss-town_map.html#town-map-graphics">Town Map Graphics</a></li>
</ul>
</li>
<li><a href="gen4/guides/interface/hgss-town_map.html#part-2---overlay-101-hex-editing">Part 2 - Overlay 101 Hex Editing</a>
<ul>
<li><a href="gen4/guides/interface/hgss-town_map.html#redgray-map-chunks-flight-spots">Red/Gray Map Chunks, Flight Spots</a></li>
<li><a href="gen4/guides/interface/hgss-town_map.html#orange-selection-blocks">Orange Selection Blocks</a></li>
<li><a href="gen4/guides/interface/hgss-town_map.html#arm9-flight-positions">ARM9 Exact Flight Positions</a></li>
</ul>
</li>
<li><a href="gen4/guides/interface/hgss-town_map.html#todo">TODO</a></li>
</ul>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ul>
<li>Comfortability with hex editing (and I mean comfortability, this gets pretty intense) and interpreting data</li>
<li>Comfortability with Tinke</li>
</ul>
<h2 id="part-1---graphics"><a class="header" href="#part-1---graphics">Part 1 - Graphics</a></h2>
<p>First thing's first, the graphics are the easy part.  <code>a/1/4/4</code> contains all of the graphics for the Town Map.  These are all easily editable using Tinke--a tutorial for which will not be covered here.  Refer to Jay's tutorials on YouTube for a basics of graphics editing tutorial.</p>
<h3 id="protagonist-portraits"><a class="header" href="#protagonist-portraits">Protagonist Portraits</a></h3>
<p>Clicking on the NCLR file 0 and then the NCGR file 1 will give you the town map portraits and the selectors--set the width to 16 and the height to 232.  Here you can replace the protagonist mugshots with whatever you can fit in the 16x16 space that uses very few colors to keep the rest of the indicators the same.  The roamers are also here, all of the Beasts and the Lati twins--feel free to change those as your hack requires!</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/original_portraits.png" alt="" /></p>
<p>When saving, make sure to click replace palette or whatever the checkbox is.  The graphic I will use is this one:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/new_portraits.png" alt="" /></p>
<p>You can even check out the portraits in the game if you repack the narc and resave the ROM:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/new_portrait_in_game.png" alt="" /></p>
<h3 id="town-previews"><a class="header" href="#town-previews">Town Previews</a></h3>
<p>Clicking on the NCLR file 14, the NCGR file 12, and the NSCR file 13 (in that order to load resources properly for editing) will give the Town Previews.  These are the things shown along the top of the Poké Gear when the town is hovered over.  There are 20 of these slots available--as this serves the purposes for my hack, I haven't looked into expanding it, but may eventually.  Kanto and Johto combined give a lot of leeway in this sense.</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/old_previews.png" alt="" /></p>
<p>I've also been pretty careful about replacing old city maps with cities in my hack to ensure that every facet of this tutorial goes over well.  It requires a bit of planning, but will keep things nice and easy for you if you choose to edit the town map.  Editing that image and replacing the NSCR file with tiling encoding enabled will conclude the Town Previews.</p>
<p>I haven't personally done this for my hack yet, as I have yet to place the buildings in most cities, so I have yet to replace these graphics.  I may come back eventually and update this.</p>
<h3 id="town-map-graphics"><a class="header" href="#town-map-graphics">Town Map Graphics</a></h3>
<p>First we have to disable a few things from the town map code that copy over blank map parts before Kanto is unlocked.  We also make the entire region into Johto so that there are no issues dealing with the town map name changing:</p>
<pre><code>Limit the PokéGear selectable area - Overlay 101
0x307C - [max x coord selectable]
0xFC18 - [max x coord selectable] 00 [max x coord selectable] 00 [max x coord selectable] 00
For example, my FC18 looks like 1C 00 1C 00 1C 00
This is the normal PokéGear map area limiter.

The same byte sequence exists at 0x107FC, and is used for the Fly map--replace that one too.

Make no map replacement from right part of image before Kanto is unlocked - Overlay 101
0x3846 - 00 00 00 00 00 00
0x38D6 - 00 00
0x38E2 - 00 00

Allow the user to fly to any region (make ov101_021EA804 always return 1) - Overlay 101
0x30C4 - 01 20 70 47

Cianwood we just replace the areas as needed.  Not all that bad, no need to find the code for it.
</code></pre>
<p>Next we have to add in the Town Map blurbs that appear when you hover over the town in the PokéGear.  This is all done in a027 file 273, so you can either replace existing entries or add new ones entirely--it's all up to you.  Just keep track of which is which.</p>
<p>Furthermore, change the first two entries (<code>Kanto</code> and <code>Johto</code>) to both be the name of your region.  Here, I replace both of mine with <code>Hoenn</code>.</p>
<p>Here is the part where things get a little bit complicated.</p>
<p>Each selectable tile in the PokéGear corresponds to one map chunk in the overworld.  Each 32x32 overworld space is one selectable tile in the PokéGear--and you can verify this by forcing the ability to open the start menu in the Mystery Zone, even as you run around out there it still updates your position in the PokéGear.
This somewhat constrains what you can and can't do mapping-wise.  I know I have made a number of concessions when it comes to mapping my overworld (especially given that Hoenn seems to be broken into 20x20 chunks and the town map there doesn't care).</p>
<p>Clicking on NCLR file 23, NCGR file 10, and NSCR 11 will net this massive image.</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/old_town_map.png" alt="" /></p>
<p>This is a lot to take in at first.  We have the actual town map on top of the many little highlight sections at the bottom.  Here, we whip out a new town map for our new region in the top section:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/town_map_red_area_done.png" alt="" /></p>
<p><em>Make sure that the top leftmost tile is just the transparent (first) color in the palette!</em>  Issues come up if you do not abide by this, and you'll think that everything is buggy until you realize that you just didn't do this.  This is just because of how Tinke does the tiling in the NSCR file.</p>
<p>As we can see as well, we need to take into account that the Safari Zone areas are blocked out first, so I make sure to replace those down in the bottom right as well.  Saving this image and reopening it in the ROM:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/poke_gear_screen_red_area.png" alt="" /></p>
<p><em>This being a garbled mess is 100% expected!</em>  We still have to deal with tables.</p>
<p>Trust the process here, it will look better, but it isn't then worth it to stress about how it appears in game until we get through the final hex editing step.  The game does lots of tile swapping at run time.</p>
<p>From here, we add the gray areas to the overall image as well:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/town_map_gray_area_done.png" alt="" /></p>
<p>Then we just need to add the highlighted orange areas to the image, or rather the ones that are missing (including the routes):</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/town_map_orange_area_done.png" alt="" /></p>
<p>Now we move to making this look alright in the game and into overlay 101.</p>
<h2 id="part-2---overlay-101-hex-editing"><a class="header" href="#part-2---overlay-101-hex-editing">Part 2 - Overlay 101 Hex Editing</a></h2>
<h3 id="redgray-map-chunks-flight-spots"><a class="header" href="#redgray-map-chunks-flight-spots">Red/Gray Map Chunks, Flight Spots</a></h3>
<p>Overlay 101 has a table governing replacing the red town chunks with the gray town chunks when the town hasn't been visited, and another governing the orange selected overlay that appears when you select a town chunk or route chunk.  The first table is at 0x10274 (0x021F79B4) of overlay 101, and has the format for each entry:</p>
<pre><code class="language-c">struct GearMapTownOverlay
{
    /* 0x0 */ u16 mapHeader;
    /* 0x2 */ u16 gateAppearance; // not sure
    /* 0x4 */ u8 entry; // maybe
    /* 0x5 */ u8 entry2; // maybe
    /* 0x6 */ u8 redX;
    /* 0x7 */ u8 redY;
    /* 0x8 */ u8 grayX;
    /* 0x9 */ u8 grayY;
    /* 0xA */ u8 townDimY:4; // msn
              u8 townDimX:4; // lsn
    /* 0xB */ u8 replacementDimY:4; // msn
              u8 replacementDimX:4; // lsn
    /* 0xC */ u8 offsetY:4; // msn
              u8 offsetX:4; // lsn
    /* 0xD */ u8 padding;
}; // entry size = 0xE
</code></pre>
<p>More in-depth structure description and the fields appear on <a href="gen4/guides/interface/../../resources/interface/hgss-town_map_spots.html">this other page</a>.</p>
<p>So let's look at this table, split up by entry (0xE in size):</p>
<pre><code>31 00 31 00 00 00 20 0B 00 14 11 33 11 00 
32 00 32 00 01 01 1F 07 05 14 22 44 11 00 
33 00 33 00 02 02 20 02 0A 14 22 44 11 00 
34 00 34 00 03 03 28 03 0F 14 22 44 11 00 
35 00 35 00 04 04 2C 07 14 14 11 33 11 00 
36 00 36 00 05 05 28 09 19 14 22 44 11 00 
37 00 37 00 06 06 25 07 1E 14 22 44 11 00 
38 00 38 00 07 07 25 0C 23 14 22 44 11 00 
39 00 39 00 08 08 20 0F 00 18 11 33 11 00 
3A 00 3A 00 09 FF 1C 06 00 00 11 00 00 00 
3B 00 3B 00 0A 09 28 06 05 18 22 44 11 00 
3C 00 3C 00 0B 0A 15 0C 0B 19 11 11 00 00 
43 00 43 00 0C 0B 10 0C 0F 18 12 34 11 00 
49 00 49 00 0D 0C 0E 07 14 18 22 43 10 00 
4A 00 4A 00 0E 0D 0C 0E 19 18 12 34 11 00 
4B 00 4B 00 0F 0E 05 0A 1E 18 21 43 11 00 
4C 00 4C 00 10 0F 09 0A 23 18 23 45 11 00 
4D 00 4D 00 11 10 08 07 00 1C 22 44 11 00 
4E 00 4E 00 12 11 0B 04 05 1C 22 44 11 00 
57 00 57 00 13 12 10 05 0A 1C 11 33 11 00 
59 00 59 00 15 13 14 04 0F 1C 22 44 11 00 
58 00 58 00 14 FF 0F 01 00 00 23 00 00 00 
5A 00 5A 00 16 FF 19 08 00 00 11 00 00 00 
AE 00 AE 00 1E FF 02 08 00 00 22 00 00 00 
10 01 9B 01 1B FF 06 06 00 00 22 00 00 00 
60 00 18 01 23 FF 0A 06 00 00 22 00 00 00 
7C 00 1E 00 21 FF 1C 07 00 00 21 00 00 00  
</code></pre>
<p>We can see that there are clearly patterns.</p>
<p>Further breaking it down and labeling the names based on the map headers:</p>
<pre><code>        mapHeader  gateHeader  entry   entry2  redX  redY  grayX  grayY  townDim  replDim  offsetPos  padding
[0x00]  31 00      31 00       00      00      20    0B    00     14     11       33       11         00       // pallet town
[0x01]  32 00      32 00       01      01      1F    07    05     14     22       44       11         00       // viridian town
[0x02]  33 00      33 00       02      02      20    02    0A     14     22       44       11         00       // pewter
[0x03]  34 00      34 00       03      03      28    03    0F     14     22       44       11         00       // cerulean
[0x04]  35 00      35 00       04      04      2C    07    14     14     11       33       11         00       // lavender
[0x05]  36 00      36 00       05      05      28    09    19     14     22       44       11         00       // vermilion
[0x06]  37 00      37 00       06      06      25    07    1E     14     22       44       11         00       // celadon
[0x07]  38 00      38 00       07      07      25    0C    23     14     22       44       11         00       // fuchsia
[0x08]  39 00      39 00       08      08      20    0F    00     18     11       33       11         00       // cinnabar
[0x09]  3A 00      3A 00       09      FF      1C    06    00     00     11       00       00         00       // indigo plateau
[0x0A]  3B 00      3B 00       0A      09      28    06    05     18     22       44       11         00       // saffron
[0x0B]  3C 00      3C 00       0B      0A      15    0C    0B     19     11       11       00         00       // new bark town
[0x0C]  43 00      43 00       0C      0B      10    0C    0F     18     12       34       11         00       // cherrygrove
[0x0D]  49 00      49 00       0D      0C      0E    07    14     18     22       43       10         00       // violet
[0x0E]  4A 00      4A 00       0E      0D      0C    0E    19     18     12       34       11         00       // azalea
[0x0F]  4B 00      4B 00       0F      0E      05    0A    1E     18     21       43       11         00       // cianwood
[0x10]  4C 00      4C 00       10      0F      09    0A    23     18     23       45       11         00       // goldenrod
[0x11]  4D 00      4D 00       11      10      08    07    00     1C     22       44       11         00       // olivine
[0x12]  4E 00      4E 00       12      11      0B    04    05     1C     22       44       11         00       // ecruteak
[0x13]  57 00      57 00       13      12      10    05    0A     1C     11       33       11         00       // mahogany
[0x14]  59 00      59 00       15      13      14    04    0F     1C     22       44       11         00       // blackthorn
[0x15]  58 00      58 00       14      FF      0F    01    00     00     23       00       00         00       // lake of rage
[0x16]  5A 00      5A 00       16      FF      19    08    00     00     11       00       00         00       // mt silver
[0x17]  AE 00      AE 00       1E      FF      02    08    00     00     22       00       00         00       // safari zone gate
[0x18]  10 01      9B 01       1B      FF      06    06    00     00     22       00       00         00       // battle frontier / gate is access
[0x19]  60 00      18 01       23      FF      0A    06    00     00     22       00       00         00       // national park / gate is pokeathlon dome
[0x1A]  7C 00      1E 00       21      FF      1C    07    00     00     21       00       00         00       // victory road / gate is route 26
</code></pre>
<p>Every city gets an <code>entry2</code> field filled out.  All the entries get an <code>entry1</code> field.  I do not know much about these--I just use the existing ones in an effort not to renovate anything that doesn't need renovated.</p>
<p>How do we interpret the <code>redX</code>, <code>redY</code>, <code>grayX</code>, and <code>grayY</code> fields? </p>
<p>Tiles form tilesets (NCGR) and are 8x8 pixels, with the idea being that the tilemap (NSCR) then &quot;maps&quot; the tiles to the overall image that Tinke lets you view.  The coordinate fields are all coordinates in the overall image that is dumped:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/old_town_map_but_8x8_annotated.png" alt="" /></p>
<p>We can start to circle gray positions really nicely, but circling red positions seems to be weird (bear with me, the circles are red and gray respectively and are a little hard to see):</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/old_town_map_with_wrong_circles.png" alt="" /></p>
<p>Entries 0x00 (Pallet), 0x01 (Viridian), and 0x05 (Vermilion) are circled on the map using the raw coordinates.</p>
<p>For whatever reason, the red position fields are offset by 1 each.  So on the image, the <code>redX</code> field actually references a position of <code>redX - 1</code>.  The <code>redY</code> field then references a position of <code>redY + 1</code>--<code>redX</code> is one less than what it should be, and <code>redY</code> is one more than it should be.</p>
<p>The gray fields are not affected by this issue.  Circling the adjusted red ones, offset 1 left and 1 down:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/old_town_map_with_right_circles.png" alt="" /></p>
<p>That shows the top left of each city and the place that its replaced with.</p>
<p>We can tell how much to circle by the <code>townDim</code> field.  The <code>townDim</code> field is just a byte where the significant nybble is the y dimension and the other the x dimension.  For example, the <code>townDim</code> for Azalea is <code>12</code>, showing a y dimension of 1 and an x dimension of 2.  The <code>replDim</code> byte is the dimension of the replacement (encoded similarly)--before you visit the place, it replaces the red on the town map with the gray below.  This byte is the dimensions of that area.  For example, the <code>replDim</code> byte for Goldenrod City is <code>45</code>, meaning that the gray replacement area of Goldenrod is on a 5 horizontal by 4 vertical area.  Finally, the <code>offsetPos</code> byte describes the x- and y-offset away from the base coordinate the town itself actually starts, once again similarly encoded in the nybbles.</p>
<p>Dissecting a full entry:</p>
<p>Entry <code>0x0D</code> corresponds to a map header of <code>49 00</code>--after converting from little endian--<code>0x49</code>.  This corresponds to a map header of Violet City.  The <code>gateHeader</code> also has the Violet City map header.
Its <code>entry1</code>--which I believe is something of a &quot;flight spot flag&quot;--is <code>0xD</code> with an <code>entry2</code>--which I believe is some sort of &quot;city visited&quot; flag--of <code>0xC</code>.
The <code>redX</code>, <code>redY</code> fields show it belonging here (after being adjusted with the 1 offsets), and the <code>grayX</code>, <code>grayY</code> position is circled as well.  The areas are both circled to account for <code>replDim</code>, with <code>townDim</code> being located inside of each at an offset of <code>offsetPos</code>.</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/old_town_map_violet_focus.png" alt="" /></p>
<p>I would strongly recommend making something like an Excel sheet or a Google Sheets workbook to keep track of all of this!  It allows for quick adjustments such that you know what each field is in addition to being something you can always keep open to reference.  Mine looks like this:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/excel_town_map_red_gray.png" alt="" /></p>
<p>This can then just copy-paste the table into HxD or similar for easy updating and editing (especially on a ROM with entirely decompressed overlays).</p>
<p>My table looks like:</p>
<pre><code>        mapHeader  gateHeader  entry   entry2  redX  redY  grayX  grayY  townDim  replDim  offsetPos  padding
[0x00]  31 00      31 00       00      00      06    0C    00     14     11       33       11         00       // littleroot
[0x01]  32 00      32 00       01      01      06    0A    00     17     11       23       11         00       // oldale
[0x02]  33 00      33 00       02      02      02    05    03     14     22       44       11         00       // rustboro
[0x03]  34 00      34 00       03      03      11    0A    0A     17     11       33       11         00       // pacifidlog
[0x04]  35 00      35 00       04      04      04    0F    00     1C     11       33       11         00       // dewford
[0x05]  36 00      36 00       05      05      09    0A    03     18     22       44       11         00       // slateport
[0x06]  37 00      37 00       06      06      09    06    03     1C     12       34       11         00       // mauville
[0x07]  38 00      38 00       07      07      06    06    07     14     11       33       11         00       // verdanturf
[0x08]  39 00      39 00       08      08      07    03    07     17     11       33       11         00       // lavaridge
[0x09]  3A 00      3A 00       09      09      04    01    07     1A     11       33       11         00       // fallarbor
[0x0A]  3B 00      3B 00       0A      0A      0D    01    07     1D     11       33       11         00       // fortree
[0x0B]  3C 00      3C 00       0B      0B      11    03    0D     17     23       45       11         00       // lilycove
[0x0C]  43 00      43 00       0C      0C      17    04    0D     14     12       34       11         00       // mossdeep
[0x0D]  49 00      49 00       0D      0D      15    07    0A     14     11       33       11         00       // sootopolis
[0x0E]  4A 00      4A 00       0E      0E      1A    07    0A     1A     21       43       11         00       // ever grande
[0x0F]  4B 00      4B 00       0F      0F      03    0A    00     19     11       23       11         00       // petalburg (replaced cianwood)
[0x10]  4C 00      4C 00       10      10      0E    0E    0D     1B     11       33       11         00       // battle frontier
[0x11]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x12]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x13]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x14]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x15]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x16]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x17]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x18]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x19]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
[0x1A]  00 00      00 00       00      00      00    00    00     00     00       00       00         00       // empty
</code></pre>
<p>Inserting into the ROM:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/town_map_first_pass_in_rom.png" alt="" /></p>
<p>We can see that unregistered areas (Pacifidlog, Dewford, Lavaridge) are copied properly from their gray entries below.  All the red areas are also properly partitioned and are just fine when registered.</p>
<h3 id="orange-selection-blocks"><a class="header" href="#orange-selection-blocks">Orange Selection Blocks</a></h3>
<p>Next part:  The orange selection blocks.  Walking around the map will show that the old selection blocks are still there:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/town_map_first_pass_in_rom_1.png" alt="" /></p>
<p>As previously mentioned, overlay 101 has another table.  This table is at 0xFC32 (0x021F7372) of overlay 101, and has the format for each entry:</p>
<pre><code class="language-c">struct GearMapTownSelectionOverlay
{
    /* 0x0 */ u16 mapHeader;
    /* 0x2 */ u8 baseX; // in poke gear position
    /* 0x3 */ u8 baseY; // in poke gear position
    /* 0x4 */ u8 dimY:4; // msn
              u8 dimX:4; // lsn
    /* 0x5 */ u8 flags;
    /* 0x6 */ u8 textEntry; // in a027 file 273
    /* 0x7 */ u8 flySpot;
    /* 0x8 */ u32 padding;
    /* 0xC */ u8 orangeBaseX; // in image
    /* 0xD */ u8 orangeBaseY; // in image
    /* 0xE */ u8 orangeDimX; // in image
    /* 0xF */ u8 orangeDimY; // in image
}; // size = 0x10
</code></pre>
<p>Note that I have yet to document what the flags do.  The <code>GearMapTownSelectionOverlay</code> is better documented as well <a href="gen4/guides/interface/../../structures/town_map/town_map_spots.html">on this page</a>.</p>
<p>The table split up by entry:</p>
<pre><code>09 02 13 02 33 C0 41 00 00 00 00 00 00 00 00 00
33 01 18 10 33 C0 45 00 00 00 00 00 00 00 00 00
78 00 15 06 11 00 37 00 00 00 00 00 05 28 01 01
7B 00 11 0A 11 00 3A 00 00 00 00 00 0A 28 01 01
7B 00 13 0C 11 00 3A 00 00 00 00 00 0C 2C 01 01
7B 00 14 08 11 00 3A 00 00 00 00 00 0D 28 01 01
6E 00 0F 09 11 00 27 00 00 00 00 00 05 28 01 01
63 00 0E 0F 11 00 2E 00 00 00 00 00 08 2C 01 01
72 00 0D 10 11 00 2F 00 00 00 00 00 05 28 01 01
75 00 0B 10 11 00 34 00 00 00 00 00 05 2D 01 01
60 00 0A 08 22 44 2B 00 00 00 00 00 00 25 02 02
6F 00 0C 06 11 00 28 00 00 00 00 00 05 28 01 01
07 00 0B 06 11 00 2A 00 00 00 00 00 05 28 01 01
77 00 0E 07 11 00 36 00 00 00 00 00 05 28 01 01
79 00 07 0D 11 00 38 00 00 00 00 00 01 2E 01 01
...
</code></pre>
<details>
<summary>Further elaborating on the table (click for drop down!)</summary>
<p>This table is (somewhat) sporadically labeled, instead of being super in-depth.</p>
<pre><code>        mapHeader  baseX  baseY  dim  flags  textEntry  flySpot  padding      orangeBaseX  orangeBaseY  orangeDimX  orangeDimY
[0x00]  09 02      13     02     33   C0     41         00       00 00 00 00  00           00           00          00          // sinjoh ruins
[0x01]  33 01      18     10     33   C0     45         00       00 00 00 00  00           00           00          00          // s.s. aqua
[0x02]  78 00      15     06     11   00     37         00       00 00 00 00  05           28           01          01          // ice path
[0x03]  7B 00      11     0A     11   00     3A         00       00 00 00 00  0A           28           01          01          // dark cave 1
[0x04]  7B 00      13     0C     11   00     3A         00       00 00 00 00  0C           2C           01          01          // dark cave 2
[0x05]  7B 00      14     08     11   00     3A         00       00 00 00 00  0D           28           01          01          // dark cave 3
[0x06]  6E 00      0F     09     11   00     27         00       00 00 00 00  05           28           01          01
[0x07]  63 00      0E     0F     11   00     2E         00       00 00 00 00  08           2C           01          01
[0x08]  72 00      0D     10     11   00     2F         00       00 00 00 00  05           28           01          01
[0x09]  75 00      0B     10     11   00     34         00       00 00 00 00  05           2D           01          01
[0x0A]  60 00      0A     08     22   44     2B         00       00 00 00 00  00           25           02          02          // national park
[0x0B]  6F 00      0C     06     11   00     28         00       00 00 00 00  05           28           01          01
[0x0C]  07 00      0B     06     11   00     2A         00       00 00 00 00  05           28           01          01
[0x0D]  77 00      0E     07     11   00     36         00       00 00 00 00  05           28           01          01
[0x0E]  79 00      07     0D     11   00     38         00       00 00 00 00  01           2E           01          01
[0x0F]  7E 00      17     0E     11   00     3D         00       00 00 00 00  06           28           01          01
[0x10]  7C 00      1C     09     21   40     3B         00       00 00 00 00  03           25           01          02
[0x11]  93 00      20     07     11   00     3E         00       00 00 00 00  0F           29           01          01
[0x12]  6A 00      20     06     11   00     21         00       00 00 00 00  0F           28           01          01
[0x13]  6A 00      2A     0B     11   00     21         00       00 00 00 00  1C           2B           01          01
[0x14]  6B 00      24     05     11   00     22         00       00 00 00 00  06           28           01          01
[0x15]  91 00      28     05     11   00     23         00       00 00 00 00  05           28           01          01
[0x16]  6C 00      2C     06     11   00     24         00       00 00 00 00  1F           29           01          01
[0x17]  E9 01      2C     07     11   00     43         00       00 00 00 00  1F           2A           01          01
[0x18]  92 00      23     11     11   00     26         00       00 00 00 00  06           28           01          01
[0x19]  10 01      06     08     22   44     32         00       00 00 00 00  00           25           02          02
[0x1A]  DF 01      25     0E     11   00     25         00       00 00 00 00  05           28           01          01
[0x1B]  DC 00      09     0A     11   00     30         00       00 00 00 00  05           28           01          01
[0x1C]  31 00      20     0D     11   00     0A         01       00 00 00 00  00           20           03          03          // pallet town
[0x1D]  32 00      1F     09     22   44     0B         02       00 00 00 00  23           20           04          04          // viridian town
[0x1E]  33 00      20     04     22   44     0C         03       00 00 00 00  23           20           04          04          // pewter
[0x1F]  34 00      28     05     22   84     0D         04       00 00 00 00  12           20           04          04          // cerulean
[0x20]  35 00      2C     09     11   00     0E         05       00 00 00 00  00           20           03          03          // lavender
[0x21]  36 00      28     0B     22   44     0F         06       00 00 00 00  23           20           04          04          // vermilion
[0x22]  37 00      25     09     22   44     10         07       00 00 00 00  23           20           04          04          // celadon
[0x23]  38 00      25     0E     22   84     11         08       00 00 00 00  12           20           04          04          // fuchsia
[0x24]  39 00      20     11     11   00     12         09       00 00 00 00  00           20           03          03          // cinnabar
[0x25]  3B 00      28     08     22   44     14         0A       00 00 00 00  23           20           04          04          // saffron
[0x26]  3C 00      15     0E     11   00     15         0B       00 00 00 00  00           20           03          03          // new bark town
[0x27]  43 00      10     0E     12   04     16         0C       00 00 00 00  1A           20           04          03          // cherrygrove
[0x28]  49 00      0E     09     22   84     17         0D       00 00 00 00  0E           20           04          04          // violet
[0x29]  4A 00      0C     10     11   00     18         0E       00 00 00 00  16           20           04          03          // azalea
[0x2A]  4B 00      05     0C     21   40     19         0F       00 00 00 00  03           20           03          04          // cianwood
[0x2B]  4C 00      09     0C     23   48     1A         10       00 00 00 00  1E           20           05          04          // goldenrod
[0x2C]  4D 00      08     09     22   04     1B         11       00 00 00 00  06           20           04          04          // olivine
[0x2D]  4E 00      0B     06     22   84     1C         12       00 00 00 00  0A           20           04          04          // ecruteak
[0x2E]  57 00      10     07     11   00     1D         13       00 00 00 00  00           20           03          03          // mahogany
[0x2F]  59 00      14     06     22   84     1F         14       00 00 00 00  0E           20           04          04          // blackthorn
[0x30]  3A 00      1C     08     11   00     13         00       00 00 00 00  05           28           01          01          // indigo plateau
[0x31]  58 00      0F     03     23   48     1E         00       00 00 00 00  1E           20           05          04
[0x32]  5A 00      19     0A     11   00     39         00       00 00 00 00  05           28           01          01
[0x33]  08 00      0D     0A     21   40     2D         00       00 00 00 00  03           20           03          04
[0x34]  AE 00      02     0A     22   44     44         00       00 00 00 00  09           25           02          02
[0x35]  09 00      20     0B     21   40     46         00       00 00 00 00  0F           2E           01          02
[0x36]  0A 00      20     08     11   00     47         00       00 00 00 00  0F           2A           01          01
[0x37]  0B 00      22     05     12   04     48         00       00 00 00 00  19           28           02          01
[0x38]  0C 00      25     05     13   04     49         00       00 00 00 00  1C           28           03          01
[0x39]  0D 00      28     07     11   00     4A         00       00 00 00 00  19           2C           01          01
[0x3A]  0E 00      28     0A     11   00     4B         00       00 00 00 00  1A           2C           01          01
[0x3B]  0F 00      27     09     11   00     4C         00       00 00 00 00  18           2C           01          01
[0x3C]  10 00      2A     09     12   04     4D         00       00 00 00 00  1B           2C           02          01
[0x3D]  11 00      2A     06     12   04     4E         00       00 00 00 00  1D           29           02          01
[0x3E]  12 00      2C     08     11   00     4F         00       00 00 00 00  1F           2B           01          01
[0x3F]  13 00      2B     0B     11   00     50         00       00 00 00 00  1D           2B           01          01
[0x40]  14 00      2C     0A     31   40     51         00       00 00 00 00  1E           2A           01          03
[0x41]  15 00      2A     0D     13   04     52         00       00 00 00 00  1C           2D           03          01
[0x42]  16 00      2A     0E     21   40     53         00       00 00 00 00  1C           2E           01          02
[0x43]  17 00      27     0F     13   0C     54         00       00 00 00 00  19           2F           03          01
[0x44]  18 00      23     0A     12   04     55         00       00 00 00 00  17           28           02          01
[0x45]  19 00      23     0B     41   C0     56         00       00 00 00 00  17           29           01          04          // 
[0x46]  1A 00      23     0F     12   04     57         00       00 00 00 00  17           2D           02          01
[0x47]  5B 00      25     10     21   40     58         00       00 00 00 00  16           2D           01          02
[0x48]  5C 00      21     11     14   08     59         00       00 00 00 00  12           2E           04          01
[0x49]  5D 00      20     0E     31   C0     5A         00       00 00 00 00  11           2D           01          03          // 
[0x4A]  1B 00      1D     0A     12   04     5B         00       00 00 00 00  15           28           02          01
[0x4B]  1C 00      29     04     11   00     5D         00       00 00 00 00  18           2A           01          01
[0x4C]  1D 00      29     03     14   0C     5E         00       00 00 00 00  18           29           04          01
[0x4D]  1E 00      1C     0B     41   C0     5F         00       00 00 00 00  14           29           01          04          // 
[0x4E]  1F 00      16     0E     16   0F     60         00       00 00 00 00  0E           2C           06          01
[0x4F]  20 00      1A     0A     12   04     61         00       00 00 00 00  12           28           02          01
[0x50]  21 00      12     0E     13   0C     62         00       00 00 00 00  0B           2E           03          01
[0x51]  22 00      11     0B     31   40     63         00       00 00 00 00  0A           29           01          03
[0x52]  23 00      10     0A     12   01     64         00       00 00 00 00  09           28           01          01
[0x53]  24 00      0E     0B     41   C0     65         00       00 00 00 00  08           28           01          04
[0x54]  25 00      0E     10     11   00     66         00       00 00 00 00  08           2D           01          01
[0x55]  26 00      0B     0E     31   40     67         00       00 00 00 00  05           2B           01          02
[0x56]  27 00      0B     0A     21   40     68         00       00 00 00 00  02           2D           01          02
[0x57]  28 00      0B     09     13   04     69         00       00 00 00 00  02           2C           03          01
[0x58]  29 00      0C     08     11   00     6A         00       00 00 00 00  03           2B           01          01
[0x59]  2A 00      09     07     12   04     6B         00       00 00 00 00  01           28           02          01
[0x5A]  2B 00      08     07     21   40     6C         00       00 00 00 00  00           28           01          02
[0x5B]  5E 00      07     0A     21   40     6D         00       00 00 00 00  01           2A           01          02
[0x5C]  5F 00      06     0C     22   04     6E         00       00 00 00 00  00           2C           02          02
[0x5D]  2C 00      0D     07     13   02     6F         00       00 00 00 00  02           2A           03          01
[0x5E]  2D 00      10     05     21   40     70         00       00 00 00 00  03           28           01          02
[0x5F]  2E 00      11     07     13   08     71         00       00 00 00 00  05           2A           03          01
[0x60]  2F 00      14     09     41   80     72         00       00 00 00 00  0D           29           01          04
[0x61]  30 00      13     0D     21   00     73         00       00 00 00 00  0C           2D           01          01
[0x62]  97 00      02     0D     23   48     74         00       00 00 00 00  20           29           03          02
[0x63]  98 00      02     0C     12   04     75         00       00 00 00 00  20           28           02          01
</code></pre>
</details>
<p>These are all as simple as the table makes it seem.  When anywhere within the coordinates <code>(baseX+dimX, baseY+dimY)</code>, the PokéGear will select the entire orange area as specified on the image by the area <code>(orangeBaseX+orangeDimX, orangeBaseY+orangeDimY)</code>.</p>
<p>This can also similarly be broken down into a nice spreadsheet for easy editing and pasting into the ROM.  I actually include mine as a <a href="gen4/guides/interface/resources/hgss-town_map/town_map_blocks.xlsx">template for you to download</a>.  My entries look something like this (each commented):</p>
<pre><code>        mapHeader  baseX  baseY  dim  flags  textEntry  flySpot  padding      orangeBaseX  orangeBaseY  orangeDimX  orangeDimY
[0x00]  31 00      06     0E     11   00     0A         01       00 00 00 00  00           20           03          03          // littleroot
[0x01]  32 00      06     0C     11   00     0B         02       00 00 00 00  00           20           03          03          // oldale
[0x02]  33 00      02     07     22   00     0C         03       00 00 00 00  23           20           04          04          // rustboro
[0x03]  34 00      11     0C     11   00     0D         04       00 00 00 00  00           20           03          03          // pacifidlog
[0x04]  35 00      04     11     11   00     0E         05       00 00 00 00  00           20           03          03          // dewford
[0x05]  36 00      09     0C     22   00     0F         06       00 00 00 00  23           20           04          04          // slateport
[0x06]  37 00      09     08     12   00     10         07       00 00 00 00  1A           20           04          03          // mauville
[0x07]  38 00      06     08     11   00     11         08       00 00 00 00  00           20           03          03          // verdanturf
[0x08]  39 00      07     05     11   00     12         09       00 00 00 00  00           20           03          03          // lavaridge
[0x09]  3B 00      0D     03     11   00     14         0A       00 00 00 00  00           20           03          03          // fortree
[0x0A]  3C 00      11     05     23   00     15         0B       00 00 00 00  1E           20           05          04          // lilycove
[0x0B]  43 00      17     06     12   00     16         0C       00 00 00 00  1A           20           04          03          // mossdeep
[0x0C]  49 00      15     09     11   00     17         0D       00 00 00 00  00           20           03          03          // sootopolis
[0x0D]  4A 00      1A     09     21   00     18         0E       00 00 00 00  0C           24           03          04          // ever grande
[0x0E]  4B 00      03     0C     11   00     19         0F       00 00 00 00  00           20           03          03          // petalburg
[0x0F]  3A 00      04     03     11   00     13         10       00 00 00 00  00           20           03          03          // fallarbor
[0x10]  4C 00      0E     10     11   00     1A         11       00 00 00 00  00           20           03          03          // battle frontier
</code></pre>
<p>The rest of them are 00'd out to ensure that nothing is displayed in the PokéGear.</p>
<p>Note that I haven't done the routes yet, but the cities are there to demonstrate functionality.  As an example, my Rustboro city is at <code>(2, 7)</code> on the map, has a selectable dimension of 2x2, uses text entry as a blurb <code>0x0C</code> from a027/273 on the top screen when selected, and uses fly spot 2.
Furthermore, the orange block that shows it is highlighted is located at <code>(0x23, 0x20)</code> on the massive town map image from earlier and is 4x4 in size.</p>
<p>Putting everything together, we can run through the map rather nicely:</p>
<p><img src="gen4/guides/interface/resources/hgss-town_map/final_town_map.png" alt="" /> <img src="gen4/guides/interface/resources/hgss-town_map/final_town_map_1.png" alt="" /> <img src="gen4/guides/interface/resources/hgss-town_map/final_town_map_2.png" alt="" /> <img src="gen4/guides/interface/resources/hgss-town_map/final_fly_map.png" alt="" /> <img src="gen4/guides/interface/resources/hgss-town_map/final_fly_map_1.png" alt="" /> <img src="gen4/guides/interface/resources/hgss-town_map/final_fly_map_2.png" alt="" /></p>
<h3 id="arm9-exact-flight-positions"><a class="header" href="#arm9-exact-flight-positions">ARM9 Exact Flight Positions</a></h3>
<p>Finally, there is a table that works with the orange selection blocks structure to map both fly positions and whiteout respawn positions.  Research on this thanks to BagBoy on the KoDSH server.</p>
<p>This is in the ARM9 binary at 0xF9E80 (0x020F9E80).  The table has the structure:</p>
<pre><code>struct FlyRespawnPosition
{
    /* 0x00 */ u8 flySpot;       // flySpot id to correspond with orange selection blocks structure
    /* 0x01 */ u8 flags;         // only 2 least significant bits are important
    /* 0x02 */ u16 mapHeader;    // map header in dspre for the room you respawn in
    /* 0x04 */ u8 x;             // global x pos in room
    /* 0x05 */ u8 y;             // global y pos in room
    /* 0x06 */ u16 fieldId;      // map header in dspre for the spot you fly to
    /* 0x08 */ u16 fieldCoordX;  // global x pos in field spot
    /* 0x0A */ u16 fieldCoordY;  // global y pos in field spot
    /* 0x0C */ u16 fieldId2;     // duplicate of fieldId
    /* 0x0E */ u16 fieldCoordX2; // duplicate of fieldCoordX
    /* 0x10 */ u16 fieldCoordY2; // duplicate of fieldCoordY
}; // size = 0x12
</code></pre>
<p>Here's an annotated hex dump, skipping the table dump from before:</p>
<pre><code>        flySpot flags mapHeader  x   y   fieldId fieldCoordX fieldCoordY fieldId2 fieldCoordX2 fieldCoordY2
[0x00]  0B      03    3F 00      06  08  3C 00   B7 02       8D 01       3C 00    B7 02        8D 01 
[0x01]  0C      03    45 00      08  0D  43 00   34 02       88 01       43 00    34 02        88 01 
[0x02]  0D      03    9E 00      08  0D  49 00   F1 01       10 01       49 00    F1 01        10 01 
[0x03]  0E      03    A6 00      08  0D  4A 00   9A 01       CD 01       4A 00    9A 01        CD 01 
[0x04]  0F      03    EC 00      08  0D  4B 00   BB 00       72 01       4B 00    BB 00        72 01 
[0x05]  10      03    B9 00      08  0D  4C 00   60 01       71 01       4C 00    60 01        71 01 
[0x06]  11      03    E2 00      08  0D  4D 00   10 01       02 01       4D 00    10 01        02 01 
[0x07]  12      03    51 00      08  0D  4E 00   8D 01       B8 00       4E 00    8D 01        B8 00 
[0x08]  13      03    F6 00      08  0D  57 00   16 02       B8 00       57 00    16 02        B8 00 
[0x09]  14      02    58 00      08  0D  58 00   18 02       5A 00       58 00    18 02        5A 00 
[0x0A]  15      03    25 01      08  0D  59 00   A2 02       B1 00       59 00    A2 02        B1 00 
[0x0B]  16      03    02 02      08  0D  5A 00   34 03       0A 01       5A 00    34 03        0A 01 
[0x0C]  00      02    31 00      08  0D  31 00   09 04       6C 01       31 00    09 04        6C 01 
[0x0D]  01      03    F5 01      08  0D  32 00   08 04       07 01       32 00    08 04        07 01 
[0x0E]  02      03    DB 01      08  0D  33 00   18 04       6B 00       33 00    18 04        6B 00 
[0x0F]  03      03    AC 01      08  0D  34 00   1D 05       84 00       34 00    1D 05        84 00 
[0x10]  04      03    B2 01      08  0D  35 00   8A 05       EB 00       35 00    8A 05        EB 00 
[0x11]  05      03    66 01      08  0D  36 00   11 05       27 01       36 00    11 05        27 01 
[0x12]  06      03    89 01      08  0D  37 00   CF 04       EE 00       37 00    CF 04        EE 00 
[0x13]  07      03    E2 01      08  0D  38 00   B9 04       B8 01       38 00    B9 04        B8 01 
[0x14]  08      02    FC 01      08  0D  39 00   0F 04       F7 01       39 00    0F 04        F7 01 
[0x15]  09      03    2C 01      06  15  3A 00   90 03       C9 00       3A 00    90 03        C9 00 
[0x16]  0A      03    97 01      08  0D  3B 00   0E 05       F3 00       3B 00    0E 05        F3 00 
[0x17]  1E      03    16 02      08  0D  AE 00   52 00       2F 01       AE 00    52 00        2F 01 
[0x18]  1F      03    10 02      08  0D  9B 01   08 00       0F 00       5E 00    ED 00        0B 01 
[0x19]  23      00    18 01      08  0D  18 01   2A 00       17 00       27 00    6A 01        0B 01 
[0x1A]  21      00    2B 01      08  0D  1E 00   8D 03       29 01       1E 00    8D 03        29 01 
[0x1B]  1B      01    A9 00      08  0D  24 00   D4 01       A3 01       24 00    D4 01        A3 01 
[0x1C]  24      01    FF 01      08  0D  0B 00   8F 04       6B 00       0B 00    8F 04        6B 00 
[0x1D]  25      01    D2 01      08  0D  12 00   92 05       A4 00       12 00    92 05        A4 00
</code></pre>
<p>The <code>flySpot</code> field is the fly spot id that corresponds with the orange selection blocks structure.</p>
<p>The <code>flags</code> field covers whether or not the entry can be flown to (0x2) or if it's a whiteout spawn (0x1).  Add them together if both.</p>
<p>The <code>mapHeader</code> field is the inside map to warp to upon whiteout.  This is or'd with 0x100 if it is a whiteout spawn, and 0x200 if it's a flying spawn.</p>
<p>The <code>x</code> and <code>y</code> coordinates immediately following this are the global x and y coordinates within the matrix that the <code>mapHeader</code> is located in.</p>
<p>The <code>fieldId</code> is the map header at which you spawn when you fly or teleport to the spawn location.  This is duplicated in the <code>fieldId2</code> field.  The player spawns at the <code>fieldCoordX</code> and <code>fieldCoordY</code> fields (which are also duplicated).</p>
<p>Note that the first entry is set as the default respawn point at the beginning of the game.  It can be whichever <code>flySpot</code>--just needs to be accessed as the first entry.</p>
<h2 id="todo"><a class="header" href="#todo">TODO</a></h2>
<ul>
<li><code>flags</code> field in <code>GearMapTownSelectionOverlay</code></li>
<li>PokéDex Map Editing</li>
<li>Roamer Maps Possible</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-the-weather-from-a-script-platinumhgss-1"><a class="header" href="#setting-the-weather-from-a-script-platinumhgss-1">Setting the Weather From a Script <sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This tutorial was written by <a href="https://www.romhacking.net/community/6532/">RefinedPlat</a></p>
</blockquote>
<p>The goal of this tutorial is to use <code>AdrsValueSet</code> to alter a value related to the <code>DefogAnimation/FlashAnimation</code> command to make it update to an arbitrary weather of the scripter's choice.</p>
<p>First off, have a bit of context. Technically, the Generation 4 games have a command dubbed <code>ChangeWeather</code> that would alter the weather currently loaded by the area. Sadly, this command is dummied out, and will not work. However, the games do feature a pair of commands that set the weather to a specific value - <code>DefogAnimation</code><sup><em>Platinum</em></sup> and <code>FlashAnimation</code><sup><em>Heartgold</em></sup>. This, combined with a debug command called <code>AdrsValueSet</code> which allows for free editing of values in the RAM, means that these commands can be altered to change the weather to entirely different values, allowing for free control over the weather within a script with certain caveats.</p>
<blockquote>
<p>The following scripts change the weather <code>Defog</code><sup><em>Platinum</em></sup> or <code>Flash</code><sup><em>Heartgold</em></sup> set to your desired value. It then runs the <code>DefogAnimation</code>/<code>FlashAnimation</code> command to update the weather, and afterwards reverts the weather back to normal and finally sets it back to <code>0x0</code>/<code>0xC</code> so Defog/Flash work properly after the fact. This affects both in-battle and overworld weather. Obviously, if the default weather in an area is different, you'll have to make another <code>AdrsValueSet</code> to change it to that weather before setting the changed value back to default.
By doing a <code>TrainerBattle</code> command after triggering the shift, and then doing a <code>DefogAnimation</code> right afterwards, you can set weather for the duration of a battle and turn it off afterwards.</p>
<blockquote>
<p>Note that this does not show any unique animation or sound effect, and only updates the weather.</p>
</blockquote>
</blockquote>
<p>Keep in mind that the default value for Defog weather is 0x0 while Flash weather is 0xC.</p>
<hr />
<h2 id="important-limitations-1"><a class="header" href="#important-limitations-1">Important limitations:</a></h2>
<ul>
<li>You cannot run <code>FlashAnimation</code> or <code>DefogAnimation</code> in a Level Script while in a loading zone. This generates a null reference pointer and causes the game to crash on real hardware.
<ul>
<li>This basically means any screen transitions where you fade to black are off-limits, but ones where you simply move across the same matrix are okay. This includes very few areas in vanilla, however.</li>
</ul>
</li>
<li>Certain weather particles are on the same layer as the battle intro nametags. Consequently, having sandstorm weather when fighting Bertha will make her name move with the particles. This is how weather works in general and not specific to this tutorial.</li>
</ul>
<p>The <code>AdrsValueSet</code> value you want to change depends on the game and region. It uses absolute offsets within the RAM, so if you have changed the arm9's length you may need to find it again. Here is how to find the offsets of the values that this tutorial uses:</p>
<ul>
<li>
<p>Platinum:</p>
<ul>
<li><code>70 BD 38 B5 04 1C XX XX XX XX C0 68 F7 F7 XX XX XX XX 00 21 XX XX XX XX 28 1C F7 F7 BC FD 80 34 01 1C 20 68 40 68 C0 68 XX XX XX XX 01 20 38 BD</code></li>
</ul>
</li>
<li>
<p>Heart Gold: </p>
<ul>
<li><code>70 BD 38 B5 04 1C XX XX XX XX C0 68 F8 F7 XX XX XX XX 0C 21 XX XX XX XX 28 1C F8 F7 52 F9 80 34 01 1C 20 68 40 68 C0 68 XX XX XX XX 01 20 38 BD</code></li>
</ul>
</li>
</ul>
<p><br><br></p>
<p>For this tutorial there are a few offsets used: </p>
<ul>
<li>USA Platinum uses <code>0x2042BF8</code></li>
<li>USA Heartgold uses <code>0x20436D4</code></li>
</ul>
<details>
  <summary> Sample Script 1 - USA Platinum, Set Weather </summary>
<pre><code class="language-asm">Script 1:
	AdrsValueSet 0x2042BF8 0x##
	DefogAnimation
	AdrsValueSet 0x2042BF8 0x0
End
</code></pre>
</details>
<details>
  <summary> Sample Script 2 - USA Heartgold, Set Low Light </summary>
<pre><code class="language-asm">Script 1:
	AdrsValueSet 0x20436D4 0xD
	FlashAnimation
	AdrsValueSet 0x20436D4 0xC
End
</code></pre>
</details>
<details>
  <summary> Sample Script 3 - USA Heartgold, Temporary Weather</summary>
<pre><code class="language-asm">Script 2:
  AdrsValueSet 0x20436D4 0x##
	FlashAnimation
	AdrsValueSet 0x20436D4 0x0
	[Script Contents]
	FlashAnimation
	AdrsValueSet 0x20436D4 0xC
End
</code></pre>
</details>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-make-tms-reusableplatinumhgss-1"><a class="header" href="#how-to-make-tms-reusableplatinumhgss-1">How to make TMs Reusable<sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This guide was originally written by Drayano and formatted for this wiki by SpagoAsparago.</p>
</blockquote>
<blockquote>
<p>The Research was made by Mikelan98 with help from NextWorld and Bagboy.
Mikelan98 has requested that you give credit to him if you implement this in your hack.</p>
</blockquote>
<p>This is a guide on how to implement reusable TMs in Platinum and HGSS. The US versions of those games are used, so offsets may be not be the same if you're using a different version.</p>
<p>The tools required are an hex editor and Tinke 0.9.2, or instead CrystalTile2 if you're using HGSS.</p>
<hr />
<h2 id="table-of-contents-9"><a class="header" href="#table-of-contents-9">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#section">Extracting the files</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-1">Platinum</a></li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-2">HGSS</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#section-2">Hex Editing</a>
<ul>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-1">Making TMs infinte</a></li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#subsection-2">Removing the TM item count</a></li>
</ul>
</li>
<li><a href="gen4/guides/field/pt_hgss-reusabletms.html#section-3">Reinserting the files</a></li>
</ul>
<h2 id="extracting-the-files-2"><a class="header" href="#extracting-the-files-2">Extracting the files</a></h2>
<p>First you need to extract the relative files in order to perform the hex editing</p>
<h3 id="platinum-4"><a class="header" href="#platinum-4">Platinum</a></h3>
<p>For Platinum the files you need are <em>arm9.bin</em> and <em>overaly9_84</em>.</p>
<p>Open your ROM in Tinke, search the file, select it and click the extract button.</p>
<h3 id="hgss-4"><a class="header" href="#hgss-4">HGSS</a></h3>
<p>For HGSS you need to extract <em>arm9.bin</em> and <em>overlay_0015.bin</em>, but they are compressed unlike in Platinum hence the need for CystalTile2.
Open CrystalTile2 and then select File&gt;Open and select your ROM. Then click the NDS icon in the top bar, which should open a window called <em>NDS filesystem information</em>:</p>
<p><img src="gen4/guides/field/resources/pt_hgss-reusabletms/tms_ct2screen.PNG" alt="" /></p>
<p>Select the file you want to export, right click and click <em>Extract (U)</em>, and save it somewhere.
You can also use the arm9.bin from your DSPRE project folder, which is already uncompressed.</p>
<h2 id="hex-editing-3"><a class="header" href="#hex-editing-3">Hex Editing</a></h2>
<p>Load the files you extracted in a hex editor, then change the bytes according to the following steps, then save the files.</p>
<h3 id="making-tms-infinite-1"><a class="header" href="#making-tms-infinite-1">Making TMs infinite</a></h3>
<ul>
<li>For Platinum, at offset <code>0x865EB</code> in the arm9.bin change <code>D1</code> to <code>E0</code></li>
<li>For HGSS, at <code>0x825A7</code> in the arm9.bin change <code>D1</code> to <code>E0</code> </li>
</ul>
<h3 id="removing-the-tm-item-count-1"><a class="header" href="#removing-the-tm-item-count-1">Removing the TM item count</a></h3>
<ul>
<li>For Platinum, at <code>0x4372</code> in overlay 84 change <code>FF F7 83 FF</code> to <code>00 00 00 00</code></li>
<li>For HGSS,  at <code>0x6239</code> in overlay 15 change <code>D3</code> to <code>E0</code></li>
</ul>
<h2 id="reinserting-the-files-2"><a class="header" href="#reinserting-the-files-2">Reinserting the files</a></h2>
<ul>
<li>
<p>For Platinum just open your ROM in Tinke again, search the files you previously extracted, select them and click the <em>Change File</em> button to replace them with the ones you hex edited. Then save the ROM.</p>
</li>
<li>
<p>For HGSS, in the NDS filesystem information window, you can select the files you previously extracted, right click and this time click <em>Compression</em> and select your own hex edited files. If you're using the arm9 from DSPRE project folder, you only need to click <em>Import</em> instead. After you're done you can use <code>File&gt;Build ROM...</code> to save your ROM.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-change-the-hp-bar-speedplatinumhgss-1"><a class="header" href="#how-to-change-the-hp-bar-speedplatinumhgss-1">How to change the HP Bar speed<sup><em>(Platinum/HGSS)</em></sup></a></h1>
<blockquote>
<p>This guide was written by AdAstra, formatted for this wiki by SpagoAsparago.
Research: AdAstra, Mikelan98 and Nitram</p>
</blockquote>
<p>This is a tutorial on how to change the HP Bar speed in gen 4 games.</p>
<hr />
<h2 id="table-of-contents-10"><a class="header" href="#table-of-contents-10">Table of Contents</a></h2>
<ul>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#section">Cy's Hex Macros</a></li>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#section-2">Hex Editing</a>
<ul>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#subsection">Extracting the files</a></li>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#subsection-1">Changing the Speed</a></li>
<li><a href="gen4/guides/interface/pt_hgss-hp_bar_speed.html#subsection-2">Reinserting the files</a></li>
</ul>
</li>
</ul>
<h2 id="cys-hex-macros-1"><a class="header" href="#cys-hex-macros-1">Cy's Hex Macros</a></h2>
<p>For Platinum, if 2x speed is enough for your needs, you can use <a href="https://github.com/dev-cyw/Cy-s-Hex-Macros/releases/tag/v1.2">Cy's Hex Macros</a>.</p>
<p>Run the program and select the arm9.bin in your DSPRE's extracted folder, then click the appropriate button. 
When you load your project in DSPRE in order to export the ROM, remember to <strong>not</strong> re-extract it.</p>
<h2 id="hex-editing-4"><a class="header" href="#hex-editing-4">Hex Editing</a></h2>
<p>If you're using HGSS or want a different speed for Platinum, you need to hex edit the appropriate files. All offsets provided are based on the US ROM(s) and might be different on another version.</p>
<h3 id="extracting-the-files-3"><a class="header" href="#extracting-the-files-3">Extracting the files</a></h3>
<ul>
<li>
<p>Platinum:
Since Platinum overlays aren't compressed, you can just use the <em>overlay_0016.bin</em> file in the <em>YourROMNAme_DSPRE_contents/overlay</em> folder generated by DSPRE. Alternatively you can extract it with Tinke by searching <em>verlay_9_16</em> and clicking <em>Extract</em>.</p>
</li>
<li>
<p>HGSS:
HGSS overlays are compressed instead, so you can use CrystalTile2 to extract them already decompressed.
After you've loaded your ROM, click the NDS icon in the top bar, it should open a window called <em>NDS filesystem information</em>. From there, select <em>overlay_0022.bin</em>, right click and select <em>Extract (U)</em></p>
</li>
</ul>
<h3 id="changing-the-speed-1"><a class="header" href="#changing-the-speed-1">Changing the Speed</a></h3>
<p>Open the overlay in a hex editor, then go to the following offset:</p>
<ul>
<li>HGSS: <code>0x2E17A</code></li>
<li>Platinum: <code>0x2D046</code></li>
</ul>
<p>Then, replace the bytes at this offset with the following sequence, depending on the speed you want to have:</p>
<details> 
 <summary>HGSS</summary>
<div class="table-wrapper"><table><thead><tr><th>Byte Sequence</th><th>Speed</th></tr></thead><tbody>
<tr><td>80 01</td><td>x0.25</td></tr>
<tr><td>C0 01</td><td>x0.5</td></tr>
<tr><td>40 02</td><td>x2</td></tr>
<tr><td>80 02</td><td>x4</td></tr>
<tr><td>C0 02</td><td>x8</td></tr>
</tbody></table>
</div>
<p>If you want a speed that is not listed above:</p>
<details> 
 <summary>HGSS - Custom Speed</summary>
<ol>
<li>You'll need to use either <a href="https://shell-storm.org/online/Online-Assembler-and-Disassembler/">Shell-storm online assembler and disassembler</a> or an assembler like <a href="https://github.com/Kingcom/armips">Armips</a></li>
<li>Assemble the instruction <code>LSLS R0, R0, #yourNumber</code>, with the default <code>#yourNumber</code> being 8, which means the base speed is <code>2^8 = 256</code>.</li>
<li>Paste the assembled bytes in the overlay</li>
</ol>
</details>
</details>
<details> 
 <summary>Platinum</summary>
<div class="table-wrapper"><table><thead><tr><th>Byte Sequence</th><th>Speed</th></tr></thead><tbody>
<tr><td>88 1E</td><td>x2</td></tr>
<tr><td>C8 1E</td><td>x3</td></tr>
<tr><td>08 1F</td><td>x4</td></tr>
<tr><td>48 1F</td><td>x5</td></tr>
<tr><td>88 1F</td><td>x6</td></tr>
<tr><td>C8 1F</td><td>x7</td></tr>
</tbody></table>
</div></details>
<p>If you want to fine-tune the speed Animation:</p>
<details><summary>How to fine-tune the speed Animation (HGSS only):</summary>
<ol>
<li>
<p>If you haven't already, you need to expand the arm9 using DSPRE's toolbox</p>
</li>
<li>
<p>Paste this at 0x14FF0 of your synthetic overlay file:</p>
</li>
</ol>
<pre><code>2D 2D 48 50 20 42 41 52 20 53 50 45 45 44 2D 2D 
80 21 49 00 48 43 11 1C 70 47 C0 46 FF FF FF FF
</code></pre>
<ul>
<li>
<p>The first byte of the second row (default is <code>0x80</code>) represents the speed &quot;fine control&quot;.</p>
</li>
<li>
<p><code>80 21 49 00</code> means the speed is 128*2 = 256. [x1]</p>
</li>
<li>
<p><code>A0 21 49 00</code> means the speed is 160*2 = 320. [x1.25]</p>
</li>
<li>
<p><code>C0 21 49 00</code> means the speed is 192*2 = 384. [x1.5]</p>
</li>
<li>
<p>...up to <code>FF 21 49 00</code>, which means the speed is 255*2 = 510. [x1.9921]</p>
</li>
<li>
<p>The third byte of the second row (default is <code>0x49</code>) acts as a cumulative multiplier, or &quot;coarse control&quot;. </p>
</li>
<li>
<p>Increasing that value will allow you to set the speed even higher.</p>
</li>
<li>
<p><code>60 21 89 00</code> means the speed is 96*4 = 384. [x1.5]</p>
</li>
<li>
<p><code>80 21 89 00</code> means the speed is 128*4 = 512. [x2]</p>
</li>
<li>
<p><code>EC 21 89 00</code> means the speed is 236*4 = 944. [x3.6875]</p>
</li>
<li>
<p>...up to <code>FF 21 89 00</code>, which means the speed is 255*4 = 1020. [x3.9843]</p>
</li>
</ul>
<ol start="3">
<li>Paste <code>77 F1 D1 FA</code> at <code>0x2E17A</code> offset of uncompressed overlay12.</li>
</ol>
</details>
<h3 id="reinserting-the-files-3"><a class="header" href="#reinserting-the-files-3">Reinserting the files</a></h3>
<ul>
<li>For Platinum, if you edited the overlay in DSPRE's content folder, just load your ROM in DSPRE and export it. Remember to <strong>not</strong> re-extract the contents. If you extracted the overlay with Tinke, just do the same steps you did for extracting it, but this time use the <em>Change File</em> button and select your extracted overlay you modified.</li>
<li>For HGSS, in CrystalTile's NDS filesystem information window, you can select the overlay you previously extracted, right click and this time click <em>Compression</em>, then select your own hex edited overlay. After you're done you can use <code>File&gt;Build ROM...</code> to save your ROM.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="code-injection-guide-generation-v"><a class="header" href="#code-injection-guide-generation-v">Code Injection Guide (Generation V)</a></h1>
<p><em>It is recommended to check out the <a href="gen5/guides/misc/universal/guides/code_injection/code_injection.html">universal code injection guide</a> before attempting this. This tutorial assumes that you have intermediate C++/ARMv5T assembly knowledge and know how to use a compiler or build system.</em></p>
<h2 id="setting-up-your-environment"><a class="header" href="#setting-up-your-environment">Setting up your environment</a></h2>
<p>So, you think you've got what it takes to have a crack at Generation V code injection? Then press onward!</p>
<p>First, we've got to set up a few prerequisites. It's a boring job but I promise it'll be smooth sailing from there on out. To start, download (and install, where applicable) all these:</p>
<ul>
<li><a href="https://github.com/kingdom-of-ds-hacking/CTRMap-CE/releases">CTRMap Community Edition</a></li>
<li><a href="https://github.com/kingdom-of-ds-hacking/CTRMapV">CTRMapV (Generation V plugin for CTRMap)</a></li>
<li><a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads">The <code>arm-none-eabi</code> GCC toolchain</a></li>
<li><a href="https://github.com/kingdom-of-ds-hacking/PMC/releases">Latest RPM build of <code>PMC</code></a></li>
<li><a href="https://github.com/kingdom-of-ds-hacking/swan">Pokémon White 2 development headers</a></li>
<li><a href="https://github.com/HelloOO7/NitroKernel/releases">Latest NitroKernel DLL</a></li>
</ul>
<p><strong>Note: This guide assumes that you are using a American Pokémon White 2 [IRDO] (and strictly no other) ROM. This does not mean Black, White, or Black 2 cannot be used; as long as you provide the relevant materials, they can be used for code injection.</strong> </p>
<p>Before you get into code injection, set up a CTRMap project and load it up. If everything went as planned, there should be a <code>Code injection</code> section in your <code>Extras</code> tab. This is where it gets interesting:</p>
<ol>
<li>Click the <code>Install/Update PMC</code> button and select your <code>PMC.rpm</code> file. You should do this every time <code>libRPM</code> is updated, as the DLLs that CTRMap produces need the latest version of PMC to be recognized.</li>
<li>Make sure that there is a <code>patches</code> directory in your project's <code>vfs/data</code>. If there isn't one, create it. Move your <code>NitroKernel.dll</code> into that directory.</li>
<li>Export your ROM from CTRMap.</li>
<li>If everything went correctly, there should be a <code>00</code> byte at <code>0x02005050</code> in your game's RAM as part of PMC's initialization code.</li>
</ol>
<h2 id="building-code-injection-patches"><a class="header" href="#building-code-injection-patches">Building code injection patches</a></h2>
<h3 id="symbol-maps"><a class="header" href="#symbol-maps">Symbol maps</a></h3>
<p>There are two quintessential things that you need in order to begin writing proper code injection modules. The first one - a compiler - you've already got since Chapter 1. The other is what we call an <code>ESDB</code> (short for &quot;external symbol database&quot;) and is pretty much the stepping stone for interfacing and hijacking game routines. If you've already got one from a friend or relative, you should be all set, however, should you need to build your own one, that's also an option:</p>
<ol>
<li>Export the symbols you need from IDA using <code>File &gt; Produce file &gt; Create MAP file...</code></li>
<li>Copy the contents of IDA's Segment Register table (<code>View &gt; Open subviews &gt; Segment registers</code>) into a text file.</li>
<li>Open the result <code>.map</code> file in a text editor and fix the segment starting addresses to their proper values instead of <code>00000000</code>. IDA's just sometimes moody like that.</li>
<li>Run <code>MAP2ESDB</code>. If you do not have it, there are two ways to acquire it.
<ul>
<li>Clone and build the <a href="https://github.com/HelloOO7/RPMAuthoringTools">RPM authoring tools</a>, then execute MAP2ESDB in your console.</li>
<li>Use the CTRMap JAR (<code>java -cp &lt;path to CTRMap JAR&gt; rpm.cli.MAP2ESDB</code>) to launch MAP2ESDB.</li>
</ul>
</li>
<li>Proceed with the instructions provided by the command line interface. Use your .map as <code>--map</code> and your segment register plaintext as <code>--thmfile</code>.</li>
<li>Once done, you should have an <code>esdb.yml</code> or similar all built and ready for code injection.</li>
</ol>
<h3 id="programming"><a class="header" href="#programming">Programming</a></h3>
<p>Here's where you'll finally put those headers you downloaded earlier to good use! Any function that you've included in your ESDB, you can now use from your C++ code as long as it is properly declared. <strong>If you hate C++ for some reason, <del>that's tough</del> you can also use assembly; see <a href="gen5/guides/misc/bw_b2w2-code_injection.html#using-assembly">here</a>.</strong> </p>
<p>Some of the structures and functions we've researched have been compiled into the <code>swan</code> repo for convenience, and as long as they are in your ESDB, you can use them to their full advantage. Here are a couple of things you should keep in mind:</p>
<ul>
<li>Functions that have C linkage should be treated as such. Declaring them inside namespaces, or even outside them as plain C++ functions, will most likely not link up with your ESDB.</li>
<li>Failure to link a function against the ESDB is not reported in any way, since it's indistinguishable from a regular extern function present in a DLL and linked at run-time. Always make sure you've got everything registered properly before you commit.</li>
<li>Unless you really know what you're doing and you've got all the proper ABI functions handled, you shouldn't use the C++ standard library, RTTI or exceptions (in fact, you may want to disable them with <code>-fno-rtti</code> and <code>-fno-exceptions</code> in GCC).</li>
<li>Some C++ ABI features (pure virtual functions) are supported and backed by <code>NitroKernel</code>, but need to be included explicitly in order to prevent GCC from complaining. Including <code>ExtLib.Include</code> and its <code>ABI/exl_CxxAbi.h</code> should do the trick.</li>
<li>Floating point operations, albeit <em>very</em> slow, are supported on the DS to an extent, but should be avoided. <code>__aeabi_#fcmp#</code> functions aren't fully present on the target, so comparisons may produce undefined behavior.</li>
<li>Memory allocation through <code>malloc</code> and <code>free</code> will fail. This is because <code>malloc</code> by default allocates in the <code>0x02000000 - 0x02004000</code> area (as configured by the game), and said area is filled at boot for some reserved memory heaps. Instead, use the ExtLib new and delete operators (from <code>Heap/exl_MemOperators.h</code>) that pass through <code>exl::heap::Allocator</code>s, or Game Freak's <code>GFL_HeapAllocate</code> and <code>GFL_HeapDelete</code> functions. What might also be handy to know is that an <code>exl::heap::OSAllocator</code> can be created on demand for any GFL Heap ID with <code>exl::heap::OSAllocator::OSAllocator(HeapID heapId)</code>.</li>
<li>The entirety of the <code>ExtLib.Heap</code> library is included within your NitroKernel, so it's recommended that you use it wherever possible.</li>
<li>DLLs from the <code>lib</code> folder in the ROM root can be loaded using utility functions from NitroKernel's <code>k::dll</code> namespace.</li>
</ul>
<p>Got all that? Don't worry, if you didn't, I'm fairly sure this text isn't going to go anywhere. But now, we finally get to the fun part - actually injecting stuff!</p>
<h3 id="preparing-our-code-for-injection"><a class="header" href="#preparing-our-code-for-injection">Preparing our Code for Injection</a></h3>
<p>Historically, there were many ways of injecting code into existing executables, but they all essentially get down to one thing: hooks, or branches. Branches are, simply put, a processor directive that changes the program counter - a register containing a pointer to the currently executed instruction - to another value. Each ISA and CPU architecture has its own way of performing these, but in most cases only two things are required: a source and destination address. </p>
<p>In the early days of computing where programs had a fixed load address and memory space (also known as static loading), all branches were fully deterministic at compile time. This approach is still actually supported on modern CPUs through virtual memory addressing (in fact, some ancient Microsoft Windows programs rely on it to this day) and even though it's a thing of the past in desktop programming, it is still widely used in low-power embedded software, as is the case with standard Nintendo DS development. </p>
<p>However, since code injection is a highly volatile process with very little headroom, we've decided to borrow the more flexible approach of dynamic loading, which includes a lot of fun quirks that you can use to your own advantage. As per the definition of branches, any program jump requires a source and destination address, but since those may not be fully known at compile-time, they are often stored into a <a href="https://en.wikipedia.org/wiki/Relocation_(computing)">relocation table</a> that is used to correct the branch instructions within the program once the executable is fixed in memory. </p>
<p>Inasmuch as the DS has next to no memory protection, we can easily use these to perform the relocation process even outside of our program - such as the game code! All you've gotta do is adjust the relocation table accordingly, for which there are a grand total of two options:</p>
<ol>
<li>Use RPMTool's (<code>java -cp CTRMap.jar rpm.cli.RPMTool</code> or build RPMAuthoringTools) <code>--in-relocations-yml</code> to manually specify the relocations using an YML file (not recommended).</li>
<li>Use the automated hook derivation process built into CTRMap.</li>
</ol>
<p>To have the RPM converter automatically convert your function into a relocation referring to it, it needs to be in either of the following formats:</p>
<ul>
<li><code>&lt;RELOCATION_TYPE&gt;_FunctionName</code> - hooks directly into the start of a named function (e.g. <code>THUMB_BRANCH_BagSave_AddItem</code>)</li>
<li><code>&lt;RELOCATION_TYPE&gt;_FunctionName_0xoffset</code> - hooks into a function-relative offset (e.g. <code>THUMB_BRANCH_LINK_BagSave_AddItem_0x2</code>)</li>
<li><code>&lt;RELOCATION_TYPE&gt;_SEGMENT_0xaddress</code> - hooks at an absolute address within a segment (e.g. <code>FULL_COPY_ARM9_0x02008268</code>)</li>
</ul>
<p>I know that might be a lot to take in at first, so let's take this apart piece by piece. </p>
<ul>
<li>First of all, there's the function names. If a function is to be overriden with another, these should match the names in the ESDB, meaning they require explicit C linkage if used in C++. The relocation will then take place at the address of the function as specified in the ESDB, optionally offset by a constant addend. </li>
<li>Additionally, if you don't feel like using the name database or are aiming for some memory wizardry, you can directly input the memory address of the relocation. However, as a side effect of the static loading method used on the Nintendo DS, you also have to specify a &quot;segment&quot; (in a similar way as the ESDB segment header does) of the address, which ensures that the relocation won't be inadvertently applied to an undesirable module, such as an overlay that shares the memory area with another. </li>
<li>Last, but certainly not least, there is the <code>RELOCATION_TYPE</code> parameter. Its value specifies what data or CPU instruction should be written to the destination address. This is especially important on the ARM architecture, as it distinguishes between two instruction sets (ARM and Thumb) which use two separate methods of encoding. As a result, you've got quite a lot of options, but be wary - they are not at all interchangeable! The specific procedures are described in detail <a href="https://github.com/HelloOO7/libRPM/blob/master/include/RPM_Control.h">here</a>, but for starters, here's a quick reference that should hopefully guide you towards a correct choice:
<ul>
<li><code>THUMB_BRANCH</code> writes a one-way branch using the 16-bit Thumb instruction encoding. In most cases, this will be converted into a <code>PUSH, BL, PUSH</code> because of Thumb short branch restrictions, meaning you'll have to use another method for functions that use the stack for parameters (basically any with more than 4*4 bytes of arguments).</li>
<li><code>THUMB_BRANCH_SAFESTACK</code> does exactly that. While it takes up more space (which generally isn't a problem as the overriden function isn't going to be a little one just based off its argument count), this relocation type preserves all stack parameters.</li>
<li><code>THUMB_BRANCH_LINK</code> writes a simple BL/BLX using the 16-bit Thumb instruction encoding. This is useful for intercepting a function call in only one place as opposed to replacing the entire implementation.</li>
<li><code>ARM_BRANCH</code> and <code>ARM_BRANCH_LINK</code> - 32-bit ARM instructions equivalent to <code>THUMB_BRANCH</code> and <code>THUMB_BRANCH_LINK</code> respectively. Since ARM short branches cover a decent address range, there isn't a need for <code>THUMB_BRANCH_SAFESTACK</code>.</li>
<li><code>FULL_COPY</code> copies the raw contents of the function/symbol onto the destination address. Bear in mind that this will not carry over relocations (unless hard-linked into the ROM, which isn't our objective here) inside the function, so it is only useful for simple injections.</li>
</ul>
</li>
</ul>
<p>From here on, if you name your function according to these rules, the linker will magically make it so that it will override the specified code. The future is now, thanks to science!</p>
<h3 id="compiling"><a class="header" href="#compiling">Compiling</a></h3>
<p>You can compile your code using standard GCC CLI, or using a build system like CMake. While compiling, be sure to use the following options:</p>
<ul>
<li><code>-r</code> - produce a relocatable executable.</li>
<li><code>-march=armv5t</code> - target the ARMv5T architecture.</li>
<li><code>-mthumb (optional)</code> - generate Thumb instructions (instead of ARM).</li>
<li><code>-Os</code> - optimize for code size.</li>
</ul>
<p>Additionally, if using CMake, you'll need to provide the following variables before compiler configuration to pass the compiler test:</p>
<pre><code>set(CMAKE_SYSTEM_NAME             Generic)
set(CMAKE_SYSTEM_PROCESSOR            arm)
set(CMAKE_C_FLAGS   &quot;--specs=nosys.specs&quot;)
set(CMAKE_CXX_FLAGS &quot;--specs=nosys.specs&quot;)
</code></pre>
<p>If you're using dynamic linking for parts of your code, be sure to load the dependencies (and properly release them!) using <code>k::dll::LoadLibrary</code> (resp. <code>k::dll::ReleaseLibrary</code>) from NitroKernel. If you need to do this in initialization, create a <code>DllMain</code> function using libRPM's <code>RPM_DLLMAIN_DECLARE</code> and <code>RPM_DLLMAIN_DEFINE</code> macros, then write your loading code to run on module load/unload.</p>
<h3 id="linking"><a class="header" href="#linking">Linking</a></h3>
<p>Linking is probably the simplest part of the entire process, in fact, it's so trivial that we'll skip over it in just one (1) step:</p>
<ol>
<li>Click the <code>Convert ELF to DLL</code> button in CTRMap's Extras panel and follow the instructions.</li>
</ol>
<p>Just in case you didn't hear me, that's:</p>
<ol>
<li>When prompted, select the ESDB file to be used for linking (be wary that this will not be reloaded when changed on disk).</li>
<li>Then select the ELF file you compiled and a destination DLL file.</li>
<li>Copy the result DLL into your <code>patches</code> or <code>lib</code> folder.</li>
<li>You're done! Save your ROM, cross your fingers and start it up!</li>
</ol>
<h2 id="additional-notes"><a class="header" href="#additional-notes">Additional notes</a></h2>
<h3 id="using-assembly"><a class="header" href="#using-assembly">Using Assembly</a></h3>
<p>If you do not feel like writing C or C++, or you want to do a relatively simple patch, then you are also able to use assembly! 
C and C++ compile into assembly, which is then assembled into an executable and linkable format (ELF) file. Assembly is just assembled into the ELF format directly. So, you can very easily use tools such as kingcom's armips, or (if you set up the C/C++ compiler above) the GNU assembler.</p>
<p>To use assembly, just follow the same conventions above for naming functions/symbols. Then, assemble and link your file with the instructions above. Assuming you are using the GNU assembler, you just need to use the following options when assembling your file:</p>
<ul>
<li><code>-march=armv5t</code> - target the ARMv5T architecture.</li>
<li><code>-mthumb (optional)</code> - generate Thumb instructions (instead of ARM).</li>
<li><code>-mtune=arm946e-s</code> (optional) - target the ARM946E-S architecture.</li>
</ul>
<p>From there, just follow the steps for <a href="gen5/guides/misc/bw_b2w2-code_injection.html#linking">linking</a>.</p>
<h3 id="patch-priority"><a class="header" href="#patch-priority">Patch priority</a></h3>
<p>Should you need to change the priority of loading a DLL patch to higher than 4 (default), hold the <code>Alt</code> key while clicking <code>Convert ELF to DLL</code> and you'll be prompted to choose the priority after conversion.</p>
<h3 id="changing-esdbs-mid-stream"><a class="header" href="#changing-esdbs-mid-stream">Changing ESDBs mid-stream</a></h3>
<p>Holding <code>Shift</code> while clicking <code>Convert ELF to DLL</code> will prompt you to re-select an ESDB even if you've selected one already.</p>
<h3 id="dynamic-loading"><a class="header" href="#dynamic-loading">Dynamic loading</a></h3>
<p>Unlike WinAPI where you need to use <code>GetProcAddress</code> unless you know the exact address layout of your DLL, libRPM's dynamic linker only requires function names to match (the lookup is done using fast hash tables, so technically there are only about 4 billion possible combos, meaning collision is possible). As a result, headers are all that's needed to properly include a library.</p>
<p>NitroKernel's library loader forces all libraries to be stored in <code>/lib</code> with the <code>.dll</code> extension. A library named <code>Library.dll</code> would then be loaded with <code>k::dll::LoadLibrary(&quot;Library&quot;)</code>.</p>
<h3 id="debug-prints"><a class="header" href="#debug-prints">Debug prints</a></h3>
<p>If you're using DeSmuMe or a similar &quot;nocash message&quot; compliant emulator, you can use the <code>_DeSmuMe</code> DLL of NitroKernel to enable debug prints through <code>k::Print</code> or <code>k::Printf</code>.</p>
<p>The maximum length of a print string in NitroKernel is 1024 characters.</p>
<h3 id="multithreading"><a class="header" href="#multithreading">Multithreading</a></h3>
<p>Should you really need to simulate a multi-threaded context on the Nintendo DS's single-core CPU (such as for audio processing or asynchronous rendering), you can do so using NitroKernel's <code>kThread</code> library. Keep in mind though that this will add a slight overhead to your code and should wherever possible be substituted with a single-threaded replacement.</p>
<h3 id="rpm-version-support"><a class="header" href="#rpm-version-support">RPM version support</a></h3>
<p>RPMs that do not target the libRPM version present in the installed PMC module will produce undefined behavior. It is therefore recommended to recompile all modules to the latest version in case of uncertainty. If you're using CTRMap, you can upgrade all modules in the <code>patches</code> and <code>lib</code> VFS folders using a button in the Extras panel.</p>
<h3 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h3>
<p>DeSmuME + IDA debugger is your best friend.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inserting-your-own-maps-in-gen-v-games"><a class="header" href="#inserting-your-own-maps-in-gen-v-games">Inserting your own Maps in Gen V games</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago, based on information provided by Gonhex</p>
</blockquote>
<p>This is a tutorial on how to insert your own maps in generation 5 games, as well as change the Area Data textures.
It is assumed you have already made your map in PDSMS (or Blender) and have all the files already converted. If you're unsure how to do so, check Jay's video on creating a map with PDSMS.</p>
<hr />
<h2 id="table-of-contents-11"><a class="header" href="#table-of-contents-11">Table of Contents</a></h2>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section">Replacing Maps</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-2">Finding the Map file</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-3">Adding a new Header</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-4">Inserting the Map</a>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#subsection">Using BasicPerHandler</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#subsection-2">Using SAK</a></li>
</ul>
</li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-5">Updating the Area Data</a></li>
</ul>
<h2 id="replacing-maps"><a class="header" href="#replacing-maps">Replacing Maps</a></h2>
<p>First you need to open CTRMap Zone Loader, and select the map you want to replace. From this window you want to keep in mind:</p>
<ol>
<li>The Zone ID (Header Number in SDSME)</li>
<li>The Matrix</li>
<li>If your map is using textures not present in the original map, then the <em>Area</em> value as well</li>
</ol>
<p><img src="gen5/guides/field/resources/bw_b2w2-map_insertion/mapinsertion.png" alt="" /></p>
<h2 id="finding-the-map-file"><a class="header" href="#finding-the-map-file">Finding the map file</a></h2>
<p>Now you have to find the file number of the map you want to replace, you can do so in two ways:</p>
<ul>
<li>Using SDSME:</li>
</ul>
<p><strong>Only use SDSME for viewing purposes, you shouldn't use it to extract or import files</strong>.</p>
<p>Go to the Matrix Editor tab and select your Matrix. Then in the Map Headers tab find out where your Zone ID is located. Open the Map Files tab, and the number you're looking for will be at the same spot of that header in the previous tab. If there is no Map Header tab for the Matrix you've selected, it means all Map Files share the same header.</p>
<ul>
<li>Using GFMatrixEditor:</li>
</ul>
<p>First you have to oepn your ROM with <a href="https://github.com/R-YaTian/TinkeDSi/releases/tag/V0.9.3">TinkeDSi</a>, navigate the filesystem to a/0/0/9, and extract the file corrisponding to the matrix number.
Then launch <a href="https://drive.google.com/file/d/1w6SL2llu9oiIev5XIV2XdEQpJm-APm27/view?usp=sharing">GFMatrixEditor</a> and click the GFMat-&gt;Pack button, it will generate two spreadsheet, contaning the Headers and Map files for that matrix. Open the Headers spreadsheet and check where your Zone ID is located, then open the Map Files spreadsheet and at the same spot check what number is there. That's the Map File you're looking for.</p>
<h2 id="inserting-the-map"><a class="header" href="#inserting-the-map">Inserting the Map</a></h2>
<p>There are two different programs that can insert the map:</p>
<h3 id="using-basicperhandler"><a class="header" href="#using-basicperhandler">Using BasicPerHandler</a></h3>
<p>In order to use <a href="https://drive.google.com/drive/folders/1eJwed-scWbroN5mGJdg2T10ZrYdanheH">BasicPerHandler</a> you have to first extract the Map Container narc. Load your ROM with Tinke, navigate to a/0/0/8 in the filesystem, select it and click <em>Extract File</em>, and save the file somewhere.</p>
<p>Then launch BasicPerHandler, click <em>File</em>&gt;<em>Load</em> and select that extracted file. From the list of Map Files, select the one with the number you previously found.</p>
<p>Now all that's left is importing all the files using the buttons below the Matrix view; they are all fairly self-explanatory and you should have all the relevant files from PDSMS.</p>
<p>Remember to also click the <em>Remove</em> button on the Building Table section, unless for the map you're inserting you wish to keep the original buildings (if there are any).</p>
<p>After you're done, click the save button and save the new map container narc. Follow the steps you used to extract it but instead of <em>Extract File</em> click <em>Change File</em> instead, then save your ROM.</p>
<h3 id="using-sak"><a class="header" href="#using-sak">Using SAK</a></h3>
<p>If you've never used <a href="https://github.com/PlatinumMaster/SwissArmyKnife/releases">Swiss Army Knife</a>, before launching the program you will have to go to SAK folder and in there create a new folder called <em>BaseROMs</em>, and in there put a fresh copy of the ROM you're editing. It must be named <em>Black</em>/<em>White</em>/<em>Black 2</em>/<em>White 2</em>.
Now you can launch SAK and create a new project. </p>
<p>Go to the <em>Map Editor</em> tab and from the <em>Container Index</em> menu select the Map File number you previously found. Then it's just a matter of importing the relevant files:</p>
<ul>
<li><em>Map Model</em> is the .NSBMD file</li>
<li><em>Permissions</em> is the .per file</li>
<li>At <em>Building Positions</em> click the remove button if possible, unless you wish to keep the original map buildings.</li>
</ul>
<p>After you're done, save the ROM.</p>
<h2 id="updating-the-area-data"><a class="header" href="#updating-the-area-data">Updating the Area Data</a></h2>
<p>Now your map is inserted into the game, but it will still have its old textures used, meaning if you're using different textures than the map you're replacing, they will have a lot of white spots, so you have to replace the old texture set used with your own that you exported from PDSMS.</p>
<p>Open your ROM in Tinke, then go to a/0/1/4 and unpack it. You will see a list of files named <em>4_number.BTX0</em>, go to the file with the same number as the <em>Area</em> value in CTRMap Header, select it and click <em>Change File</em>, and replace it with your own NSBTX. </p>
<p>Keep in mind that if the map you replaced has different textures based on seasons, the next 3 files in the narc will be used as well. So for example if your Area Data number listed in CTRMap is 182, you will have to replace files 182, 183, 184 and 185 as well.</p>
<p><strong>Remember to pack the narc before saving the ROM!</strong></p>
<p>Go back to a/0/1/4 and click the <em>Pack</em> button. There is no visual confirmation of this in Tinke.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exporting-and-importing-buildings-fromto-gen-5-games"><a class="header" href="#exporting-and-importing-buildings-fromto-gen-5-games">Exporting and Importing buildings from/to Gen 5 games</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago.</p>
</blockquote>
<p>This is a tutorial on how to export and import buildings in gen 5 games.
You will need to have installed <a href="https://github.com/kingdom-of-ds-hacking/CTRMapV/releases">CTRMap-CE</a> as well as the <a href="https://github.com/kingdom-of-ds-hacking/CTRMapV/releases">CTRMapV</a> plugin, then create a project of the game you want to import/export buildings to/from if you haven't already.</p>
<hr />
<h2 id="table-of-contents-12"><a class="header" href="#table-of-contents-12">Table of Contents</a></h2>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#section">Exporting Buildings</a>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#subsection">Exporting Animations</a></li>
</ul>
</li>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#section-2">Importing Buildings</a>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#subsection-2">Importing Animations</a></li>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#subsection-3">Animated Doors</a></li>
</ul>
</li>
</ul>
<p>The first thing you want to do is load the map you want to export/import your building(s) using the Zone Loader, then open the building editor by clicking the Pokémon Center icon in the World Editor's top bar, and then click <em>Edit Resource Bundle</em></p>
<p><img src="gen5/guides/field/resources/bw_b2w2-buildings/ctrmapbuildingeditor.PNG" alt="" /></p>
<h2 id="exporting-buildings"><a class="header" href="#exporting-buildings">Exporting Buildings</a></h2>
<p>Select the building you want to export from the list on the left side of the editor, then click the <em>Open in CS</em> button right below. This will launch Creative Map studio, from where you can export the model in a number of different formats, using the <em>Export</em> options from the top bar.</p>
<p>About the different file types you can get, it's worth mentioning:</p>
<ul>
<li>COLLADA: exports as <strong>DAE</strong> format</li>
<li>NNS Resource: exports as <strong>NSBMD</strong>, Nintendo's proprietary format</li>
<li>WaveFront OBJ: exports as <strong>OBJ</strong> format. The textures will be exported as a separate <strong>mtl</strong> file, keep both in the same directory.</li>
</ul>
<p>If you're planning to import the building in a gen 4 game, both DSPRE and PDSMS building editors only acccept NSBMD files. For gen 5 games, both OBJ and DAE work but the latter is recommended.</p>
<h3 id="exporting-animations"><a class="header" href="#exporting-animations">Exporting Animations</a></h3>
<p>If the building you want to export has an animation, you can export it by selecting the animation on the menu on the right side of the editor after having selected the building, then click the <em>Open in CS</em> button right below it.</p>
<p><img src="gen5/guides/field/resources/bw_b2w2-buildings/ctrmapanims.PNG" alt="" /></p>
<p>In Creative Studio, select the animation in the dropdown menu (it will be either in the Material or Skeletal Animation folder), then right click on it &gt; Export and it will be saved as a NSBTA/NSBCA file depending on the animation type.</p>
<p><img src="gen5/guides/field/resources/bw_b2w2-buildings/animscs.PNG" alt="" /></p>
<h2 id="importing-buildings"><a class="header" href="#importing-buildings">Importing Buildings</a></h2>
<p>Keep in mind that adding a building will simply display the building model in the map, but it won't change the map collision. For that you have to edit the tile permissions of the map in question trough PDSMS.</p>
<p>Open the map you want to add your building(s) to from the Zone Loader, then open the Building Editor. If the type of building you want to add is already present in the map, you can just add it by clicking the + button and then choosing it from the list, setting the coordinates and saving it.</p>
<p>If the building is not present, click the Edit Resource Bundle, and click the <strong>+</strong> button in the bottom left of the screen. Choose the DAE or OBJ you previously exported (or made on your own), once you've added all the buildings click <em>Commit Changes</em> &gt; <em>Resource Bundle</em> and <em>Static Texture Pack</em>.
Now you can close the tab and go back to the building editor in the world editor tab.</p>
<p>Click the <strong>+</strong> icon and select the type of the building from the list right below it. All that's left is setting coordinates of the new building you've added and clicking the save button. You can also press F5, the selected building will have a yellow outline; you can drag it across the map to the location you prefer.</p>
<h3 id="importing-animations"><a class="header" href="#importing-animations">Importing Animations</a></h3>
<ul>
<li>
<p>Material Animations:</p>
<p>After having imported the DAE/OBJ model, on the right side of the screen set the Animation Controller to <em>Ambient Generic</em>. Select the first <strong>X</strong> in the list, then click the blue arrow pointing downwards button, and select the NSBTA file you previously exported/created.</p>
</li>
<li>
<p>Skeletal Animations:
Same steps as above, the only differences are that you have to set the animation controllers to <em>Dynamic</em> instead, and you will import a NSBCA file.</p>
</li>
</ul>
<h3 id="animated-doors"><a class="header" href="#animated-doors">Animated Doors</a></h3>
<ul>
<li>If the building you want to import is a door (and its animations) you'll need to specify two different animations set:
Change the <em>1 set/4 animations</em> option to <em>2 sets/1 + 1 animation</em>, and for both sets you have to import respectively the Opening and Closing animation.</li>
<li>You can set the sound by changing the <em>Type</em> value from the top right of the building editor.</li>
<li>You need to bind the door to a building to have the animation actually work: select the building, then from the menu on the right side choose the door model and set its coordinates.</li>
</ul>
<p>Remember that you still have to click both <em>Commit Changes</em> and <em>Static Texture Pack</em> buttons after importing animations as well.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="code-injection-guide-generation-v-1"><a class="header" href="#code-injection-guide-generation-v-1">Code Injection Guide (Generation V)</a></h1>
<p><em>It is recommended to check out the <a href="gen5/guides/misc/universal/guides/code_injection/code_injection.html">universal code injection guide</a> before attempting this. This tutorial assumes that you have intermediate C++/ARMv5T assembly knowledge and know how to use a compiler or build system.</em></p>
<h2 id="setting-up-your-environment-1"><a class="header" href="#setting-up-your-environment-1">Setting up your environment</a></h2>
<p>So, you think you've got what it takes to have a crack at Generation V code injection? Then press onward!</p>
<p>First, we've got to set up a few prerequisites. It's a boring job but I promise it'll be smooth sailing from there on out. To start, download (and install, where applicable) all these:</p>
<ul>
<li><a href="https://github.com/kingdom-of-ds-hacking/CTRMap-CE/releases">CTRMap Community Edition</a></li>
<li><a href="https://github.com/kingdom-of-ds-hacking/CTRMapV">CTRMapV (Generation V plugin for CTRMap)</a></li>
<li><a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads">The <code>arm-none-eabi</code> GCC toolchain</a></li>
<li><a href="https://github.com/kingdom-of-ds-hacking/PMC/releases">Latest RPM build of <code>PMC</code></a></li>
<li><a href="https://github.com/kingdom-of-ds-hacking/swan">Pokémon White 2 development headers</a></li>
<li><a href="https://github.com/HelloOO7/NitroKernel/releases">Latest NitroKernel DLL</a></li>
</ul>
<p><strong>Note: This guide assumes that you are using a American Pokémon White 2 [IRDO] (and strictly no other) ROM. This does not mean Black, White, or Black 2 cannot be used; as long as you provide the relevant materials, they can be used for code injection.</strong> </p>
<p>Before you get into code injection, set up a CTRMap project and load it up. If everything went as planned, there should be a <code>Code injection</code> section in your <code>Extras</code> tab. This is where it gets interesting:</p>
<ol>
<li>Click the <code>Install/Update PMC</code> button and select your <code>PMC.rpm</code> file. You should do this every time <code>libRPM</code> is updated, as the DLLs that CTRMap produces need the latest version of PMC to be recognized.</li>
<li>Make sure that there is a <code>patches</code> directory in your project's <code>vfs/data</code>. If there isn't one, create it. Move your <code>NitroKernel.dll</code> into that directory.</li>
<li>Export your ROM from CTRMap.</li>
<li>If everything went correctly, there should be a <code>00</code> byte at <code>0x02005050</code> in your game's RAM as part of PMC's initialization code.</li>
</ol>
<h2 id="building-code-injection-patches-1"><a class="header" href="#building-code-injection-patches-1">Building code injection patches</a></h2>
<h3 id="symbol-maps-1"><a class="header" href="#symbol-maps-1">Symbol maps</a></h3>
<p>There are two quintessential things that you need in order to begin writing proper code injection modules. The first one - a compiler - you've already got since Chapter 1. The other is what we call an <code>ESDB</code> (short for &quot;external symbol database&quot;) and is pretty much the stepping stone for interfacing and hijacking game routines. If you've already got one from a friend or relative, you should be all set, however, should you need to build your own one, that's also an option:</p>
<ol>
<li>Export the symbols you need from IDA using <code>File &gt; Produce file &gt; Create MAP file...</code></li>
<li>Copy the contents of IDA's Segment Register table (<code>View &gt; Open subviews &gt; Segment registers</code>) into a text file.</li>
<li>Open the result <code>.map</code> file in a text editor and fix the segment starting addresses to their proper values instead of <code>00000000</code>. IDA's just sometimes moody like that.</li>
<li>Run <code>MAP2ESDB</code>. If you do not have it, there are two ways to acquire it.
<ul>
<li>Clone and build the <a href="https://github.com/HelloOO7/RPMAuthoringTools">RPM authoring tools</a>, then execute MAP2ESDB in your console.</li>
<li>Use the CTRMap JAR (<code>java -cp &lt;path to CTRMap JAR&gt; rpm.cli.MAP2ESDB</code>) to launch MAP2ESDB.</li>
</ul>
</li>
<li>Proceed with the instructions provided by the command line interface. Use your .map as <code>--map</code> and your segment register plaintext as <code>--thmfile</code>.</li>
<li>Once done, you should have an <code>esdb.yml</code> or similar all built and ready for code injection.</li>
</ol>
<h3 id="programming-1"><a class="header" href="#programming-1">Programming</a></h3>
<p>Here's where you'll finally put those headers you downloaded earlier to good use! Any function that you've included in your ESDB, you can now use from your C++ code as long as it is properly declared. <strong>If you hate C++ for some reason, <del>that's tough</del> you can also use assembly; see <a href="gen5/guides/misc/bw_b2w2-code_injection.html#using-assembly">here</a>.</strong> </p>
<p>Some of the structures and functions we've researched have been compiled into the <code>swan</code> repo for convenience, and as long as they are in your ESDB, you can use them to their full advantage. Here are a couple of things you should keep in mind:</p>
<ul>
<li>Functions that have C linkage should be treated as such. Declaring them inside namespaces, or even outside them as plain C++ functions, will most likely not link up with your ESDB.</li>
<li>Failure to link a function against the ESDB is not reported in any way, since it's indistinguishable from a regular extern function present in a DLL and linked at run-time. Always make sure you've got everything registered properly before you commit.</li>
<li>Unless you really know what you're doing and you've got all the proper ABI functions handled, you shouldn't use the C++ standard library, RTTI or exceptions (in fact, you may want to disable them with <code>-fno-rtti</code> and <code>-fno-exceptions</code> in GCC).</li>
<li>Some C++ ABI features (pure virtual functions) are supported and backed by <code>NitroKernel</code>, but need to be included explicitly in order to prevent GCC from complaining. Including <code>ExtLib.Include</code> and its <code>ABI/exl_CxxAbi.h</code> should do the trick.</li>
<li>Floating point operations, albeit <em>very</em> slow, are supported on the DS to an extent, but should be avoided. <code>__aeabi_#fcmp#</code> functions aren't fully present on the target, so comparisons may produce undefined behavior.</li>
<li>Memory allocation through <code>malloc</code> and <code>free</code> will fail. This is because <code>malloc</code> by default allocates in the <code>0x02000000 - 0x02004000</code> area (as configured by the game), and said area is filled at boot for some reserved memory heaps. Instead, use the ExtLib new and delete operators (from <code>Heap/exl_MemOperators.h</code>) that pass through <code>exl::heap::Allocator</code>s, or Game Freak's <code>GFL_HeapAllocate</code> and <code>GFL_HeapDelete</code> functions. What might also be handy to know is that an <code>exl::heap::OSAllocator</code> can be created on demand for any GFL Heap ID with <code>exl::heap::OSAllocator::OSAllocator(HeapID heapId)</code>.</li>
<li>The entirety of the <code>ExtLib.Heap</code> library is included within your NitroKernel, so it's recommended that you use it wherever possible.</li>
<li>DLLs from the <code>lib</code> folder in the ROM root can be loaded using utility functions from NitroKernel's <code>k::dll</code> namespace.</li>
</ul>
<p>Got all that? Don't worry, if you didn't, I'm fairly sure this text isn't going to go anywhere. But now, we finally get to the fun part - actually injecting stuff!</p>
<h3 id="preparing-our-code-for-injection-1"><a class="header" href="#preparing-our-code-for-injection-1">Preparing our Code for Injection</a></h3>
<p>Historically, there were many ways of injecting code into existing executables, but they all essentially get down to one thing: hooks, or branches. Branches are, simply put, a processor directive that changes the program counter - a register containing a pointer to the currently executed instruction - to another value. Each ISA and CPU architecture has its own way of performing these, but in most cases only two things are required: a source and destination address. </p>
<p>In the early days of computing where programs had a fixed load address and memory space (also known as static loading), all branches were fully deterministic at compile time. This approach is still actually supported on modern CPUs through virtual memory addressing (in fact, some ancient Microsoft Windows programs rely on it to this day) and even though it's a thing of the past in desktop programming, it is still widely used in low-power embedded software, as is the case with standard Nintendo DS development. </p>
<p>However, since code injection is a highly volatile process with very little headroom, we've decided to borrow the more flexible approach of dynamic loading, which includes a lot of fun quirks that you can use to your own advantage. As per the definition of branches, any program jump requires a source and destination address, but since those may not be fully known at compile-time, they are often stored into a <a href="https://en.wikipedia.org/wiki/Relocation_(computing)">relocation table</a> that is used to correct the branch instructions within the program once the executable is fixed in memory. </p>
<p>Inasmuch as the DS has next to no memory protection, we can easily use these to perform the relocation process even outside of our program - such as the game code! All you've gotta do is adjust the relocation table accordingly, for which there are a grand total of two options:</p>
<ol>
<li>Use RPMTool's (<code>java -cp CTRMap.jar rpm.cli.RPMTool</code> or build RPMAuthoringTools) <code>--in-relocations-yml</code> to manually specify the relocations using an YML file (not recommended).</li>
<li>Use the automated hook derivation process built into CTRMap.</li>
</ol>
<p>To have the RPM converter automatically convert your function into a relocation referring to it, it needs to be in either of the following formats:</p>
<ul>
<li><code>&lt;RELOCATION_TYPE&gt;_FunctionName</code> - hooks directly into the start of a named function (e.g. <code>THUMB_BRANCH_BagSave_AddItem</code>)</li>
<li><code>&lt;RELOCATION_TYPE&gt;_FunctionName_0xoffset</code> - hooks into a function-relative offset (e.g. <code>THUMB_BRANCH_LINK_BagSave_AddItem_0x2</code>)</li>
<li><code>&lt;RELOCATION_TYPE&gt;_SEGMENT_0xaddress</code> - hooks at an absolute address within a segment (e.g. <code>FULL_COPY_ARM9_0x02008268</code>)</li>
</ul>
<p>I know that might be a lot to take in at first, so let's take this apart piece by piece. </p>
<ul>
<li>First of all, there's the function names. If a function is to be overriden with another, these should match the names in the ESDB, meaning they require explicit C linkage if used in C++. The relocation will then take place at the address of the function as specified in the ESDB, optionally offset by a constant addend. </li>
<li>Additionally, if you don't feel like using the name database or are aiming for some memory wizardry, you can directly input the memory address of the relocation. However, as a side effect of the static loading method used on the Nintendo DS, you also have to specify a &quot;segment&quot; (in a similar way as the ESDB segment header does) of the address, which ensures that the relocation won't be inadvertently applied to an undesirable module, such as an overlay that shares the memory area with another. </li>
<li>Last, but certainly not least, there is the <code>RELOCATION_TYPE</code> parameter. Its value specifies what data or CPU instruction should be written to the destination address. This is especially important on the ARM architecture, as it distinguishes between two instruction sets (ARM and Thumb) which use two separate methods of encoding. As a result, you've got quite a lot of options, but be wary - they are not at all interchangeable! The specific procedures are described in detail <a href="https://github.com/HelloOO7/libRPM/blob/master/include/RPM_Control.h">here</a>, but for starters, here's a quick reference that should hopefully guide you towards a correct choice:
<ul>
<li><code>THUMB_BRANCH</code> writes a one-way branch using the 16-bit Thumb instruction encoding. In most cases, this will be converted into a <code>PUSH, BL, PUSH</code> because of Thumb short branch restrictions, meaning you'll have to use another method for functions that use the stack for parameters (basically any with more than 4*4 bytes of arguments).</li>
<li><code>THUMB_BRANCH_SAFESTACK</code> does exactly that. While it takes up more space (which generally isn't a problem as the overriden function isn't going to be a little one just based off its argument count), this relocation type preserves all stack parameters.</li>
<li><code>THUMB_BRANCH_LINK</code> writes a simple BL/BLX using the 16-bit Thumb instruction encoding. This is useful for intercepting a function call in only one place as opposed to replacing the entire implementation.</li>
<li><code>ARM_BRANCH</code> and <code>ARM_BRANCH_LINK</code> - 32-bit ARM instructions equivalent to <code>THUMB_BRANCH</code> and <code>THUMB_BRANCH_LINK</code> respectively. Since ARM short branches cover a decent address range, there isn't a need for <code>THUMB_BRANCH_SAFESTACK</code>.</li>
<li><code>FULL_COPY</code> copies the raw contents of the function/symbol onto the destination address. Bear in mind that this will not carry over relocations (unless hard-linked into the ROM, which isn't our objective here) inside the function, so it is only useful for simple injections.</li>
</ul>
</li>
</ul>
<p>From here on, if you name your function according to these rules, the linker will magically make it so that it will override the specified code. The future is now, thanks to science!</p>
<h3 id="compiling-1"><a class="header" href="#compiling-1">Compiling</a></h3>
<p>You can compile your code using standard GCC CLI, or using a build system like CMake. While compiling, be sure to use the following options:</p>
<ul>
<li><code>-r</code> - produce a relocatable executable.</li>
<li><code>-march=armv5t</code> - target the ARMv5T architecture.</li>
<li><code>-mthumb (optional)</code> - generate Thumb instructions (instead of ARM).</li>
<li><code>-Os</code> - optimize for code size.</li>
</ul>
<p>Additionally, if using CMake, you'll need to provide the following variables before compiler configuration to pass the compiler test:</p>
<pre><code>set(CMAKE_SYSTEM_NAME             Generic)
set(CMAKE_SYSTEM_PROCESSOR            arm)
set(CMAKE_C_FLAGS   &quot;--specs=nosys.specs&quot;)
set(CMAKE_CXX_FLAGS &quot;--specs=nosys.specs&quot;)
</code></pre>
<p>If you're using dynamic linking for parts of your code, be sure to load the dependencies (and properly release them!) using <code>k::dll::LoadLibrary</code> (resp. <code>k::dll::ReleaseLibrary</code>) from NitroKernel. If you need to do this in initialization, create a <code>DllMain</code> function using libRPM's <code>RPM_DLLMAIN_DECLARE</code> and <code>RPM_DLLMAIN_DEFINE</code> macros, then write your loading code to run on module load/unload.</p>
<h3 id="linking-1"><a class="header" href="#linking-1">Linking</a></h3>
<p>Linking is probably the simplest part of the entire process, in fact, it's so trivial that we'll skip over it in just one (1) step:</p>
<ol>
<li>Click the <code>Convert ELF to DLL</code> button in CTRMap's Extras panel and follow the instructions.</li>
</ol>
<p>Just in case you didn't hear me, that's:</p>
<ol>
<li>When prompted, select the ESDB file to be used for linking (be wary that this will not be reloaded when changed on disk).</li>
<li>Then select the ELF file you compiled and a destination DLL file.</li>
<li>Copy the result DLL into your <code>patches</code> or <code>lib</code> folder.</li>
<li>You're done! Save your ROM, cross your fingers and start it up!</li>
</ol>
<h2 id="additional-notes-1"><a class="header" href="#additional-notes-1">Additional notes</a></h2>
<h3 id="using-assembly-1"><a class="header" href="#using-assembly-1">Using Assembly</a></h3>
<p>If you do not feel like writing C or C++, or you want to do a relatively simple patch, then you are also able to use assembly! 
C and C++ compile into assembly, which is then assembled into an executable and linkable format (ELF) file. Assembly is just assembled into the ELF format directly. So, you can very easily use tools such as kingcom's armips, or (if you set up the C/C++ compiler above) the GNU assembler.</p>
<p>To use assembly, just follow the same conventions above for naming functions/symbols. Then, assemble and link your file with the instructions above. Assuming you are using the GNU assembler, you just need to use the following options when assembling your file:</p>
<ul>
<li><code>-march=armv5t</code> - target the ARMv5T architecture.</li>
<li><code>-mthumb (optional)</code> - generate Thumb instructions (instead of ARM).</li>
<li><code>-mtune=arm946e-s</code> (optional) - target the ARM946E-S architecture.</li>
</ul>
<p>From there, just follow the steps for <a href="gen5/guides/misc/bw_b2w2-code_injection.html#linking">linking</a>.</p>
<h3 id="patch-priority-1"><a class="header" href="#patch-priority-1">Patch priority</a></h3>
<p>Should you need to change the priority of loading a DLL patch to higher than 4 (default), hold the <code>Alt</code> key while clicking <code>Convert ELF to DLL</code> and you'll be prompted to choose the priority after conversion.</p>
<h3 id="changing-esdbs-mid-stream-1"><a class="header" href="#changing-esdbs-mid-stream-1">Changing ESDBs mid-stream</a></h3>
<p>Holding <code>Shift</code> while clicking <code>Convert ELF to DLL</code> will prompt you to re-select an ESDB even if you've selected one already.</p>
<h3 id="dynamic-loading-1"><a class="header" href="#dynamic-loading-1">Dynamic loading</a></h3>
<p>Unlike WinAPI where you need to use <code>GetProcAddress</code> unless you know the exact address layout of your DLL, libRPM's dynamic linker only requires function names to match (the lookup is done using fast hash tables, so technically there are only about 4 billion possible combos, meaning collision is possible). As a result, headers are all that's needed to properly include a library.</p>
<p>NitroKernel's library loader forces all libraries to be stored in <code>/lib</code> with the <code>.dll</code> extension. A library named <code>Library.dll</code> would then be loaded with <code>k::dll::LoadLibrary(&quot;Library&quot;)</code>.</p>
<h3 id="debug-prints-1"><a class="header" href="#debug-prints-1">Debug prints</a></h3>
<p>If you're using DeSmuMe or a similar &quot;nocash message&quot; compliant emulator, you can use the <code>_DeSmuMe</code> DLL of NitroKernel to enable debug prints through <code>k::Print</code> or <code>k::Printf</code>.</p>
<p>The maximum length of a print string in NitroKernel is 1024 characters.</p>
<h3 id="multithreading-1"><a class="header" href="#multithreading-1">Multithreading</a></h3>
<p>Should you really need to simulate a multi-threaded context on the Nintendo DS's single-core CPU (such as for audio processing or asynchronous rendering), you can do so using NitroKernel's <code>kThread</code> library. Keep in mind though that this will add a slight overhead to your code and should wherever possible be substituted with a single-threaded replacement.</p>
<h3 id="rpm-version-support-1"><a class="header" href="#rpm-version-support-1">RPM version support</a></h3>
<p>RPMs that do not target the libRPM version present in the installed PMC module will produce undefined behavior. It is therefore recommended to recompile all modules to the latest version in case of uncertainty. If you're using CTRMap, you can upgrade all modules in the <code>patches</code> and <code>lib</code> VFS folders using a button in the Extras panel.</p>
<h3 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h3>
<p>DeSmuME + IDA debugger is your best friend.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fairy-type-in-b2w2"><a class="header" href="#fairy-type-in-b2w2">Fairy Type in B2W2</a></h1>
<blockquote>
<p>This guide was written by <a href="https://github.com/BluRosie">BluRose</a> based significantly on research from <a href="https://www.pokecommunity.com/showthread.php?t=349000">MeroMero</a>.</p>
</blockquote>
<p>This is a tutorial that details how to insert the Fairy type in Black 2 and White 2 using MeroMero's <a href="https://www.pokecommunity.com/showthread.php?t=349000">initial research from years ago</a> and building upon it with a new and improved better understanding of just what happens in the assembly.  While yet imperfect, the improvements allow for a much better Fairy representation overall, eliminating the appearance of glitched graphics and crashes entirely.</p>
<hr />
<h2 id="table-of-contents-13"><a class="header" href="#table-of-contents-13">Table of Contents</a></h2>
<ul>
<li><a href="gen5/guides/misc/b2w2-fairy.html#graphics">Graphics</a>
<ul>
<li><a href="gen5/guides/misc/b2w2-fairy.html#type-icons---a082-a125">Type Icons - <code>a/0/8/2</code>, <code>a/1/2/5</code></a></li>
<li><a href="gen5/guides/misc/b2w2-fairy.html#move-selection-palette---a011">Move Selection Palette - <code>a/0/1/1</code></a></li>
<li><a href="gen5/guides/misc/b2w2-fairy.html#hall-of-fame-palette---a213">Hall of Fame Palette - <code>a/2/1/3</code></a></li>
</ul>
</li>
<li><a href="gen5/guides/misc/b2w2-fairy.html#code---asm-file">Code - ASM File</a></li>
<li><a href="gen5/guides/misc/b2w2-fairy.html#cleanup">Cleanup</a></li>
<li><a href="gen5/guides/misc/b2w2-fairy.html#todo">TODO</a></li>
</ul>
<h2 id="graphics"><a class="header" href="#graphics">Graphics</a></h2>
<p>Various other type graphics are leftover from possible features.  We look to replace those here.</p>
<h3 id="type-icons---a082-a125"><a class="header" href="#type-icons---a082-a125">Type Icons - <code>a/0/8/2</code>, <code>a/1/2/5</code></a></h3>
<p>Here we replace the Cool and ??? type icons with the Fairy type icon to allow us to print the icon.  Tinke allows us to do this by replacing the relevant files, first in <code>a/0/8/2</code>: </p>
<p><a href="gen5/guides/misc/resources/b2w2-fairy/a082_33.RLCN">a082_33.RLCN</a> and <a href="gen5/guides/misc/resources/b2w2-fairy/a082_51.RGCN">a082_51.RGCN</a> should replace the ones in the ROM from an extracted <code>a/0/8/2</code>.</p>
<p>This replaces <img src="gen5/guides/misc/resources/b2w2-fairy/cool_type.png" alt="" /> with <img src="gen5/guides/misc/resources/b2w2-fairy/fairy_type_1.png" alt="" /></p>
<p>Similarly in <code>a/1/2/5</code>, we just replace the ??? type icon at the bottom of an image to now be the Fairy type, replacing the files in <code>a/1/2/5</code> with <a href="gen5/guides/misc/resources/b2w2-fairy/a125_22.RLCN">a125_22.RLCN</a> and <a href="gen5/guides/misc/resources/b2w2-fairy/a125_23.RGCN">a125_23.RGCN</a></p>
<p>This replaces <img src="gen5/guides/misc/resources/b2w2-fairy/question_type.png" alt="" /> with <img src="gen5/guides/misc/resources/b2w2-fairy/fairy_type_2.png" alt="" />.</p>
<h3 id="move-selection-palette---a011"><a class="header" href="#move-selection-palette---a011">Move Selection Palette - <code>a/0/1/1</code></a></h3>
<p>Here we add a new palette to <code>a/0/1/1</code> to make Fairy moves appear as pink in the move selection screen.</p>
<p>This file is <a href="gen5/guides/misc/resources/b2w2-fairy/a011_572.RLCN">a011_572.RLCN</a>.</p>
<p><code>a011</code> originally just has 571 files.  We add a 572nd file for our purposes.  You can either unpack/repack using narchive (included in the b2w2-fairy repository) or Extract directory using Tinke, add the file, and Change by directory using Tinke again.</p>
<h3 id="hall-of-fame-palette---a213"><a class="header" href="#hall-of-fame-palette---a213">Hall of Fame Palette - <code>a/2/1/3</code></a></h3>
<p>Here we add a new palette to <code>a/2/1/3</code> to make Fairy Pokémon show up in the Hall of Fame with a pink nameplate.  This is currently bugged and unfinished, but once the code is written it will be fixed in the Git repo.</p>
<p>The file to replace with once extracted:  <a href="gen5/guides/misc/resources/b2w2-fairy/a213_9.RLCN">a213_9.RLCN</a></p>
<h2 id="code---asm-file"><a class="header" href="#code---asm-file">Code - ASM File</a></h2>
<p>I have made a <a href="https://github.com/BluRosie/b2w2-fairy">repository</a> which should be downloaded as-is that has the fairy type code and is maintained as such.  Any additions or changes (future bugfixes!) will be included there.</p>
<p>All you <em>need</em> to do is follow the instructions there, abridged here (currently for Windows only):</p>
<ul>
<li>Place your White 2/Black 2 ROM in the base folder (<code>b2w2-fairy-main</code>) as <code>base.nds</code></li>
<li>Read and modify the configs at the beginning of <code>asm\fairy.s</code>.  The only one that should really be changed is <code>BLACK2</code> being <code>1</code> if you are applying to Black 2, and <code>0</code> if applying to White 2.</li>
<li>Double click on the <code>applyfairytype.bat</code> batch file
<ul>
<li>A script will run that applies all the Fairy type code changes to copied overlay files and recompresses them in the base folder for ROM insertion</li>
</ul>
</li>
<li>Open <code>base.nds</code> in Tinke</li>
<li>&quot;Change file&quot; all of overlays 167, 168, 207, 255, 265, the overlay table (y9.bin), and the arm9</li>
<li>Save your ROM as some other named file</li>
</ul>
<details>
<summary>Documentation - Code Changes</summary>
<br>
<p><b>Overlay 167</b></p>
<p>This overlay hosts the type chart.  All the edits made to this overlay are for adjusting the type chart.  The type chart declaration is</p>
<pre><code class="language-c">const u8 gTypeEffectiveness[NUM_OF_TYPES][NUM_OF_TYPES];

gTypeEffectiveness[atkType][defType] grabs the effectiveness of atkType when attacking defType
- 08 is super effective
- 04 is normal effective
- 02 is not very effective
- 00 is ineffective
</code></pre>
<p>So all of the code for accessing subsequent entries needs to take into account an extra element in each row and an extra column.</p>
<br>
<p><b>Overlay 168</b></p>
<p>This overlay hosts the move type -&gt; move selection palette table.  We just write a 572 near the end of the file and leave it be to correspond to the newly created nclr in a011.</p>
<br>
<p><b>Overlay 207</b></p>
<p>This overlay handles a lot of the code for the summary screen.  We edit it to support the new type icon.</p>
<p>The old structure allocated for this was <code>0x264</code> in size, and at <code>0x130</code> it kept track of the type icon OAM id's or something like that.  I'm honestly not 100% certain what it is, but it maps something to the graphics.  This is a common theme with all of the type icon edits made.</p>
<p>First, we double the memory heap allocation size for the summary screen to give us freedom in messing with the structure.  We need to add an entry to the <code>0x130</code> structure.  This is an issue--it's baked into the overall structure.  We need to move it to the end of the old structure--we can do this by replacing the <code>0x130</code> entries that represent this with <code>0x264</code> and to increase the size of the allocated structure to begin with to allow for this moving.  How this is done is documented in the <code>asm\fairy.s</code> file.</p>
<br>
<p><b>Overlay 255</b></p>
<p>Similarly, the PC Screen has a structure <code>0xA5BC</code> in size.  At <code>0xA268</code> of this structure, the type icon OAM id's are stored once again.  This would be as simple as moving it to the end, but <code>0xA268</code> is actually just a part of a substructure that is baked into the overall structure that starts at <code>0x18C</code>.  At <code>0xA0DC</code> of this substructure, there is a massive array of OAM id's for every sprite that is possibly on screen.  This includes and captures the <code>0xA268</code> from the overall structure--so I end up writing a hook into that area that checks for the overall structure offset and will redirect it to the end if it's part of the type icons.</p>
<p>Whenever switching off of a Pokémon, the type icons are all deleted and and replaced--this is done by deleting all of the type OAM id's in a for loop.  There are two separate code areas that are run for these, one for switching onto a new Pokémon and another for switching into blank space.  These for loops are both expanded to run one more time for the Fairy type.</p>
<p>This new type then takes the tag of one of the boxes when &quot;move Pokémon&quot; is selected, so the box is then deleted instead of loaded in properly.  Need to look into moving the boxes to be one tag later.</p>
<br>
<p><b>Overlay 265</b></p>
<p>Here, the table <code>u32 type_to_loaded_gfx_hof[NUM_OF_TYPES]</code> exists to map the types to their loaded SPA file when the hall of fame cutscene happens.  This SPA is all of the particles that appear when the Pokémon slides on screen.  Similarly, the palette table is at the very end of the overlay, but currently assigning a valid palette causes a crash in the hall of fame.  As such, we currently just load an invalid palette to prevent the crash.</p>
</details>
<p><img src="gen5/guides/misc/resources/b2w2-fairy/summary_1.png" alt="" /> <img src="gen5/guides/misc/resources/b2w2-fairy/summary_2.png" alt="" /> <img src="gen5/guides/misc/resources/b2w2-fairy/select.png" alt="" /> <img src="gen5/guides/misc/resources/b2w2-fairy/pc_screen.png" alt="" /></p>
<h2 id="cleanup"><a class="header" href="#cleanup">Cleanup</a></h2>
<p>From there, just make Struggle type 18 to make it typeless.  Assign all the Pokémon that need it to be Fairy type.  Make moves that have the Fairy typing as well.  It's now a functional type entirely!</p>
<h2 id="todo-1"><a class="header" href="#todo-1">TODO</a></h2>
<ul>
<li>Type icon in the Dex does not show up--pure fairy types don't have anything show up!  Does not crash, though.</li>
<li>Hall of Fame palette loading--memory overflow or something?  Having it load nothing works fine, but appears as a black void.</li>
<li>PC Screen tag overlap--fairy is loaded in the same sprite slot as one of the box icons and is both scrolled as such and the box icon doesn't show up in the menu.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inserting-your-own-maps-in-gen-v-games-1"><a class="header" href="#inserting-your-own-maps-in-gen-v-games-1">Inserting your own Maps in Gen V games</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago, based on information provided by Gonhex</p>
</blockquote>
<p>This is a tutorial on how to insert your own maps in generation 5 games, as well as change the Area Data textures.
It is assumed you have already made your map in PDSMS (or Blender) and have all the files already converted. If you're unsure how to do so, check Jay's video on creating a map with PDSMS.</p>
<hr />
<h2 id="table-of-contents-14"><a class="header" href="#table-of-contents-14">Table of Contents</a></h2>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section">Replacing Maps</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-2">Finding the Map file</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-3">Adding a new Header</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-4">Inserting the Map</a>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#subsection">Using BasicPerHandler</a></li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#subsection-2">Using SAK</a></li>
</ul>
</li>
<li><a href="gen5/guides/field/bw_b2w2-map_insertion.html#section-5">Updating the Area Data</a></li>
</ul>
<h2 id="replacing-maps-1"><a class="header" href="#replacing-maps-1">Replacing Maps</a></h2>
<p>First you need to open CTRMap Zone Loader, and select the map you want to replace. From this window you want to keep in mind:</p>
<ol>
<li>The Zone ID (Header Number in SDSME)</li>
<li>The Matrix</li>
<li>If your map is using textures not present in the original map, then the <em>Area</em> value as well</li>
</ol>
<p><img src="gen5/guides/field/resources/bw_b2w2-map_insertion/mapinsertion.png" alt="" /></p>
<h2 id="finding-the-map-file-1"><a class="header" href="#finding-the-map-file-1">Finding the map file</a></h2>
<p>Now you have to find the file number of the map you want to replace, you can do so in two ways:</p>
<ul>
<li>Using SDSME:</li>
</ul>
<p><strong>Only use SDSME for viewing purposes, you shouldn't use it to extract or import files</strong>.</p>
<p>Go to the Matrix Editor tab and select your Matrix. Then in the Map Headers tab find out where your Zone ID is located. Open the Map Files tab, and the number you're looking for will be at the same spot of that header in the previous tab. If there is no Map Header tab for the Matrix you've selected, it means all Map Files share the same header.</p>
<ul>
<li>Using GFMatrixEditor:</li>
</ul>
<p>First you have to oepn your ROM with <a href="https://github.com/R-YaTian/TinkeDSi/releases/tag/V0.9.3">TinkeDSi</a>, navigate the filesystem to a/0/0/9, and extract the file corrisponding to the matrix number.
Then launch <a href="https://drive.google.com/file/d/1w6SL2llu9oiIev5XIV2XdEQpJm-APm27/view?usp=sharing">GFMatrixEditor</a> and click the GFMat-&gt;Pack button, it will generate two spreadsheet, contaning the Headers and Map files for that matrix. Open the Headers spreadsheet and check where your Zone ID is located, then open the Map Files spreadsheet and at the same spot check what number is there. That's the Map File you're looking for.</p>
<h2 id="inserting-the-map-1"><a class="header" href="#inserting-the-map-1">Inserting the Map</a></h2>
<p>There are two different programs that can insert the map:</p>
<h3 id="using-basicperhandler-1"><a class="header" href="#using-basicperhandler-1">Using BasicPerHandler</a></h3>
<p>In order to use <a href="https://drive.google.com/drive/folders/1eJwed-scWbroN5mGJdg2T10ZrYdanheH">BasicPerHandler</a> you have to first extract the Map Container narc. Load your ROM with Tinke, navigate to a/0/0/8 in the filesystem, select it and click <em>Extract File</em>, and save the file somewhere.</p>
<p>Then launch BasicPerHandler, click <em>File</em>&gt;<em>Load</em> and select that extracted file. From the list of Map Files, select the one with the number you previously found.</p>
<p>Now all that's left is importing all the files using the buttons below the Matrix view; they are all fairly self-explanatory and you should have all the relevant files from PDSMS.</p>
<p>Remember to also click the <em>Remove</em> button on the Building Table section, unless for the map you're inserting you wish to keep the original buildings (if there are any).</p>
<p>After you're done, click the save button and save the new map container narc. Follow the steps you used to extract it but instead of <em>Extract File</em> click <em>Change File</em> instead, then save your ROM.</p>
<h3 id="using-sak-1"><a class="header" href="#using-sak-1">Using SAK</a></h3>
<p>If you've never used <a href="https://github.com/PlatinumMaster/SwissArmyKnife/releases">Swiss Army Knife</a>, before launching the program you will have to go to SAK folder and in there create a new folder called <em>BaseROMs</em>, and in there put a fresh copy of the ROM you're editing. It must be named <em>Black</em>/<em>White</em>/<em>Black 2</em>/<em>White 2</em>.
Now you can launch SAK and create a new project. </p>
<p>Go to the <em>Map Editor</em> tab and from the <em>Container Index</em> menu select the Map File number you previously found. Then it's just a matter of importing the relevant files:</p>
<ul>
<li><em>Map Model</em> is the .NSBMD file</li>
<li><em>Permissions</em> is the .per file</li>
<li>At <em>Building Positions</em> click the remove button if possible, unless you wish to keep the original map buildings.</li>
</ul>
<p>After you're done, save the ROM.</p>
<h2 id="updating-the-area-data-1"><a class="header" href="#updating-the-area-data-1">Updating the Area Data</a></h2>
<p>Now your map is inserted into the game, but it will still have its old textures used, meaning if you're using different textures than the map you're replacing, they will have a lot of white spots, so you have to replace the old texture set used with your own that you exported from PDSMS.</p>
<p>Open your ROM in Tinke, then go to a/0/1/4 and unpack it. You will see a list of files named <em>4_number.BTX0</em>, go to the file with the same number as the <em>Area</em> value in CTRMap Header, select it and click <em>Change File</em>, and replace it with your own NSBTX. </p>
<p>Keep in mind that if the map you replaced has different textures based on seasons, the next 3 files in the narc will be used as well. So for example if your Area Data number listed in CTRMap is 182, you will have to replace files 182, 183, 184 and 185 as well.</p>
<p><strong>Remember to pack the narc before saving the ROM!</strong></p>
<p>Go back to a/0/1/4 and click the <em>Pack</em> button. There is no visual confirmation of this in Tinke.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exporting-and-importing-buildings-fromto-gen-5-games-1"><a class="header" href="#exporting-and-importing-buildings-fromto-gen-5-games-1">Exporting and Importing buildings from/to Gen 5 games</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago.</p>
</blockquote>
<p>This is a tutorial on how to export and import buildings in gen 5 games.
You will need to have installed <a href="https://github.com/kingdom-of-ds-hacking/CTRMapV/releases">CTRMap-CE</a> as well as the <a href="https://github.com/kingdom-of-ds-hacking/CTRMapV/releases">CTRMapV</a> plugin, then create a project of the game you want to import/export buildings to/from if you haven't already.</p>
<hr />
<h2 id="table-of-contents-15"><a class="header" href="#table-of-contents-15">Table of Contents</a></h2>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#section">Exporting Buildings</a>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#subsection">Exporting Animations</a></li>
</ul>
</li>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#section-2">Importing Buildings</a>
<ul>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#subsection-2">Importing Animations</a></li>
<li><a href="gen5/guides/field/bw_b2w2-buildings.html#subsection-3">Animated Doors</a></li>
</ul>
</li>
</ul>
<p>The first thing you want to do is load the map you want to export/import your building(s) using the Zone Loader, then open the building editor by clicking the Pokémon Center icon in the World Editor's top bar, and then click <em>Edit Resource Bundle</em></p>
<p><img src="gen5/guides/field/resources/bw_b2w2-buildings/ctrmapbuildingeditor.PNG" alt="" /></p>
<h2 id="exporting-buildings-1"><a class="header" href="#exporting-buildings-1">Exporting Buildings</a></h2>
<p>Select the building you want to export from the list on the left side of the editor, then click the <em>Open in CS</em> button right below. This will launch Creative Map studio, from where you can export the model in a number of different formats, using the <em>Export</em> options from the top bar.</p>
<p>About the different file types you can get, it's worth mentioning:</p>
<ul>
<li>COLLADA: exports as <strong>DAE</strong> format</li>
<li>NNS Resource: exports as <strong>NSBMD</strong>, Nintendo's proprietary format</li>
<li>WaveFront OBJ: exports as <strong>OBJ</strong> format. The textures will be exported as a separate <strong>mtl</strong> file, keep both in the same directory.</li>
</ul>
<p>If you're planning to import the building in a gen 4 game, both DSPRE and PDSMS building editors only acccept NSBMD files. For gen 5 games, both OBJ and DAE work but the latter is recommended.</p>
<h3 id="exporting-animations-1"><a class="header" href="#exporting-animations-1">Exporting Animations</a></h3>
<p>If the building you want to export has an animation, you can export it by selecting the animation on the menu on the right side of the editor after having selected the building, then click the <em>Open in CS</em> button right below it.</p>
<p><img src="gen5/guides/field/resources/bw_b2w2-buildings/ctrmapanims.PNG" alt="" /></p>
<p>In Creative Studio, select the animation in the dropdown menu (it will be either in the Material or Skeletal Animation folder), then right click on it &gt; Export and it will be saved as a NSBTA/NSBCA file depending on the animation type.</p>
<p><img src="gen5/guides/field/resources/bw_b2w2-buildings/animscs.PNG" alt="" /></p>
<h2 id="importing-buildings-1"><a class="header" href="#importing-buildings-1">Importing Buildings</a></h2>
<p>Keep in mind that adding a building will simply display the building model in the map, but it won't change the map collision. For that you have to edit the tile permissions of the map in question trough PDSMS.</p>
<p>Open the map you want to add your building(s) to from the Zone Loader, then open the Building Editor. If the type of building you want to add is already present in the map, you can just add it by clicking the + button and then choosing it from the list, setting the coordinates and saving it.</p>
<p>If the building is not present, click the Edit Resource Bundle, and click the <strong>+</strong> button in the bottom left of the screen. Choose the DAE or OBJ you previously exported (or made on your own), once you've added all the buildings click <em>Commit Changes</em> &gt; <em>Resource Bundle</em> and <em>Static Texture Pack</em>.
Now you can close the tab and go back to the building editor in the world editor tab.</p>
<p>Click the <strong>+</strong> icon and select the type of the building from the list right below it. All that's left is setting coordinates of the new building you've added and clicking the save button. You can also press F5, the selected building will have a yellow outline; you can drag it across the map to the location you prefer.</p>
<h3 id="importing-animations-1"><a class="header" href="#importing-animations-1">Importing Animations</a></h3>
<ul>
<li>
<p>Material Animations:</p>
<p>After having imported the DAE/OBJ model, on the right side of the screen set the Animation Controller to <em>Ambient Generic</em>. Select the first <strong>X</strong> in the list, then click the blue arrow pointing downwards button, and select the NSBTA file you previously exported/created.</p>
</li>
<li>
<p>Skeletal Animations:
Same steps as above, the only differences are that you have to set the animation controllers to <em>Dynamic</em> instead, and you will import a NSBCA file.</p>
</li>
</ul>
<h3 id="animated-doors-1"><a class="header" href="#animated-doors-1">Animated Doors</a></h3>
<ul>
<li>If the building you want to import is a door (and its animations) you'll need to specify two different animations set:
Change the <em>1 set/4 animations</em> option to <em>2 sets/1 + 1 animation</em>, and for both sets you have to import respectively the Opening and Closing animation.</li>
<li>You can set the sound by changing the <em>Type</em> value from the top right of the building editor.</li>
<li>You need to bind the door to a building to have the animation actually work: select the building, then from the menu on the right side choose the door model and set its coordinates.</li>
</ul>
<p>Remember that you still have to click both <em>Commit Changes</em> and <em>Static Texture Pack</em> buttons after importing animations as well.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="general-code-injection-guide"><a class="header" href="#general-code-injection-guide">General Code Injection Guide</a></h1>
<p>This guide aims to serve as a technical introduction to code injection in the DS Pokemon games, as well as common processes for it. It is strongly recommended that you read this page before continuing onto generation-specific code injection, as it will attempt to familiarize you with how it generally works.</p>
<h2 id="assembly-injection"><a class="header" href="#assembly-injection">Assembly Injection</a></h2>
<p>Assembly injection is the process of compiling an assembly routine, and hooking it into the executable part of a ROM. </p>
<h2 id="cc-injection"><a class="header" href="#cc-injection">C/C++ Injection</a></h2>
<p>C/C++ injection is almost the exact same idea, except you use a high-level language (mostly C or C++, though you can go wild with Rust if that's what your heart desires) to create the code which emits assembly. That's because compilers/translators of these languages use Assembly as an intermediate between the source code stage and the binary stage. In other words, C/C++ code creates assembly code, which is then assembled. Assembly knowledge is, for the most part, not necessary.</p>
<h3 id="how-does-c-injection-work"><a class="header" href="#how-does-c-injection-work">How does C Injection work?</a></h3>
<p>It's easier to explain with an example, so I will go with that.</p>
<p>Say we have the following C code:</p>
<pre><code class="language-C">// We declare these so the code can compile. Can go into a separate library file.
int AddMoney(int);
void LoadScript(int);
void PlayScript();

// The function we're writing.
void funFunction1() {
  int v1 = AddMoney(3000);
  if (v1) {
    LoadScript(12);
    PlayScript();
  }
  for (int i = 0; i &lt; 99; ++i) {
    int v2 = AddMoney(i);
  }
  //...
}
</code></pre>
<p>Our compiler will take our C code and turn it into Assembly. How, you might be asking yourself? I will give you a high level idea of what is going on.</p>
<p>See, when we do an operation in C, the operation we do has a corresponding set of Assembly. By parsing the C file, the compiler can match each operation in our C source code to a list of Assembly instructions that are functionally equivalent. This yields an intermediate Assembly file, which pertains to the architecture of the system we are compiling the binary for. In this case, it would yield ARMv5T Assembly (unless otherwise specified), which is the Assembly variant used on the Nintendo DS.</p>
<p>In the case of our file, it would turn it into the following assembly (courtesy of <code>gcc</code>):</p>
<pre><code class="language-ASM">funFunction1:
        push    {r7, lr}
        sub     sp, sp, #16
        add     r7, sp, #0
        movw    r0, #3000
        bl      AddMoney
        str     r0, [r7, #8]
        ldr     r3, [r7, #8]
        cmp     r3, #0
        beq     .L2
        movs    r0, #12
        bl      LoadScript
        bl      PlayScript
.L2:
        movs    r3, #0
        str     r3, [r7, #12]
        b       .L3
.L4:
        ldr     r0, [r7, #12]
        bl      AddMoney
        str     r0, [r7, #4]
        ldr     r3, [r7, #12]
        adds    r3, r3, #1
        str     r3, [r7, #12]
.L3:
        ldr     r3, [r7, #12]
        cmp     r3, #98
        ble     .L4
        nop
        nop
        adds    r7, r7, #16
        mov     sp, r7
        pop     {r7, pc}
</code></pre>
<p>This code is functionally equivalent to the code we wrote, but might be harder to understand at first glance.</p>
<h2 id="insertion-process"><a class="header" href="#insertion-process">Insertion Process</a></h2>
<h3 id="fixing-our-assembly"><a class="header" href="#fixing-our-assembly">Fixing our Assembly</a></h3>
<p>Similar to the above, assembling Assembly consists of taking our code and translating it into a format that our processor can understand. The Executable and Linkable Format, or ELF, allows us to simplify this process. </p>
<p>Simply put, our processor does not read assembly -- only machine code -- and as such, we need to give it a set of bytes that it <em>can</em> read. But, before we can give it bytes to read, we need to make sure <em>all</em> of our instructions are correct. With simple arithmetic instructions such as addition and subtraction, this is light-work -- no further verification needs to be done. However, with function calls, <em>how</em> will the assembly know where we are telling it to go? </p>
<p>This is easily solved by converting our assembly into an ELF file. With an ELF, we can perform a process known as linking. Linking is one of the most important parts of the entire compilation process, and for good reason; with our Assembly in ELF format, we can define the addresses of functions we are calling, determine the order of multiple files being linked together, and create relocatable objects, all of which solve our earlier problems. So, let's go into detail about linking.</p>
<h4 id="assembly-to-executable-and-linkable-format-elf-and-linking"><a class="header" href="#assembly-to-executable-and-linkable-format-elf-and-linking">Assembly to Executable and Linkable Format (ELF), and Linking</a></h4>
<p>On the high level, linking is performed using a linker. A linker is equipped with a translation table which takes in symbol names, and translates them to addresses. This translation table is comprised of all of the addresses of functions in the binaries we link together, and a (optionally) hand-crafted symbol to address map.</p>
<p>This hand-crafted translation table is an integral part of code injection. Without it, calling existing functions would be practically impossible. This translation table is created by researching the ROM's code, and documenting the functions. We then give names to these functions, which we later use as symbols. This creates a one-to-one mapping that allows us to properly fix our addresses.</p>
<p>Take this segment of our Assembly from above, for example.</p>
<pre><code class="language-ARMASM">        movw    r0, #3000
        bl      AddMoney
</code></pre>
<p><code>bl</code>, which performs a function call in this case, will force the program to jump to the function <code>AddMoney</code>. But, <em>where</em> is <code>AddMoney</code>? We as humans know that it is at the address <code>30</code>, as I had mentioned previously. But, what about the computer? </p>
<p>With a translation table similar to below (note: this is likely not valid syntax, I am just making this up):</p>
<pre><code>BEGIN_TRANSLATION_DEFINITIONS
AddMoney: 30
LoadScript: 45
PlayScript: 60
END_TRANSLATION_DEFINITIONS
</code></pre>
<p>The aforementioned code becomes the following:</p>
<pre><code class="language-ARMASM">        movw    r0, #3000
        bl      30 @ Note, this will likely be a relative offset (destination - address of this instruction) and not an absolute one. This is just for demonstration.
</code></pre>
<p>Pretty neat, huh? The same thing would happen to <code>bl LoadScript</code> or <code>bl PlayScript</code>, provided those were the instructions there.</p>
<p>That being said, how do we perform linking with code injection?</p>
<ul>
<li>In the case of Generation IV, BluRose uses the linker provided by devkitPro (which is <code>arm-none-eabi-ld</code>) and a hand crafted translation table to fix the addresses to in-game functions. They also use a linker script to rearrange the order of their binary, which is a possibility I mentioned previously.</li>
<li>In the case of Generation V, the input source code is first linked using the default toolchain, then later post-processed using a provided symbol mapping database during conversion to the RPM executable format. This means that before the final step, the ELF isn't bound to a fixed binary layout, providing simpler targeting of different games/revisions. Programs that only provide support functionality (file format libraries, codecs) are game-independent and can be loaded on-demand as DLLs.</li>
</ul>
<p>After linking, we will usually end up with an ELF file that we can use to create our final binary.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="intro-to-sprite-indexing"><a class="header" href="#intro-to-sprite-indexing">Intro to Sprite Indexing</a></h1>
<blockquote>
<p>This document was written by turtleisaac</p>
</blockquote>
<p>This document aims to introduce the concept of indexing a sprite</p>
<hr />
<h2 id="indexing"><a class="header" href="#indexing">Indexing</a></h2>
<p>Indexing is a process that converts an image from having a specific color assigned to each individual pixel to having a centralized palette where the RGB(A) values are stored.</p>
<p>By doing this, each pixel is assigned a specific index within the palette instead of an individual color. This allows image files to take up less space.</p>
<p><img src="universal/guides/sprite_indexing/resources/indexed_image_example.png" alt="Indexed Image Example" /></p>
<h2 id="special-considerations-for-the-nintendo-ds"><a class="header" href="#special-considerations-for-the-nintendo-ds">Special Considerations for the Nintendo DS</a></h2>
<ul>
<li>The Pokémon DS games (and most others) use NCGR files for storing images, and NCLR files for storing palettes. The NCLR file that a NCGR pulls its palette information from is determined by the code of the game, so when viewing or replacing NCGR files in a tool like Tinke, you must first select the proper NCLR for that image for the correct palette to be displayed</li>
<li>Sprites within these games lack an alpha channel
<ul>
<li>If the game is programmed to display the image with any form of transparency, it will use the color at index 0 of the palette to determine what part of the sprite should be made transparent when displaying it</li>
</ul>
</li>
<li>Most sprites are 8bpp (8 bits per pixel), meaning they have a maximum palette size of 256 colors</li>
</ul>
<hr />
<h2 id="guides-for-specific-tools"><a class="header" href="#guides-for-specific-tools">Guides for Specific Tools</a></h2>
<ul>
<li><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html">GIMP</a></li>
</ul>
<blockquote>
<p>TODO: Aseprite, Photoshop, GraphicsGale, Paint.NET</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sprite-indexing-with-gimp-guide"><a class="header" href="#sprite-indexing-with-gimp-guide">Sprite Indexing with GIMP Guide</a></h1>
<blockquote>
<p>This guide was written by <a href="https://github.com/turtleisaac">turtleisaac</a>.</p>
</blockquote>
<p>This guide aims to serve as general instructions for indexing a sprite using GIMP, a free and open-source image editing program which is available on GNU/Linux, macOS, Windows, and more</p>
<hr />
<h2 id="table-of-contents-16"><a class="header" href="#table-of-contents-16">Table of Contents</a></h2>
<ul>
<li><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html#Instructions">Instructions</a>
<ul>
<li><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html#Indexing">Indexing</a></li>
<li><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html#Palette-Editing">Palette Editing</a>
<ul>
<li><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html#Putting-the-Background-Color-in-Index-0">Putting the Background Color in Index 0</a></li>
</ul>
</li>
<li><a href="universal/guides/sprite_indexing/resources/gimp/gimp.html#Saving">Saving</a></li>
</ul>
</li>
</ul>
<h2 id="instructions"><a class="header" href="#instructions">Instructions</a></h2>
<ol>
<li><strong>To begin, if you don't have it already, you'll want to download <a href="https://www.gimp.org/downloads/">GIMP</a>.</strong></li>
<li>From here, open an image of your choice in GIMP. If this image has an alpha channel, it technically can be removed, but that image most likely wouldn't be ideal for inserting in the first place and really shouldn't be used.</li>
<li>Depending on the constraints of what kind of image you are replacing, the number of colors available for your indexed image may vary. In most cases, you are either limited to 256 colors or 16 colors. This guide will assume you are indexing an image that can only have 16 colors, but the same process will work for a 256 color image.</li>
</ol>
<p><strong>NOTE:</strong> if your image is already indexed adequately, such as if you are editing an existing image exported from the ROM and you just want to change the colors, you may skip ahead to <a href="universal/guides/sprite_indexing/resources/gimp/gimp.html#Palette-Editing">Palette Editing</a>.</p>
<h3 id="indexing-1"><a class="header" href="#indexing-1">Indexing</a></h3>
<ol start="4">
<li>
<p>In the toolbar, you'll want to go to <code>Image -&gt; Mode -&gt; Indexed...</code></p>
</li>
<li>
<p>If <code>Generate optimum palette</code> isn't already selected, do so. After that, set the maximum number of colors to 16. Press <code>Convert</code> in the bottom right of the window.</p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_1.png" alt="img1" /></p>
</li>
</ol>
<h3 id="palette-editing"><a class="header" href="#palette-editing">Palette Editing</a></h3>
<ol start="6">
<li>
<p>To make it so you can edit the palette order and/or see/edit the colors in the palette, go to <code>Windows -&gt; Dockable Dialogues -&gt; Colormap</code>.</p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_2.png" alt="img2" /></p>
<p>Doing so will bring up the following tab:</p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_3.png" alt="img3" /></p>
</li>
<li>
<p>From here, you can double-click on the colors in the palette to edit them. Located at the bottom of the Colormap tab is this bar:</p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_4.png" alt="img4" /></p>
<p>You can also press the button that has a pencil and some lines in order to edit the currently selected color. The plus-sign button can be used to add a new color to the palette. If the background color is already in index 0 of the palette, you may skip ahead to <a href="universal/guides/sprite_indexing/resources/gimp/gimp.html#Saving">Saving</a>.</p>
</li>
</ol>
<h4 id="putting-the-background-color-in-index-0"><a class="header" href="#putting-the-background-color-in-index-0">Putting the Background Color in Index 0</a></h4>
<ol start="8">
<li>
<p>You can right-click on a color to get this menu, then from there, you press <code>Rearrange Colormap...</code>. Click and drag the color you want to move to index 0 of the palette.</p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_5.png" alt="img5" />
<img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_6.png" alt="img6" /></p>
<p>When you go to let go of the dragged color, <strong>MAKE SURE</strong> there is a white box surrounding the color at index 0, as shown in the first image below. It <strong>SHOULD NOT</strong> look like the second image below, with a white line to either side, on-top of, or below the color. From here, just press <code>Ok</code>.</p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_7.png" alt="img7" />
<img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_8.png" alt="img8" /></p>
</li>
</ol>
<h3 id="saving"><a class="header" href="#saving">Saving</a></h3>
<ol start="10">
<li>
<p>Go to <code>File -&gt; Export As...</code></p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_9.png" alt="img1" /></p>
</li>
<li>
<p>Choose where you want to output the file, and make sure you use the <code>.png</code> extension.</p>
</li>
<li>
<p>Make sure you select <code>8bpc RGB</code> for the output format.</p>
<p><img src="universal/guides/sprite_indexing/resources/gimp/resources/gimp_img_10.png" alt="img10" /></p>
</li>
<li>
<p>Now, you can insert the exported image into the game files, as per the instructions of any other guide you may be following or tool you may be using.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><style>
	/* 	'main' to only affect page content
		rounded edges */
	main img, main blockquote, main code, main iframe {
		border-radius: 5px;
	}

	main summary{
		cursor: pointer;
	}

	main img{
		background-color: rgba(1,1,1,.1);
	}
	
	/* Site Cards */
	.card{
		border-left: 4px solid var(--card-color);
		border-radius: 5px;
		padding: 1em;
		margin: 1em 0;
		background-color: rgba(1,1,1,.2);
		max-width: 480px;
	}
	.video-responsive{
		margin-top:1em;
		overflow:hidden;
		border-radius: 5px;
		padding-bottom:56.25%;
		position:relative;
		height:0;
	}
	.video-responsive iframe{
		left:0;
		top:0;
		height:100%;
		width:100%;
		position:absolute;
	}

	/* Lists */
	main hr {
		border: 1px solid white;
		opacity: .125;
	}

	main ol {
		list-style: none;
		counter-reset: num;
	}
	main ol li {
		counter-increment: num;
	}
	main ol li::before {
		content: counter(num) ". ";
		font-weight: bold;
		float: left;
		margin-left: -1.5em;
		padding-right: .25em;
	}
</style>
<h1 id="editing-a-ncer-file"><a class="header" href="#editing-a-ncer-file">Editing a NCER file</a></h1>
<blockquote>
<p>This guide was written by <a href="universal/guides/ncer_sprite_editing/">Jay</a> and formatted for this wiki by <a href="universal/guides/ncer_sprite_editing/">Sunnhild</a>.</p>
</blockquote>
<p>Editing trainer sprites without patterns <em>(Aka: An apology letter from Jay-san about Tutorial Episode 2)</em></p>
<blockquote>
<details>
<summary style="margin:.5em 0em;">🎥 Video version</summary>
<hr>
<div class="card" style="--card-color: red"><a href="https://www.youtube.com/watch?v=kZW9LTiAfrY"><strong>Pokemon DS Rom Editing Tutorial Pt 2.5: Easier Editing w/ RECN Files (Aka: NCER)</strong></a><div class="video-responsive"><iframe type="text/html" width="480" height="270" src="https://www.youtube.com/embed/kZW9LTiAfrY" frameborder="0" title="Jay-San: Pokemon DS Rom Editing Tutorial Pt 2.5: Easier Editing w/ NCER Files (Aka: NCER)" allowfullscreen></iframe></div></div>
</details>
</blockquote>
<hr />
<h2 id="-table-of-contents"><a class="header" href="#-table-of-contents">📌 Table of Contents</a></h2>
<ul>
<li><a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#-intro">📋 Intro</a></li>
<li><a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#-getting-tinke-092">💾 Getting Tinke 0.9.2:</a></li>
<li><a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#-editing-your-sprite">🛠️ Editing your sprite:</a></li>
</ul>
<h2 id="-intro"><a class="header" href="#-intro">📋 Intro</a></h2>
<p>  Hello! You are seeing this as you’ve most likely seen my video on editing the RGCN trainer sprites with the colored pattern I shared. While this method technically still works, I came up with it before I was more experienced in rom hacking and admittedly is just a little inefficient. It turns out that <strong>ONLY</strong> if you use a certain version of Tinke, you can edit an NCER “cell” file that is a complete image instead of having to split the sprite into pieces. Which will hopefully be far simpler to edit sprites with.</p>
<h2 id="-getting-tinke-092"><a class="header" href="#-getting-tinke-092">💾 Getting Tinke 0.9.2:</a></h2>
<blockquote>
<p><strong>⚠️ (IMPORTANT: This method will not work on Tinke 0.9.0 or older versions. Be sure to get the version below if you don’t have it already.)</strong></p>
</blockquote>
<ol>
<li>
<p>First of all, here is the version of TInke you’ll want to use. It’s a copy stored in the google drive owned by the hacking server:</p>
<p><a href="https://drive.google.com/file/d/1lNMtiqKPoQigTExe-2eL7CFJApOaWX8q/view?usp=sharing">https://drive.google.com/file/d/1lNMtiqKPoQigTExe-2eL7CFJApOaWX8q/view?usp=sharing</a></p>
</li>
<li>
<p>You want to use the download button in the upper right to download it</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke_download.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke_download.png" alt="Tinke download image" /></a></p>
</li>
<li>
<p>Once you’ve downloaded the zip file, be sure to extract the contents into the folder of your choice.</p>
</li>
</ol>
<h2 id="-editing-your-sprite"><a class="header" href="#-editing-your-sprite">🛠️ Editing your sprite:</a></h2>
<ol>
<li>
<p>Once you have an extracted copy of Tinke 0.9.2 folder ready to use, you want to click the Tinke launcher.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke_launcher.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke_launcher.png" alt="Tinke Launcher" /></a></p>
<blockquote>
<details>
<summary style="margin:.5em 0em;">⚠️ If you get an error</summary>
<hr>
A few people have gotten the error below when opening Tinke 0.9.2 specifically.
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke092_error.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke092_error.png" alt="Tinke 0.9.2 error" /></a></p>
<p>This seems to be related to their computer putting a block on the Tinke files. If you see this error you should:</p>
<ol>
<li>
<p>Delete the Tinke folder you just made.</p>
</li>
<li>
<p>Locate the zip file you downloaded from the link above.</p>
</li>
<li>
<p>Right click it and select Properties.</p>
</li>
<li>
<p>If you see an “Unblock” checkbox like the one circled below, uncheck it and click OK.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/unblock_tinke_properties.png"><img src="universal/guides/ncer_sprite_editing/resources/unblock_tinke_properties.png" alt="Unblock Tinke in properties" /></a></p>
</li>
<li>
<p>Then extract your zip file again to make a new Tinke Folder, and try to open Tinke to see if the error is fixed.</p>
</li>
</ol>
<blockquote style="padding:1em;background-color:rgba(242,245,255,.075);"><strong>📝 Note: If the error continues please let us know in Discord.</strong></blockquote>
</details>
</blockquote>
</li>
<li>
<p>Then a window will open where you can browse to the rom you want to edit and open it.</p>
</li>
<li>
<p>Browse the rom files and expand the narc that holds the sprite you are looking for. </p>
<blockquote>
<p>💡 If you want any help locating certain sprites in your nds pokemon rom, check out this narc list we wrote <a href="https://docs.google.com/document/d/1_nRfhDEoNFbvYP-yjx4oAWmgGXxvqFBvLwYANFehxUU">HERE</a>. <!-- TODO add list of known sprite location ressource --></p>
</blockquote>
<p>Anyway, for my example I am going to edit the male player’s ball throw sprite in platinum. Which is located at the file path <code>poketool / trga / trbgra</code>. Where I’ll click <code>trbgra.narc</code> and click <strong>Unpack</strong> to see its contents.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke_unpack.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke_unpack.png" alt="Tinke unpack trbgra.narc" /></a></p>
<p>And are these files here.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke_files.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke_files.png" alt="Files you will edit with Tinke" /></a></p>
</li>
<li>
<p>First I need to double click file <code>trbgra_1.RLCN</code>, which is the palette.</p>
</li>
<li>
<p>Then I click <code>trbgra_0.RGCN</code> and click <strong>“View”</strong>. This brings up the puzzle-like RGCN file you may have seen me talk about in my video.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/puzzle_rgcn_tinke.png"><img src="universal/guides/ncer_sprite_editing/resources/puzzle_rgcn_tinke.png" alt="Puzzle-like RGCN preview in Tinke" /></a></p>
</li>
<li>
<p>Now we go one step further by clicking <code>trbgra_2.NCER</code> and then clicking <strong>View</strong> again. This opens the “Cell” file where you can see the sprite as a complete image. If you scroll through the “Bank” circled picklist below you will jump between the different frames of this animated sprite. Our goal is to replace each of these frames with a matching edited version of the sprite you want to use.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/cell_bank_tinke.png"><img src="universal/guides/ncer_sprite_editing/resources/cell_bank_tinke.png" alt="Cell bank complete image in Tinke" /></a></p>
</li>
<li>
<p><a name="7"></a> Before working with the NCER file, it is very important that you first <strong>uncheck</strong> the “Transparency” checkbox as shown below. This will get the background color to show up. Which is important for both export and importing the frames in the next steps.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/uncheck_transparency_tinke.png"><img src="universal/guides/ncer_sprite_editing/resources/uncheck_transparency_tinke.png" alt="Uncheck transparency box in Tinke" /></a></p>
<blockquote>
<details>
<summary style="margin:.5em 0em;"><strong>💡(Optional)</strong> Exporting frames</summary>
<hr>
If you want, you can export each of the frames of this sprite as png images by scrolling to each of them in the “Bank” picklist and clicking <strong>Export</strong> for each one. Then you could use them as references when making your own edited frames that you want to insert in the next step. However if you already have the edited frames you want, you can skip this step.
<p><a href="universal/guides/ncer_sprite_editing/resources/export_frames_tinke.png"><img src="universal/guides/ncer_sprite_editing/resources/export_frames_tinke.png" alt="Export frames in Tinke" /></a></p>
<p>When you export a frame it will look like the example below. Where the frame is a tiny box in the center of a large transparent image. You want to make sure the background is displaying like my example below, by following <a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#7">step 7</a>.</p>
<p>The area covered by the background is your drawable area, but you still want to make sure your edited frame keeps the same large transparent border around it like my example in the next step. </p>
<p><a href="universal/guides/ncer_sprite_editing/resources/exported_frame_tinke.png"><img src="universal/guides/ncer_sprite_editing/resources/exported_frame_tinke.png" alt="Exported frame" /></a> </p>
</details>
</blockquote>
</li>
<li>
<p>Once you are done you want your edited frames to look like my example below. Then you’ll need to repeat this process for each of the frames that this sprite uses. Like for the Platinum ball throw sprite, I’ll need to make 8 frames.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/edited_frame.png"><img src="universal/guides/ncer_sprite_editing/resources/edited_frame.png" alt="Edited frame" /></a></p>
</li>
<li>
<p>Once all your frames are ready, you want to scroll the “Bank” picklist to the first frame you want to replace. Normally people just start with the first frame. However if there are any colors that are not being shown on the first frame, you want to switch to a frame that displays all the colors your sprite uses. </p>
<blockquote>
<p>💡 For example if your character has a yellow emblem on their shirt that’s not showing until after they throw the pokeball and their chest turns towards the camera. So you’d want to pick any later frame that shows the colors used by that emblem, if those colors aren’t shown on the earlier frames already.</p>
</blockquote>
</li>
<li>
<p><a name="10"></a> Once you’ve selected the best first frame, next change the “Palette Import Option” to <strong>Replace Palette</strong>. Use the Import button to import your edited frame that matches the one that Tinke is displaying. Since you picked “Replace Palette”, this will replace the colors in the related palette with all the colors of your sprite. So in my example, this would change the colors on <code>trbgra_1.RLCN</code>.</p>
<p>This is why it was so important to find the right frame that showed all of your colors in <a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#10">step 10</a>. To make sure all colors were added into the new palette. All 8 of the frames that the ball throw sprite I am editing will pull their colors from <code>trbgra_1.RLCN</code>. So if I pick a first frame that is missing colors that the others need, those other frames will have those colors removed when you import them.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke_palette_import.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke_palette_import.png" alt="Palette import button in Tinke" /></a></p>
<blockquote>
<details>
<summary style="margin:.5em 0em;">💡 If you have trouble getting the right colors into your palette</summary>
<hr>
You can use <strong>Console Tool</strong> to set the colors manually. Then you can import all frames just using “Swap to Original Palette” instead. You can learn about how to do so with this video:
<div class="card" style="--card-color: red"><a href="https://www.youtube.com/watch?v=ESQjr7OB1pA"><strong>Pokemon DS Rom Editing Tutorial Pt 14: Quick Color Changes with Console Tool</strong></a><div class="video-responsive"><iframe type="text/html" width="480" height="270" src="https://www.youtube.com/embed/ESQjr7OB1pA" frameborder="0" title="Jay-San: Pokemon DS Rom Editing Tutorial Pt 14: Quick Color Changes with Console Tool" allowfullscreen></iframe></div></div>
</details>
</blockquote>
<blockquote>
<details>
<a name="fix-1"></a><summary style="margin:.5em 0em;">⚠️ If you have a <strong>glitched spot</strong></summary>
<hr>
Now after importing your first frame it’s possible that it looks mostly ok but has a glitched spot like mine below. Worry not, this seems to happen a lot.
<p><a href="universal/guides/ncer_sprite_editing/resources/glitched_image_import.png"><img src="universal/guides/ncer_sprite_editing/resources/glitched_image_import.png" alt="Glitched imported image" /></a></p>
<p>The fix should be to:</p>
<ol>
<li>Change the <strong>Palette Import Option</strong> to “Swap to Original Palette”.</li>
<li>Import your frame again.</li>
</ol>
<p>Since your colors should be correctly inserted into the Palette by <a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#10">step 10</a>, they are reapplied to the frame automatically. This seems to fix the glitched spot, though we are not certain why this happens.</p>
<blockquote style="background-color:rgba(242,245,255,.075);margin: 17px 0;"><details>
<a name="fix-2"></a><summary style="margin:.5em 0em;">⚠️ Possible <strong>follow up issue</strong></summary>
<hr>
A follow up issue that can happen after you do the <a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#fix-1">fix</a> is that some of the colors of the sprite may be missing. Like if you look REALLY close at my sprite below, my pants are transparent. The fix I found is the steps below, but if all the colors on all your sprites look ok you can skip this step.
<blockquote style="padding:1em;background-color:rgba(242,245,255,.075);">📝 <strong>NOTE:</strong> This is a <strong>newly discovered issue</strong>, so this fix is not widely tested yet. If the steps below give you any trouble let us know in the sprite support channel in the discord and we’ll try to help further. </blockquote>
<ol>
<li>
<p>Type <strong>442</strong> into the Threshold field that is next to the “Pallet Import Options”.
<em>(<strong>442</strong> is just the <strong>max value</strong> this field can hold)</em></p>
<p><a href="universal/guides/ncer_sprite_editing/resources/palette_threshold_fix.png"><img src="universal/guides/ncer_sprite_editing/resources/palette_threshold_fix.png" alt="Palette threshold value fix" /></a></p>
</li>
<li>
<p>Change the “Pallet Import Option” back to <strong>Replace Palette</strong>.</p>
</li>
<li>
<p><strong>Import</strong> your frame again.</p>
</li>
<li>
<p>You may need to <strong>repeat</strong> the <a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#fix-1">fix</a> above to fix the glitched area again.</p>
</li>
<li>
<p>The sprite should now look 100% correct!</p>
</li>
</ol>
</details></blockquote>
</blockquote>
</li>
<li>
<p>Once your first frame is inserted and it looks correct, you want to make sure the “Pallet Import Option” is set to “Swap to Original Palette” and <strong>import</strong> each of the other frames. To do so, you just need to scroll to another frame and click <strong>import</strong>, then scroll to the next frame, and repeat the import until all the frames are replaced.</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke_palette_import.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke_palette_import.png" alt="Palette import button in Tinke" /></a></p>
</li>
<li>
<p>Be sure to look each of the new frames over closely to make sure none of them have any parts that are transparent that shouldn’t be. If you find some missing colors you will want to first try the <a href="universal/guides/ncer_sprite_editing/ncer_sprite_editing.html#fix-2">fix</a> above, if you haven’t already. Then <strong>reinsert</strong> all your frames again.</p>
</li>
<li>
<p>If all frames look good, then it’s time to <strong>pack</strong> the narc! </p>
<blockquote>
<p>💡 if you are not sure how to do this, check out this document <a href="https://docs.google.com/document/d/1nyuRlun9Gm_5lWodBVLZgOwTgU26k8oyfscnPZZSfV8/edit?usp=sharing">HERE</a>.<!-- TODO add how to pack a NARC in ressource --></p>
</blockquote>
</li>
<li>
<p>Then you should be set to <strong>save</strong> a new rom and test your sprite!</p>
<p><a href="universal/guides/ncer_sprite_editing/resources/tinke_save_rom.png"><img src="universal/guides/ncer_sprite_editing/resources/tinke_save_rom.png" alt="Save rom in Tinke" /></a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hex-editing-5"><a class="header" href="#hex-editing-5">Hex Editing</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago</p>
</blockquote>
<p>This is a tutorial on how to hex edit your files for the first time.</p>
<hr />
<h2 id="table-of-contents-17"><a class="header" href="#table-of-contents-17">Table of Contents</a></h2>
<ul>
<li><a href="universal/guides/hex_editing/hex_editing.html#section">Using a Hex Editor</a></li>
<li><a href="universal/guides/hex_editing/hex_editing.html#section-2">Offsets</a>
<ul>
<li><a href="universal/guides/hex_editing/hex_editing.html#subsection">Different Game Languages</a></li>
</ul>
</li>
<li><a href="universal/guides/hex_editing/hex_editing.html#section-3">Searching the bytes</a>
<ul>
<li><a href="universal/guides/hex_editing/hex_editing.html#subsection-2">Little Endian</a></li>
</ul>
</li>
<li><a href="universal/guides/hex_editing/hex_editing.html#section-4">Pasting bytes</a></li>
<li><a href="universal/guides/hex_editing/hex_editing.html#section-5">Compressed files</a></li>
</ul>
<h2 id="using-a-hex-editor"><a class="header" href="#using-a-hex-editor">Using a Hex Editor</a></h2>
<p>Binary Hacking is done by editing the compiled binaries of the game files. 
For most of the regular stuff like wild encounters and trainers there are tools in place to simplify the process, but sometimes it is still necessary to hex edit things manually.</p>
<p>If you haven't already you need to download a Hex Editor. There are plenty of different softwares that can do it, in this guide I will be using HxD.</p>
<p>To start, open the file you want to edit with it. Worth mentioning that you can open in a hex editor any file regardless of its extension, keep this in mind since narc files or their contents once extracted might not have an extension.</p>
<h2 id="offsets"><a class="header" href="#offsets">Offsets</a></h2>
<p>An offset is the address of a binary file.</p>
<p>In HxD you can &quot;jump&quot; to certain offsets using the <em>Search&gt;Go To...</em> function, or using the shortcut <code>Ctrl+G</code>. It will open up a window where you need to enter the offset. Note that offsets are usually indicated with a <code>0x</code>, such as <code>0xAB12DC</code>, so in this case you only need to enter <code>AB12DC</code>.</p>
<p><img src="universal/guides/hex_editing/resources/hexoffset.PNG" alt="" /></p>
<h3 id="different-game-languages"><a class="header" href="#different-game-languages">Different Game Languages</a></h3>
<p>Generally all offsets will refer to the US version of the game in question, unless specified otherwise. Such offset might be different if you're using a non-English version of the game, but it's still possible to find the equivalent offset:</p>
<ol>
<li>Go to the offset in the US version of the game</li>
<li>Copy 10 bytes or more</li>
<li>Open the equivalent file from the game version you want to edit</li>
<li>Search those bytes (see the next section). You should find only one result, which will be the equivalent offset If not, you need to copy more bytes and search again.</li>
</ol>
<h2 id="searching-the-bytes"><a class="header" href="#searching-the-bytes">Searching the bytes</a></h2>
<p>When you need to instead search for a sequence of bytes (that you already know), you can use HxD Search function or the shortcut <code>Ctrl+F</code>, selecting Hex Values and then pasting the bytes you are looking for. 
Click <em>Search All</em> to display all the possible results.</p>
<p><img src="universal/guides/hex_editing/resources/hexsearch.PNG" alt="" /></p>
<h3 id="little-endian"><a class="header" href="#little-endian">Little Endian</a></h3>
<p>When it comes to binary all the data is stored in <a href="https://thebittheories.com/little-endian-vs-big-endian-b4046c63e1f2">little-endian format</a>:</p>
<p>To keep it simple, just remember that the order of bytes is always inverted. For example, if you want to search 1212, first convert it to hexadecimal (Windows Calculator programmer mode can come in handy): it will be <code>04 BC</code>, swapping the order of bytes we get the little endian number which is <code>BC 04</code> in this case.
Also, in HxD you can see the decimal value of the bytes you currently have selected (Make sure Little Endian is selected).</p>
<p><img src="universal/guides/hex_editing/resources/hexconversion.PNG" alt="" /></p>
<h2 id="pasting-bytes"><a class="header" href="#pasting-bytes">Pasting Bytes</a></h2>
<p>Once you are at the right offset you can simply type the bytes you want to replace and save the file, or use the Ctrl+B shortcut, which will overwrite the amount of bytes you have currently copied at the offset location. In HxD the bytes you edited before saving the file will be displayed in red.</p>
<p><img src="universal/guides/hex_editing/resources/hexpaste.png" alt="" /></p>
<p><strong>Remember to only replace bytes and never expand the size of the original file, unless you know what you are doing</strong>.
The game expects an exact amount of data, generally expanding the size of the file will break your game unless you are also accounting for that trough code editing.</p>
<p>Don't forget to save the file after you're done hex editing!</p>
<h2 id="compressed-files"><a class="header" href="#compressed-files">Compressed files</a></h2>
<p>All games including HGSS and onwards have their overlay and arm9 files compressed. This is always going to be mentioned in all the guides you can read here but it's worth to keep it in mind:</p>
<ul>
<li>You can use CrystalTile2 to decompress and then reinsert (once edited) the arm9 and overlays</li>
<li>For gen 4 games, the arm9 in the PokEditor and DSPRE project folder is already uncompressed. For HGSS, you can uncompress Overlay 1 using DSPRE's toolbox. You can find all the compressed overlays in the project folder.</li>
<li>For gen 5 games, the arm9 in the CTRMap project folder is already uncompressed. If you insert a uncompressed overlay in the appropriate subfolder, you can pack and then export the ROM without recompressing it.</li>
<li><a href="https://www.romhacking.net/utilities/826/">blz</a> can be used to decompress and recompress arm9 and overlays. This is a <strong>command line tool</strong>, you don't double click on it. Put blz.exe and the file you need to compress/uncompress in the same folder, open the cmd from that folder and then run the appropriate command. You can see the available commands by running the <code>blz</code> command.</li>
<li>Overlays and arm9 extracted with Tinke are always compressed. If you decompressed it afterwards, you'll need to hex edit the overlay table to insert it with Tinke again.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="making-a-new-texture-flipbook-animation-from-scratch"><a class="header" href="#making-a-new-texture-flipbook-animation-from-scratch">Making a new texture flipbook animation from scratch</a></h1>
<blockquote>
<p>This guide was written by <a href="https://github.com/BromBromBromley">Brom</a>.</p>
</blockquote>
<h2 id="what-is-a-texture-flipbook"><a class="header" href="#what-is-a-texture-flipbook">What is a texture flipbook?</a></h2>
<p>Ever seen flowers on the field change between different frames in their animation? Have you seen the water rise and fall with rocks in the ocean? Even with the player character, all of these examples use texture flipbook animations! Let's learn how to make one from scratch together.</p>
<h2 id="what-is-an-nsbtp"><a class="header" href="#what-is-an-nsbtp">What is an NSBTP?</a></h2>
<p>For the Nintendo DS, games that are 3D primarily use <a href="https://kingdom-of-ds-hacking.github.io/universal/resources/nitro/graphics_3d/file_btp0.html">NSBTP (NITRO System Binary Texture Pattern animation)</a> files to make texture flipbooks. In tools like Tinke, you may see these files as &quot;.btp0&quot; files, but don't worry, they're the same as NSBTP files.</p>
<h2 id="what-is-an-itp"><a class="header" href="#what-is-an-itp">What is an ITP?</a></h2>
<p>Before the texture flipbook animation is put into a format that the Nintendo DS can read easily with the NSBTP file, it's in a plain-text format that humans can read more easily. These files are called ITP (Intermediate Texture Pattern animation) files. We will be making one of these in order to create an NSBTP of our own. After we give it to a special program, we can get an NSBTP file from it.</p>
<h2 id="what-do-we-need-to-make-one"><a class="header" href="#what-do-we-need-to-make-one">What do we need to make one?</a></h2>
<p>Required materials:</p>
<ul>
<li>Any text editor</li>
<li>G3DCVTR</li>
</ul>
<h2 id="creating-the-itp-file"><a class="header" href="#creating-the-itp-file">Creating the ITP file</a></h2>
<h3 id="what-are-the-parts-of-the-itp-file"><a class="header" href="#what-are-the-parts-of-the-itp-file">What are the parts of the ITP file?</a></h3>
<p>There are two primary parts to the ITP being the &quot;header&quot; section with various info about how the file was generated along with the &quot;body&quot; section which is the more important part. For the most part, the data in the header section isn't very important for our purposes, but will be included in order to make a valid ITP file.</p>
<h3 id="making-the-basic-skeleton-of-the-itp"><a class="header" href="#making-the-basic-skeleton-of-the-itp">Making the basic skeleton of the ITP</a></h3>
<p>For anyone who has seen an XML file before, you might not be in for a total shock as ITP files are actually XML files in disguise! To start, let's put in the data that every ITP needs here:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;Shift_JIS&quot;?&gt;

&lt;itp version=&quot;1.6.0&quot;&gt;

&lt;head&gt;
    &lt;create user=&quot;name&quot; host=&quot;host&quot; date=&quot;date&quot; source=&quot;source&quot;/&gt;
    &lt;title&gt;Texture Pattern Animation Data for NINTENDO NITRO-System&lt;/title&gt;
    &lt;generator name=&quot;generator&quot; version=&quot;version&quot;/&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;/body&gt;

&lt;/itp&gt;
</code></pre>
<p>With this, we now have a basic header for the ITP. Let's now fill out the body section.</p>
<h3 id="filling-in-the-body-section-of-the-itp"><a class="header" href="#filling-in-the-body-section-of-the-itp">Filling in the &quot;body&quot; section of the ITP</a></h3>
<p>The body is a little bit more complicated. It is split up into 4 parts being:</p>
<ul>
<li>The texture pattern animation's general information (<code>tex_pattern_info</code>)</li>
<li>The texture pattern animation's texture and palette names (<code>tex_pattern_list_data</code>)</li>
<li>The texture pattern animation's data (<code>tex_pattern_data</code>)</li>
<li>The array of texture pattern animations (<code>tex_pattern_anm_array</code>)*</li>
</ul>
<p>*<em>For this guide, we will only be covering having a single pattern animation in the texture pattern animation array</em></p>
<p>First up is the <code>tex_pattern_info</code> section.</p>
<pre><code class="language-xml">&lt;tex_pattern_info
    frame_size=&quot;16&quot;
    tool_start_frame=&quot;1&quot;
    tool_end_frame=&quot;16&quot;
    compress_material=&quot;on&quot; material_size=&quot;1 1&quot;
/&gt;
</code></pre>
<p>Here, we set how many frames our animation should have (<code>frame_size</code>), what frame our animation should start on (<code>tool_start_frame</code>), and what frame our animation should end on (<code>tool_end_frame</code>). For this guide, we won't be touching the <code>compress_material</code> or <code>material_size</code> fields. </p>
<p>With this section here, we have an 16 frame long animation that starts at frame 1 and ends on frame 16.</p>
<p>Next up is the <code>tex_pattern_list_data</code> section.</p>
<pre><code class="language-xml">&lt;tex_pattern_list_data image_size=&quot;4&quot; palette_size=&quot;4&quot;&gt;
    &lt;image_name index=&quot;0&quot; name=&quot;anim.1&quot;/&gt;
    &lt;image_name index=&quot;1&quot; name=&quot;anim.2&quot;/&gt;
    &lt;image_name index=&quot;2&quot; name=&quot;anim.3&quot;/&gt;
    &lt;image_name index=&quot;3&quot; name=&quot;anim.4&quot;/&gt;
    &lt;palette_name index=&quot;0&quot; name=&quot;anim.1_pl&quot;/&gt;
    &lt;palette_name index=&quot;1&quot; name=&quot;anim.2_pl&quot;/&gt;
    &lt;palette_name index=&quot;2&quot; name=&quot;anim.3_pl&quot;/&gt;
    &lt;palette_name index=&quot;3&quot; name=&quot;anim.4_pl&quot;/&gt;
&lt;/tex_pattern_list_data&gt;
</code></pre>
<p>The first half of this section dictates what textures from a model's NSBTX will be used and the second half dictates what palettes will be used. If the amount of textures needs to be increased or decreased, make sure to adjust the <code>image_size</code> field appropriately and same for the amount of palettes with the <code>palette_size</code> field.</p>
<p>After this is the <code>tex_pattern_data</code> section.</p>
<pre><code class="language-xml">&lt;tex_pattern_data&gt;
    &lt;frame_idx size=&quot;8&quot;&gt;
        0 2 4 6 8 10 12 14
    &lt;/frame_idx&gt;
    &lt;image_idx size=&quot;8&quot;&gt;
        0 1 2 3 2 3 1 0
    &lt;/image_idx&gt;
    &lt;palette_idx size=&quot;8&quot;&gt;
        0 1 2 3 2 3 1 0
    &lt;/palette_idx&gt;
&lt;/tex_pattern_data&gt;
</code></pre>
<p>This part right here is the actual animation part. The <code>frame_idx</code> portion determines what frames will change the image and palette shown. The <code>image_idx</code> potion determines what image is shown based on the image index from the <code>tex_pattern_list_data</code> section. Similarly, the <code>palette_idx</code> portion does the same thing but for the palette. In this example, it does the following:</p>
<pre><code class="language-xml">Frame 0 - Shows anim.1 (texture 0) with palette anim.1_pl
Frame 2 - Shows anim.2 (texture 1) with palette anim.2_pl
Frame 4 - Shows anim.3 (texture 2) with palette anim.3_pl
Frame 6 - Shows anim.4 (texture 3) with palette anim.4_pl
Frame 8 - Shows anim.3 (texture 2) with palette anim.3_pl
Frame 10 - Shows anim.4 (texture 3) with palette anim.4_pl
Frame 12 - Shows anim.2 (texture 1) with palette anim.2_pl
Frame 14 - Shows anim.1 (texture 0) with palette anim.1_pl
</code></pre>
<p>Until another key frame is hit, it will keep the currently displayed image and palette. If the amount of key frames needed needs to be increased or decreased, make sure to change the &quot;size&quot; field for <code>frame_idx</code>, <code>image_idx</code>, and <code>palette_idx</code>.</p>
<p>As the last section for the <code>body</code> section, we have <code>tex_pattern_anm_array</code>.</p>
<pre><code class="language-xml">&lt;tex_pattern_anm_array size=&quot;1&quot;&gt;
    &lt;tex_pattern_anm index=&quot;0&quot; material_name=&quot;anim_tex&quot; data_size=&quot;8&quot; data_head=&quot;0&quot;/&gt;
&lt;/tex_pattern_anm_array&gt;
</code></pre>
<p>The main things of importance for us here are the <code>material_name</code> and <code>data_size</code> fields. With the <code>material_name</code> field, we can target a specific material for the animation to play instead of displaying that material. In this case, if we had a material called <code>anim_tex</code> on a model, it would display the animation from here instead. With the <code>data_size</code> field, for our purposes, make sure it matches the <code>size</code> field from the <code>tex_pattern_data</code> section because if it's smaller than it, it won't use all of the key frames listed.</p>
<p>With everything put together from the examples we should get this:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;Shift_JIS&quot;?&gt;

&lt;itp version=&quot;1.6.0&quot;&gt;

&lt;head&gt;
    &lt;create user=&quot;name&quot; host=&quot;host&quot; date=&quot;date&quot; source=&quot;source&quot;/&gt;
    &lt;title&gt;Texture Pattern Animation Data for NINTENDO NITRO-System&lt;/title&gt;
    &lt;generator name=&quot;generator&quot; version=&quot;version&quot;/&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;tex_pattern_info
    frame_size=&quot;16&quot;
    tool_start_frame=&quot;1&quot;
    tool_end_frame=&quot;16&quot;
    compress_material=&quot;on&quot; material_size=&quot;1 1&quot;
/&gt;

&lt;tex_pattern_list_data image_size=&quot;4&quot; palette_size=&quot;4&quot;&gt;
    &lt;image_name index=&quot;0&quot; name=&quot;anim.1&quot;/&gt;
    &lt;image_name index=&quot;1&quot; name=&quot;anim.2&quot;/&gt;
    &lt;image_name index=&quot;2&quot; name=&quot;anim.3&quot;/&gt;
    &lt;image_name index=&quot;3&quot; name=&quot;anim.4&quot;/&gt;
    &lt;palette_name index=&quot;0&quot; name=&quot;anim.1_pl&quot;/&gt;
    &lt;palette_name index=&quot;1&quot; name=&quot;anim.2_pl&quot;/&gt;
    &lt;palette_name index=&quot;2&quot; name=&quot;anim.3_pl&quot;/&gt;
    &lt;palette_name index=&quot;3&quot; name=&quot;anim.4_pl&quot;/&gt;
&lt;/tex_pattern_list_data&gt;

&lt;tex_pattern_data&gt;
    &lt;frame_idx size=&quot;8&quot;&gt;
        0 2 4 6 8 10 12 14
    &lt;/frame_idx&gt;
    &lt;image_idx size=&quot;8&quot;&gt;
        0 1 2 3 2 3 1 0
    &lt;/image_idx&gt;
    &lt;palette_idx size=&quot;8&quot;&gt;
        0 1 2 3 2 3 1 0
    &lt;/palette_idx&gt;
&lt;/tex_pattern_data&gt;

&lt;tex_pattern_anm_array size=&quot;1&quot;&gt;
    &lt;tex_pattern_anm index=&quot;0&quot; material_name=&quot;anim_tex&quot; data_size=&quot;8&quot; data_head=&quot;0&quot;/&gt;
&lt;/tex_pattern_anm_array&gt;

&lt;/body&gt;

&lt;/itp&gt;
</code></pre>
<p>With this, it should play a short animation on the material <code>anim_tex</code> assuming all the textures and palettes listed are within the texture set of the model.</p>
<h2 id="getting-an-nsbtp-from-our-itp"><a class="header" href="#getting-an-nsbtp-from-our-itp">Getting an NSBTP from our ITP</a></h2>
<p>After you finish making your ITP, all you have to do is drag and drop your ITP file onto <code>g3dcvtr.exe</code> and assuming there are no errors, it should convert your ITP into a new NSBTP file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-use-knarc"><a class="header" href="#how-to-use-knarc">How to use Knarc</a></h1>
<blockquote>
<p>This guide was written by SpagoAsparago.</p>
</blockquote>
<p>This is a tutorial on how to use Knarc to pack/unpack NARC files.
You can download Knarc.exe from <a href="https://github.com/kr3nshaw/knarc/releases/tag/1.0.0">here</a></p>
<hr />
<h2 id="table-of-contents-18"><a class="header" href="#table-of-contents-18">Table of Contents</a></h2>
<ul>
<li><a href="universal/guides/knarc/knarc.html#section">Opening the CMD</a></li>
<li><a href="universal/guides/knarc/knarc.html#section-2">Unpacking the NARC</a></li>
<li><a href="universal/guides/knarc/knarc.html#section-3">Adding files and Packing the NARC</a></li>
</ul>
<h2 id="opening-the-cmd"><a class="header" href="#opening-the-cmd">Opening the CMD</a></h2>
<p>First, extract the NARC you want to unpack with Tinke and save it in the same folder as the Knarc.exe file.</p>
<p>Launch the Command Prompt in that same folder.</p>
<details>
 <summary>On Windows you can type `cmd` in the folder address and press enter:</summary>
<p><video src="resources/quickcmdvideo.mp4" width="640" height="480" controls></video></p>
<h2 id="unpacking-the-narc"><a class="header" href="#unpacking-the-narc">Unpacking the NARC</a></h2>
<p>To unpack the NARC, you can use the command </p>
<p><code>Knarc -u file</code>
With <code>file</code> being the extracted NARC filename. This will extract all its content in the folder the NARC is currently located, if you want to extract them to a different folder, then use</p>
<p><code>Knarc -d folder -u file</code>
With <code>folder</code> being the address of the destination folder you want. You can create a new folder inside the one from where you launched Knarc and simply use that folder name in the command.</p>
<p>You should do this if you plan to add additional files to the NARC.</p>
<h2 id="adding-files-and-packing-the-narc"><a class="header" href="#adding-files-and-packing-the-narc">Adding files and Packing the NARC</a></h2>
<p>If you're going to add a new file to the NARC, make sure the newly added file follows the same naming convention as the already existing files.</p>
<p>For repacking the narc, you can use: 
<code>Knarc -d folder -p file</code></p>
<p>Now you can reinsert the NARC using Tinke. Just go to the same location as the original file you extracted, and use the <code>Change File</code> button instead of <code>Extract</code>. Now you can save your ROM.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="town-map-spots"><a class="header" href="#town-map-spots">Town Map Spots</a></h1>
<p>These structures are used to describe the Town Map selectable structures in Heart Gold and Soul Silver as they appear baked into Overlay 101.</p>
<hr />
<h3 id="gearmaptownoverlay-struct-description"><a class="header" href="#gearmaptownoverlay-struct-description">GearMapTownOverlay Struct Description</a></h3>
<pre><code class="language-c">struct GearMapTownOverlay
{
    /* 0x0 */ u16 mapHeader;
    /* 0x2 */ u16 gateAppearance; // not sure
    /* 0x4 */ u8 entry; // maybe
    /* 0x5 */ u8 entry2; // maybe
    /* 0x6 */ u8 redX;
    /* 0x7 */ u8 redY;
    /* 0x8 */ u8 grayX;
    /* 0x9 */ u8 grayY;
    /* 0xA */ u8 townDimY:4; // msn
              u8 townDimX:4; // lsn
    /* 0xB */ u8 replacementDimY:4; // msn
              u8 replacementDimX:4; // lsn
    /* 0xC */ u8 offsetY:4; // msn
              u8 offsetX:4; // lsn
    /* 0xD */ u8 padding;
}; // entry size = 0xE
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>mapHeader</td><td>the map header that the entry describes</td><td>u16</td></tr>
<tr><td>gateAppearance</td><td>the map header that describes gates for the entry</td><td>u16</td></tr>
<tr><td>entry</td><td>the entry in this table (maybe?)</td><td>u8</td></tr>
<tr><td>entry2</td><td>the entry in recorded visit (has player visited entry?)</td><td>u8</td></tr>
<tr><td>redX</td><td>the base x coordinate for the red blocks (shifted right one)</td><td>u8</td></tr>
<tr><td>redY</td><td>the base y coordinate for the red blocks (shifted up one)</td><td>u8</td></tr>
<tr><td>grayX</td><td>the base x coordinate for the gray block on the image</td><td>u8</td></tr>
<tr><td>grayY</td><td>the base y coordinate for the gray block on the image</td><td>u8</td></tr>
<tr><td>townDimY</td><td>the amount of matrix chunks the town spans up and down</td><td>u8:4 (4 bits)</td></tr>
<tr><td>townDimX</td><td>the amount of matrix chunks the town spans left and right</td><td>u8:4 (4 bits)</td></tr>
<tr><td>offsetY</td><td>y offset within the replacement block of the actual town</td><td>u8:4 (4 bits)</td></tr>
<tr><td>offsetX</td><td>x offset within the replacement block of the actual town</td><td>u8:4 (4 bits)</td></tr>
<tr><td>padding</td><td>unused (ensures next entry is 2-byte aligned)</td><td>u8</td></tr>
</tbody></table>
</div>
<h3 id="gearmaptownselectionoverlay-struct-description"><a class="header" href="#gearmaptownselectionoverlay-struct-description">GearMapTownSelectionOverlay Struct Description</a></h3>
<pre><code class="language-c">struct GearMapTownSelectionOverlay
{
    /* 0x0 */ u16 mapHeader;
    /* 0x2 */ u8 baseX; // in poke gear position
    /* 0x3 */ u8 baseY; // in poke gear position
    /* 0x4 */ u8 dimY:4; // msn
              u8 dimX:4; // lsn
    /* 0x5 */ u8 flags;
    /* 0x6 */ u8 textEntry; // in a027 file 273
    /* 0x7 */ u8 flySpot;
    /* 0x8 */ u32 padding;
    /* 0xC */ u8 orangeBaseX; // in image
    /* 0xD */ u8 orangeBaseY; // in image
    /* 0xE */ u8 orangeDimX; // in image
    /* 0xF */ u8 orangeDimY; // in image
}; // size = 0x10
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>mapHeader</td><td>the map header that the entry describes</td><td>u16</td></tr>
<tr><td>baseX</td><td>base x position in PokéGear</td><td>u8</td></tr>
<tr><td>baseY</td><td>base y position in PokéGear</td><td>u8</td></tr>
<tr><td>dimY</td><td>y dimension of selection overlay in tiles</td><td>u8:4 (4 bits)</td></tr>
<tr><td>dimX</td><td>x dimension of selection overlay in tiles</td><td>u8:4 (4 bits)</td></tr>
<tr><td>flags</td><td>flags that seemingly control when/how things are shown</td><td>u8</td></tr>
<tr><td>textEntry</td><td>text entry to use from a027 file 273 for the blurb</td><td>u8</td></tr>
<tr><td>flySpot</td><td>towns with a fly spot have this nonzero</td><td>u8</td></tr>
<tr><td>padding</td><td>unused field</td><td>u32</td></tr>
<tr><td>orangeBaseX</td><td>base x position in image of the orange overlay block</td><td>u8</td></tr>
<tr><td>orangeBaseY</td><td>base y position in image of the orange overlay block</td><td>u8</td></tr>
<tr><td>orangeDimX</td><td>x dimension in image of the orange overlay block</td><td>u8</td></tr>
<tr><td>orangeDimY</td><td>y dimension in image of the orange overlay block</td><td>u8</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="maps"><a class="header" href="#maps">Maps</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://github.com/Gonhex">Gonhex</a>, <a href="https://github.com/Trifindo">Trifindo</a></p>
</blockquote>
<p>The term &quot;map&quot; is used for areas of the game world. The player can navigate through them and interact with other objects placed on the map. Usually one map has a size of 32 by 32 tiles and a maximum of four of them are loaded simultaneously. The maps are usually selected by the currently active &quot;matrix&quot; in <code>a/0/0/9</code> but there are cases where the game chooses an other map, depending on the in-game season.</p>
<h2 id="table-of-contents-19"><a class="header" href="#table-of-contents-19">Table of Contents</a></h2>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#data-location">Data Location</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#data-structure">Data Structure</a>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#container-structure">Container Structure</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#model">Model</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#permissions">Permissions</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#building-table">Building Table</a></li>
</ul>
</li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#specification">Specification</a>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#overview">Overview</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#size">Size</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#permission-data">Permission Data</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#special-rd-maps">Special RD Maps</a></li>
</ul>
</li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-location"><a class="header" href="#data-location">Data Location</a></h2>
<p>The NARC containing these files can be found in the following game paths:</p>
<ul>
<li>Black and White: <code>/a/0/0/8</code></li>
<li>Black 2 and White 2: <code>/a/0/0/8</code></li>
</ul>
<hr />
<h2 id="data-structure"><a class="header" href="#data-structure">Data Structure</a></h2>
<h3 id="container-structure"><a class="header" href="#container-structure">Container Structure</a></h3>
<pre><code class="language-c">struct ContainerMap
{
    // header
    uint8_t signature[2];
    uint16_t numberSections;
    uint32_t offsetModel;
    uint32_t offsetPermissions[numberSections - 2];
    uint32_t offsetBuildingTable;
    uint32_t length;
    
    // data
    struct NSBMD dataModel;
    struct SectionPermission dataPermissions[numberSections - 2];
    struct SectionBuildingTable dataBuildingTable;
};
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>signature</td><td><code>&quot;NG&quot;</code>: No permission section.  <br /> <code>&quot;WB&quot;</code>: One permission section. <br /> <code>&quot;GC&quot;</code>: Two permission sections. <br /> <code>&quot;RD&quot;</code>: One permission section, but with a different file format.</td><td>uint8_t[]</td></tr>
<tr><td>numberSections</td><td>Number of data sections within this file.</td><td>uint16_t</td></tr>
<tr><td>offsetModel</td><td>Points to the 3D model of the map.</td><td>uint32_t</td></tr>
<tr><td>offsetPermissions</td><td>Points to the movement permission data.</td><td>uint32_t[]</td></tr>
<tr><td>offsetBuildingTable</td><td>Points to the building table.</td><td>uint32_t</td></tr>
<tr><td>length</td><td>Length of this file.</td><td>uint32_t</td></tr>
<tr><td>dataModel</td><td>3D model of the map. NSBMD format without a texture section.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#model">NSBMD</a></td></tr>
<tr><td>dataPermissions</td><td>0, 1 or 2 permission sections. A 2nd one can be used for things like bridges where one can walk on two different heights.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#permissions">SectionPermission</a>[]</td></tr>
<tr><td>dataBuildingTable</td><td>Define appearance settings for all buildings.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#building-table">SectionBuildingTable</a></td></tr>
</tbody></table>
</div>
<h3 id="model"><a class="header" href="#model">Model</a></h3>
<p>The NSBMD data format is currently not documented in this repository. You can find some information <a href="https://github.com/JackHack96/nsbmd_docs/blob/master/nsbmd_docs.md">here</a> instead.</p>
<h3 id="permissions"><a class="header" href="#permissions">Permissions</a></h3>
<pre><code class="language-c">struct SectionPermission
{
    // header
    uint16_t width;
    uint16_t height;
    
    // data
    struct Tile tile[width * height];
    struct CornerTerrain corner[numberCorners];
};
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>width</td><td>Number of tiles in horizontal direction.</td><td>uint16_t</td></tr>
<tr><td>height</td><td>Number of tiles in vertical direction.</td><td>uint16_t</td></tr>
<tr><td>tile</td><td>Individual soil properties for all fields.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#tile">Tile</a>[]</td></tr>
<tr><td>corner</td><td>Special terrain properties for corners. Corners are optional.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#terrain-extension-for-corners">CornerTerrain</a>[]</td></tr>
</tbody></table>
</div>
<h4 id="tile"><a class="header" href="#tile">Tile</a></h4>
<pre><code class="language-c">// &quot;WB&quot; and &quot;GC&quot; type maps:
struct Tile
{
    struct TileTerrain terrain;
    struct TileEnvironment environment;
}; // entry size = 0x8

// &quot;RD&quot; type maps:
struct Tile
{
    int8_t unknown[20]; // TODO: document structure
    struct TileEnvironment environment;
}; // entry size = 0x18
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>terrain</td><td>Defines height and slope on which overworlds are placed.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#terrain">TileTerrain</a></td></tr>
<tr><td>unknown</td><td>Data for <code>&quot;RD&quot;</code>-type maps. Those maps have flag based object placement.</td><td>int8_t[]</td></tr>
<tr><td>environment</td><td>Interaction between tile and overworld.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#environment">TileEnvironment</a></td></tr>
</tbody></table>
</div>
<h4 id="terrain"><a class="header" href="#terrain">Terrain</a></h4>
<pre><code class="language-c">struct TileTerrain
{
    uint16_t inclination;
    uint16_t distance;
}; // entry size = 0x4
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>inclination</td><td>Indexes a specific terrain slope. Probably flag based with a format like <code>0bTTTT'TTTT'TTTT'TTCR</code> with <code>T = terrain settings</code>, <code>C = is corner</code> and <code>R = reset</code></td><td>uint16_t</td></tr>
<tr><td>distance</td><td>Indexes values that represent the distance perpendicular to the center of the map when the plane is extended to allow that vector. If the inclination for this tile indicates a corner, the field represents the index of the corner instead. Counting starts by zero.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<h4 id="environment"><a class="header" href="#environment">Environment</a></h4>
<pre><code class="language-c">struct TileEnvironment
{
    uint16_t behavior;
    uint16_t flags;
}; // entry size = 0x4
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>behavior</td><td>Often used in combination with <code>flags</code>. Manages data used for interactions and affects the overall behavior of a tile.</td><td>uint16_t</td></tr>
<tr><td>flags</td><td>Flag based tile settings that can be combined. See table below.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<h4 id="terrain-extension-for-corners"><a class="header" href="#terrain-extension-for-corners">Terrain extension for corners</a></h4>
<pre><code class="language-c">struct CornerTerrain
{
    uint16_t inclinationTop;
    uint16_t inclinationBottom;
    uint16_t distanceTop;
    uint16_t distanceBottom;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>inclinationTop</td><td>Inclination for top-left and top-right corners, <code>inclination = inclinationTop - 1</code>.</td><td>uint16_t</td></tr>
<tr><td>inclinationBottom</td><td>Inclination for bottom-left and bottom-right corners, <code>inclination = inclinationBottom * 4</code>.</td><td>uint16_t</td></tr>
<tr><td>distanceTop</td><td>Distance for top-left and top-right corners, <code>distance = distanceTop</code>.</td><td>uint16_t</td></tr>
<tr><td>distanceBottom</td><td>Distance for bottom-left and bottom-right corners, <code>distance = distanceBottom</code>.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<hr />
<h3 id="building-table"><a class="header" href="#building-table">Building Table</a></h3>
<pre><code class="language-c">struct SectionBuildingTable
{
    // header
    uint32_t numberBuildings;
    
    // data
    struct BuildingProperties building[numberBuildings];
};
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberBuildings</td><td>Header of the building table, tells how many building are assigned to the map.</td><td>uint32_t</td></tr>
<tr><td>building</td><td>Display settings for a building. Includes local position, yaw rotation and the building index.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#building-display-settings">BuildingProperties</a></td></tr>
</tbody></table>
</div>
<h4 id="building-display-settings"><a class="header" href="#building-display-settings">Building display settings</a></h4>
<pre><code class="language-c">struct BuildingProperties
{
    fx&lt;1.19.12&gt; localPositionX;
    fx&lt;1.19.12&gt; localPositionY;
    fx&lt;1.19.12&gt; localPositionZ;
    uint16_t rotationAngleYaw;
    uint16_t buildingID; // big endian
}; // entry size = 0x10
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>localPositionX</td><td>X position relative to the center of the map.</td><td><a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>localPositionY</td><td>Y position relative to the center of the map.</td><td><a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>localPositionZ</td><td>Z position relative to the center of the map.</td><td><a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>rotationAngleYaw</td><td>Counterclockwise yaw rotation angle.</td><td>uint16_t</td></tr>
<tr><td>buildingID</td><td>ID of the building model. Unlike most variables, this one is in big endian.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<h3 id="overview"><a class="header" href="#overview">Overview</a></h3>
<p>Part of the map files are:</p>
<ol>
<li>A 3D NSBMD-model of the map. This <strong>does not</strong> include textures!. The teture data is in <code>a/0/1/4</code>.</li>
<li>0-2 permission matrices. This is basically how the game sees the map since the model does not provide any collision data. It is a 2D environment layout with additional informations about the 3rd dimension. The 2nd permission matrix is optional and almost identical to the first one, except for coordinates where two different behaviors are required (for example walking under OR on a bridge). Rails (<code>a/0/7/8</code>) also contain collision data and may be loaded externally in some cases. This is why some maps come without own permission sections.</li>
<li>A layout for externally loaded models (buildings).</li>
</ol>
<h3 id="size"><a class="header" href="#size">Size</a></h3>
<p>As already mentioned, the standard size for a map is 32 by 32 tiles. But how large is a tile? The game accesses positions on the overworld using 32 bit values. These can be read as fixed point values. The default format is <a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a>. This means that one tile has a size of 16 units. The most textures are also mapped with 16 pixel per tile.</p>
<p>To convert the value to one unit per tile, we can move the decimal point into the middle and read as <a href="gen5/resources/field/">fx&lt;1.15.16&gt;</a> instead. This is how the terrain values for PDSMS were calculated, since its a tile based tool.</p>
<h3 id="permission-data"><a class="header" href="#permission-data">Permission Data</a></h3>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#corners">Corners</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#terrain-inclination-values">Terrain Inclination Values</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#terrain-distance-values">Terrain Distance Values</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#environment-behavior-values">Environment Behavior Values</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#environment-flag-values">Environment Flag Values</a></li>
</ul>
<h4 id="corners"><a class="header" href="#corners">Corners</a></h4>
<p>To allow the character to walk a different slope depending from the direction, Pokemon Black and White introduced corner tiles. These store data for two differnt terrains and apply one terrain to the northern vertices and the 2nd one to the southern vertices. Since the double amount of data at random position wouldn't fit into the permission grid, this data gets appended to the end of the permission section. The <code>0x0002</code> (bit) command in the terrain inclination tells the game to read a value from the extra data. The terrain distance behaves as an index for this section.</p>
<h4 id="terrain-inclination-values"><a class="header" href="#terrain-inclination-values">Terrain Inclination Values</a></h4>
<p>The 3-dimensional shape of a tile.</p>
<p>TODO: Add tables or code.</p>
<h4 id="terrain-distance-values"><a class="header" href="#terrain-distance-values">Terrain Distance Values</a></h4>
<p>If we extend the tile to an infinite plane, we can draw a line which is perpendicular to the plane and connect it to the origin (0, 0, 0) of the map. The length of this line is the distance. The distence is selected using indices. </p>
<details>
<summary>Distance table - Black and White</summary>
<pre><code class="language-c">/**
 * Table created by Gonhex
 * Number of entries: 1314
 * All values signed int32
 * Tiles = value / 0x10000
 */

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x000- */ 0x00000000, 0xFFFE7FE9, 0x00016A20, 0xFFF6191D, 0xFFFEFFF1, 0xFFF7AD6F, 0x00043E61, 0x00038951, 0xFFFB01A9, 0x0000B510, 0x000712A2, 0xFFF4AEFC, 0xFFFDE0D0, 0xFFFDC36D, 0x0001000F, 0x0001CA0E,
/* 0x001- */ 0x0000E507, 0x00007283, 0xFFFEA875, 0xFFFB86DB, 0x00020AAF, 0x0000CD4E, 0x0001A225, 0xFFFBF95F, 0xFFFF7FF9, 0x00016317, 0x00008E09, 0x00019A9C, 0x0000D112, 0x00006889, 0x0002AF16, 0x0002DBC2,
/* 0x002- */ 0x00027338, 0x0002AAD4, 0x0001AA1C, 0x0002001F, 0x0000D50E, 0x000267EB, 0xFFFF1AF9, 0x0002237B, 0x00023C93, 0x0001562D, 0x0002557B, 0x0001AAC4, 0xFFFCDE66, 0x000406A1, 0xFFFE35F2, 0xFFFE95E0,
/* 0x003- */ 0x0003219A, 0xFFF9BCCC, 0x00047925, 0x000E00DF, 0xFFFC6BE2, 0x000B5104, 0x00087CC3, 0xFFF69BA6, 0xFFF9A26E, 0x000A9BF3, 0x0009E6E3, 0xFFFA577E, 0xFFF7833D, 0xFFFB1458, 0xFFFAA1D3, 0xFFF8384E,
/* 0x004- */ 0xFFF6331C, 0xFFFA2F50, 0xFFF94A48, 0xFFFC532B, 0x00065D92, 0x0002D441, 0xFFFE5DDB, 0xFFFD2BBF, 0x0005A882, 0x00021F30, 0xFFFDF551, 0xFFFBC19F, 0x0004F371, 0x0000EF97, 0x0001BF3C, 0x00006FCF,
/* 0x005- */ 0x00011010, 0x00013F74, 0x00068F85, 0x000633DB, 0x0005E091, 0xFFFF703F, 0x0000DF9E, 0xFFFF504D, 0x00008FC1, 0x00001000, 0xFFFFA02A, 0x0000AFB3, 0x0000BFAC, 0xFFFF4054, 0x00005FD6, 0xFFFFD015,
/* 0x006- */ 0xFFFF4AF0, 0x001000FF, 0x0008FC13, 0x0002E940, 0xFFFA2D80, 0x0006005F, 0x0004003F, 0xFFF8ED5E, 0xFFFC76AF, 0xFFFBEAA1, 0xFFFB4164, 0x0001E5D8, 0xFFFB25EB, 0xFFFB188D, 0x0008D3CE, 0x00018017,
/* 0x007- */ 0xFFFD50EA, 0x0001578B, 0xFFFDFFE1, 0xFFFB0C8F, 0x0003941E, 0x0009DDC9, 0x0007C7B2, 0x000931D3, 0x00008007, 0xFFF8384D, 0xFFF6CE2D, 0x001EC444, 0x001EC443, 0x000A3061, 0x001DB4AB, 0xFFFF1DA1,
/* 0x008- */ 0x002B82B7, 0x000897E4, 0x0032031F, 0x002F02EF, 0x000038BF, 0xFFFF5D2A, 0x00085BBB, 0x00097611, 0x00007A84, 0xFFFFA79A, 0x000CF8EC, 0x00127ACE, 0x0000C7A4, 0xFFFF13DE, 0x001CFF9A, 0x001CFF9B,
/* 0x009- */ 0x00019216, 0x0000D003, 0x00021A88, 0x0001710D, 0xFFFCBAE0, 0x000160DA, 0x0005608F, 0x0002C6AF, 0x00024167, 0x000A079E, 0x000A079F, 0x0003A677, 0x000358B6, 0x0022E425, 0x0026EAC5, 0x00149BEE,
/* 0x00A- */ 0x00086DD7, 0x000BB39F, 0x001C4A8A, 0x0031030F, 0x0004D4C2, 0x0009F3C9, 0x001B957A, 0xFFFE741F, 0xFFF959F8, 0x00065E9C, 0x0001E0F6, 0x001DF60C, 0x0018F7B4, 0x001CDF0B, 0x00197F55, 0x000387EC,
/* 0x00B- */ 0x0002CDE9, 0x00151671, 0x00176740, 0xFFFF1296, 0x000474EE, 0x0010C317, 0x001A01A0, 0x001FC289, 0x0028B4D5, 0x0014D76D, 0x00150346, 0xFFFFBA4F, 0x00010E38, 0x001F08D1, 0x00015FBA, 0x00042DCB,
/* 0x00C- */ 0x00275D4A, 0x001A019F, 0x0015F3DE, 0x00043175, 0xFFFEF7A7, 0x000AF506, 0x000AE99A, 0x0005F196, 0x000D5F92, 0x00267842, 0x00284251, 0x00180F34, 0x0013A672, 0x001028D1, 0x000E73B4, 0x000BF40B,
/* 0x00D- */ 0x000B42E2, 0x00097053, 0x00093967, 0x0007C88E, 0x00243BAF, 0x0007D682, 0x00069DB9, 0x002B02AF, 0x0006D776, 0x0005C022, 0x0020E374, 0x00224D1D, 0x0027CFCD, 0x0025F9F2, 0x00061818, 0x0004D33C,
/* 0x00E- */ 0x0006FDF4, 0x001D01CF, 0x0005663B, 0x000830B0, 0xFFFA934E, 0x00083ED0, 0xFFF93361, 0xFFF6FEB3, 0xFFFB8312, 0xFFFF5386, 0x000D3FA1, 0x00257C5E, 0x00051447, 0x001B4964, 0xFFFB3789, 0x0016D03F,
/* 0x00F- */ 0x0019F1D9, 0x00208207, 0x000B3A4B, 0x0009E473, 0x00111053, 0xFFFF9D72, 0x0021F30C, 0x001DCF35, 0x0023C92B, 0x00231E30, 0x001578B3, 0x0009ADC5, 0x000B1217, 0x00003237, 0xFFFE5985, 0x000519AA,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x010- */ 0x0000FB16, 0x000F00EF, 0xFFFEC97B, 0x000B00AF, 0x000A009F, 0x0001F62E, 0x0002E32F, 0x0003237C, 0x000614C2, 0x0008A990, 0x00079ABF, 0x0002BF75, 0x0005393E, 0x0005B785, 0x00041617, 0x00074721,
/* 0x011- */ 0x00085291, 0x00084980, 0x000D80D7, 0x0008BAD4, 0x0006DF56, 0x000A00A0, 0x00080170, 0x00083F8B, 0x00077D83, 0x000755CA, 0x000B2EDD, 0x000E5077, 0x00077C32, 0x0007283B, 0x00088DF0, 0x00082ABD,
/* 0x012- */ 0x000D6B70, 0x000E4ACB, 0x000C0614, 0x00054EFB, 0x00060281, 0x00089346, 0x0009D752, 0x000A6514, 0xFFFDC92F, 0xFFFE30C4, 0x00045DE0, 0x000EDA55, 0x00039E78, 0x000BB40B, 0x000143E4, 0x000BB40A,
/* 0x013- */ 0x00093D67, 0x000CF7F0, 0x000CF7EF, 0xFFFE6E42, 0x00083D28, 0x00077110, 0x00194DED, 0x000A2385, 0x002A0C61, 0x0004D44A, 0xFFFC68B5, 0xFFFC472F, 0xFFFF4170, 0x000938C7, 0x002A82A7, 0x002A029F,
/* 0x014- */ 0xFFFD4545, 0xFFFB4919, 0x00015F86, 0x00084E1E, 0x002271A0, 0xFFFE435A, 0xFFF652AC, 0x00090C2C, 0x000B6310, 0x000D79B9, 0x0010FF8E, 0x0014CA28, 0x001E69BB, 0x0017AD59, 0x0013AEA5, 0x0012C99D,
/* 0x015- */ 0x000E79E0, 0x000C2136, 0x000A3355, 0x0008E134, 0x00093FB6, 0x001FD3DB, 0x00099A7D, 0x0009ECDA, 0x00074882, 0x001537E8, 0x000681C8, 0x000B753B, 0x00074D3F, 0x0005C15F, 0xFFFC5C70, 0x0008F9DB,
/* 0x016- */ 0xFFFC5C71, 0x0013313E, 0x000EC2FB, 0x001A9089, 0x0015ECF8, 0x001263A6, 0x00077449, 0x0005C660, 0x00014F43, 0x00043C25, 0xFFFE9F89, 0xFFFD273C, 0x0006F121, 0x000F8F66, 0x00097D39, 0xFFFDE38F,
/* 0x017- */ 0x0005BAE8, 0xFFFE6B21, 0x00047DE8, 0x000B289C, 0x00046D6C, 0x00180C29, 0x00143652, 0x0008F24A, 0x001482D7, 0x000CBB24, 0x000CB46E, 0x00055E2D, 0x000AF8EA, 0x0003B5EA, 0x0005D0B0, 0x0004EBA8,
/* 0x018- */ 0x000425AC, 0x000126AC, 0x000345BF, 0x0007C7B3, 0x000D00CF, 0x0012011F, 0x00037706, 0x0002F5BC, 0x0003153D, 0x00028BD3, 0x0002CD1E, 0x00023BB0, 0x0002F0F9, 0x0002679D, 0x00036850, 0x0002A18A,
/* 0x019- */ 0x00040ADC, 0x0002F144, 0x00036576, 0x00065552, 0x00041CAA, 0x0009D13D, 0x0005004F, 0xFFF50716, 0xFFF77210, 0xFFF4D735, 0xFFF5B0A5, 0xFFF2E0D2, 0xFFF7C1A1, 0xFFFF9777, 0xFFF61044, 0xFFF7825A,
/* 0x01A- */ 0xFFF4EB57, 0xFFF53603, 0x000FF4EF, 0x00090B4D, 0xFFF748E4, 0xFFF85FAD, 0xFFF6F263, 0x0011AE96, 0x0014013F, 0xFFF6E9D4, 0x000A49D6, 0x00002A18, 0xFFF69151, 0x000C80C7, 0xFFF6C7C2, 0x000BA161,
/* 0x01B- */ 0xFFF91045, 0xFFF8B999, 0x00080D43, 0x0001BB82, 0x0002FE16, 0x000AF8FD, 0x0003731B, 0x000210B3, 0xFFF44C05, 0x0003FD3C, 0x0003ADFC, 0x0003FD73, 0xFFF4084D, 0xFFF46923, 0xFFF409DD, 0xFFF48BC7,
/* 0x01C- */ 0xFFF40BDE, 0xFFF4B5A7, 0xFFF40E80, 0xFFF4E93E, 0xFFF4120B, 0xFFF52A52, 0xFFF416FB, 0xFFF57ECF, 0xFFF41E23, 0xFFF5F098, 0xFFF4290F, 0xFFF43AEC, 0xFFF45AFF, 0xFFF49CF0, 0xFFF543A6, 0x0003002F,
/* 0x01D- */ 0xFFFAFFB1, 0xFFFCBBB4, 0x000EB659, 0xFFFC13A4, 0x0006DDA1, 0xFFFE09D2, 0xFFFE4D46, 0xFFFEBC1C, 0xFFFF8D7D, 0xFFFE447E, 0x0009CEE6, 0x000759AA, 0xFFFB198E, 0x0006B5B8, 0xFFF8D7C5, 0xFFF50984,
/* 0x01E- */ 0x00098C5C, 0xFFFC1C28, 0x000279B8, 0xFFFD8648, 0x000C2097, 0x0004BE9C, 0x000A9DF7, 0x00049EB3, 0xFFF868A0, 0xFFFF32B2, 0xFFFFBB91, 0x0006EE0D, 0x000F2EC1, 0x00060309, 0x000D48E9, 0xFFFA4E78,
/* 0x01F- */ 0xFFF682C7, 0xFFF947E6, 0x00005A87, 0xFFFAB206, 0x0003E3D9, 0x0003E3D8, 0x00054DFA, 0x000498E9, 0xFFF5640D, 0x000088DE, 0xFFFDC7DA, 0xFFFB7499, 0xFFFD8CC8, 0x00042948, 0x0006A874, 0xFFF6D860,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x020- */ 0xFFF60351, 0x000BA6CC, 0xFFF3FF41, 0xFFF45934, 0xFFFA2C9B, 0xFFF654BC, 0xFFF8FF90, 0x00023A98, 0xFFFACC9D, 0x00032857, 0xFFFCD8A5, 0x000927A0, 0x00027F2B, 0x0009FCAF, 0xFFFF554C, 0x0002C93E,
/* 0x021- */ 0x00006FC1, 0x0002D8C4, 0x0000BB00, 0x000C55FD, 0xFFFEC664, 0x0003543A, 0x0003B6FE, 0x0001A4C1, 0x0003CBAF, 0x0001DFE2, 0x0003D8D7, 0x000D76F1, 0x00064334, 0xFFFBF524, 0xFFF86541, 0xFFF3BFE4,
/* 0x022- */ 0xFFF9AA46, 0xFFF38427, 0xFFF1546C, 0x000052D5, 0x0001F3ED, 0x00003DA7, 0x0001F0D5, 0x000022D8, 0x0001EC6C, 0xFFFFD140, 0x0001DB7E, 0xFFFF903F, 0xFFFEAA96, 0x000F9F70, 0x0003E7DC, 0x00022ADF,
/* 0x023- */ 0x0003E1AA, 0x00076D2B, 0x0008223A, 0x00010F98, 0xFFFEF068, 0x00028027, 0xFFFB6717, 0xFFFC1C27, 0xFFFFA579, 0xFFF5BE95, 0xFFF892D5, 0x0001C4A9, 0x000AAB54, 0xFFFC7FC9, 0xFFFCFFD1, 0xFFF7666A,
/* 0x024- */ 0x0007367E, 0x00048047, 0x000E2545, 0x000D7035, 0x0007D8B8, 0xFFF82748, 0xFFF90593, 0x0008C47D, 0xFFF90943, 0x00092D9F, 0x0007006F, 0x0004155F, 0x0006200E, 0xFFF8208B, 0xFFF72C32, 0xFFF9225F,
/* 0x025- */ 0x0003EC5C, 0xFFFA9B67, 0xFFFA0870, 0xFFFA7FA9, 0xFFF6311A, 0xFFF8FD3A, 0xFFFA1D77, 0x000DBB41, 0x0005E289, 0x000CC02B, 0x000BC514, 0xFFFDA475, 0x00062137, 0xFFFF04EA, 0x00053289, 0xFFFB614D,
/* 0x026- */ 0xFFF628AE, 0x00068897, 0x0005B188, 0xFFF8A656, 0x00079760, 0x0007C234, 0xFFF9A5CA, 0xFFF45E9F, 0xFFF2B717, 0xFFFAB105, 0xFFFE1D2B, 0xFFFACD77, 0xFFF58FDB, 0xFFF7D543, 0xFFF76CBA, 0xFFF95B8B,
/* 0x027- */ 0xFFFF6C2B, 0xFFFD243F, 0xFFFA39A0, 0xFFFC3451, 0x0005B784, 0xFFF490F7, 0x000B8CC1, 0xFFF6C299, 0xFFFC88FA, 0xFFF4286D, 0x000EB355, 0x000CA8A6, 0x000C8669, 0xFFFD243E, 0xFFF70DB6, 0x0009CCE4,
/* 0x028- */ 0x0001BB83, 0x00065A36, 0x000093D5, 0xFFFED23A, 0xFFFECB2D, 0xFFFD1CD1, 0xFFFCD643, 0xFFFED854, 0xFFFC1454, 0xFFFBFDFA, 0x0004E773, 0xFFF149A7, 0x00054BC2, 0xFFF83DCC, 0xFFF78039, 0xFFFCF2CB,
/* 0x029- */ 0x000A43B3, 0xFFF69D46, 0xFFF57CE9, 0x0004704D, 0x000111BD, 0x0001ECCB, 0x0000D27B, 0x000AB044, 0xFFFE1A28, 0x00038037, 0xFFF4D123, 0x000ABC5A, 0xFFF87E1D, 0x00024F59, 0x0007853B, 0x0006EFBB,
/* 0x02A- */ 0x00074667, 0x0004AAF5, 0x00095B3E, 0x0009F396, 0xFFFCB30A, 0xFFFE55E4, 0xFFFD552C, 0xFFF4FB8A, 0xFFF7135D, 0xFFF84CD5, 0x00056C27, 0x00059466, 0x00056DB4, 0x000287CA, 0x0002B6DA, 0x000AC9FD,
/* 0x02B- */ 0xFFF5B62A, 0xFFFBFFC1, 0xFFFC1E56, 0x00087FC7, 0xFFF75670, 0xFFFB7FB9, 0xFFF1DABB, 0x0005AB04, 0x000655BA, 0xFFF91087, 0x000AF67C, 0xFFF911F3, 0xFFFF2AF2, 0x000855DB, 0x0004FE57, 0x000555AA,
/* 0x02C- */ 0x0006B81A, 0x00032EC9, 0x000AD1BD, 0xFFFE3B57, 0xFFFBD235, 0x00089996, 0xFFFCD137, 0xFFF7DDC6, 0xFFFAAA56, 0xFFF7F2BD, 0x0002AC5B, 0x0002C630, 0xFFFC551C, 0xFFF7F474, 0xFFF3CB2A, 0xFFF3CB2B,
/* 0x02D- */ 0x0006EF79, 0x0007C488, 0xFFF3F9EC, 0xFFF2F61D, 0x0001AAC5, 0xFFF344DC, 0xFFF673A4, 0xFFFD80D5, 0x0005D365, 0x0008D74B, 0xFFF69B31, 0x000FB170, 0x000C12B9, 0xFFFE2482, 0xFFF6B686, 0xFFFD7FD9,
/* 0x02E- */ 0xFFF29490, 0x000A7025, 0x00088A4C, 0x0001399C, 0x000C401C, 0x000C5D6F, 0x000BA501, 0xFFFD16C0, 0x000C426F, 0xFFFD0EBC, 0x000BD6F1, 0xFFFDB0A7, 0xFFFD0A44, 0x000B8542, 0x000BE1DD, 0xFFFCEAC3,
/* 0x02F- */ 0xFFFD0789, 0x000B7C30, 0x000BE905, 0xFFFCC751, 0xFFFD05BF, 0x000B7346, 0x000BEDF5, 0xFFFCACFD, 0xFFFD0484, 0x0009008F, 0x0008F277, 0x00099E1A, 0xFFFF09CA, 0xFFFF0D15, 0xFFF8833C, 0x0009DC85,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x030- */ 0xFFFB6F3E, 0x00057A82, 0xFFF9FCF7, 0xFFF728B5, 0x000A416B, 0xFFF59AEC, 0x0004E672, 0xFFF9DFF2, 0x0003ACD5, 0x000DDC1B, 0x0009F0F6, 0xFFFC0604, 0xFFF90A87, 0x00020020, 0x0003444C, 0x00095960,
/* 0x031- */ 0x000A33CC, 0x000A627B, 0xFFFADF81, 0xFFFAD034, 0xFFFC0DB0, 0xFFFACEC3, 0xFFFC0A0C, 0x00004D35, 0xFFFF6189, 0x000ADA5C, 0x0003AAE4, 0x0007AB24, 0x0000AAB4, 0xFFFDFFE0, 0x00080511, 0x00058057,
/* 0x032- */ 0x000BAB8B, 0x000CE5B6, 0x000BE8AC, 0x00010B33, 0x000D95D7, 0x000E16AD, 0x000DAB81, 0x000DBA32, 0x000B75D1, 0x000CA735, 0x000DBD4A, 0x000ED6A0, 0xFFF5F110, 0x000DBEAC, 0x0004C99A, 0x000AF56D,
/* 0x033- */ 0xFFF917F4, 0x000ECCAD, 0x000F476B, 0xFFFAA539, 0xFFFB111C, 0xFFFB79EA, 0x0005F0EE, 0x000CDF5B, 0x000C2B68, 0x000CD384, 0x000BC305, 0x000C9D6C, 0x000B0680, 0xFFFDD13A, 0xFFFE8B60, 0xFFFF207E,
/* 0x034- */ 0x000BD793, 0x0008FBD0, 0xFFF7EA46, 0xFFF3ED47, 0xFFFCCAC6, 0xFFFCABC6, 0xFFFD0F36, 0xFFF77CC9, 0xFFF4DB06, 0xFFF5C8C6, 0x0004A4BD, 0xFFFEE498, 0x0000CA6F, 0xFFFEE1B7, 0x0000ABC5, 0xFFF25B4E,
/* 0x035- */ 0xFFFF1241, 0x0005927C, 0x00011B68, 0x00030140, 0xFFF3D280, 0x000275D4, 0x00049620, 0xFFFDF1AB, 0x00011E49, 0x0002E858, 0xFFF87F89, 0x00043FE3, 0xFFFDFCB0, 0x00020350, 0xFFF497E1, 0x0004E719,
/* 0x036- */ 0xFFF97FC4, 0x000A373A, 0x0006CCF1, 0x0000287C, 0x0005976E, 0xFFFF543B, 0x000A47A8, 0xFFFB18E7, 0xFFF77F79, 0xFFF103C2, 0x0003CD60, 0xFFF67F69, 0xFFF2CDD2, 0x000B3A94, 0xFFF1E8CA, 0xFFED6B90,
/* 0x037- */ 0x0008B2C9, 0x00086BB8, 0x0009515A, 0x0007E2D9, 0x00067C76, 0xFFEF6102, 0xFFF89204, 0xFFFDC10C, 0x000609F2, 0x0005890B, 0x0005367E, 0x00036ED0, 0x0007158B, 0x0005DA05, 0x00035ADB, 0xFFFFD784,
/* 0x038- */ 0x0003A333, 0xFFFCFEC0, 0x0006803C, 0xFFFD36C2, 0x00076DFC, 0x000BE31B, 0x0009B5AA, 0x0002DBC1, 0x0007C0A1, 0x000A1094, 0x0006FC14, 0x0004B267, 0xFFFC0BD3, 0xFFF9330F, 0xFFFD42BF, 0x000954BC,
/* 0x039- */ 0xFFF92EE5, 0xFFF8A4D4, 0xFFFDF4F5, 0xFFFCB9D7, 0xFFFEB0BD, 0x000190CD, 0xFFFB96D1, 0xFFF89E83, 0x00002EC0, 0x0001BD5B, 0xFFFC6420, 0xFFF80E2D, 0x0001BCD5, 0x0001DD12, 0x0002D829, 0xFFF70B69,
/* 0x03A- */ 0xFFF2DF94, 0xFFFC4902, 0x0005C96E, 0x00060086, 0x00014D7C, 0x0005A943, 0x000741FF, 0xFFFE533B, 0xFFF8547D, 0x000454C8, 0x000A3C41, 0xFFFB58FA, 0xFFF83432, 0xFFF39F64, 0x0009DC86, 0x00076EE4,
/* 0x03B- */ 0xFFF18033, 0xFFF1D4EB, 0xFFF5E4D8, 0xFFF0BDF6, 0xFFF1907B, 0xFFF55101, 0x00046202, 0x00003941, 0x000A6799, 0x000B8B8D, 0x0002CA28, 0xFFFB9619, 0xFFF3B2D9, 0xFFF45CB2, 0xFFFD4FB9, 0xFFF45475,
/* 0x03C- */ 0x0000D33D, 0xFFF97F99, 0x00034668, 0x000B3AC4, 0x0002430A, 0x000066A7, 0x00092B8C, 0x0004ACB0, 0x00097D76, 0x000BE562, 0x0002B047, 0x0008B909, 0x0000EDBF, 0xFFFB5B43, 0xFFFA6D84, 0xFFF9B14A,
/* 0x03E- */ 0xFFFB8FB3, 0x000EDBF7, 0xFFFF0796, 0x0006A475, 0xFFFB8218, 0xFFFE2996, 0xFFFDFA92, 0x00007D8B, 0x00017197, 0xFFF7A05B, 0x000469E7, 0xFFFE875E, 0x0006104B, 0x00099E10, 0x00014050, 0xFFFE7016,
/* 0x03D- */ 0x000C7E7A, 0x0003E11A, 0xFFFD8A2C, 0xFFFDF0B6, 0xFFF01613, 0xFFF8C808, 0xFFEDCF1D, 0xFFF23544, 0x0006C485, 0x000603CC, 0x00081376, 0x0007617D, 0x00068C53, 0xFFF2FF87, 0x000D0079, 0xFFF95BDE,
/* 0x03F- */ 0xFFFAE54A, 0xFFFAC982, 0x00009CCE, 0x00020240, 0xFFF9ABAD, 0xFFF84023, 0x0001D66A, 0xFFFCEFF9, 0x0001F6E5, 0xFFFCA525, 0xFFFC41E7, 0xFFFD39D0, 0x00056481, 0x000165D2, 0x0004B752, 0x0007514A,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x040- */ 0x000574EF, 0xFFF91106, 0xFFFAFAD2, 0x000A4706, 0xFFFB7A59, 0x000B9180, 0x0009D27B, 0xFFFE5D21, 0x0002056E, 0x00084685, 0x0004559A, 0x0009497A, 0x0004CD4D, 0x0002D668, 0x0003A702, 0x00031AC1,
/* 0x041- */ 0xFFF9E36F, 0xFFFADB15, 0x000962BA, 0x000BDAA3, 0x00084B57, 0x0004956D, 0xFFFC4A16, 0x000D18A5, 0x0016015F, 0x000CFD61, 0x0002FF65, 0x0001FF98, 0x000278A0, 0x00017924, 0x0002FF51, 0x00027E90,
/* 0x042- */ 0x0001FF8B, 0x00017F23, 0x0013012F, 0x0002FF3A, 0xFFF70250, 0x0001FF7C, 0x0008FD60, 0xFFFE0096, 0x00093235, 0x0008FD04, 0x000943AE, 0x0008FC96, 0x0005FDB9, 0x000F8F65, 0x0005FE40, 0x000CFC36,
/* 0x043- */ 0x000CBDDB, 0xFFF80255, 0xFFF7CD12, 0xFFFC012B, 0xFFFC3BA0, 0xFFFC4E55, 0xFFFC0154, 0xFFFC0185, 0x000CFBAF, 0x000CC852, 0xFFF802A8, 0xFFF7D985, 0x000CFB11, 0xFFFE00C3, 0xFFF80309, 0x0002FC60,
/* 0x044- */ 0xFFFA0740, 0x0003D7BA, 0x0002FB7C, 0x00041021, 0x0002FA41, 0x0001FD95, 0x0002DAC4, 0x000313F9, 0x0001FCFE, 0x0001FC2C, 0xFFFE00E0, 0xFFFD7A2C, 0xFFFE0103, 0xFFFD8316, 0xFFFE012E, 0xFFFA0388,
/* 0x045- */ 0x0009FBA3, 0x0006FCF2, 0x0006708F, 0x000677FA, 0x0006FC78, 0x0006FBE1, 0xFFF904D8, 0x0001FE9E, 0xFFF90BE2, 0xFFF905C2, 0xFFF92549, 0xFFF906ED, 0x0001FE05, 0x000BF7B3, 0x000BEBA1, 0x000BFEC1,
/* 0x046- */ 0x000BF623, 0x000BF422, 0xFFF56209, 0xFFF37997, 0xFFF97769, 0xFFFA487B, 0xFFF775B4, 0xFFF70430, 0x000D4844, 0x000127AC, 0xFFF1C42C, 0x0010BE05, 0x000F8469, 0xFFF34B92, 0xFFF1B535, 0x000FE15C,
/* 0x047- */ 0x000DE531, 0x0008007F, 0x00104476, 0x000F979E, 0x0010C39F, 0x00053B7F, 0xFFF90A92, 0xFFFC8300, 0xFFF7113C, 0xFFFC07A9, 0x00072F8D, 0x000AEF51, 0x000DD019, 0xFFFA1488, 0x0006E80C, 0x000AC7A3,
/* 0x048- */ 0x0008F579, 0x0009B42C, 0x0000F2EB, 0x000815BA, 0x000A356D, 0x00003E1A, 0x0003040F, 0x000050F9, 0xFFF490F6, 0xFFF0D13F, 0x000781E3, 0x0006395B, 0x00055AC7, 0x00063FAA, 0x000563D1, 0x000646F9,
/* 0x049- */ 0x00064EB6, 0x000174A0, 0xFFFE8A27, 0xFFFEA70C, 0xFFFF579E, 0x0006A286, 0x00046DA3, 0xFFF9FFA1, 0x0001F928, 0x0003F250, 0xFFFFCEB9, 0xFFFF0E96, 0xFFF72528, 0xFFF691D2, 0xFFF5BF02, 0xFFF93515,
/* 0x04A- */ 0xFFF83CAB, 0xFFFE0F2B, 0xFFF7DB72, 0xFFFA487C, 0x000B6F0A, 0xFFF43CFB, 0xFFFF2EEE, 0xFFF5E0D5, 0x00073CF0, 0x0010557C, 0xFFF26A29, 0xFFF09E82, 0xFFF0E422, 0xFFF30810, 0xFFF2B7BC, 0x000236D1,
/* 0x04B- */ 0x0000F86A, 0x000329BD, 0x0000A862, 0x0008B91D, 0x00087DA6, 0xFFF3DF69, 0xFFF6D4FD, 0x000F86AC, 0x00091949, 0x001135E1, 0x000F7004, 0x0010EB05, 0x00098182, 0x0003A155, 0x00078756, 0xFFF7A445,
/* 0x04C- */ 0xFFFFE573, 0x0007C355, 0x0008BBC0, 0xFFC0FC11, 0xFFB47B48, 0xFFC1FC21, 0xFFC07C09, 0xFFE72C71, 0xFFE56261, 0xFFCA523E, 0xFFD151CF, 0xFFDFEBBB, 0xFFC17C19, 0xFFE0B90A, 0xFFE59BA3, 0xFFE4B69C,
/* 0x04D- */ 0xFFE6AE39, 0xFFEA743F, 0xFFE5CEB6, 0xFFE98680, 0xFFEAFFB4, 0xFFEDF87B, 0xFFEA15F4, 0xFFED058F, 0xFFEE311D, 0xFFF09CA4, 0xFFED412C, 0xFFEFA66E, 0xFFF09E70, 0xFFF2A844, 0xFFEFAA84, 0xFFF1AFD9,
/* 0x04E- */ 0xFFEFB6E4, 0xFFC4FC51, 0xFFEECF46, 0xFFC8D50C, 0xFFCF329E, 0xFFD91982, 0x0007E4A1, 0x00071F55, 0xFFFCFBF1, 0x000C00BF, 0x000D7034, 0x00022865, 0x0003B836, 0xFFFC45DC, 0x000CA6F6, 0x000B60A4,
/* 0x04F- */ 0x000191BE, 0x0002FE3C, 0x0002E819, 0x0001FED2, 0x0001E989, 0x0002FDED, 0x0002FAE8, 0x0001FC9B, 0x0002FD89, 0x0000FF2D, 0x0001FE5B, 0x000BF180, 0x0003FB2A, 0x000AF2B5, 0x0004F9F5, 0x0009F3EA,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x050- */ 0x0005F8C0, 0xFFFD03A0, 0xFFFE026B, 0xFFFF0136, 0x0001DDCF, 0x0002F475, 0x0001F84E, 0x0000FE16, 0x00068067, 0x00078077, 0x00088087, 0x00117DEF, 0x0010F092, 0xFFF525A4, 0xFFF5683B, 0x0001556A,
/* 0x051- */ 0x0009AB44, 0xFFF3DECA, 0xFFF6A6A0, 0x0009645A, 0xFFF954EC, 0x0012602B, 0xFFF4733F, 0xFFF33FD5, 0xFFF244BF, 0xFFF5F853, 0x000F0B84, 0x0007098F, 0x00113967, 0x000E25F7, 0xFFFD53A5, 0x000964CF,
/* 0x052- */ 0xFFFC87BF, 0x0006A422
</code></pre>
</details>
<details>
<summary>Distance table - Black 2 and White 2</summary>
<pre><code class="language-c">/**
 * Table created by Gonhex
 * Number of entries: 1285
 * All values signed int32
 * Tiles = value / 0x10000
 */

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x000- */ 0x0002001F, 0x00018017, 0xFFFCFFD1, 0x00000000, 0x000F1AC8, 0x000DB2B6, 0x000F01AC, 0x000F9E43, 0x000F1E98, 0xFFFC6BE2, 0xFFFCDE66, 0xFFFDFFE1, 0xFFFEFFF1, 0xFFFB0C8F, 0x0001556B, 0x0004704D,
/* 0x001- */ 0x00021F30, 0x0004AAF5, 0x00038951, 0xFFFE95E0, 0xFFFC7FC9, 0x00016A20, 0xFFF6CE2D, 0xFFFE7FE9, 0xFFF6191D, 0xFFF7AD6F, 0x00043E61, 0xFFFB01A9, 0x0000B510, 0x000712A2, 0xFFF4AEFC, 0xFFFDE0D0,
/* 0x002- */ 0x0009CEE6, 0x0003EC5C, 0x0002F144, 0x0005004F, 0x0008D3CE, 0x0007D8B8, 0x0004E773, 0xFFFB188D, 0x0001F62E, 0xFFFC13A4, 0x0000FB16, 0xFFFD2BBF, 0xFFF7833D, 0x0004F371, 0xFFFD0EBC, 0x0002D441,
/* 0x003- */ 0xFFFBC19F, 0xFFF8ED5E, 0xFFFDC36D, 0x0001000F, 0x0001CA0E, 0x0000E507, 0x00007283, 0xFFFEA875, 0xFFFB86DB, 0x00020AAF, 0x0000CD4E, 0x0001A225, 0xFFFBF95F, 0xFFFF7FF9, 0x00016317, 0x00008E09,
/* 0x004- */ 0x00019A9C, 0x0000D112, 0x00006889, 0x0002AF16, 0x0002DBC2, 0x00027338, 0x0002AAD4, 0x0001AA1C, 0x0000D50E, 0x000267EB, 0xFFFF1AF9, 0x0002237B, 0x00023C93, 0x0001562D, 0x0002557B, 0x0001AAC4,
/* 0x005- */ 0x000406A1, 0xFFFE35F2, 0x0003219A, 0xFFF9BCCC, 0x00047925, 0x000E00DF, 0x000B5104, 0x00087CC3, 0xFFF69BA6, 0xFFF9A26E, 0x000A9BF3, 0x0009E6E3, 0xFFFA577E, 0xFFFB1458, 0xFFFAA1D3, 0xFFF8384E,
/* 0x006- */ 0xFFF6331C, 0xFFFA2F50, 0xFFF94A48, 0xFFFC532B, 0x00065D92, 0xFFFE5DDB, 0x0005A882, 0xFFFDF551, 0x0000EF97, 0x0001BF3C, 0x00006FCF, 0x00011010, 0x00013F74, 0x00068F85, 0x000633DB, 0x0005E091,
/* 0x007- */ 0xFFFF703F, 0x0000DF9E, 0xFFFF504D, 0x00008FC1, 0x00001000, 0xFFFFA02A, 0x0000AFB3, 0x0000BFAC, 0xFFFF4054, 0x00005FD6, 0xFFFFD015, 0xFFFF4AF0, 0x000931D3, 0x00080D43, 0x00064334, 0xFFF5640D,
/* 0x008- */ 0xFFFBF524, 0xFFF86541, 0xFFF3BFE4, 0xFFF9AA46, 0xFFF38427, 0xFFF1546C, 0x00048047, 0xFFF82748, 0xFFF90593, 0x0008C47D, 0xFFF90943, 0x00092D9F, 0xFFF43AEC, 0xFFFAFFB1, 0xFFF8208B, 0xFFF72C32,
/* 0x009- */ 0xFFF9225F, 0xFFFE09D2, 0xFFFA9B67, 0xFFFA0870, 0xFFFA7FA9, 0xFFF6311A, 0xFFF8FD3A, 0xFFFA1D77, 0x0007C7B2, 0x0007C7B3, 0xFFFC76AF, 0x001000FF, 0x0008FC13, 0x0002E940, 0xFFFA2D80, 0x0006005F,
/* 0x00A- */ 0x0004003F, 0xFFFBEAA1, 0xFFFB4164, 0x0001E5D8, 0xFFFB25EB, 0xFFFD50EA, 0x0001578B, 0x0003941E, 0x0009DDC9, 0x00008007, 0xFFF8384D, 0x001EC444, 0x001EC443, 0x000A3061, 0x001DB4AB, 0xFFFF1DA1,
/* 0x00B- */ 0x002B82B7, 0x000897E4, 0x0032031F, 0x002F02EF, 0x000038BF, 0xFFFF5D2A, 0x00085BBB, 0x00097611, 0x00007A84, 0xFFFFA79A, 0x000CF8EC, 0x00127ACE, 0x0000C7A4, 0xFFFF13DE, 0x001CFF9A, 0x001CFF9B,
/* 0x00C- */ 0x00019216, 0x0000D003, 0x00021A88, 0x0001710D, 0xFFFCBAE0, 0x000160DA, 0x0005608F, 0x0002C6AF, 0x00024167, 0x000A079E, 0x000A079F, 0x0003A677, 0x000358B6, 0x0022E425, 0x0026EAC5, 0x00149BEE,
/* 0x00D- */ 0x00086DD7, 0x000BB39F, 0x001C4A8A, 0x0031030F, 0x0004D4C2, 0x0009F3C9, 0x001B957A, 0xFFFE741F, 0xFFF959F8, 0x00065E9C, 0x0001E0F6, 0x001DF60C, 0x0018F7B4, 0x001CDF0B, 0x00197F55, 0x000387EC,
/* 0x00E- */ 0x0002CDE9, 0x00151671, 0x00176740, 0xFFFF1296, 0x000474EE, 0x0010C317, 0x001A01A0, 0x001FC289, 0x0028B4D5, 0x0014D76D, 0x00150346, 0xFFFFBA4F, 0x00010E38, 0x001F08D1, 0x00015FBA, 0x00042DCB,
/* 0x00F- */ 0x00275D4A, 0x001A019F, 0x0015F3DE, 0x00043175, 0xFFFEF7A7, 0x000AF506, 0x000AE99A, 0x0005F196, 0x000D5F92, 0x00267842, 0x00284251, 0x00180F34, 0x0013A672, 0x001028D1, 0x000E73B4, 0x000BF40B,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x010- */ 0x000B42E2, 0x00097053, 0x00093967, 0x0007C88E, 0x00243BAF, 0x0007D682, 0x00069DB9, 0x002B02AF, 0x0006D776, 0x0005C022, 0x0020E374, 0x00224D1D, 0x0027CFCD, 0x0025F9F2, 0x00061818, 0x0004D33C,
/* 0x011- */ 0x0006FDF4, 0x001D01CF, 0x0005663B, 0x000830B0, 0xFFFA934E, 0x00083ED0, 0xFFF93361, 0xFFF6FEB3, 0xFFFB8312, 0xFFFF5386, 0x000D3FA1, 0x00257C5E, 0x00051447, 0x001B4964, 0xFFFB3789, 0x0016D03F,
/* 0x012- */ 0x0019F1D9, 0x00208207, 0x000B3A4B, 0x0009E473, 0x00111053, 0xFFFF9D72, 0x0021F30C, 0x001DCF35, 0x0023C92B, 0x00231E30, 0x001578B3, 0x0009ADC5, 0x000B1217, 0x00003237, 0xFFFE5985, 0x000519AA,
/* 0x013- */ 0x000F00EF, 0xFFFEC97B, 0x000B00AF, 0x000A009F, 0x0002E32F, 0x0003237C, 0x000614C2, 0x0008A990, 0x00079ABF, 0x0002BF75, 0x0005393E, 0x0005B785, 0x00041617, 0x00074721, 0x00085291, 0x00084980,
/* 0x014- */ 0x000D80D7, 0x0008BAD4, 0x0006DF56, 0x000A00A0, 0x00080170, 0x00083F8B, 0x00077D83, 0x000755CA, 0x000B2EDD, 0x000E5077, 0x00077C32, 0x0007283B, 0x00088DF0, 0x00082ABD, 0x000D6B70, 0x000E4ACB,
/* 0x015- */ 0x000C0614, 0x00054EFB, 0x00060281, 0x00089346, 0x0009D752, 0x000A6514, 0xFFFDC92F, 0xFFFE30C4, 0x00045DE0, 0x000EDA55, 0x00039E78, 0x000BB40B, 0x000143E4, 0x000BB40A, 0x00093D67, 0x000CF7F0,
/* 0x016- */ 0x000CF7EF, 0xFFFE6E42, 0x00083D28, 0x00077110, 0x00194DED, 0x000A2385, 0x002A0C61, 0x0004D44A, 0xFFFC68B5, 0xFFFC472F, 0xFFFF4170, 0x000938C7, 0x002A82A7, 0x002A029F, 0xFFFD4545, 0xFFFB4919,
/* 0x017- */ 0x00015F86, 0x00084E1E, 0x002271A0, 0xFFFE435A, 0xFFF652AC, 0x00090C2C, 0x000B6310, 0x000D79B9, 0x0010FF8E, 0x0014CA28, 0x001E69BB, 0x0017AD59, 0x0013AEA5, 0x0012C99D, 0x000E79E0, 0x000C2136,
/* 0x018- */ 0x000A3355, 0x0008E134, 0x00093FB6, 0x001FD3DB, 0x00099A7D, 0x0009ECDA, 0x00074882, 0x001537E8, 0x000681C8, 0x000B753B, 0x00074D3F, 0x0005C15F, 0xFFFC5C70, 0x0008F9DB, 0xFFFC5C71, 0x0013313E,
/* 0x019- */ 0x000EC2FB, 0x001A9089, 0x0015ECF8, 0x001263A6, 0x00077449, 0x0005C660, 0x00014F43, 0x00043C25, 0xFFFE9F89, 0xFFFD273C, 0x0006F121, 0x000F8F66, 0x00097D39, 0xFFFDE38F, 0x0005BAE8, 0xFFFE6B21,
/* 0x01A- */ 0x00047DE8, 0x000B289C, 0x00046D6C, 0x00180C29, 0x00143652, 0x0008F24A, 0x001482D7, 0x000CBB24, 0x000CB46E, 0x00055E2D, 0x000AF8EA, 0x0003B5EA, 0x0005D0B0, 0x0004EBA8, 0x000425AC, 0x000126AC,
/* 0x01B- */ 0x000345BF, 0x000D00CF, 0x0012011F, 0x00037706, 0x0002F5BC, 0x0003153D, 0x00028BD3, 0x0002CD1E, 0x00023BB0, 0x0002F0F9, 0x0002679D, 0x00036850, 0x0002A18A, 0x00040ADC, 0x00036576, 0x00065552,
/* 0x01C- */ 0x00041CAA, 0x0009D13D, 0xFFF50716, 0xFFF77210, 0xFFF4D735, 0xFFF5B0A5, 0xFFF2E0D2, 0xFFF7C1A1, 0xFFFF9777, 0xFFF61044, 0xFFF7825A, 0xFFF4EB57, 0xFFF53603, 0x000FF4EF, 0x00090B4D, 0xFFF748E4,
/* 0x01D- */ 0xFFF85FAD, 0xFFF6F263, 0x0011AE96, 0x0014013F, 0xFFF6E9D4, 0x000A49D6, 0x00002A18, 0xFFF69151, 0x000C80C7, 0xFFF6C7C2, 0x000BA161, 0xFFF91045, 0xFFF8B999, 0x0001BB82, 0x0002FE16, 0x000AF8FD,
/* 0x01E- */ 0x0003731B, 0x000210B3, 0xFFF44C05, 0x0003FD3C, 0x0003ADFC, 0x0003FD73, 0xFFF4084D, 0xFFF46923, 0xFFF409DD, 0xFFF48BC7, 0xFFF40BDE, 0xFFF4B5A7, 0xFFF40E80, 0xFFF4E93E, 0xFFF4120B, 0xFFF52A52,
/* 0x01F- */ 0xFFF416FB, 0xFFF57ECF, 0xFFF41E23, 0xFFF5F098, 0xFFF4290F, 0xFFF45AFF, 0xFFF49CF0, 0xFFF543A6, 0x0003002F, 0x0007006F, 0x0009008F, 0xFFFCBBB4, 0x000EB659, 0x0006DDA1, 0xFFFE4D46, 0xFFFEBC1C,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x020- */ 0xFFFF8D7D, 0xFFFE447E, 0x000759AA, 0xFFFB198E, 0x0006B5B8, 0xFFF8D7C5, 0xFFF50984, 0x00098C5C, 0xFFFC1C28, 0x000279B8, 0xFFFD8648, 0x000C2097, 0x0004BE9C, 0x000A9DF7, 0x00049EB3, 0xFFF868A0,
/* 0x021- */ 0x0006EE0D, 0x000F2EC1, 0x00060309, 0x000D48E9, 0xFFFA4E78, 0xFFF682C7, 0xFFF947E6, 0x00005A87, 0xFFFAB206, 0x0003E3D9, 0x0003E3D8, 0x00054DFA, 0x000498E9, 0x00099A9A, 0xFFFDC7DA, 0xFFFB7499,
/* 0x022- */ 0xFFFD8CC8, 0x00042948, 0x0006A874, 0xFFFA2C9B, 0x000927A0, 0x00027F2B, 0xFFFF554C, 0x0002C93E, 0x00006FC1, 0x0002D8C4, 0x0000BB00, 0x000C55FD, 0xFFFEC664, 0x0003543A, 0x0003B6FE, 0x0001A4C1,
/* 0x023- */ 0x0003CBAF, 0x0001DFE2, 0x0003D8D7, 0x000D76F1, 0xFFFBFFC1, 0x000052D5, 0x0001F3ED, 0x00003DA7, 0x0001F0D5, 0x000022D8, 0x0001EC6C, 0xFFFFD140, 0x0001DB7E, 0xFFFF903F, 0xFFFF32B2, 0xFFFEAA96,
/* 0x024- */ 0x000F9F70, 0x0003E7DC, 0x00022ADF, 0x0003E1AA, 0x00076D2B, 0x0008223A, 0x00010F98, 0xFFFEF068, 0x00028027, 0xFFFB6717, 0xFFFC1C27, 0xFFFFA579, 0xFFF5BE95, 0xFFF892D5, 0x0001C4A9, 0x000AAB54,
/* 0x025- */ 0xFFF7666A, 0x0007367E, 0x000E2545, 0x000D7035, 0x0004155F, 0x0006200E, 0x00104476, 0x00038037, 0x000ABC5A, 0x00058057, 0x000DBB41, 0x0005E289, 0x000CC02B, 0x000BC514, 0xFFFDA475, 0x00062137,
/* 0x026- */ 0xFFFF04EA, 0x00053289, 0xFFFB614D, 0xFFF628AE, 0x00068897, 0x0005B188, 0xFFF8A656, 0x00079760, 0x0007C234, 0xFFF9A5CA, 0xFFF45E9F, 0xFFF2B717, 0xFFFAB105, 0xFFFE1D2B, 0xFFFACD77, 0xFFF58FDB,
/* 0x027- */ 0xFFF7D543, 0xFFF76CBA, 0xFFF95B8B, 0xFFFF6C2B, 0xFFFD243F, 0xFFFA39A0, 0xFFFC3451, 0x0005B784, 0xFFF490F7, 0x000B8CC1, 0xFFF6C299, 0xFFFC88FA, 0xFFF4286D, 0x000EB355, 0x000CA8A6, 0x000C8669,
/* 0x028- */ 0xFFFD243E, 0xFFF70DB6, 0x0009CCE4, 0x0001BB83, 0x00065A36, 0x000093D5, 0xFFFED23A, 0xFFFECB2D, 0xFFFD1CD1, 0xFFFCD643, 0xFFFED854, 0xFFFC1454, 0xFFFBFDFA, 0xFFF149A7, 0x00054BC2, 0xFFF83DCC,
/* 0x029- */ 0xFFF78039, 0xFFFCF2CB, 0x000A43B3, 0xFFF69D46, 0xFFF57CE9, 0x000111BD, 0x0001ECCB, 0x0000D27B, 0x000AB044, 0x00098097, 0xFFFE1A28, 0xFFF4D123, 0xFFF8FF91, 0xFFF9FFA1, 0xFFF87E1D, 0x00024F59,
/* 0x02A- */ 0x0007853B, 0x0006EFBB, 0x00074667, 0x00095B3E, 0x0009F396, 0xFFFCB30A, 0xFFFE55E4, 0xFFFD552C, 0xFFF4FB8A, 0xFFF7135D, 0xFFF84CD5, 0x00056C27, 0x00059466, 0x00056DB4, 0x000287CA, 0x0002B6DA,
/* 0x02B- */ 0x000AC9FD, 0xFFF5B62A, 0xFFFC1E56, 0x00087FC7, 0xFFF75670, 0xFFFB7FB9, 0x0005AB04, 0x000655BA, 0x0009FCAF, 0xFFF91087, 0x000AF67C, 0xFFF911F3, 0x000BA6CC, 0x0006AEE3, 0xFFFF2AF2, 0x000855DB,
/* 0x02C- */ 0x0004FE57, 0x000555AA, 0x0006B81A, 0x00032EC9, 0x000AD1BD, 0xFFFE3B57, 0xFFFBD235, 0x00089996, 0xFFFCD137, 0xFFF7DDC6, 0xFFFAAA56, 0xFFF7F2BD, 0x0002AC5B, 0x0002C630, 0xFFFC551C, 0xFFF7F474,
/* 0x02D- */ 0xFFF3CB2A, 0xFFF3FF41, 0xFFF3CB2B, 0x0006EF79, 0x0007C488, 0xFFF3F9EC, 0xFFF2F61D, 0x0001AAC5, 0xFFF344DC, 0xFFF673A4, 0xFFFD80D5, 0xFFF60351, 0x0005D365, 0x0008D74B, 0xFFF45475, 0xFFF9FCF7,
/* 0x02E- */ 0x0008007F, 0xFFF69B31, 0x000FB170, 0x000C12B9, 0xFFFE2482, 0xFFF6B686, 0xFFFD7FD9, 0xFFF29490, 0x00148147, 0x00118117, 0x00142128, 0x00128127, 0x0013012F, 0x00101A86, 0x0009B5AA, 0x000CD4E8,
/* 0x02F- */ 0x000C079A, 0x000A8AB8, 0x000FABA4, 0x0009D27B, 0x00062123, 0x0012C8B4, 0x000BAB8B, 0x0012602B, 0x000F357F, 0x000E80E7, 0x0008E09B, 0x000F00F0, 0x000DDDF4, 0x000A416B, 0x000A7025, 0x00088A4C,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x030- */ 0x000C401C, 0x000C5D6F, 0x000BA501, 0xFFFD16C0, 0x000C426F, 0x000BD6F1, 0xFFFDB0A7, 0xFFFD0A44, 0x000B8542, 0x000BE1DD, 0xFFFCEAC3, 0xFFFD0789, 0x000B7C30, 0x000BE905, 0xFFFCC751, 0xFFFD05BF,
/* 0x031- */ 0x000B7346, 0x000BEDF5, 0xFFFCACFD, 0xFFFD0484, 0x0008F277, 0x00099E1A, 0xFFFF09CA, 0xFFFF0D15, 0xFFF8833C, 0x0009DC85, 0xFFFB6F3E, 0x00057A82, 0xFFF728B5, 0xFFF59AEC, 0x0004E672, 0xFFF9DFF2,
/* 0x032- */ 0x0001399C, 0x0003ACD5, 0x000DDC1B, 0x0009F0F6, 0xFFFC0604, 0xFFF90A87, 0x00020020, 0x0003444C, 0x00095960, 0x000A33CC, 0x000A627B, 0xFFFADF81, 0xFFFAD034, 0xFFFC0DB0, 0xFFFACEC3, 0xFFFC0A0C,
/* 0x033- */ 0x0000DF82, 0xFFF854DB, 0x000D50E8, 0x0001556A, 0xFFF6D860, 0xFFFCAA75, 0x00004D35, 0xFFFF6189, 0x000ADA5C, 0x0003AAE4, 0x0007AB24, 0x0000AAB4, 0xFFFDFFE0, 0x00080511, 0x000CE5B6, 0x000BE8AC,
/* 0x034- */ 0x00010B33, 0x000D95D7, 0x000E16AD, 0x000DAB81, 0x000DBA32, 0x000B75D1, 0x000CA735, 0x000DBD4A, 0x000ED6A0, 0xFFF5F110, 0x000DBEAC, 0x0004C99A, 0x000AF56D, 0xFFF917F4, 0x000ECCAD, 0x000F476B,
/* 0x035- */ 0xFFFAA539, 0xFFFB111C, 0xFFFB79EA, 0x0005F0EE, 0x000CDF5B, 0x000C2B68, 0x000CD384, 0x000BC305, 0x000C9D6C, 0x000B0680, 0xFFFDD13A, 0xFFFE8B60, 0xFFFF207E, 0x000BD793, 0x0008FBD0, 0xFFF7EA46,
/* 0x036- */ 0xFFF3ED47, 0xFFFCCAC6, 0xFFFCABC6, 0xFFFD0F36, 0xFFF77CC9, 0xFFF4DB06, 0xFFF5C8C6, 0x0004A4BD, 0xFFFEE498, 0x0000CA6F, 0xFFFEE1B7, 0x0000ABC5, 0xFFF25B4E, 0xFFFF1241, 0x0005927C, 0x00011B68,
/* 0x037- */ 0x00030140, 0xFFF3D280, 0x000275D4, 0x00049620, 0xFFFDF1AB, 0x00011E49, 0x0002E858, 0xFFF87F89, 0x00043FE3, 0xFFFDFCB0, 0x00020350, 0xFFF497E1, 0x0004E719, 0xFFF97FC4, 0x000A373A, 0x0006CCF1,
/* 0x038- */ 0x0000287C, 0x0005976E, 0xFFFF543B, 0x000A47A8, 0xFFFB18E7, 0xFFF77F79, 0xFFF103C2, 0x0003CD60, 0xFFF67F69, 0xFFF2CDD2, 0x000B3A94, 0xFFF1E8CA, 0xFFED6B90, 0x0008B2C9, 0x00086BB8, 0x0009515A,
/* 0x039- */ 0x0007E2D9, 0x00067C76, 0xFFEF6102, 0xFFF89204, 0xFFFDC10C, 0x000609F2, 0x0005890B, 0x0005367E, 0x00036ED0, 0x0007158B, 0x0005DA05, 0x00035ADB, 0xFFFFD784, 0x0003A333, 0xFFFCFEC0, 0x0006803C,
/* 0x03A- */ 0xFFFD36C2, 0x00076DFC, 0x000BE31B, 0x0002DBC1, 0x0007C0A1, 0x000A1094, 0x0006FC14, 0x0004B267, 0xFFFC0BD3, 0xFFF9330F, 0xFFFD42BF, 0x000954BC, 0xFFF92EE5, 0xFFF8A4D4, 0xFFFDF4F5, 0xFFFCB9D7,
/* 0x03B- */ 0xFFFEB0BD, 0x000190CD, 0xFFFB96D1, 0xFFF89E83, 0x00002EC0, 0x0001BD5B, 0xFFFC6420, 0xFFF80E2D, 0x0001BCD5, 0x0001DD12, 0x0002D829, 0xFFF70B69, 0xFFF2DF94, 0xFFFC4902, 0x0005C96E, 0x00060086,
/* 0x03C- */ 0x00014D7C, 0x0005A943, 0x000741FF, 0xFFFE533B, 0xFFF8547D, 0x000454C8, 0x000A3C41, 0xFFFB58FA, 0xFFF83432, 0xFFF39F64, 0x0009DC86, 0x00076EE4, 0xFFF18033, 0xFFF1D4EB, 0xFFF5E4D8, 0xFFF0BDF6,
/* 0x03D- */ 0xFFF1907B, 0xFFF55101, 0x00046202, 0x00003941, 0x000A6799, 0x000B8B8D, 0x0002CA28, 0xFFFB9619, 0xFFF3B2D9, 0xFFF45CB2, 0xFFFD4FB9, 0x0000D33D, 0xFFF97F99, 0x00034668, 0x000B3AC4, 0x0002430A,
/* 0x03E- */ 0x000066A7, 0x00092B8C, 0x0004ACB0, 0x00097D76, 0x000BE562, 0x0002B047, 0x0008B909, 0x0000EDBF, 0xFFFB5B43, 0xFFFA6D84, 0xFFF9B14A, 0xFFFB8FB3, 0x000EDBF7, 0xFFFF0796, 0x0006A475, 0xFFFB8218,
/* 0x03F- */ 0xFFFDF0B6, 0xFFF01613, 0xFFF8C808, 0xFFEDCF1D, 0xFFF23544, 0x0006C485, 0x000603CC, 0x00081376, 0x0007617D, 0x00068C53, 0xFFF2FF87, 0x000D0079, 0xFFF95BDE, 0xFFFAE54A, 0xFFFAC982, 0x00009CCE,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x040- */ 0x00020240, 0xFFF9ABAD, 0xFFF84023, 0x0001D66A, 0xFFFCEFF9, 0x0001F6E5, 0xFFFCA525, 0xFFFC41E7, 0xFFFD39D0, 0x00056481, 0x000165D2, 0x0004B752, 0x0007514A, 0xFFFE7016, 0x000574EF, 0xFFF91106,
/* 0x041- */ 0xFFFAFAD2, 0x000A4706, 0xFFFB7A59, 0x000B9180, 0xFFFE5D21, 0x0002056E, 0x00084685, 0x0004559A, 0x0009497A, 0x0004CD4D, 0x0002D668, 0x0003A702, 0x00031AC1, 0xFFF9E36F, 0xFFFADB15, 0x000962BA,
/* 0x042- */ 0x000BDAA3, 0x00084B57, 0x0004956D, 0xFFFC4A16, 0x000D18A5, 0x0016015F, 0x000CFD61, 0x0002FF65, 0x0001FF98, 0x000278A0, 0x00017924, 0x0002FF51, 0x00027E90, 0x0001FF8B, 0x00017F23, 0x0002FF3A,
/* 0x043- */ 0xFFF70250, 0x0001FF7C, 0x0008FD60, 0xFFFE0096, 0x00093235, 0x0008FD04, 0x000943AE, 0x0008FC96, 0x0005FDB9, 0x000F8F65, 0x0005FE40, 0x000CFC36, 0x000CBDDB, 0xFFF80255, 0xFFF7CD12, 0xFFFC012B,
/* 0x044- */ 0xFFFC3BA0, 0xFFFC4E55, 0xFFFC0154, 0xFFFC0185, 0x000CFBAF, 0x000CC852, 0xFFF802A8, 0xFFF7D985, 0x000CFB11, 0xFFFE00C3, 0xFFF80309, 0x0002FC60, 0xFFFA0740, 0x0003D7BA, 0x0002FB7C, 0x00041021,
/* 0x045- */ 0x0002FA41, 0x0001FD95, 0x0002DAC4, 0x000313F9, 0x0001FCFE, 0x0001FC2C, 0xFFFE00E0, 0xFFFD7A2C, 0xFFFE0103, 0xFFFD8316, 0xFFFE012E, 0xFFFA0388, 0x0009FBA3, 0x0006FCF2, 0x0006708F, 0x000677FA,
/* 0x046- */ 0x0006FC78, 0x0006FBE1, 0xFFF904D8, 0x0001FE9E, 0xFFF90BE2, 0xFFF905C2, 0xFFF92549, 0xFFF906ED, 0x0001FE05, 0x000BF7B3, 0x000BEBA1, 0x000BFEC1, 0x000BF623, 0x000BF422, 0xFFF56209, 0xFFF37997,
/* 0x047- */ 0xFFF97769, 0xFFFA487B, 0xFFF775B4, 0xFFF70430, 0x000D4844, 0x000127AC, 0xFFF1C42C, 0x0010BE05, 0x000F8469, 0xFFF34B92, 0xFFF1B535, 0x000FE15C, 0x000DE531, 0x000F979E, 0x0010C39F, 0x00053B7F,
/* 0x048- */ 0xFFF90A92, 0xFFFC8300, 0xFFF7113C, 0xFFFC07A9, 0x00072F8D, 0x000AEF51, 0x000DD019, 0xFFFA1488, 0x0006E80C, 0x000AC7A3, 0x0008F579, 0x0009B42C, 0x0000F2EB, 0x000815BA, 0x000A356D, 0x00003E1A,
/* 0x049- */ 0x0003040F, 0x000050F9, 0xFFF490F6, 0xFFF0D13F, 0x000781E3, 0x0006395B, 0x00055AC7, 0x00063FAA, 0x000563D1, 0x000646F9, 0x00064EB6, 0x000174A0, 0xFFFE8A27, 0xFFFEA70C, 0xFFFF579E, 0x0006A286,
/* 0x04A- */ 0x00046DA3, 0x0001F928, 0x0003F250, 0xFFFFCEB9, 0xFFFF0E96, 0xFFF72528, 0xFFF691D2, 0xFFF5BF02, 0xFFF93515, 0x000B6F0A, 0xFFF83CAB, 0xFFF43CFB, 0xFFFF2EEE, 0xFFF5E0D5, 0x00073CF0, 0x0010557C,
/* 0x04B- */ 0xFFF26A29, 0xFFF09E82, 0xFFF0E422, 0xFFF30810, 0xFFF2B7BC, 0x0008B91D, 0x00087DA6, 0xFFF3DF69, 0xFFF6D4FD, 0x000F86AC, 0x00091949, 0x001135E1, 0x000F7004, 0x0010EB05, 0x00098182, 0x0003A155,
/* 0x04C- */ 0x00078756, 0xFFF7A445, 0xFFFFE573, 0x0007C355, 0x0008BBC0, 0xFFF64A56, 0xFFF4A039, 0xFFF57548, 0x000E6FF1, 0x0011010F, 0x000C00BF, 0x0010F986, 0x0011E6F8, 0x000C13E4, 0xFFF5FF61, 0x00088087,
/* 0x04D- */ 0xFFF6FF71, 0xFFECFED1, 0xFFED7ED9, 0xFFEB7EB9, 0xFFEEFEF1, 0xFFF62EC3, 0xFFF57F59, 0x0007E4A1, 0x00071F55, 0xFFFCFBF1, 0x002E02DF, 0x003C03BF, 0x00117DEF, 0x0010F092, 0x00022865, 0x0003B836,
/* 0x04E- */ 0xFFFC45DC, 0x000CA6F6, 0x000B60A4, 0x000191BE, 0x0000AAB5, 0x0000555B, 0xFFFBD6B8, 0x00068067, 0x00078077, 0xFFF525A4, 0xFFF5683B, 0x0009AB44, 0xFFF3DECA, 0xFFF6A6A0, 0x0009645A, 0xFFF954EC,
/* 0x04F- */ 0xFFF4733F, 0xFFF33FD5, 0xFFF244BF, 0xFFF5F853, 0x000F0B84, 0x0007098F, 0x00113967, 0x000E25F7, 0xFFFD53A5, 0x000964CF, 0xFFFC87BF, 0xFFEC7EC9, 0x00007D8B, 0x00017197, 0x000469E7, 0xFFFE875E,

/*             0x---0      0x---1      0x---2      0x---3      0x---4 */
/* 0x050- */ 0x00014050, 0x000C7E7A, 0x0003E11A, 0xFFFD8A2C, 0x0006A422
</code></pre>
</details>
<h4 id="environment-behavior-values"><a class="header" href="#environment-behavior-values">Environment Behavior Values</a></h4>
<p><strong>WARNING:</strong> SDSME and PDSMS mistakenly call them &quot;FLAGS &amp; LAYER 6&quot;, which can lead to confusion.</p>
<p>Some sort of command table which can introduce different effects depending on its value. Used in combination with the <code>Flag</code> value. Can display additional textures, make sounds, add direction dependdend collisions and much more. The extra textures (...and models ...and animations) can be found in <code>a/0/7/5</code> in Black and White and <code>a/0/7/4</code> in Black 2 and White 2.</p>
<details>
<summary>Behavior descriptions.</summary>
<div class="table-wrapper"><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0001</code></td><td>Used for can't pass (collision). Flag <code>0x0001</code> must be set, else no effect(?).</td></tr>
<tr><td><code>0x0002</code></td><td>Winter only footprints if flag <code>0x0008</code> is enabled(?) Used as winter path.</td></tr>
<tr><td><code>0x0003</code></td><td>Used as ground path.</td></tr>
<tr><td><code>0x0004</code></td><td>Used for normal tall gras. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0005</code></td><td>Used for normal tall gras that can have snow in winter. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0006</code></td><td>Used for dark tall gras, possible double battels with flag <code>0x0004</code>. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0007</code></td><td>Used for dark tall gras that can have snow in winter, possible double battels with flag <code>0x0004</code>. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0008</code></td><td>Play longer gras enter sound. Display very tall gras, if flag <code>0x0020</code> is set. Can't use bike.</td></tr>
<tr><td><code>0x0009</code></td><td>Play longer gras enter sound. Display very tall dark gras, if flag <code>0x0020</code> is set. Possible double battels with flag <code>0x0004</code>. Can't use bike.</td></tr>
<tr><td><code>0x000A</code></td><td>Can spawn animated dirt with sound which result in getting a (type-)gem or a wild battle by moving in. Used as ground in caves.</td></tr>
<tr><td><code>0x000B</code></td><td>Play step sound. Used as sand path.</td></tr>
<tr><td><code>0x000C</code></td><td>Offset character down to let it sink a bit. Play sand sound. Display dark hole if flag <code>0x0008</code> is set. Slow down bike. Used as deep sand.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x000E</code></td><td>Play snow sound. Display blue footprints, if flag <code>0x0008</code> is enabled. Used as snow.</td></tr>
<tr><td><code>0x000F</code></td><td>Play snow sound. Display blue footprints, if flag <code>0x0008</code> is enabled. Can't use bike.</td></tr>
<tr><td><code>0x0010</code></td><td>Slide over this tile, if next tile is can be entered (no collision there).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0012</code></td><td>Used as lake border collision (corners).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0014</code></td><td>Display ripple while entering and play sound. Used for puddles.</td></tr>
<tr><td><code>0x0015</code></td><td>Display ripple while entering and play sound.</td></tr>
<tr><td><code>0x0016</code></td><td>Used as ground in the ´Bizarro-House´.</td></tr>
<tr><td><code>0x0017</code></td><td>Display water splashing and play sound. Used at beach water boarders and on sand which is slightly under water.</td></tr>
<tr><td><code>0x0018</code></td><td>Slide over this tile, if next tile is can be entered (no collision there). Used as ice.</td></tr>
<tr><td><code>0x0019</code></td><td>Play step sound. Used as sand path.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x001C</code></td><td>Play ripple sound, no animation. Used for puddles with wild pokemon (flag <code>0x0004</code> enabled).</td></tr>
<tr><td><code>0x001D</code></td><td>Used as hole for the strength rocks. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x001E</code></td><td>Season depending flooring (footprints), if flag <code>0x0008</code> is enabled. Used if there is a spot leafs in autumn but snow in winter and something else in other seasons.</td></tr>
<tr><td><code>0x001F</code></td><td>Used as gras path (normal not tall gras which usually is all over the place).</td></tr>
<tr><td><code>0x0020</code></td><td>Can spawn animated shadows with sound which result in getting a feather or a wild battle by moving in. Used on some bridges.</td></tr>
<tr><td><code>0x0021</code></td><td>Display slightly different tall gras, if flag <code>0x0020</code> is enabled.</td></tr>
<tr><td><code>0x0022</code></td><td>Display slightly different dark tall gras, if flag <code>0x0020</code> is enabled. Possible double battels with flag <code>0x0004</code>(?).</td></tr>
<tr><td><code>0x0023</code></td><td>Play step sound. Used as sand path inside a cave.</td></tr>
<tr><td><code>0x0024</code></td><td>Play long smooth sound. Can't use bike.</td></tr>
<tr><td><code>0x0025</code></td><td>Display leafs flying into the air, play sound. Used when the path is full of leafes in autumn.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0030</code></td><td>Display electrostatic discharge. Used in the <code>Chargestone Cave</code>. Crashes the game if loaded with wrong settings!</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0032</code></td><td>Used for charged stones in the <code>Chargestone Cave</code>. Activation field for a gimmick?</td></tr>
<tr><td><code>0x0033</code></td><td>Scriptable behavior? Used for the levitation effect (slowly up and down) in the gate after route 10 in BW. No effect outside that room.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x003D</code></td><td>Can use fishing rod. Used as lake water.</td></tr>
<tr><td><code>0x003E</code></td><td>Can use fishing rod.</td></tr>
<tr><td><code>0x003F</code></td><td>Can use fishing rod. Used as water.</td></tr>
<tr><td><code>0x0040</code></td><td>Used as waterfall. Flag <code>0x0001</code> must be set, else no effect. Can connect to any height.</td></tr>
<tr><td><code>0x0041</code></td><td>Skip this field for water connections. Can force surf on the tile behind, fishing only if there is water. Is used as lake border.</td></tr>
<tr><td><code>0x0042</code></td><td>Can use fishing rod.</td></tr>
<tr><td><code>0x0043</code></td><td>Can use fishing rod. Used as deep sea to stard diving.</td></tr>
<tr><td><code>0x0044</code></td><td>Skip this field for water connections. Can force surf on the tile behind, fishing only if there is water. Is used as border.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0051</code></td><td>Collision east side.</td></tr>
<tr><td><code>0x0052</code></td><td>Collision west side.</td></tr>
<tr><td><code>0x0053</code></td><td>Collision north side.</td></tr>
<tr><td><code>0x0054</code></td><td>Collision south side.</td></tr>
<tr><td><code>0x0055</code></td><td>Collision north and east side.</td></tr>
<tr><td><code>0x0056</code></td><td>Collision north and west side.</td></tr>
<tr><td><code>0x0057</code></td><td>Collision south and east side.</td></tr>
<tr><td><code>0x0058</code></td><td>Collision south and east side.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0072</code></td><td>One way jump east. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0073</code></td><td>One way jump west. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0074</code></td><td>One way jump north. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0075</code></td><td>One way jump south. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0076</code></td><td>Start spinning while moving to east until collision. Play funny sound while spinning.</td></tr>
<tr><td><code>0x0077</code></td><td>Start spinning while moving to west until collision. Play funny sound while spinning.</td></tr>
<tr><td><code>0x0078</code></td><td>Start spinning while moving to north until collision. Play funny sound while spinning.</td></tr>
<tr><td><code>0x0079</code></td><td>Start spinning while moving to south until collision. Play funny sound while spinning.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x007C</code></td><td>Used to slide on quick sand on a slope if running and animate it(?).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0094</code></td><td>Move the character to east and play sound. Used for rapids.</td></tr>
<tr><td><code>0x0095</code></td><td>Move the character to west and play sound. Used for rapids.</td></tr>
<tr><td><code>0x0096</code></td><td>Move the character to north and play sound. Used for rapids.</td></tr>
<tr><td><code>0x0097</code></td><td>Move the character to south and play sound. Used for rapids.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x009C</code></td><td>Used in diving areas. Connected to a counter which limits diving time/distance(?).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00A3</code></td><td>Used to connect the map grid with an external rail. The connections tiles on the rail must also use <code>0x00A3</code> and be very close to this tile in 3D space.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00BE</code></td><td>Lose balance if standing on this tile and fall off from a side after a while. Surrounding tile must be deeper in terrain to avoid getting trapped. Used as tightrope.</td></tr>
<tr><td><code>0x00BF</code></td><td>Connection ramp to a tightrope, safe enter and leave point.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00D4</code></td><td>Can talk to NPC behind this tile. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00D6</code></td><td>Used for the PC (box, mail, ...). Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00D8</code></td><td>Used for the TV. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00D9</code></td><td>Dialog text <code>index 0</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DA</code></td><td>Dialog text <code>index 1</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DB</code></td><td>Dialog text <code>index 2</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DC</code></td><td>Dialog text <code>index 3</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DD</code></td><td>Dialog text <code>index 4</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DE</code></td><td>Dialog text <code>index 4</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect. Used for the trash bin.</td></tr>
<tr><td><code>0x00DF</code></td><td>Dialog text <code>index 5</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00E0</code></td><td>Dialog text <code>index 6</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00E1</code></td><td>Dialog text <code>index 7</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00E2</code></td><td>Used for the vending machine. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00FE</code></td><td>Somewhere used instead of duplicates in 2nd permission layer(?). Ignore this...</td></tr>
<tr><td><code>0x00FF</code></td><td>Can't pass (collision)(?). This one doesn't rely on a flag.</td></tr>
<tr><td>...</td><td></td></tr>
</tbody></table>
</div></details>
<p>TODO: Document missing values.</p>
<h4 id="environment-flag-values"><a class="header" href="#environment-flag-values">Environment Flag Values</a></h4>
<p><strong>WARNING:</strong> SDSME and PDSMS mistakenly call them &quot;COLLISION &amp; SHADOW&quot;, which can lead to confusion.</p>
<p>Sets the properties of a tile using binary flags. Multiple flags can be combined. Footprints are displayed for a short time after a character left the field. Gras is animated when the character enters a field and remains in the last frame until the character leaves. </p>
<details>
<summary>Flag descriptions</summary>
<div class="table-wrapper"><table><thead><tr><th>Bitmask</th><th>Description</th></tr></thead><tbody>
<tr><td><code>0x0001</code></td><td>Interactable field. Usually used for collisions but depending on the behavior-value it can also result in jumping over, talk to behind, interact with furniture, ...</td></tr>
<tr><td><code>0x0002</code></td><td>Surfable tile, does not include fishing!</td></tr>
<tr><td><code>0x0004</code></td><td>Enable wild pokemon encounter for this tile</td></tr>
<tr><td><code>0x0008</code></td><td>Display footprints, appearance depends on the behavior field.</td></tr>
<tr><td><code>0x0010</code></td><td>Enabled on water and flooded sand but not on water-borders, rapids and diveable areas. Not sure how it is used.</td></tr>
<tr><td><code>0x0020</code></td><td>Display gras animation and play sound, appearance depends on the behavior field.</td></tr>
<tr><td><code>0x0040</code></td><td>Reflection, vertical flipped copy of the overworld under the ground.</td></tr>
<tr><td><code>0x0080</code></td><td>Has shadow. The shadow is a dark circle under the overworld.</td></tr>
<tr><td><code>0x0100</code></td><td>Enables overworld shading with the color defined in light 3.</td></tr>
<tr><td><code>0xFE00</code></td><td>Some of the remaining bits are enabled on corner terrain slopes but the purpose is unclear.</td></tr>
</tbody></table>
</div></details>
<h3 id="special-rd-maps"><a class="header" href="#special-rd-maps">Special RD Maps</a></h3>
<p>There are a handful maps which use the &quot;RD&quot; signature and have no terrain data within the permission section. Instead, there are a set of currently unknown bytes. These maps are special, because they allow the game to load different sets of additional 3D models, movements permissions, interactable things like NPCs (...), depending on scripting flags. RD maps work in combination with the files from <code>a/1/5/6</code> in BW and <code>a/1/5/4</code> in B2W2.</p>
<p>In Pokemon Black and White, only the <code>Black City</code> and the <code>White Forest</code> are RD maps. Those places get content added, when the player poaches people through the Entralink.</p>
<p>In Pokemon Black 2 and White 2, only the <code>Join Avenue</code> and an island are RD maps. Here the player can talk to people passing through to add stalls at the sides of the road. The island maps, that also use these permissions, are an unused developement leftover. It is assumed that the join avenue was initially supposed to be an island, since it got some free space for eight markets in the center:</p>
<p align="center">
 <img src="gen5/resources/field/resources/bw_b2w2-maps/rd_island.png" alt="RD island" style="width:80%">
 <img src="gen5/resources/field/resources/bw_b2w2-maps/rd_island_top.png" alt="RD island top view" style="width:80%">
</p>
<hr />
<h2 id="todo-2"><a class="header" href="#todo-2">TODO</a></h2>
<ul>
<li>Link the NSBMD section to <code>src/universal/resources/nitro/graphics_3d/file_bmd0.md</code> once it contains information.</li>
<li>Research and document &quot;RD&quot; type maps.</li>
<li>Add terrain tables or insight into its internal working. Do NOT add the one with float values!</li>
<li>Document missing <code>behavior</code> values.</li>
<li>Link fixed point definition.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="zone-entities-container"><a class="header" href="#zone-entities-container">Zone Entities Container</a></h1>
<p>The NARC containing these files can be found in the following game paths:</p>
<ul>
<li>Black and White: /a/1/2/5</li>
<li>Black 2 and White 2: /a/1/2/6</li>
</ul>
<hr />
<h1 id="container-structure-1"><a class="header" href="#container-structure-1">Container Structure</a></h1>
<pre><code class="language-C">struct ZoneEntitiesContainer {
    uint32_t pInitializationScripts; // Relative pointer to initialization scripts.
    uint8_t InteractablesCount;
    uint8_t NPCCount;
    uint8_t WarpCount;
    uint8_t TriggerCount;

    InteractableEntry Interactables[InteractablesCount];
    NPCEntry NPCs[NPCCount];
    WarpEntry Warp[WarpCount];
    TriggerEntry Trigger[TriggerCount];


    DynamicInitializationEntry pDynamicInitScripts;
    StaticInitializationEntry StaticInitScripts; 
} 
</code></pre>
<hr />
<h1 id="section-structures"><a class="header" href="#section-structures">Section Structures</a></h1>
<h2 id="interactable-entry"><a class="header" href="#interactable-entry">Interactable Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>Script ID</td><td>The script to execute when interacted with. Read from the zone's script container.</td><td>uint16_t</td></tr>
<tr><td>Condition</td><td>The condition needed for this interactable to allow interactions.</td><td>uint16_t</td></tr>
<tr><td>Interactibility</td><td>The sides which the interactable can be interacted with.</td><td>uint16_t</td></tr>
<tr><td>RailSystem Index</td><td>The index of the interactable in the context of RailSystem, the 3D permissions system.</td><td>uint16_t</td></tr>
<tr><td>X</td><td>The world X position of the interactable.</td><td>uint32_t</td></tr>
<tr><td>Z</td><td>The world Z position of the interactable.</td><td>uint32_t</td></tr>
<tr><td>Y</td><td>The world Y position of the interactable.</td><td>int32_t</td></tr>
</tbody></table>
</div>
<h2 id="npc-entry"><a class="header" href="#npc-entry">NPC Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>ID</td><td>The ID that will be used to reference the NPC in game.</td><td>uint16_t</td></tr>
<tr><td>Model ID</td><td>The ID of the sprite to use for the NPC in game.</td><td>uint16_t</td></tr>
<tr><td>Movement Code</td><td>The default movement behavior of the NPC in game.</td><td>uint16_t</td></tr>
<tr><td>Type</td><td>The type of NPC to be spawned.</td><td>uint16_t</td></tr>
<tr><td>Spawn Flag</td><td>The flag which can be used to control the NPC's presence in game.</td><td>uint16_t</td></tr>
<tr><td>Script ID</td><td>The script which the NPC will use when interacted with in game.</td><td>uint16_t</td></tr>
<tr><td>Face Direction</td><td>The default direction that the NPC will look before they start their movement.</td><td>uint16_t</td></tr>
<tr><td>Parameter 1</td><td>An optional parameter, whose value purpose depends on the actor's movement code.</td><td>uint16_t</td></tr>
<tr><td>Parameter 2</td><td>An optional parameter, whose value purpose depends on the actor's movement code.</td><td>uint16_t</td></tr>
<tr><td>Parameter 3</td><td>An optional parameter, whose value purpose depends on the actor's movement code.</td><td>uint16_t</td></tr>
<tr><td>Traversal Width</td><td>How far the NPC will travel from left to right, in game units.</td><td>uint16_t</td></tr>
<tr><td>Traversal Height</td><td>How far the NPC will travel up and down, in game units.</td><td>uint16_t</td></tr>
<tr><td>Coordinate System</td><td>If this value is 1, then RailSystem (the system for nonlinear collisions) is used. Otherwise, it is the grid system.</td><td>uint32_t</td></tr>
<tr><td>X</td><td>The world X position of the NPC.</td><td>uint16_t</td></tr>
<tr><td>Z</td><td>The world Z position of the NPC.</td><td>uint16_t</td></tr>
<tr><td>RailSystem Side Position</td><td>If the coordinate system is RailSystem, then this specifies the NPC's side position.</td><td>uint16_t</td></tr>
<tr><td>Y</td><td>The world Y position of this NPC.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<h2 id="warp-entry"><a class="header" href="#warp-entry">Warp Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>Target Zone</td><td>The map header where this warp will teleport you to.</td><td>uint16_t</td></tr>
<tr><td>Target Warp</td><td>The warp where you will be teleported to.</td><td>uint16_t</td></tr>
<tr><td>Contact Direction</td><td>The direction you need to interact with the warp.</td><td>uint8_t</td></tr>
<tr><td>Transition Type</td><td>The transition that will be played when warping.</td><td>uint8_t</td></tr>
<tr><td>Coordinate Type</td><td>The type of coordinates you will be passing in.</td><td>uint16_t</td></tr>
<tr><td>X</td><td>The world X position of the warp.</td><td>uint16_t</td></tr>
<tr><td>Z</td><td>The world Z position of the warp.</td><td>int16_t</td></tr>
<tr><td>Y</td><td>The world Y position of the warp.</td><td>uint16_t</td></tr>
<tr><td>Width</td><td>The width of the warp zone, in game units.</td><td>uint16_t</td></tr>
<tr><td>Height</td><td>The height of the warp zone, in game units.</td><td>uint16_t</td></tr>
<tr><td>Coordinate System</td><td>If this value is 1, then the coordinates are based on RailSystem. Otherwise, it uses the grid system.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<h2 id="trigger-entry"><a class="header" href="#trigger-entry">Trigger Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>Script ID</td><td>The script ID which will be used when the trigger is executed.</td><td>uint16_t</td></tr>
<tr><td>Work Reference Value</td><td>The value that must be in the work in order for this trigger to execute.</td><td>uint16_t</td></tr>
<tr><td>Work</td><td>The variable that is being monitored for the value we want.</td><td>uint16_t</td></tr>
<tr><td>Unknown</td><td>The purpose of this field has yet to be discovered.</td><td>uint16_t</td></tr>
<tr><td>Unknown 2</td><td>The purpose of this field has yet to be discovered.</td><td>uint16_t</td></tr>
<tr><td>X</td><td>The world X position of the trigger.</td><td>uint16_t</td></tr>
<tr><td>Z</td><td>The world Z position of the trigger.</td><td>uint16_t</td></tr>
<tr><td>Width</td><td>The width of the trigger area.</td><td>uint16_t</td></tr>
<tr><td>Height</td><td>The height of the trigger area.</td><td>uint16_t</td></tr>
<tr><td>Y</td><td>The world Y position of the trigger.</td><td>int16_t</td></tr>
<tr><td>Unknown 3</td><td>The purpose of this field has yet to be discovered.</td><td>uint16_t</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="area-data"><a class="header" href="#area-data">Area Data</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://github.com/Bond697">Bond697</a>, <a href="https://github.com/PlatinumMaster">PlatinumMaster</a>, <a href="https://github.com/Gonhex">Gonhex</a>, <a href="https://github.com/HelloOO7">Hello007</a></p>
</blockquote>
<p>The area data describes the current state of the overworld. It selects all the optical elements. The area is selected by the zone data in <code>a/0/1/2</code> but can also depend on the season.</p>
<h2 id="table-of-contents-20"><a class="header" href="#table-of-contents-20">Table of Contents</a></h2>
<ul>
<li><a href="gen5/resources/field/b2w2-area_data.html#data-location">Data Location</a></li>
<li><a href="gen5/resources/field/b2w2-area_data.html#data-structure">Data Structure</a>
<ul>
<li><a href="gen5/resources/field/b2w2-area_data.html#container">Container</a></li>
<li><a href="gen5/resources/field/b2w2-area_data.html#area-data-entry">Area Data</a></li>
</ul>
</li>
<li><a href="gen5/resources/field/b2w2-area_data.html#specification">Specification</a>
<ul>
<li><a href="gen5/resources/field/b2w2-area_data.html#seasons">Seasons</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-location-1"><a class="header" href="#data-location-1">Data Location</a></h2>
<p>The file (not a NARC!) can be found in the following game path:</p>
<ul>
<li>Black 2 and White 2: <code>/a/0/1/3</code></li>
</ul>
<hr />
<h2 id="data-structure-1"><a class="header" href="#data-structure-1">Data Structure</a></h2>
<h3 id="container"><a class="header" href="#container">Container</a></h3>
<pre><code class="language-c">struct ContainerAreaData
{
    /* 0x0 */ struct AreaData areaTable[409];
}; // entry size = 0xFFA
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>areaTable</td><td>Array of area configurations. Only one entry is active.</td><td><a href="gen5/resources/field/b2w2-area_data.html#area-data-entry">AreaData[]</a></td></tr>
</tbody></table>
</div>
<h3 id="area-data-entry"><a class="header" href="#area-data-entry">Area Data Entry</a></h3>
<pre><code class="language-c">struct AreaData
{
    /* 0x0 */ uint16_t buildings;
    /* 0x2 */ uint16_t mapTextures;
    /* 0x4 */ uint8_t textureAnimation;
    /* 0x5 */ uint8_t frameAnimation;
    /* 0x6 */ uint8_t fieldEnvironment;
    /* 0x7 */ uint8_t ambientLight;
    /* 0x8 */ uint8_t outlineColor;
    /* 0x9 */ uint8_t bbdMdlColors;
}; // entry size = 0xA
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>buildings</td><td>Select builing container from the NARC:<br />Interior: Model = <code>a/2/2/6</code>, texture = <code>a/1/7/5</code>.<br />Exterior: Model = <code>a/2/2/5</code>, texture = <code>a/1/7/4</code>.</td><td>uint16_t</td></tr>
<tr><td>mapTextures</td><td>Select map texture NSBTX from the NARC: <code>a/0/1/4</code>.</td><td>uint16_t</td></tr>
<tr><td>textureAnimation</td><td>Select map texture SRT animation NSBTA from the NARC: <code>a/0/6/8</code>. Is <code>0xFF</code> if none.</td><td>uint8_t</td></tr>
<tr><td>frameAnimation</td><td>Select map frame animation container from the NARC: <code>a/0/6/9</code>. Is <code>0xFF</code> if none.</td><td>uint8_t</td></tr>
<tr><td>fieldEnvironment</td><td>Area type: <code>0</code> = interior, <code>1</code> = exterior.</td><td>uint8_t</td></tr>
<tr><td>ambientLight</td><td>Select ambient light settings from NARC: <code>a/0/6/0</code>. Note: Weather can overwrite the setting.</td><td>uint8_t</td></tr>
<tr><td>outlineColor</td><td>Select outline color profile from NARC: <code>a/0/1/5</code>. Is <code>0xFF</code> if none.</td><td>uint8_t</td></tr>
<tr><td>bbdMdlColors</td><td>Material preset for actor billboards.</td><td>uint8_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-1"><a class="header" href="#specification-1">Specification</a></h2>
<h3 id="seasons"><a class="header" href="#seasons">Seasons</a></h3>
<p>The current season depends on the month.</p>
<pre><code class="language-c">enum Season
{
    SEASON_SPRING = 0,
    SEASON_SUMMER = 1,
    SEASON_AUTUMN = 2,
    SEASON_WINTER = 3
};

enum Season getSeason()
{
    // example if january = 0 ... december = 11
    return currentMonth % 4;
}
</code></pre>
<p>While the area data is selected by the zone, it can also be influeced by the season. This is necessary to adjust lights and textures. The decision whether to change the area data depending on the season or not is hardcoded.</p>
<pre><code class="language-c">bool isSeasonsEnabled(uint32_t zoneAreaID)
{
    return (zoneAreaID &gt;= 0x2) &amp;&amp; (zoneAreaID &lt; 0x11A);
}

uint32_t getAreaID(uint32_t zoneAreaID)
{
    uint32_t areaID = zoneAreaID;
    
    if (isSeasonsEnabled(zoneAreaID))
    {
        areaID += getSeason();
    }
    
    return areaID;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="maps-1"><a class="header" href="#maps-1">Maps</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://github.com/Gonhex">Gonhex</a>, <a href="https://github.com/Trifindo">Trifindo</a></p>
</blockquote>
<p>The term &quot;map&quot; is used for areas of the game world. The player can navigate through them and interact with other objects placed on the map. Usually one map has a size of 32 by 32 tiles and a maximum of four of them are loaded simultaneously. The maps are usually selected by the currently active &quot;matrix&quot; in <code>a/0/0/9</code> but there are cases where the game chooses an other map, depending on the in-game season.</p>
<h2 id="table-of-contents-21"><a class="header" href="#table-of-contents-21">Table of Contents</a></h2>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#data-location">Data Location</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#data-structure">Data Structure</a>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#container-structure">Container Structure</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#model">Model</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#permissions">Permissions</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#building-table">Building Table</a></li>
</ul>
</li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#specification">Specification</a>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#overview">Overview</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#size">Size</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#permission-data">Permission Data</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#special-rd-maps">Special RD Maps</a></li>
</ul>
</li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-location-2"><a class="header" href="#data-location-2">Data Location</a></h2>
<p>The NARC containing these files can be found in the following game paths:</p>
<ul>
<li>Black and White: <code>/a/0/0/8</code></li>
<li>Black 2 and White 2: <code>/a/0/0/8</code></li>
</ul>
<hr />
<h2 id="data-structure-2"><a class="header" href="#data-structure-2">Data Structure</a></h2>
<h3 id="container-structure-2"><a class="header" href="#container-structure-2">Container Structure</a></h3>
<pre><code class="language-c">struct ContainerMap
{
    // header
    uint8_t signature[2];
    uint16_t numberSections;
    uint32_t offsetModel;
    uint32_t offsetPermissions[numberSections - 2];
    uint32_t offsetBuildingTable;
    uint32_t length;
    
    // data
    struct NSBMD dataModel;
    struct SectionPermission dataPermissions[numberSections - 2];
    struct SectionBuildingTable dataBuildingTable;
};
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>signature</td><td><code>&quot;NG&quot;</code>: No permission section.  <br /> <code>&quot;WB&quot;</code>: One permission section. <br /> <code>&quot;GC&quot;</code>: Two permission sections. <br /> <code>&quot;RD&quot;</code>: One permission section, but with a different file format.</td><td>uint8_t[]</td></tr>
<tr><td>numberSections</td><td>Number of data sections within this file.</td><td>uint16_t</td></tr>
<tr><td>offsetModel</td><td>Points to the 3D model of the map.</td><td>uint32_t</td></tr>
<tr><td>offsetPermissions</td><td>Points to the movement permission data.</td><td>uint32_t[]</td></tr>
<tr><td>offsetBuildingTable</td><td>Points to the building table.</td><td>uint32_t</td></tr>
<tr><td>length</td><td>Length of this file.</td><td>uint32_t</td></tr>
<tr><td>dataModel</td><td>3D model of the map. NSBMD format without a texture section.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#model">NSBMD</a></td></tr>
<tr><td>dataPermissions</td><td>0, 1 or 2 permission sections. A 2nd one can be used for things like bridges where one can walk on two different heights.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#permissions">SectionPermission</a>[]</td></tr>
<tr><td>dataBuildingTable</td><td>Define appearance settings for all buildings.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#building-table">SectionBuildingTable</a></td></tr>
</tbody></table>
</div>
<h3 id="model-1"><a class="header" href="#model-1">Model</a></h3>
<p>The NSBMD data format is currently not documented in this repository. You can find some information <a href="https://github.com/JackHack96/nsbmd_docs/blob/master/nsbmd_docs.md">here</a> instead.</p>
<h3 id="permissions-1"><a class="header" href="#permissions-1">Permissions</a></h3>
<pre><code class="language-c">struct SectionPermission
{
    // header
    uint16_t width;
    uint16_t height;
    
    // data
    struct Tile tile[width * height];
    struct CornerTerrain corner[numberCorners];
};
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>width</td><td>Number of tiles in horizontal direction.</td><td>uint16_t</td></tr>
<tr><td>height</td><td>Number of tiles in vertical direction.</td><td>uint16_t</td></tr>
<tr><td>tile</td><td>Individual soil properties for all fields.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#tile">Tile</a>[]</td></tr>
<tr><td>corner</td><td>Special terrain properties for corners. Corners are optional.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#terrain-extension-for-corners">CornerTerrain</a>[]</td></tr>
</tbody></table>
</div>
<h4 id="tile-1"><a class="header" href="#tile-1">Tile</a></h4>
<pre><code class="language-c">// &quot;WB&quot; and &quot;GC&quot; type maps:
struct Tile
{
    struct TileTerrain terrain;
    struct TileEnvironment environment;
}; // entry size = 0x8

// &quot;RD&quot; type maps:
struct Tile
{
    int8_t unknown[20]; // TODO: document structure
    struct TileEnvironment environment;
}; // entry size = 0x18
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>terrain</td><td>Defines height and slope on which overworlds are placed.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#terrain">TileTerrain</a></td></tr>
<tr><td>unknown</td><td>Data for <code>&quot;RD&quot;</code>-type maps. Those maps have flag based object placement.</td><td>int8_t[]</td></tr>
<tr><td>environment</td><td>Interaction between tile and overworld.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#environment">TileEnvironment</a></td></tr>
</tbody></table>
</div>
<h4 id="terrain-1"><a class="header" href="#terrain-1">Terrain</a></h4>
<pre><code class="language-c">struct TileTerrain
{
    uint16_t inclination;
    uint16_t distance;
}; // entry size = 0x4
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>inclination</td><td>Indexes a specific terrain slope. Probably flag based with a format like <code>0bTTTT'TTTT'TTTT'TTCR</code> with <code>T = terrain settings</code>, <code>C = is corner</code> and <code>R = reset</code></td><td>uint16_t</td></tr>
<tr><td>distance</td><td>Indexes values that represent the distance perpendicular to the center of the map when the plane is extended to allow that vector. If the inclination for this tile indicates a corner, the field represents the index of the corner instead. Counting starts by zero.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<h4 id="environment-1"><a class="header" href="#environment-1">Environment</a></h4>
<pre><code class="language-c">struct TileEnvironment
{
    uint16_t behavior;
    uint16_t flags;
}; // entry size = 0x4
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>behavior</td><td>Often used in combination with <code>flags</code>. Manages data used for interactions and affects the overall behavior of a tile.</td><td>uint16_t</td></tr>
<tr><td>flags</td><td>Flag based tile settings that can be combined. See table below.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<h4 id="terrain-extension-for-corners-1"><a class="header" href="#terrain-extension-for-corners-1">Terrain extension for corners</a></h4>
<pre><code class="language-c">struct CornerTerrain
{
    uint16_t inclinationTop;
    uint16_t inclinationBottom;
    uint16_t distanceTop;
    uint16_t distanceBottom;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>inclinationTop</td><td>Inclination for top-left and top-right corners, <code>inclination = inclinationTop - 1</code>.</td><td>uint16_t</td></tr>
<tr><td>inclinationBottom</td><td>Inclination for bottom-left and bottom-right corners, <code>inclination = inclinationBottom * 4</code>.</td><td>uint16_t</td></tr>
<tr><td>distanceTop</td><td>Distance for top-left and top-right corners, <code>distance = distanceTop</code>.</td><td>uint16_t</td></tr>
<tr><td>distanceBottom</td><td>Distance for bottom-left and bottom-right corners, <code>distance = distanceBottom</code>.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<hr />
<h3 id="building-table-1"><a class="header" href="#building-table-1">Building Table</a></h3>
<pre><code class="language-c">struct SectionBuildingTable
{
    // header
    uint32_t numberBuildings;
    
    // data
    struct BuildingProperties building[numberBuildings];
};
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberBuildings</td><td>Header of the building table, tells how many building are assigned to the map.</td><td>uint32_t</td></tr>
<tr><td>building</td><td>Display settings for a building. Includes local position, yaw rotation and the building index.</td><td><a href="gen5/resources/field/bw_b2w2-maps.html#building-display-settings">BuildingProperties</a></td></tr>
</tbody></table>
</div>
<h4 id="building-display-settings-1"><a class="header" href="#building-display-settings-1">Building display settings</a></h4>
<pre><code class="language-c">struct BuildingProperties
{
    fx&lt;1.19.12&gt; localPositionX;
    fx&lt;1.19.12&gt; localPositionY;
    fx&lt;1.19.12&gt; localPositionZ;
    uint16_t rotationAngleYaw;
    uint16_t buildingID; // big endian
}; // entry size = 0x10
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>localPositionX</td><td>X position relative to the center of the map.</td><td><a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>localPositionY</td><td>Y position relative to the center of the map.</td><td><a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>localPositionZ</td><td>Z position relative to the center of the map.</td><td><a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>rotationAngleYaw</td><td>Counterclockwise yaw rotation angle.</td><td>uint16_t</td></tr>
<tr><td>buildingID</td><td>ID of the building model. Unlike most variables, this one is in big endian.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-2"><a class="header" href="#specification-2">Specification</a></h2>
<h3 id="overview-1"><a class="header" href="#overview-1">Overview</a></h3>
<p>Part of the map files are:</p>
<ol>
<li>A 3D NSBMD-model of the map. This <strong>does not</strong> include textures!. The teture data is in <code>a/0/1/4</code>.</li>
<li>0-2 permission matrices. This is basically how the game sees the map since the model does not provide any collision data. It is a 2D environment layout with additional informations about the 3rd dimension. The 2nd permission matrix is optional and almost identical to the first one, except for coordinates where two different behaviors are required (for example walking under OR on a bridge). Rails (<code>a/0/7/8</code>) also contain collision data and may be loaded externally in some cases. This is why some maps come without own permission sections.</li>
<li>A layout for externally loaded models (buildings).</li>
</ol>
<h3 id="size-1"><a class="header" href="#size-1">Size</a></h3>
<p>As already mentioned, the standard size for a map is 32 by 32 tiles. But how large is a tile? The game accesses positions on the overworld using 32 bit values. These can be read as fixed point values. The default format is <a href="gen5/resources/field/">fx&lt;1.19.12&gt;</a>. This means that one tile has a size of 16 units. The most textures are also mapped with 16 pixel per tile.</p>
<p>To convert the value to one unit per tile, we can move the decimal point into the middle and read as <a href="gen5/resources/field/">fx&lt;1.15.16&gt;</a> instead. This is how the terrain values for PDSMS were calculated, since its a tile based tool.</p>
<h3 id="permission-data-1"><a class="header" href="#permission-data-1">Permission Data</a></h3>
<ul>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#corners">Corners</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#terrain-inclination-values">Terrain Inclination Values</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#terrain-distance-values">Terrain Distance Values</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#environment-behavior-values">Environment Behavior Values</a></li>
<li><a href="gen5/resources/field/bw_b2w2-maps.html#environment-flag-values">Environment Flag Values</a></li>
</ul>
<h4 id="corners-1"><a class="header" href="#corners-1">Corners</a></h4>
<p>To allow the character to walk a different slope depending from the direction, Pokemon Black and White introduced corner tiles. These store data for two differnt terrains and apply one terrain to the northern vertices and the 2nd one to the southern vertices. Since the double amount of data at random position wouldn't fit into the permission grid, this data gets appended to the end of the permission section. The <code>0x0002</code> (bit) command in the terrain inclination tells the game to read a value from the extra data. The terrain distance behaves as an index for this section.</p>
<h4 id="terrain-inclination-values-1"><a class="header" href="#terrain-inclination-values-1">Terrain Inclination Values</a></h4>
<p>The 3-dimensional shape of a tile.</p>
<p>TODO: Add tables or code.</p>
<h4 id="terrain-distance-values-1"><a class="header" href="#terrain-distance-values-1">Terrain Distance Values</a></h4>
<p>If we extend the tile to an infinite plane, we can draw a line which is perpendicular to the plane and connect it to the origin (0, 0, 0) of the map. The length of this line is the distance. The distence is selected using indices. </p>
<details>
<summary>Distance table - Black and White</summary>
<pre><code class="language-c">/**
 * Table created by Gonhex
 * Number of entries: 1314
 * All values signed int32
 * Tiles = value / 0x10000
 */

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x000- */ 0x00000000, 0xFFFE7FE9, 0x00016A20, 0xFFF6191D, 0xFFFEFFF1, 0xFFF7AD6F, 0x00043E61, 0x00038951, 0xFFFB01A9, 0x0000B510, 0x000712A2, 0xFFF4AEFC, 0xFFFDE0D0, 0xFFFDC36D, 0x0001000F, 0x0001CA0E,
/* 0x001- */ 0x0000E507, 0x00007283, 0xFFFEA875, 0xFFFB86DB, 0x00020AAF, 0x0000CD4E, 0x0001A225, 0xFFFBF95F, 0xFFFF7FF9, 0x00016317, 0x00008E09, 0x00019A9C, 0x0000D112, 0x00006889, 0x0002AF16, 0x0002DBC2,
/* 0x002- */ 0x00027338, 0x0002AAD4, 0x0001AA1C, 0x0002001F, 0x0000D50E, 0x000267EB, 0xFFFF1AF9, 0x0002237B, 0x00023C93, 0x0001562D, 0x0002557B, 0x0001AAC4, 0xFFFCDE66, 0x000406A1, 0xFFFE35F2, 0xFFFE95E0,
/* 0x003- */ 0x0003219A, 0xFFF9BCCC, 0x00047925, 0x000E00DF, 0xFFFC6BE2, 0x000B5104, 0x00087CC3, 0xFFF69BA6, 0xFFF9A26E, 0x000A9BF3, 0x0009E6E3, 0xFFFA577E, 0xFFF7833D, 0xFFFB1458, 0xFFFAA1D3, 0xFFF8384E,
/* 0x004- */ 0xFFF6331C, 0xFFFA2F50, 0xFFF94A48, 0xFFFC532B, 0x00065D92, 0x0002D441, 0xFFFE5DDB, 0xFFFD2BBF, 0x0005A882, 0x00021F30, 0xFFFDF551, 0xFFFBC19F, 0x0004F371, 0x0000EF97, 0x0001BF3C, 0x00006FCF,
/* 0x005- */ 0x00011010, 0x00013F74, 0x00068F85, 0x000633DB, 0x0005E091, 0xFFFF703F, 0x0000DF9E, 0xFFFF504D, 0x00008FC1, 0x00001000, 0xFFFFA02A, 0x0000AFB3, 0x0000BFAC, 0xFFFF4054, 0x00005FD6, 0xFFFFD015,
/* 0x006- */ 0xFFFF4AF0, 0x001000FF, 0x0008FC13, 0x0002E940, 0xFFFA2D80, 0x0006005F, 0x0004003F, 0xFFF8ED5E, 0xFFFC76AF, 0xFFFBEAA1, 0xFFFB4164, 0x0001E5D8, 0xFFFB25EB, 0xFFFB188D, 0x0008D3CE, 0x00018017,
/* 0x007- */ 0xFFFD50EA, 0x0001578B, 0xFFFDFFE1, 0xFFFB0C8F, 0x0003941E, 0x0009DDC9, 0x0007C7B2, 0x000931D3, 0x00008007, 0xFFF8384D, 0xFFF6CE2D, 0x001EC444, 0x001EC443, 0x000A3061, 0x001DB4AB, 0xFFFF1DA1,
/* 0x008- */ 0x002B82B7, 0x000897E4, 0x0032031F, 0x002F02EF, 0x000038BF, 0xFFFF5D2A, 0x00085BBB, 0x00097611, 0x00007A84, 0xFFFFA79A, 0x000CF8EC, 0x00127ACE, 0x0000C7A4, 0xFFFF13DE, 0x001CFF9A, 0x001CFF9B,
/* 0x009- */ 0x00019216, 0x0000D003, 0x00021A88, 0x0001710D, 0xFFFCBAE0, 0x000160DA, 0x0005608F, 0x0002C6AF, 0x00024167, 0x000A079E, 0x000A079F, 0x0003A677, 0x000358B6, 0x0022E425, 0x0026EAC5, 0x00149BEE,
/* 0x00A- */ 0x00086DD7, 0x000BB39F, 0x001C4A8A, 0x0031030F, 0x0004D4C2, 0x0009F3C9, 0x001B957A, 0xFFFE741F, 0xFFF959F8, 0x00065E9C, 0x0001E0F6, 0x001DF60C, 0x0018F7B4, 0x001CDF0B, 0x00197F55, 0x000387EC,
/* 0x00B- */ 0x0002CDE9, 0x00151671, 0x00176740, 0xFFFF1296, 0x000474EE, 0x0010C317, 0x001A01A0, 0x001FC289, 0x0028B4D5, 0x0014D76D, 0x00150346, 0xFFFFBA4F, 0x00010E38, 0x001F08D1, 0x00015FBA, 0x00042DCB,
/* 0x00C- */ 0x00275D4A, 0x001A019F, 0x0015F3DE, 0x00043175, 0xFFFEF7A7, 0x000AF506, 0x000AE99A, 0x0005F196, 0x000D5F92, 0x00267842, 0x00284251, 0x00180F34, 0x0013A672, 0x001028D1, 0x000E73B4, 0x000BF40B,
/* 0x00D- */ 0x000B42E2, 0x00097053, 0x00093967, 0x0007C88E, 0x00243BAF, 0x0007D682, 0x00069DB9, 0x002B02AF, 0x0006D776, 0x0005C022, 0x0020E374, 0x00224D1D, 0x0027CFCD, 0x0025F9F2, 0x00061818, 0x0004D33C,
/* 0x00E- */ 0x0006FDF4, 0x001D01CF, 0x0005663B, 0x000830B0, 0xFFFA934E, 0x00083ED0, 0xFFF93361, 0xFFF6FEB3, 0xFFFB8312, 0xFFFF5386, 0x000D3FA1, 0x00257C5E, 0x00051447, 0x001B4964, 0xFFFB3789, 0x0016D03F,
/* 0x00F- */ 0x0019F1D9, 0x00208207, 0x000B3A4B, 0x0009E473, 0x00111053, 0xFFFF9D72, 0x0021F30C, 0x001DCF35, 0x0023C92B, 0x00231E30, 0x001578B3, 0x0009ADC5, 0x000B1217, 0x00003237, 0xFFFE5985, 0x000519AA,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x010- */ 0x0000FB16, 0x000F00EF, 0xFFFEC97B, 0x000B00AF, 0x000A009F, 0x0001F62E, 0x0002E32F, 0x0003237C, 0x000614C2, 0x0008A990, 0x00079ABF, 0x0002BF75, 0x0005393E, 0x0005B785, 0x00041617, 0x00074721,
/* 0x011- */ 0x00085291, 0x00084980, 0x000D80D7, 0x0008BAD4, 0x0006DF56, 0x000A00A0, 0x00080170, 0x00083F8B, 0x00077D83, 0x000755CA, 0x000B2EDD, 0x000E5077, 0x00077C32, 0x0007283B, 0x00088DF0, 0x00082ABD,
/* 0x012- */ 0x000D6B70, 0x000E4ACB, 0x000C0614, 0x00054EFB, 0x00060281, 0x00089346, 0x0009D752, 0x000A6514, 0xFFFDC92F, 0xFFFE30C4, 0x00045DE0, 0x000EDA55, 0x00039E78, 0x000BB40B, 0x000143E4, 0x000BB40A,
/* 0x013- */ 0x00093D67, 0x000CF7F0, 0x000CF7EF, 0xFFFE6E42, 0x00083D28, 0x00077110, 0x00194DED, 0x000A2385, 0x002A0C61, 0x0004D44A, 0xFFFC68B5, 0xFFFC472F, 0xFFFF4170, 0x000938C7, 0x002A82A7, 0x002A029F,
/* 0x014- */ 0xFFFD4545, 0xFFFB4919, 0x00015F86, 0x00084E1E, 0x002271A0, 0xFFFE435A, 0xFFF652AC, 0x00090C2C, 0x000B6310, 0x000D79B9, 0x0010FF8E, 0x0014CA28, 0x001E69BB, 0x0017AD59, 0x0013AEA5, 0x0012C99D,
/* 0x015- */ 0x000E79E0, 0x000C2136, 0x000A3355, 0x0008E134, 0x00093FB6, 0x001FD3DB, 0x00099A7D, 0x0009ECDA, 0x00074882, 0x001537E8, 0x000681C8, 0x000B753B, 0x00074D3F, 0x0005C15F, 0xFFFC5C70, 0x0008F9DB,
/* 0x016- */ 0xFFFC5C71, 0x0013313E, 0x000EC2FB, 0x001A9089, 0x0015ECF8, 0x001263A6, 0x00077449, 0x0005C660, 0x00014F43, 0x00043C25, 0xFFFE9F89, 0xFFFD273C, 0x0006F121, 0x000F8F66, 0x00097D39, 0xFFFDE38F,
/* 0x017- */ 0x0005BAE8, 0xFFFE6B21, 0x00047DE8, 0x000B289C, 0x00046D6C, 0x00180C29, 0x00143652, 0x0008F24A, 0x001482D7, 0x000CBB24, 0x000CB46E, 0x00055E2D, 0x000AF8EA, 0x0003B5EA, 0x0005D0B0, 0x0004EBA8,
/* 0x018- */ 0x000425AC, 0x000126AC, 0x000345BF, 0x0007C7B3, 0x000D00CF, 0x0012011F, 0x00037706, 0x0002F5BC, 0x0003153D, 0x00028BD3, 0x0002CD1E, 0x00023BB0, 0x0002F0F9, 0x0002679D, 0x00036850, 0x0002A18A,
/* 0x019- */ 0x00040ADC, 0x0002F144, 0x00036576, 0x00065552, 0x00041CAA, 0x0009D13D, 0x0005004F, 0xFFF50716, 0xFFF77210, 0xFFF4D735, 0xFFF5B0A5, 0xFFF2E0D2, 0xFFF7C1A1, 0xFFFF9777, 0xFFF61044, 0xFFF7825A,
/* 0x01A- */ 0xFFF4EB57, 0xFFF53603, 0x000FF4EF, 0x00090B4D, 0xFFF748E4, 0xFFF85FAD, 0xFFF6F263, 0x0011AE96, 0x0014013F, 0xFFF6E9D4, 0x000A49D6, 0x00002A18, 0xFFF69151, 0x000C80C7, 0xFFF6C7C2, 0x000BA161,
/* 0x01B- */ 0xFFF91045, 0xFFF8B999, 0x00080D43, 0x0001BB82, 0x0002FE16, 0x000AF8FD, 0x0003731B, 0x000210B3, 0xFFF44C05, 0x0003FD3C, 0x0003ADFC, 0x0003FD73, 0xFFF4084D, 0xFFF46923, 0xFFF409DD, 0xFFF48BC7,
/* 0x01C- */ 0xFFF40BDE, 0xFFF4B5A7, 0xFFF40E80, 0xFFF4E93E, 0xFFF4120B, 0xFFF52A52, 0xFFF416FB, 0xFFF57ECF, 0xFFF41E23, 0xFFF5F098, 0xFFF4290F, 0xFFF43AEC, 0xFFF45AFF, 0xFFF49CF0, 0xFFF543A6, 0x0003002F,
/* 0x01D- */ 0xFFFAFFB1, 0xFFFCBBB4, 0x000EB659, 0xFFFC13A4, 0x0006DDA1, 0xFFFE09D2, 0xFFFE4D46, 0xFFFEBC1C, 0xFFFF8D7D, 0xFFFE447E, 0x0009CEE6, 0x000759AA, 0xFFFB198E, 0x0006B5B8, 0xFFF8D7C5, 0xFFF50984,
/* 0x01E- */ 0x00098C5C, 0xFFFC1C28, 0x000279B8, 0xFFFD8648, 0x000C2097, 0x0004BE9C, 0x000A9DF7, 0x00049EB3, 0xFFF868A0, 0xFFFF32B2, 0xFFFFBB91, 0x0006EE0D, 0x000F2EC1, 0x00060309, 0x000D48E9, 0xFFFA4E78,
/* 0x01F- */ 0xFFF682C7, 0xFFF947E6, 0x00005A87, 0xFFFAB206, 0x0003E3D9, 0x0003E3D8, 0x00054DFA, 0x000498E9, 0xFFF5640D, 0x000088DE, 0xFFFDC7DA, 0xFFFB7499, 0xFFFD8CC8, 0x00042948, 0x0006A874, 0xFFF6D860,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x020- */ 0xFFF60351, 0x000BA6CC, 0xFFF3FF41, 0xFFF45934, 0xFFFA2C9B, 0xFFF654BC, 0xFFF8FF90, 0x00023A98, 0xFFFACC9D, 0x00032857, 0xFFFCD8A5, 0x000927A0, 0x00027F2B, 0x0009FCAF, 0xFFFF554C, 0x0002C93E,
/* 0x021- */ 0x00006FC1, 0x0002D8C4, 0x0000BB00, 0x000C55FD, 0xFFFEC664, 0x0003543A, 0x0003B6FE, 0x0001A4C1, 0x0003CBAF, 0x0001DFE2, 0x0003D8D7, 0x000D76F1, 0x00064334, 0xFFFBF524, 0xFFF86541, 0xFFF3BFE4,
/* 0x022- */ 0xFFF9AA46, 0xFFF38427, 0xFFF1546C, 0x000052D5, 0x0001F3ED, 0x00003DA7, 0x0001F0D5, 0x000022D8, 0x0001EC6C, 0xFFFFD140, 0x0001DB7E, 0xFFFF903F, 0xFFFEAA96, 0x000F9F70, 0x0003E7DC, 0x00022ADF,
/* 0x023- */ 0x0003E1AA, 0x00076D2B, 0x0008223A, 0x00010F98, 0xFFFEF068, 0x00028027, 0xFFFB6717, 0xFFFC1C27, 0xFFFFA579, 0xFFF5BE95, 0xFFF892D5, 0x0001C4A9, 0x000AAB54, 0xFFFC7FC9, 0xFFFCFFD1, 0xFFF7666A,
/* 0x024- */ 0x0007367E, 0x00048047, 0x000E2545, 0x000D7035, 0x0007D8B8, 0xFFF82748, 0xFFF90593, 0x0008C47D, 0xFFF90943, 0x00092D9F, 0x0007006F, 0x0004155F, 0x0006200E, 0xFFF8208B, 0xFFF72C32, 0xFFF9225F,
/* 0x025- */ 0x0003EC5C, 0xFFFA9B67, 0xFFFA0870, 0xFFFA7FA9, 0xFFF6311A, 0xFFF8FD3A, 0xFFFA1D77, 0x000DBB41, 0x0005E289, 0x000CC02B, 0x000BC514, 0xFFFDA475, 0x00062137, 0xFFFF04EA, 0x00053289, 0xFFFB614D,
/* 0x026- */ 0xFFF628AE, 0x00068897, 0x0005B188, 0xFFF8A656, 0x00079760, 0x0007C234, 0xFFF9A5CA, 0xFFF45E9F, 0xFFF2B717, 0xFFFAB105, 0xFFFE1D2B, 0xFFFACD77, 0xFFF58FDB, 0xFFF7D543, 0xFFF76CBA, 0xFFF95B8B,
/* 0x027- */ 0xFFFF6C2B, 0xFFFD243F, 0xFFFA39A0, 0xFFFC3451, 0x0005B784, 0xFFF490F7, 0x000B8CC1, 0xFFF6C299, 0xFFFC88FA, 0xFFF4286D, 0x000EB355, 0x000CA8A6, 0x000C8669, 0xFFFD243E, 0xFFF70DB6, 0x0009CCE4,
/* 0x028- */ 0x0001BB83, 0x00065A36, 0x000093D5, 0xFFFED23A, 0xFFFECB2D, 0xFFFD1CD1, 0xFFFCD643, 0xFFFED854, 0xFFFC1454, 0xFFFBFDFA, 0x0004E773, 0xFFF149A7, 0x00054BC2, 0xFFF83DCC, 0xFFF78039, 0xFFFCF2CB,
/* 0x029- */ 0x000A43B3, 0xFFF69D46, 0xFFF57CE9, 0x0004704D, 0x000111BD, 0x0001ECCB, 0x0000D27B, 0x000AB044, 0xFFFE1A28, 0x00038037, 0xFFF4D123, 0x000ABC5A, 0xFFF87E1D, 0x00024F59, 0x0007853B, 0x0006EFBB,
/* 0x02A- */ 0x00074667, 0x0004AAF5, 0x00095B3E, 0x0009F396, 0xFFFCB30A, 0xFFFE55E4, 0xFFFD552C, 0xFFF4FB8A, 0xFFF7135D, 0xFFF84CD5, 0x00056C27, 0x00059466, 0x00056DB4, 0x000287CA, 0x0002B6DA, 0x000AC9FD,
/* 0x02B- */ 0xFFF5B62A, 0xFFFBFFC1, 0xFFFC1E56, 0x00087FC7, 0xFFF75670, 0xFFFB7FB9, 0xFFF1DABB, 0x0005AB04, 0x000655BA, 0xFFF91087, 0x000AF67C, 0xFFF911F3, 0xFFFF2AF2, 0x000855DB, 0x0004FE57, 0x000555AA,
/* 0x02C- */ 0x0006B81A, 0x00032EC9, 0x000AD1BD, 0xFFFE3B57, 0xFFFBD235, 0x00089996, 0xFFFCD137, 0xFFF7DDC6, 0xFFFAAA56, 0xFFF7F2BD, 0x0002AC5B, 0x0002C630, 0xFFFC551C, 0xFFF7F474, 0xFFF3CB2A, 0xFFF3CB2B,
/* 0x02D- */ 0x0006EF79, 0x0007C488, 0xFFF3F9EC, 0xFFF2F61D, 0x0001AAC5, 0xFFF344DC, 0xFFF673A4, 0xFFFD80D5, 0x0005D365, 0x0008D74B, 0xFFF69B31, 0x000FB170, 0x000C12B9, 0xFFFE2482, 0xFFF6B686, 0xFFFD7FD9,
/* 0x02E- */ 0xFFF29490, 0x000A7025, 0x00088A4C, 0x0001399C, 0x000C401C, 0x000C5D6F, 0x000BA501, 0xFFFD16C0, 0x000C426F, 0xFFFD0EBC, 0x000BD6F1, 0xFFFDB0A7, 0xFFFD0A44, 0x000B8542, 0x000BE1DD, 0xFFFCEAC3,
/* 0x02F- */ 0xFFFD0789, 0x000B7C30, 0x000BE905, 0xFFFCC751, 0xFFFD05BF, 0x000B7346, 0x000BEDF5, 0xFFFCACFD, 0xFFFD0484, 0x0009008F, 0x0008F277, 0x00099E1A, 0xFFFF09CA, 0xFFFF0D15, 0xFFF8833C, 0x0009DC85,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x030- */ 0xFFFB6F3E, 0x00057A82, 0xFFF9FCF7, 0xFFF728B5, 0x000A416B, 0xFFF59AEC, 0x0004E672, 0xFFF9DFF2, 0x0003ACD5, 0x000DDC1B, 0x0009F0F6, 0xFFFC0604, 0xFFF90A87, 0x00020020, 0x0003444C, 0x00095960,
/* 0x031- */ 0x000A33CC, 0x000A627B, 0xFFFADF81, 0xFFFAD034, 0xFFFC0DB0, 0xFFFACEC3, 0xFFFC0A0C, 0x00004D35, 0xFFFF6189, 0x000ADA5C, 0x0003AAE4, 0x0007AB24, 0x0000AAB4, 0xFFFDFFE0, 0x00080511, 0x00058057,
/* 0x032- */ 0x000BAB8B, 0x000CE5B6, 0x000BE8AC, 0x00010B33, 0x000D95D7, 0x000E16AD, 0x000DAB81, 0x000DBA32, 0x000B75D1, 0x000CA735, 0x000DBD4A, 0x000ED6A0, 0xFFF5F110, 0x000DBEAC, 0x0004C99A, 0x000AF56D,
/* 0x033- */ 0xFFF917F4, 0x000ECCAD, 0x000F476B, 0xFFFAA539, 0xFFFB111C, 0xFFFB79EA, 0x0005F0EE, 0x000CDF5B, 0x000C2B68, 0x000CD384, 0x000BC305, 0x000C9D6C, 0x000B0680, 0xFFFDD13A, 0xFFFE8B60, 0xFFFF207E,
/* 0x034- */ 0x000BD793, 0x0008FBD0, 0xFFF7EA46, 0xFFF3ED47, 0xFFFCCAC6, 0xFFFCABC6, 0xFFFD0F36, 0xFFF77CC9, 0xFFF4DB06, 0xFFF5C8C6, 0x0004A4BD, 0xFFFEE498, 0x0000CA6F, 0xFFFEE1B7, 0x0000ABC5, 0xFFF25B4E,
/* 0x035- */ 0xFFFF1241, 0x0005927C, 0x00011B68, 0x00030140, 0xFFF3D280, 0x000275D4, 0x00049620, 0xFFFDF1AB, 0x00011E49, 0x0002E858, 0xFFF87F89, 0x00043FE3, 0xFFFDFCB0, 0x00020350, 0xFFF497E1, 0x0004E719,
/* 0x036- */ 0xFFF97FC4, 0x000A373A, 0x0006CCF1, 0x0000287C, 0x0005976E, 0xFFFF543B, 0x000A47A8, 0xFFFB18E7, 0xFFF77F79, 0xFFF103C2, 0x0003CD60, 0xFFF67F69, 0xFFF2CDD2, 0x000B3A94, 0xFFF1E8CA, 0xFFED6B90,
/* 0x037- */ 0x0008B2C9, 0x00086BB8, 0x0009515A, 0x0007E2D9, 0x00067C76, 0xFFEF6102, 0xFFF89204, 0xFFFDC10C, 0x000609F2, 0x0005890B, 0x0005367E, 0x00036ED0, 0x0007158B, 0x0005DA05, 0x00035ADB, 0xFFFFD784,
/* 0x038- */ 0x0003A333, 0xFFFCFEC0, 0x0006803C, 0xFFFD36C2, 0x00076DFC, 0x000BE31B, 0x0009B5AA, 0x0002DBC1, 0x0007C0A1, 0x000A1094, 0x0006FC14, 0x0004B267, 0xFFFC0BD3, 0xFFF9330F, 0xFFFD42BF, 0x000954BC,
/* 0x039- */ 0xFFF92EE5, 0xFFF8A4D4, 0xFFFDF4F5, 0xFFFCB9D7, 0xFFFEB0BD, 0x000190CD, 0xFFFB96D1, 0xFFF89E83, 0x00002EC0, 0x0001BD5B, 0xFFFC6420, 0xFFF80E2D, 0x0001BCD5, 0x0001DD12, 0x0002D829, 0xFFF70B69,
/* 0x03A- */ 0xFFF2DF94, 0xFFFC4902, 0x0005C96E, 0x00060086, 0x00014D7C, 0x0005A943, 0x000741FF, 0xFFFE533B, 0xFFF8547D, 0x000454C8, 0x000A3C41, 0xFFFB58FA, 0xFFF83432, 0xFFF39F64, 0x0009DC86, 0x00076EE4,
/* 0x03B- */ 0xFFF18033, 0xFFF1D4EB, 0xFFF5E4D8, 0xFFF0BDF6, 0xFFF1907B, 0xFFF55101, 0x00046202, 0x00003941, 0x000A6799, 0x000B8B8D, 0x0002CA28, 0xFFFB9619, 0xFFF3B2D9, 0xFFF45CB2, 0xFFFD4FB9, 0xFFF45475,
/* 0x03C- */ 0x0000D33D, 0xFFF97F99, 0x00034668, 0x000B3AC4, 0x0002430A, 0x000066A7, 0x00092B8C, 0x0004ACB0, 0x00097D76, 0x000BE562, 0x0002B047, 0x0008B909, 0x0000EDBF, 0xFFFB5B43, 0xFFFA6D84, 0xFFF9B14A,
/* 0x03E- */ 0xFFFB8FB3, 0x000EDBF7, 0xFFFF0796, 0x0006A475, 0xFFFB8218, 0xFFFE2996, 0xFFFDFA92, 0x00007D8B, 0x00017197, 0xFFF7A05B, 0x000469E7, 0xFFFE875E, 0x0006104B, 0x00099E10, 0x00014050, 0xFFFE7016,
/* 0x03D- */ 0x000C7E7A, 0x0003E11A, 0xFFFD8A2C, 0xFFFDF0B6, 0xFFF01613, 0xFFF8C808, 0xFFEDCF1D, 0xFFF23544, 0x0006C485, 0x000603CC, 0x00081376, 0x0007617D, 0x00068C53, 0xFFF2FF87, 0x000D0079, 0xFFF95BDE,
/* 0x03F- */ 0xFFFAE54A, 0xFFFAC982, 0x00009CCE, 0x00020240, 0xFFF9ABAD, 0xFFF84023, 0x0001D66A, 0xFFFCEFF9, 0x0001F6E5, 0xFFFCA525, 0xFFFC41E7, 0xFFFD39D0, 0x00056481, 0x000165D2, 0x0004B752, 0x0007514A,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x040- */ 0x000574EF, 0xFFF91106, 0xFFFAFAD2, 0x000A4706, 0xFFFB7A59, 0x000B9180, 0x0009D27B, 0xFFFE5D21, 0x0002056E, 0x00084685, 0x0004559A, 0x0009497A, 0x0004CD4D, 0x0002D668, 0x0003A702, 0x00031AC1,
/* 0x041- */ 0xFFF9E36F, 0xFFFADB15, 0x000962BA, 0x000BDAA3, 0x00084B57, 0x0004956D, 0xFFFC4A16, 0x000D18A5, 0x0016015F, 0x000CFD61, 0x0002FF65, 0x0001FF98, 0x000278A0, 0x00017924, 0x0002FF51, 0x00027E90,
/* 0x042- */ 0x0001FF8B, 0x00017F23, 0x0013012F, 0x0002FF3A, 0xFFF70250, 0x0001FF7C, 0x0008FD60, 0xFFFE0096, 0x00093235, 0x0008FD04, 0x000943AE, 0x0008FC96, 0x0005FDB9, 0x000F8F65, 0x0005FE40, 0x000CFC36,
/* 0x043- */ 0x000CBDDB, 0xFFF80255, 0xFFF7CD12, 0xFFFC012B, 0xFFFC3BA0, 0xFFFC4E55, 0xFFFC0154, 0xFFFC0185, 0x000CFBAF, 0x000CC852, 0xFFF802A8, 0xFFF7D985, 0x000CFB11, 0xFFFE00C3, 0xFFF80309, 0x0002FC60,
/* 0x044- */ 0xFFFA0740, 0x0003D7BA, 0x0002FB7C, 0x00041021, 0x0002FA41, 0x0001FD95, 0x0002DAC4, 0x000313F9, 0x0001FCFE, 0x0001FC2C, 0xFFFE00E0, 0xFFFD7A2C, 0xFFFE0103, 0xFFFD8316, 0xFFFE012E, 0xFFFA0388,
/* 0x045- */ 0x0009FBA3, 0x0006FCF2, 0x0006708F, 0x000677FA, 0x0006FC78, 0x0006FBE1, 0xFFF904D8, 0x0001FE9E, 0xFFF90BE2, 0xFFF905C2, 0xFFF92549, 0xFFF906ED, 0x0001FE05, 0x000BF7B3, 0x000BEBA1, 0x000BFEC1,
/* 0x046- */ 0x000BF623, 0x000BF422, 0xFFF56209, 0xFFF37997, 0xFFF97769, 0xFFFA487B, 0xFFF775B4, 0xFFF70430, 0x000D4844, 0x000127AC, 0xFFF1C42C, 0x0010BE05, 0x000F8469, 0xFFF34B92, 0xFFF1B535, 0x000FE15C,
/* 0x047- */ 0x000DE531, 0x0008007F, 0x00104476, 0x000F979E, 0x0010C39F, 0x00053B7F, 0xFFF90A92, 0xFFFC8300, 0xFFF7113C, 0xFFFC07A9, 0x00072F8D, 0x000AEF51, 0x000DD019, 0xFFFA1488, 0x0006E80C, 0x000AC7A3,
/* 0x048- */ 0x0008F579, 0x0009B42C, 0x0000F2EB, 0x000815BA, 0x000A356D, 0x00003E1A, 0x0003040F, 0x000050F9, 0xFFF490F6, 0xFFF0D13F, 0x000781E3, 0x0006395B, 0x00055AC7, 0x00063FAA, 0x000563D1, 0x000646F9,
/* 0x049- */ 0x00064EB6, 0x000174A0, 0xFFFE8A27, 0xFFFEA70C, 0xFFFF579E, 0x0006A286, 0x00046DA3, 0xFFF9FFA1, 0x0001F928, 0x0003F250, 0xFFFFCEB9, 0xFFFF0E96, 0xFFF72528, 0xFFF691D2, 0xFFF5BF02, 0xFFF93515,
/* 0x04A- */ 0xFFF83CAB, 0xFFFE0F2B, 0xFFF7DB72, 0xFFFA487C, 0x000B6F0A, 0xFFF43CFB, 0xFFFF2EEE, 0xFFF5E0D5, 0x00073CF0, 0x0010557C, 0xFFF26A29, 0xFFF09E82, 0xFFF0E422, 0xFFF30810, 0xFFF2B7BC, 0x000236D1,
/* 0x04B- */ 0x0000F86A, 0x000329BD, 0x0000A862, 0x0008B91D, 0x00087DA6, 0xFFF3DF69, 0xFFF6D4FD, 0x000F86AC, 0x00091949, 0x001135E1, 0x000F7004, 0x0010EB05, 0x00098182, 0x0003A155, 0x00078756, 0xFFF7A445,
/* 0x04C- */ 0xFFFFE573, 0x0007C355, 0x0008BBC0, 0xFFC0FC11, 0xFFB47B48, 0xFFC1FC21, 0xFFC07C09, 0xFFE72C71, 0xFFE56261, 0xFFCA523E, 0xFFD151CF, 0xFFDFEBBB, 0xFFC17C19, 0xFFE0B90A, 0xFFE59BA3, 0xFFE4B69C,
/* 0x04D- */ 0xFFE6AE39, 0xFFEA743F, 0xFFE5CEB6, 0xFFE98680, 0xFFEAFFB4, 0xFFEDF87B, 0xFFEA15F4, 0xFFED058F, 0xFFEE311D, 0xFFF09CA4, 0xFFED412C, 0xFFEFA66E, 0xFFF09E70, 0xFFF2A844, 0xFFEFAA84, 0xFFF1AFD9,
/* 0x04E- */ 0xFFEFB6E4, 0xFFC4FC51, 0xFFEECF46, 0xFFC8D50C, 0xFFCF329E, 0xFFD91982, 0x0007E4A1, 0x00071F55, 0xFFFCFBF1, 0x000C00BF, 0x000D7034, 0x00022865, 0x0003B836, 0xFFFC45DC, 0x000CA6F6, 0x000B60A4,
/* 0x04F- */ 0x000191BE, 0x0002FE3C, 0x0002E819, 0x0001FED2, 0x0001E989, 0x0002FDED, 0x0002FAE8, 0x0001FC9B, 0x0002FD89, 0x0000FF2D, 0x0001FE5B, 0x000BF180, 0x0003FB2A, 0x000AF2B5, 0x0004F9F5, 0x0009F3EA,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x050- */ 0x0005F8C0, 0xFFFD03A0, 0xFFFE026B, 0xFFFF0136, 0x0001DDCF, 0x0002F475, 0x0001F84E, 0x0000FE16, 0x00068067, 0x00078077, 0x00088087, 0x00117DEF, 0x0010F092, 0xFFF525A4, 0xFFF5683B, 0x0001556A,
/* 0x051- */ 0x0009AB44, 0xFFF3DECA, 0xFFF6A6A0, 0x0009645A, 0xFFF954EC, 0x0012602B, 0xFFF4733F, 0xFFF33FD5, 0xFFF244BF, 0xFFF5F853, 0x000F0B84, 0x0007098F, 0x00113967, 0x000E25F7, 0xFFFD53A5, 0x000964CF,
/* 0x052- */ 0xFFFC87BF, 0x0006A422
</code></pre>
</details>
<details>
<summary>Distance table - Black 2 and White 2</summary>
<pre><code class="language-c">/**
 * Table created by Gonhex
 * Number of entries: 1285
 * All values signed int32
 * Tiles = value / 0x10000
 */

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x000- */ 0x0002001F, 0x00018017, 0xFFFCFFD1, 0x00000000, 0x000F1AC8, 0x000DB2B6, 0x000F01AC, 0x000F9E43, 0x000F1E98, 0xFFFC6BE2, 0xFFFCDE66, 0xFFFDFFE1, 0xFFFEFFF1, 0xFFFB0C8F, 0x0001556B, 0x0004704D,
/* 0x001- */ 0x00021F30, 0x0004AAF5, 0x00038951, 0xFFFE95E0, 0xFFFC7FC9, 0x00016A20, 0xFFF6CE2D, 0xFFFE7FE9, 0xFFF6191D, 0xFFF7AD6F, 0x00043E61, 0xFFFB01A9, 0x0000B510, 0x000712A2, 0xFFF4AEFC, 0xFFFDE0D0,
/* 0x002- */ 0x0009CEE6, 0x0003EC5C, 0x0002F144, 0x0005004F, 0x0008D3CE, 0x0007D8B8, 0x0004E773, 0xFFFB188D, 0x0001F62E, 0xFFFC13A4, 0x0000FB16, 0xFFFD2BBF, 0xFFF7833D, 0x0004F371, 0xFFFD0EBC, 0x0002D441,
/* 0x003- */ 0xFFFBC19F, 0xFFF8ED5E, 0xFFFDC36D, 0x0001000F, 0x0001CA0E, 0x0000E507, 0x00007283, 0xFFFEA875, 0xFFFB86DB, 0x00020AAF, 0x0000CD4E, 0x0001A225, 0xFFFBF95F, 0xFFFF7FF9, 0x00016317, 0x00008E09,
/* 0x004- */ 0x00019A9C, 0x0000D112, 0x00006889, 0x0002AF16, 0x0002DBC2, 0x00027338, 0x0002AAD4, 0x0001AA1C, 0x0000D50E, 0x000267EB, 0xFFFF1AF9, 0x0002237B, 0x00023C93, 0x0001562D, 0x0002557B, 0x0001AAC4,
/* 0x005- */ 0x000406A1, 0xFFFE35F2, 0x0003219A, 0xFFF9BCCC, 0x00047925, 0x000E00DF, 0x000B5104, 0x00087CC3, 0xFFF69BA6, 0xFFF9A26E, 0x000A9BF3, 0x0009E6E3, 0xFFFA577E, 0xFFFB1458, 0xFFFAA1D3, 0xFFF8384E,
/* 0x006- */ 0xFFF6331C, 0xFFFA2F50, 0xFFF94A48, 0xFFFC532B, 0x00065D92, 0xFFFE5DDB, 0x0005A882, 0xFFFDF551, 0x0000EF97, 0x0001BF3C, 0x00006FCF, 0x00011010, 0x00013F74, 0x00068F85, 0x000633DB, 0x0005E091,
/* 0x007- */ 0xFFFF703F, 0x0000DF9E, 0xFFFF504D, 0x00008FC1, 0x00001000, 0xFFFFA02A, 0x0000AFB3, 0x0000BFAC, 0xFFFF4054, 0x00005FD6, 0xFFFFD015, 0xFFFF4AF0, 0x000931D3, 0x00080D43, 0x00064334, 0xFFF5640D,
/* 0x008- */ 0xFFFBF524, 0xFFF86541, 0xFFF3BFE4, 0xFFF9AA46, 0xFFF38427, 0xFFF1546C, 0x00048047, 0xFFF82748, 0xFFF90593, 0x0008C47D, 0xFFF90943, 0x00092D9F, 0xFFF43AEC, 0xFFFAFFB1, 0xFFF8208B, 0xFFF72C32,
/* 0x009- */ 0xFFF9225F, 0xFFFE09D2, 0xFFFA9B67, 0xFFFA0870, 0xFFFA7FA9, 0xFFF6311A, 0xFFF8FD3A, 0xFFFA1D77, 0x0007C7B2, 0x0007C7B3, 0xFFFC76AF, 0x001000FF, 0x0008FC13, 0x0002E940, 0xFFFA2D80, 0x0006005F,
/* 0x00A- */ 0x0004003F, 0xFFFBEAA1, 0xFFFB4164, 0x0001E5D8, 0xFFFB25EB, 0xFFFD50EA, 0x0001578B, 0x0003941E, 0x0009DDC9, 0x00008007, 0xFFF8384D, 0x001EC444, 0x001EC443, 0x000A3061, 0x001DB4AB, 0xFFFF1DA1,
/* 0x00B- */ 0x002B82B7, 0x000897E4, 0x0032031F, 0x002F02EF, 0x000038BF, 0xFFFF5D2A, 0x00085BBB, 0x00097611, 0x00007A84, 0xFFFFA79A, 0x000CF8EC, 0x00127ACE, 0x0000C7A4, 0xFFFF13DE, 0x001CFF9A, 0x001CFF9B,
/* 0x00C- */ 0x00019216, 0x0000D003, 0x00021A88, 0x0001710D, 0xFFFCBAE0, 0x000160DA, 0x0005608F, 0x0002C6AF, 0x00024167, 0x000A079E, 0x000A079F, 0x0003A677, 0x000358B6, 0x0022E425, 0x0026EAC5, 0x00149BEE,
/* 0x00D- */ 0x00086DD7, 0x000BB39F, 0x001C4A8A, 0x0031030F, 0x0004D4C2, 0x0009F3C9, 0x001B957A, 0xFFFE741F, 0xFFF959F8, 0x00065E9C, 0x0001E0F6, 0x001DF60C, 0x0018F7B4, 0x001CDF0B, 0x00197F55, 0x000387EC,
/* 0x00E- */ 0x0002CDE9, 0x00151671, 0x00176740, 0xFFFF1296, 0x000474EE, 0x0010C317, 0x001A01A0, 0x001FC289, 0x0028B4D5, 0x0014D76D, 0x00150346, 0xFFFFBA4F, 0x00010E38, 0x001F08D1, 0x00015FBA, 0x00042DCB,
/* 0x00F- */ 0x00275D4A, 0x001A019F, 0x0015F3DE, 0x00043175, 0xFFFEF7A7, 0x000AF506, 0x000AE99A, 0x0005F196, 0x000D5F92, 0x00267842, 0x00284251, 0x00180F34, 0x0013A672, 0x001028D1, 0x000E73B4, 0x000BF40B,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x010- */ 0x000B42E2, 0x00097053, 0x00093967, 0x0007C88E, 0x00243BAF, 0x0007D682, 0x00069DB9, 0x002B02AF, 0x0006D776, 0x0005C022, 0x0020E374, 0x00224D1D, 0x0027CFCD, 0x0025F9F2, 0x00061818, 0x0004D33C,
/* 0x011- */ 0x0006FDF4, 0x001D01CF, 0x0005663B, 0x000830B0, 0xFFFA934E, 0x00083ED0, 0xFFF93361, 0xFFF6FEB3, 0xFFFB8312, 0xFFFF5386, 0x000D3FA1, 0x00257C5E, 0x00051447, 0x001B4964, 0xFFFB3789, 0x0016D03F,
/* 0x012- */ 0x0019F1D9, 0x00208207, 0x000B3A4B, 0x0009E473, 0x00111053, 0xFFFF9D72, 0x0021F30C, 0x001DCF35, 0x0023C92B, 0x00231E30, 0x001578B3, 0x0009ADC5, 0x000B1217, 0x00003237, 0xFFFE5985, 0x000519AA,
/* 0x013- */ 0x000F00EF, 0xFFFEC97B, 0x000B00AF, 0x000A009F, 0x0002E32F, 0x0003237C, 0x000614C2, 0x0008A990, 0x00079ABF, 0x0002BF75, 0x0005393E, 0x0005B785, 0x00041617, 0x00074721, 0x00085291, 0x00084980,
/* 0x014- */ 0x000D80D7, 0x0008BAD4, 0x0006DF56, 0x000A00A0, 0x00080170, 0x00083F8B, 0x00077D83, 0x000755CA, 0x000B2EDD, 0x000E5077, 0x00077C32, 0x0007283B, 0x00088DF0, 0x00082ABD, 0x000D6B70, 0x000E4ACB,
/* 0x015- */ 0x000C0614, 0x00054EFB, 0x00060281, 0x00089346, 0x0009D752, 0x000A6514, 0xFFFDC92F, 0xFFFE30C4, 0x00045DE0, 0x000EDA55, 0x00039E78, 0x000BB40B, 0x000143E4, 0x000BB40A, 0x00093D67, 0x000CF7F0,
/* 0x016- */ 0x000CF7EF, 0xFFFE6E42, 0x00083D28, 0x00077110, 0x00194DED, 0x000A2385, 0x002A0C61, 0x0004D44A, 0xFFFC68B5, 0xFFFC472F, 0xFFFF4170, 0x000938C7, 0x002A82A7, 0x002A029F, 0xFFFD4545, 0xFFFB4919,
/* 0x017- */ 0x00015F86, 0x00084E1E, 0x002271A0, 0xFFFE435A, 0xFFF652AC, 0x00090C2C, 0x000B6310, 0x000D79B9, 0x0010FF8E, 0x0014CA28, 0x001E69BB, 0x0017AD59, 0x0013AEA5, 0x0012C99D, 0x000E79E0, 0x000C2136,
/* 0x018- */ 0x000A3355, 0x0008E134, 0x00093FB6, 0x001FD3DB, 0x00099A7D, 0x0009ECDA, 0x00074882, 0x001537E8, 0x000681C8, 0x000B753B, 0x00074D3F, 0x0005C15F, 0xFFFC5C70, 0x0008F9DB, 0xFFFC5C71, 0x0013313E,
/* 0x019- */ 0x000EC2FB, 0x001A9089, 0x0015ECF8, 0x001263A6, 0x00077449, 0x0005C660, 0x00014F43, 0x00043C25, 0xFFFE9F89, 0xFFFD273C, 0x0006F121, 0x000F8F66, 0x00097D39, 0xFFFDE38F, 0x0005BAE8, 0xFFFE6B21,
/* 0x01A- */ 0x00047DE8, 0x000B289C, 0x00046D6C, 0x00180C29, 0x00143652, 0x0008F24A, 0x001482D7, 0x000CBB24, 0x000CB46E, 0x00055E2D, 0x000AF8EA, 0x0003B5EA, 0x0005D0B0, 0x0004EBA8, 0x000425AC, 0x000126AC,
/* 0x01B- */ 0x000345BF, 0x000D00CF, 0x0012011F, 0x00037706, 0x0002F5BC, 0x0003153D, 0x00028BD3, 0x0002CD1E, 0x00023BB0, 0x0002F0F9, 0x0002679D, 0x00036850, 0x0002A18A, 0x00040ADC, 0x00036576, 0x00065552,
/* 0x01C- */ 0x00041CAA, 0x0009D13D, 0xFFF50716, 0xFFF77210, 0xFFF4D735, 0xFFF5B0A5, 0xFFF2E0D2, 0xFFF7C1A1, 0xFFFF9777, 0xFFF61044, 0xFFF7825A, 0xFFF4EB57, 0xFFF53603, 0x000FF4EF, 0x00090B4D, 0xFFF748E4,
/* 0x01D- */ 0xFFF85FAD, 0xFFF6F263, 0x0011AE96, 0x0014013F, 0xFFF6E9D4, 0x000A49D6, 0x00002A18, 0xFFF69151, 0x000C80C7, 0xFFF6C7C2, 0x000BA161, 0xFFF91045, 0xFFF8B999, 0x0001BB82, 0x0002FE16, 0x000AF8FD,
/* 0x01E- */ 0x0003731B, 0x000210B3, 0xFFF44C05, 0x0003FD3C, 0x0003ADFC, 0x0003FD73, 0xFFF4084D, 0xFFF46923, 0xFFF409DD, 0xFFF48BC7, 0xFFF40BDE, 0xFFF4B5A7, 0xFFF40E80, 0xFFF4E93E, 0xFFF4120B, 0xFFF52A52,
/* 0x01F- */ 0xFFF416FB, 0xFFF57ECF, 0xFFF41E23, 0xFFF5F098, 0xFFF4290F, 0xFFF45AFF, 0xFFF49CF0, 0xFFF543A6, 0x0003002F, 0x0007006F, 0x0009008F, 0xFFFCBBB4, 0x000EB659, 0x0006DDA1, 0xFFFE4D46, 0xFFFEBC1C,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x020- */ 0xFFFF8D7D, 0xFFFE447E, 0x000759AA, 0xFFFB198E, 0x0006B5B8, 0xFFF8D7C5, 0xFFF50984, 0x00098C5C, 0xFFFC1C28, 0x000279B8, 0xFFFD8648, 0x000C2097, 0x0004BE9C, 0x000A9DF7, 0x00049EB3, 0xFFF868A0,
/* 0x021- */ 0x0006EE0D, 0x000F2EC1, 0x00060309, 0x000D48E9, 0xFFFA4E78, 0xFFF682C7, 0xFFF947E6, 0x00005A87, 0xFFFAB206, 0x0003E3D9, 0x0003E3D8, 0x00054DFA, 0x000498E9, 0x00099A9A, 0xFFFDC7DA, 0xFFFB7499,
/* 0x022- */ 0xFFFD8CC8, 0x00042948, 0x0006A874, 0xFFFA2C9B, 0x000927A0, 0x00027F2B, 0xFFFF554C, 0x0002C93E, 0x00006FC1, 0x0002D8C4, 0x0000BB00, 0x000C55FD, 0xFFFEC664, 0x0003543A, 0x0003B6FE, 0x0001A4C1,
/* 0x023- */ 0x0003CBAF, 0x0001DFE2, 0x0003D8D7, 0x000D76F1, 0xFFFBFFC1, 0x000052D5, 0x0001F3ED, 0x00003DA7, 0x0001F0D5, 0x000022D8, 0x0001EC6C, 0xFFFFD140, 0x0001DB7E, 0xFFFF903F, 0xFFFF32B2, 0xFFFEAA96,
/* 0x024- */ 0x000F9F70, 0x0003E7DC, 0x00022ADF, 0x0003E1AA, 0x00076D2B, 0x0008223A, 0x00010F98, 0xFFFEF068, 0x00028027, 0xFFFB6717, 0xFFFC1C27, 0xFFFFA579, 0xFFF5BE95, 0xFFF892D5, 0x0001C4A9, 0x000AAB54,
/* 0x025- */ 0xFFF7666A, 0x0007367E, 0x000E2545, 0x000D7035, 0x0004155F, 0x0006200E, 0x00104476, 0x00038037, 0x000ABC5A, 0x00058057, 0x000DBB41, 0x0005E289, 0x000CC02B, 0x000BC514, 0xFFFDA475, 0x00062137,
/* 0x026- */ 0xFFFF04EA, 0x00053289, 0xFFFB614D, 0xFFF628AE, 0x00068897, 0x0005B188, 0xFFF8A656, 0x00079760, 0x0007C234, 0xFFF9A5CA, 0xFFF45E9F, 0xFFF2B717, 0xFFFAB105, 0xFFFE1D2B, 0xFFFACD77, 0xFFF58FDB,
/* 0x027- */ 0xFFF7D543, 0xFFF76CBA, 0xFFF95B8B, 0xFFFF6C2B, 0xFFFD243F, 0xFFFA39A0, 0xFFFC3451, 0x0005B784, 0xFFF490F7, 0x000B8CC1, 0xFFF6C299, 0xFFFC88FA, 0xFFF4286D, 0x000EB355, 0x000CA8A6, 0x000C8669,
/* 0x028- */ 0xFFFD243E, 0xFFF70DB6, 0x0009CCE4, 0x0001BB83, 0x00065A36, 0x000093D5, 0xFFFED23A, 0xFFFECB2D, 0xFFFD1CD1, 0xFFFCD643, 0xFFFED854, 0xFFFC1454, 0xFFFBFDFA, 0xFFF149A7, 0x00054BC2, 0xFFF83DCC,
/* 0x029- */ 0xFFF78039, 0xFFFCF2CB, 0x000A43B3, 0xFFF69D46, 0xFFF57CE9, 0x000111BD, 0x0001ECCB, 0x0000D27B, 0x000AB044, 0x00098097, 0xFFFE1A28, 0xFFF4D123, 0xFFF8FF91, 0xFFF9FFA1, 0xFFF87E1D, 0x00024F59,
/* 0x02A- */ 0x0007853B, 0x0006EFBB, 0x00074667, 0x00095B3E, 0x0009F396, 0xFFFCB30A, 0xFFFE55E4, 0xFFFD552C, 0xFFF4FB8A, 0xFFF7135D, 0xFFF84CD5, 0x00056C27, 0x00059466, 0x00056DB4, 0x000287CA, 0x0002B6DA,
/* 0x02B- */ 0x000AC9FD, 0xFFF5B62A, 0xFFFC1E56, 0x00087FC7, 0xFFF75670, 0xFFFB7FB9, 0x0005AB04, 0x000655BA, 0x0009FCAF, 0xFFF91087, 0x000AF67C, 0xFFF911F3, 0x000BA6CC, 0x0006AEE3, 0xFFFF2AF2, 0x000855DB,
/* 0x02C- */ 0x0004FE57, 0x000555AA, 0x0006B81A, 0x00032EC9, 0x000AD1BD, 0xFFFE3B57, 0xFFFBD235, 0x00089996, 0xFFFCD137, 0xFFF7DDC6, 0xFFFAAA56, 0xFFF7F2BD, 0x0002AC5B, 0x0002C630, 0xFFFC551C, 0xFFF7F474,
/* 0x02D- */ 0xFFF3CB2A, 0xFFF3FF41, 0xFFF3CB2B, 0x0006EF79, 0x0007C488, 0xFFF3F9EC, 0xFFF2F61D, 0x0001AAC5, 0xFFF344DC, 0xFFF673A4, 0xFFFD80D5, 0xFFF60351, 0x0005D365, 0x0008D74B, 0xFFF45475, 0xFFF9FCF7,
/* 0x02E- */ 0x0008007F, 0xFFF69B31, 0x000FB170, 0x000C12B9, 0xFFFE2482, 0xFFF6B686, 0xFFFD7FD9, 0xFFF29490, 0x00148147, 0x00118117, 0x00142128, 0x00128127, 0x0013012F, 0x00101A86, 0x0009B5AA, 0x000CD4E8,
/* 0x02F- */ 0x000C079A, 0x000A8AB8, 0x000FABA4, 0x0009D27B, 0x00062123, 0x0012C8B4, 0x000BAB8B, 0x0012602B, 0x000F357F, 0x000E80E7, 0x0008E09B, 0x000F00F0, 0x000DDDF4, 0x000A416B, 0x000A7025, 0x00088A4C,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x030- */ 0x000C401C, 0x000C5D6F, 0x000BA501, 0xFFFD16C0, 0x000C426F, 0x000BD6F1, 0xFFFDB0A7, 0xFFFD0A44, 0x000B8542, 0x000BE1DD, 0xFFFCEAC3, 0xFFFD0789, 0x000B7C30, 0x000BE905, 0xFFFCC751, 0xFFFD05BF,
/* 0x031- */ 0x000B7346, 0x000BEDF5, 0xFFFCACFD, 0xFFFD0484, 0x0008F277, 0x00099E1A, 0xFFFF09CA, 0xFFFF0D15, 0xFFF8833C, 0x0009DC85, 0xFFFB6F3E, 0x00057A82, 0xFFF728B5, 0xFFF59AEC, 0x0004E672, 0xFFF9DFF2,
/* 0x032- */ 0x0001399C, 0x0003ACD5, 0x000DDC1B, 0x0009F0F6, 0xFFFC0604, 0xFFF90A87, 0x00020020, 0x0003444C, 0x00095960, 0x000A33CC, 0x000A627B, 0xFFFADF81, 0xFFFAD034, 0xFFFC0DB0, 0xFFFACEC3, 0xFFFC0A0C,
/* 0x033- */ 0x0000DF82, 0xFFF854DB, 0x000D50E8, 0x0001556A, 0xFFF6D860, 0xFFFCAA75, 0x00004D35, 0xFFFF6189, 0x000ADA5C, 0x0003AAE4, 0x0007AB24, 0x0000AAB4, 0xFFFDFFE0, 0x00080511, 0x000CE5B6, 0x000BE8AC,
/* 0x034- */ 0x00010B33, 0x000D95D7, 0x000E16AD, 0x000DAB81, 0x000DBA32, 0x000B75D1, 0x000CA735, 0x000DBD4A, 0x000ED6A0, 0xFFF5F110, 0x000DBEAC, 0x0004C99A, 0x000AF56D, 0xFFF917F4, 0x000ECCAD, 0x000F476B,
/* 0x035- */ 0xFFFAA539, 0xFFFB111C, 0xFFFB79EA, 0x0005F0EE, 0x000CDF5B, 0x000C2B68, 0x000CD384, 0x000BC305, 0x000C9D6C, 0x000B0680, 0xFFFDD13A, 0xFFFE8B60, 0xFFFF207E, 0x000BD793, 0x0008FBD0, 0xFFF7EA46,
/* 0x036- */ 0xFFF3ED47, 0xFFFCCAC6, 0xFFFCABC6, 0xFFFD0F36, 0xFFF77CC9, 0xFFF4DB06, 0xFFF5C8C6, 0x0004A4BD, 0xFFFEE498, 0x0000CA6F, 0xFFFEE1B7, 0x0000ABC5, 0xFFF25B4E, 0xFFFF1241, 0x0005927C, 0x00011B68,
/* 0x037- */ 0x00030140, 0xFFF3D280, 0x000275D4, 0x00049620, 0xFFFDF1AB, 0x00011E49, 0x0002E858, 0xFFF87F89, 0x00043FE3, 0xFFFDFCB0, 0x00020350, 0xFFF497E1, 0x0004E719, 0xFFF97FC4, 0x000A373A, 0x0006CCF1,
/* 0x038- */ 0x0000287C, 0x0005976E, 0xFFFF543B, 0x000A47A8, 0xFFFB18E7, 0xFFF77F79, 0xFFF103C2, 0x0003CD60, 0xFFF67F69, 0xFFF2CDD2, 0x000B3A94, 0xFFF1E8CA, 0xFFED6B90, 0x0008B2C9, 0x00086BB8, 0x0009515A,
/* 0x039- */ 0x0007E2D9, 0x00067C76, 0xFFEF6102, 0xFFF89204, 0xFFFDC10C, 0x000609F2, 0x0005890B, 0x0005367E, 0x00036ED0, 0x0007158B, 0x0005DA05, 0x00035ADB, 0xFFFFD784, 0x0003A333, 0xFFFCFEC0, 0x0006803C,
/* 0x03A- */ 0xFFFD36C2, 0x00076DFC, 0x000BE31B, 0x0002DBC1, 0x0007C0A1, 0x000A1094, 0x0006FC14, 0x0004B267, 0xFFFC0BD3, 0xFFF9330F, 0xFFFD42BF, 0x000954BC, 0xFFF92EE5, 0xFFF8A4D4, 0xFFFDF4F5, 0xFFFCB9D7,
/* 0x03B- */ 0xFFFEB0BD, 0x000190CD, 0xFFFB96D1, 0xFFF89E83, 0x00002EC0, 0x0001BD5B, 0xFFFC6420, 0xFFF80E2D, 0x0001BCD5, 0x0001DD12, 0x0002D829, 0xFFF70B69, 0xFFF2DF94, 0xFFFC4902, 0x0005C96E, 0x00060086,
/* 0x03C- */ 0x00014D7C, 0x0005A943, 0x000741FF, 0xFFFE533B, 0xFFF8547D, 0x000454C8, 0x000A3C41, 0xFFFB58FA, 0xFFF83432, 0xFFF39F64, 0x0009DC86, 0x00076EE4, 0xFFF18033, 0xFFF1D4EB, 0xFFF5E4D8, 0xFFF0BDF6,
/* 0x03D- */ 0xFFF1907B, 0xFFF55101, 0x00046202, 0x00003941, 0x000A6799, 0x000B8B8D, 0x0002CA28, 0xFFFB9619, 0xFFF3B2D9, 0xFFF45CB2, 0xFFFD4FB9, 0x0000D33D, 0xFFF97F99, 0x00034668, 0x000B3AC4, 0x0002430A,
/* 0x03E- */ 0x000066A7, 0x00092B8C, 0x0004ACB0, 0x00097D76, 0x000BE562, 0x0002B047, 0x0008B909, 0x0000EDBF, 0xFFFB5B43, 0xFFFA6D84, 0xFFF9B14A, 0xFFFB8FB3, 0x000EDBF7, 0xFFFF0796, 0x0006A475, 0xFFFB8218,
/* 0x03F- */ 0xFFFDF0B6, 0xFFF01613, 0xFFF8C808, 0xFFEDCF1D, 0xFFF23544, 0x0006C485, 0x000603CC, 0x00081376, 0x0007617D, 0x00068C53, 0xFFF2FF87, 0x000D0079, 0xFFF95BDE, 0xFFFAE54A, 0xFFFAC982, 0x00009CCE,

/*             0x---0      0x---1      0x---2      0x---3      0x---4      0x---5      0x---6      0x---7      0x---8      0x---9      0x---A      0x---B      0x---C      0x---D      0x---E      0x---F */
/* 0x040- */ 0x00020240, 0xFFF9ABAD, 0xFFF84023, 0x0001D66A, 0xFFFCEFF9, 0x0001F6E5, 0xFFFCA525, 0xFFFC41E7, 0xFFFD39D0, 0x00056481, 0x000165D2, 0x0004B752, 0x0007514A, 0xFFFE7016, 0x000574EF, 0xFFF91106,
/* 0x041- */ 0xFFFAFAD2, 0x000A4706, 0xFFFB7A59, 0x000B9180, 0xFFFE5D21, 0x0002056E, 0x00084685, 0x0004559A, 0x0009497A, 0x0004CD4D, 0x0002D668, 0x0003A702, 0x00031AC1, 0xFFF9E36F, 0xFFFADB15, 0x000962BA,
/* 0x042- */ 0x000BDAA3, 0x00084B57, 0x0004956D, 0xFFFC4A16, 0x000D18A5, 0x0016015F, 0x000CFD61, 0x0002FF65, 0x0001FF98, 0x000278A0, 0x00017924, 0x0002FF51, 0x00027E90, 0x0001FF8B, 0x00017F23, 0x0002FF3A,
/* 0x043- */ 0xFFF70250, 0x0001FF7C, 0x0008FD60, 0xFFFE0096, 0x00093235, 0x0008FD04, 0x000943AE, 0x0008FC96, 0x0005FDB9, 0x000F8F65, 0x0005FE40, 0x000CFC36, 0x000CBDDB, 0xFFF80255, 0xFFF7CD12, 0xFFFC012B,
/* 0x044- */ 0xFFFC3BA0, 0xFFFC4E55, 0xFFFC0154, 0xFFFC0185, 0x000CFBAF, 0x000CC852, 0xFFF802A8, 0xFFF7D985, 0x000CFB11, 0xFFFE00C3, 0xFFF80309, 0x0002FC60, 0xFFFA0740, 0x0003D7BA, 0x0002FB7C, 0x00041021,
/* 0x045- */ 0x0002FA41, 0x0001FD95, 0x0002DAC4, 0x000313F9, 0x0001FCFE, 0x0001FC2C, 0xFFFE00E0, 0xFFFD7A2C, 0xFFFE0103, 0xFFFD8316, 0xFFFE012E, 0xFFFA0388, 0x0009FBA3, 0x0006FCF2, 0x0006708F, 0x000677FA,
/* 0x046- */ 0x0006FC78, 0x0006FBE1, 0xFFF904D8, 0x0001FE9E, 0xFFF90BE2, 0xFFF905C2, 0xFFF92549, 0xFFF906ED, 0x0001FE05, 0x000BF7B3, 0x000BEBA1, 0x000BFEC1, 0x000BF623, 0x000BF422, 0xFFF56209, 0xFFF37997,
/* 0x047- */ 0xFFF97769, 0xFFFA487B, 0xFFF775B4, 0xFFF70430, 0x000D4844, 0x000127AC, 0xFFF1C42C, 0x0010BE05, 0x000F8469, 0xFFF34B92, 0xFFF1B535, 0x000FE15C, 0x000DE531, 0x000F979E, 0x0010C39F, 0x00053B7F,
/* 0x048- */ 0xFFF90A92, 0xFFFC8300, 0xFFF7113C, 0xFFFC07A9, 0x00072F8D, 0x000AEF51, 0x000DD019, 0xFFFA1488, 0x0006E80C, 0x000AC7A3, 0x0008F579, 0x0009B42C, 0x0000F2EB, 0x000815BA, 0x000A356D, 0x00003E1A,
/* 0x049- */ 0x0003040F, 0x000050F9, 0xFFF490F6, 0xFFF0D13F, 0x000781E3, 0x0006395B, 0x00055AC7, 0x00063FAA, 0x000563D1, 0x000646F9, 0x00064EB6, 0x000174A0, 0xFFFE8A27, 0xFFFEA70C, 0xFFFF579E, 0x0006A286,
/* 0x04A- */ 0x00046DA3, 0x0001F928, 0x0003F250, 0xFFFFCEB9, 0xFFFF0E96, 0xFFF72528, 0xFFF691D2, 0xFFF5BF02, 0xFFF93515, 0x000B6F0A, 0xFFF83CAB, 0xFFF43CFB, 0xFFFF2EEE, 0xFFF5E0D5, 0x00073CF0, 0x0010557C,
/* 0x04B- */ 0xFFF26A29, 0xFFF09E82, 0xFFF0E422, 0xFFF30810, 0xFFF2B7BC, 0x0008B91D, 0x00087DA6, 0xFFF3DF69, 0xFFF6D4FD, 0x000F86AC, 0x00091949, 0x001135E1, 0x000F7004, 0x0010EB05, 0x00098182, 0x0003A155,
/* 0x04C- */ 0x00078756, 0xFFF7A445, 0xFFFFE573, 0x0007C355, 0x0008BBC0, 0xFFF64A56, 0xFFF4A039, 0xFFF57548, 0x000E6FF1, 0x0011010F, 0x000C00BF, 0x0010F986, 0x0011E6F8, 0x000C13E4, 0xFFF5FF61, 0x00088087,
/* 0x04D- */ 0xFFF6FF71, 0xFFECFED1, 0xFFED7ED9, 0xFFEB7EB9, 0xFFEEFEF1, 0xFFF62EC3, 0xFFF57F59, 0x0007E4A1, 0x00071F55, 0xFFFCFBF1, 0x002E02DF, 0x003C03BF, 0x00117DEF, 0x0010F092, 0x00022865, 0x0003B836,
/* 0x04E- */ 0xFFFC45DC, 0x000CA6F6, 0x000B60A4, 0x000191BE, 0x0000AAB5, 0x0000555B, 0xFFFBD6B8, 0x00068067, 0x00078077, 0xFFF525A4, 0xFFF5683B, 0x0009AB44, 0xFFF3DECA, 0xFFF6A6A0, 0x0009645A, 0xFFF954EC,
/* 0x04F- */ 0xFFF4733F, 0xFFF33FD5, 0xFFF244BF, 0xFFF5F853, 0x000F0B84, 0x0007098F, 0x00113967, 0x000E25F7, 0xFFFD53A5, 0x000964CF, 0xFFFC87BF, 0xFFEC7EC9, 0x00007D8B, 0x00017197, 0x000469E7, 0xFFFE875E,

/*             0x---0      0x---1      0x---2      0x---3      0x---4 */
/* 0x050- */ 0x00014050, 0x000C7E7A, 0x0003E11A, 0xFFFD8A2C, 0x0006A422
</code></pre>
</details>
<h4 id="environment-behavior-values-1"><a class="header" href="#environment-behavior-values-1">Environment Behavior Values</a></h4>
<p><strong>WARNING:</strong> SDSME and PDSMS mistakenly call them &quot;FLAGS &amp; LAYER 6&quot;, which can lead to confusion.</p>
<p>Some sort of command table which can introduce different effects depending on its value. Used in combination with the <code>Flag</code> value. Can display additional textures, make sounds, add direction dependdend collisions and much more. The extra textures (...and models ...and animations) can be found in <code>a/0/7/5</code> in Black and White and <code>a/0/7/4</code> in Black 2 and White 2.</p>
<details>
<summary>Behavior descriptions.</summary>
<div class="table-wrapper"><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0001</code></td><td>Used for can't pass (collision). Flag <code>0x0001</code> must be set, else no effect(?).</td></tr>
<tr><td><code>0x0002</code></td><td>Winter only footprints if flag <code>0x0008</code> is enabled(?) Used as winter path.</td></tr>
<tr><td><code>0x0003</code></td><td>Used as ground path.</td></tr>
<tr><td><code>0x0004</code></td><td>Used for normal tall gras. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0005</code></td><td>Used for normal tall gras that can have snow in winter. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0006</code></td><td>Used for dark tall gras, possible double battels with flag <code>0x0004</code>. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0007</code></td><td>Used for dark tall gras that can have snow in winter, possible double battels with flag <code>0x0004</code>. Flag <code>0x0020</code> must be set to display the gras.</td></tr>
<tr><td><code>0x0008</code></td><td>Play longer gras enter sound. Display very tall gras, if flag <code>0x0020</code> is set. Can't use bike.</td></tr>
<tr><td><code>0x0009</code></td><td>Play longer gras enter sound. Display very tall dark gras, if flag <code>0x0020</code> is set. Possible double battels with flag <code>0x0004</code>. Can't use bike.</td></tr>
<tr><td><code>0x000A</code></td><td>Can spawn animated dirt with sound which result in getting a (type-)gem or a wild battle by moving in. Used as ground in caves.</td></tr>
<tr><td><code>0x000B</code></td><td>Play step sound. Used as sand path.</td></tr>
<tr><td><code>0x000C</code></td><td>Offset character down to let it sink a bit. Play sand sound. Display dark hole if flag <code>0x0008</code> is set. Slow down bike. Used as deep sand.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x000E</code></td><td>Play snow sound. Display blue footprints, if flag <code>0x0008</code> is enabled. Used as snow.</td></tr>
<tr><td><code>0x000F</code></td><td>Play snow sound. Display blue footprints, if flag <code>0x0008</code> is enabled. Can't use bike.</td></tr>
<tr><td><code>0x0010</code></td><td>Slide over this tile, if next tile is can be entered (no collision there).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0012</code></td><td>Used as lake border collision (corners).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0014</code></td><td>Display ripple while entering and play sound. Used for puddles.</td></tr>
<tr><td><code>0x0015</code></td><td>Display ripple while entering and play sound.</td></tr>
<tr><td><code>0x0016</code></td><td>Used as ground in the ´Bizarro-House´.</td></tr>
<tr><td><code>0x0017</code></td><td>Display water splashing and play sound. Used at beach water boarders and on sand which is slightly under water.</td></tr>
<tr><td><code>0x0018</code></td><td>Slide over this tile, if next tile is can be entered (no collision there). Used as ice.</td></tr>
<tr><td><code>0x0019</code></td><td>Play step sound. Used as sand path.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x001C</code></td><td>Play ripple sound, no animation. Used for puddles with wild pokemon (flag <code>0x0004</code> enabled).</td></tr>
<tr><td><code>0x001D</code></td><td>Used as hole for the strength rocks. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x001E</code></td><td>Season depending flooring (footprints), if flag <code>0x0008</code> is enabled. Used if there is a spot leafs in autumn but snow in winter and something else in other seasons.</td></tr>
<tr><td><code>0x001F</code></td><td>Used as gras path (normal not tall gras which usually is all over the place).</td></tr>
<tr><td><code>0x0020</code></td><td>Can spawn animated shadows with sound which result in getting a feather or a wild battle by moving in. Used on some bridges.</td></tr>
<tr><td><code>0x0021</code></td><td>Display slightly different tall gras, if flag <code>0x0020</code> is enabled.</td></tr>
<tr><td><code>0x0022</code></td><td>Display slightly different dark tall gras, if flag <code>0x0020</code> is enabled. Possible double battels with flag <code>0x0004</code>(?).</td></tr>
<tr><td><code>0x0023</code></td><td>Play step sound. Used as sand path inside a cave.</td></tr>
<tr><td><code>0x0024</code></td><td>Play long smooth sound. Can't use bike.</td></tr>
<tr><td><code>0x0025</code></td><td>Display leafs flying into the air, play sound. Used when the path is full of leafes in autumn.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0030</code></td><td>Display electrostatic discharge. Used in the <code>Chargestone Cave</code>. Crashes the game if loaded with wrong settings!</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0032</code></td><td>Used for charged stones in the <code>Chargestone Cave</code>. Activation field for a gimmick?</td></tr>
<tr><td><code>0x0033</code></td><td>Scriptable behavior? Used for the levitation effect (slowly up and down) in the gate after route 10 in BW. No effect outside that room.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x003D</code></td><td>Can use fishing rod. Used as lake water.</td></tr>
<tr><td><code>0x003E</code></td><td>Can use fishing rod.</td></tr>
<tr><td><code>0x003F</code></td><td>Can use fishing rod. Used as water.</td></tr>
<tr><td><code>0x0040</code></td><td>Used as waterfall. Flag <code>0x0001</code> must be set, else no effect. Can connect to any height.</td></tr>
<tr><td><code>0x0041</code></td><td>Skip this field for water connections. Can force surf on the tile behind, fishing only if there is water. Is used as lake border.</td></tr>
<tr><td><code>0x0042</code></td><td>Can use fishing rod.</td></tr>
<tr><td><code>0x0043</code></td><td>Can use fishing rod. Used as deep sea to stard diving.</td></tr>
<tr><td><code>0x0044</code></td><td>Skip this field for water connections. Can force surf on the tile behind, fishing only if there is water. Is used as border.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0051</code></td><td>Collision east side.</td></tr>
<tr><td><code>0x0052</code></td><td>Collision west side.</td></tr>
<tr><td><code>0x0053</code></td><td>Collision north side.</td></tr>
<tr><td><code>0x0054</code></td><td>Collision south side.</td></tr>
<tr><td><code>0x0055</code></td><td>Collision north and east side.</td></tr>
<tr><td><code>0x0056</code></td><td>Collision north and west side.</td></tr>
<tr><td><code>0x0057</code></td><td>Collision south and east side.</td></tr>
<tr><td><code>0x0058</code></td><td>Collision south and east side.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0072</code></td><td>One way jump east. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0073</code></td><td>One way jump west. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0074</code></td><td>One way jump north. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0075</code></td><td>One way jump south. On land over one tile, on water over 3 tiles. Flag <code>0x0001</code> must be set, else no effect. Play jump sound.</td></tr>
<tr><td><code>0x0076</code></td><td>Start spinning while moving to east until collision. Play funny sound while spinning.</td></tr>
<tr><td><code>0x0077</code></td><td>Start spinning while moving to west until collision. Play funny sound while spinning.</td></tr>
<tr><td><code>0x0078</code></td><td>Start spinning while moving to north until collision. Play funny sound while spinning.</td></tr>
<tr><td><code>0x0079</code></td><td>Start spinning while moving to south until collision. Play funny sound while spinning.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x007C</code></td><td>Used to slide on quick sand on a slope if running and animate it(?).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x0094</code></td><td>Move the character to east and play sound. Used for rapids.</td></tr>
<tr><td><code>0x0095</code></td><td>Move the character to west and play sound. Used for rapids.</td></tr>
<tr><td><code>0x0096</code></td><td>Move the character to north and play sound. Used for rapids.</td></tr>
<tr><td><code>0x0097</code></td><td>Move the character to south and play sound. Used for rapids.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x009C</code></td><td>Used in diving areas. Connected to a counter which limits diving time/distance(?).</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00A3</code></td><td>Used to connect the map grid with an external rail. The connections tiles on the rail must also use <code>0x00A3</code> and be very close to this tile in 3D space.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00BE</code></td><td>Lose balance if standing on this tile and fall off from a side after a while. Surrounding tile must be deeper in terrain to avoid getting trapped. Used as tightrope.</td></tr>
<tr><td><code>0x00BF</code></td><td>Connection ramp to a tightrope, safe enter and leave point.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00D4</code></td><td>Can talk to NPC behind this tile. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00D6</code></td><td>Used for the PC (box, mail, ...). Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00D8</code></td><td>Used for the TV. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00D9</code></td><td>Dialog text <code>index 0</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DA</code></td><td>Dialog text <code>index 1</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DB</code></td><td>Dialog text <code>index 2</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DC</code></td><td>Dialog text <code>index 3</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DD</code></td><td>Dialog text <code>index 4</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00DE</code></td><td>Dialog text <code>index 4</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect. Used for the trash bin.</td></tr>
<tr><td><code>0x00DF</code></td><td>Dialog text <code>index 5</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00E0</code></td><td>Dialog text <code>index 6</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00E1</code></td><td>Dialog text <code>index 7</code> from file 10 in <code>a/0/0/3</code>. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td><code>0x00E2</code></td><td>Used for the vending machine. Flag <code>0x0001</code> must be set, else no effect.</td></tr>
<tr><td>...</td><td></td></tr>
<tr><td><code>0x00FE</code></td><td>Somewhere used instead of duplicates in 2nd permission layer(?). Ignore this...</td></tr>
<tr><td><code>0x00FF</code></td><td>Can't pass (collision)(?). This one doesn't rely on a flag.</td></tr>
<tr><td>...</td><td></td></tr>
</tbody></table>
</div></details>
<p>TODO: Document missing values.</p>
<h4 id="environment-flag-values-1"><a class="header" href="#environment-flag-values-1">Environment Flag Values</a></h4>
<p><strong>WARNING:</strong> SDSME and PDSMS mistakenly call them &quot;COLLISION &amp; SHADOW&quot;, which can lead to confusion.</p>
<p>Sets the properties of a tile using binary flags. Multiple flags can be combined. Footprints are displayed for a short time after a character left the field. Gras is animated when the character enters a field and remains in the last frame until the character leaves. </p>
<details>
<summary>Flag descriptions</summary>
<div class="table-wrapper"><table><thead><tr><th>Bitmask</th><th>Description</th></tr></thead><tbody>
<tr><td><code>0x0001</code></td><td>Interactable field. Usually used for collisions but depending on the behavior-value it can also result in jumping over, talk to behind, interact with furniture, ...</td></tr>
<tr><td><code>0x0002</code></td><td>Surfable tile, does not include fishing!</td></tr>
<tr><td><code>0x0004</code></td><td>Enable wild pokemon encounter for this tile</td></tr>
<tr><td><code>0x0008</code></td><td>Display footprints, appearance depends on the behavior field.</td></tr>
<tr><td><code>0x0010</code></td><td>Enabled on water and flooded sand but not on water-borders, rapids and diveable areas. Not sure how it is used.</td></tr>
<tr><td><code>0x0020</code></td><td>Display gras animation and play sound, appearance depends on the behavior field.</td></tr>
<tr><td><code>0x0040</code></td><td>Reflection, vertical flipped copy of the overworld under the ground.</td></tr>
<tr><td><code>0x0080</code></td><td>Has shadow. The shadow is a dark circle under the overworld.</td></tr>
<tr><td><code>0x0100</code></td><td>Enables overworld shading with the color defined in light 3.</td></tr>
<tr><td><code>0xFE00</code></td><td>Some of the remaining bits are enabled on corner terrain slopes but the purpose is unclear.</td></tr>
</tbody></table>
</div></details>
<h3 id="special-rd-maps-1"><a class="header" href="#special-rd-maps-1">Special RD Maps</a></h3>
<p>There are a handful maps which use the &quot;RD&quot; signature and have no terrain data within the permission section. Instead, there are a set of currently unknown bytes. These maps are special, because they allow the game to load different sets of additional 3D models, movements permissions, interactable things like NPCs (...), depending on scripting flags. RD maps work in combination with the files from <code>a/1/5/6</code> in BW and <code>a/1/5/4</code> in B2W2.</p>
<p>In Pokemon Black and White, only the <code>Black City</code> and the <code>White Forest</code> are RD maps. Those places get content added, when the player poaches people through the Entralink.</p>
<p>In Pokemon Black 2 and White 2, only the <code>Join Avenue</code> and an island are RD maps. Here the player can talk to people passing through to add stalls at the sides of the road. The island maps, that also use these permissions, are an unused developement leftover. It is assumed that the join avenue was initially supposed to be an island, since it got some free space for eight markets in the center:</p>
<p align="center">
 <img src="gen5/resources/field/resources/bw_b2w2-maps/rd_island.png" alt="RD island" style="width:80%">
 <img src="gen5/resources/field/resources/bw_b2w2-maps/rd_island_top.png" alt="RD island top view" style="width:80%">
</p>
<hr />
<h2 id="todo-3"><a class="header" href="#todo-3">TODO</a></h2>
<ul>
<li>Link the NSBMD section to <code>src/universal/resources/nitro/graphics_3d/file_bmd0.md</code> once it contains information.</li>
<li>Research and document &quot;RD&quot; type maps.</li>
<li>Add terrain tables or insight into its internal working. Do NOT add the one with float values!</li>
<li>Document missing <code>behavior</code> values.</li>
<li>Link fixed point definition.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="zone-entities-container-1"><a class="header" href="#zone-entities-container-1">Zone Entities Container</a></h1>
<p>The NARC containing these files can be found in the following game paths:</p>
<ul>
<li>Black and White: /a/1/2/5</li>
<li>Black 2 and White 2: /a/1/2/6</li>
</ul>
<hr />
<h1 id="container-structure-3"><a class="header" href="#container-structure-3">Container Structure</a></h1>
<pre><code class="language-C">struct ZoneEntitiesContainer {
    uint32_t pInitializationScripts; // Relative pointer to initialization scripts.
    uint8_t InteractablesCount;
    uint8_t NPCCount;
    uint8_t WarpCount;
    uint8_t TriggerCount;

    InteractableEntry Interactables[InteractablesCount];
    NPCEntry NPCs[NPCCount];
    WarpEntry Warp[WarpCount];
    TriggerEntry Trigger[TriggerCount];


    DynamicInitializationEntry pDynamicInitScripts;
    StaticInitializationEntry StaticInitScripts; 
} 
</code></pre>
<hr />
<h1 id="section-structures-1"><a class="header" href="#section-structures-1">Section Structures</a></h1>
<h2 id="interactable-entry-1"><a class="header" href="#interactable-entry-1">Interactable Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>Script ID</td><td>The script to execute when interacted with. Read from the zone's script container.</td><td>uint16_t</td></tr>
<tr><td>Condition</td><td>The condition needed for this interactable to allow interactions.</td><td>uint16_t</td></tr>
<tr><td>Interactibility</td><td>The sides which the interactable can be interacted with.</td><td>uint16_t</td></tr>
<tr><td>RailSystem Index</td><td>The index of the interactable in the context of RailSystem, the 3D permissions system.</td><td>uint16_t</td></tr>
<tr><td>X</td><td>The world X position of the interactable.</td><td>uint32_t</td></tr>
<tr><td>Z</td><td>The world Z position of the interactable.</td><td>uint32_t</td></tr>
<tr><td>Y</td><td>The world Y position of the interactable.</td><td>int32_t</td></tr>
</tbody></table>
</div>
<h2 id="npc-entry-1"><a class="header" href="#npc-entry-1">NPC Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>ID</td><td>The ID that will be used to reference the NPC in game.</td><td>uint16_t</td></tr>
<tr><td>Model ID</td><td>The ID of the sprite to use for the NPC in game.</td><td>uint16_t</td></tr>
<tr><td>Movement Code</td><td>The default movement behavior of the NPC in game.</td><td>uint16_t</td></tr>
<tr><td>Type</td><td>The type of NPC to be spawned.</td><td>uint16_t</td></tr>
<tr><td>Spawn Flag</td><td>The flag which can be used to control the NPC's presence in game.</td><td>uint16_t</td></tr>
<tr><td>Script ID</td><td>The script which the NPC will use when interacted with in game.</td><td>uint16_t</td></tr>
<tr><td>Face Direction</td><td>The default direction that the NPC will look before they start their movement.</td><td>uint16_t</td></tr>
<tr><td>Parameter 1</td><td>An optional parameter, whose value purpose depends on the actor's movement code.</td><td>uint16_t</td></tr>
<tr><td>Parameter 2</td><td>An optional parameter, whose value purpose depends on the actor's movement code.</td><td>uint16_t</td></tr>
<tr><td>Parameter 3</td><td>An optional parameter, whose value purpose depends on the actor's movement code.</td><td>uint16_t</td></tr>
<tr><td>Traversal Width</td><td>How far the NPC will travel from left to right, in game units.</td><td>uint16_t</td></tr>
<tr><td>Traversal Height</td><td>How far the NPC will travel up and down, in game units.</td><td>uint16_t</td></tr>
<tr><td>Coordinate System</td><td>If this value is 1, then RailSystem (the system for nonlinear collisions) is used. Otherwise, it is the grid system.</td><td>uint32_t</td></tr>
<tr><td>X</td><td>The world X position of the NPC.</td><td>uint16_t</td></tr>
<tr><td>Z</td><td>The world Z position of the NPC.</td><td>uint16_t</td></tr>
<tr><td>RailSystem Side Position</td><td>If the coordinate system is RailSystem, then this specifies the NPC's side position.</td><td>uint16_t</td></tr>
<tr><td>Y</td><td>The world Y position of this NPC.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<h2 id="warp-entry-1"><a class="header" href="#warp-entry-1">Warp Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>Target Zone</td><td>The map header where this warp will teleport you to.</td><td>uint16_t</td></tr>
<tr><td>Target Warp</td><td>The warp where you will be teleported to.</td><td>uint16_t</td></tr>
<tr><td>Contact Direction</td><td>The direction you need to interact with the warp.</td><td>uint8_t</td></tr>
<tr><td>Transition Type</td><td>The transition that will be played when warping.</td><td>uint8_t</td></tr>
<tr><td>Coordinate Type</td><td>The type of coordinates you will be passing in.</td><td>uint16_t</td></tr>
<tr><td>X</td><td>The world X position of the warp.</td><td>uint16_t</td></tr>
<tr><td>Z</td><td>The world Z position of the warp.</td><td>int16_t</td></tr>
<tr><td>Y</td><td>The world Y position of the warp.</td><td>uint16_t</td></tr>
<tr><td>Width</td><td>The width of the warp zone, in game units.</td><td>uint16_t</td></tr>
<tr><td>Height</td><td>The height of the warp zone, in game units.</td><td>uint16_t</td></tr>
<tr><td>Coordinate System</td><td>If this value is 1, then the coordinates are based on RailSystem. Otherwise, it uses the grid system.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<h2 id="trigger-entry-1"><a class="header" href="#trigger-entry-1">Trigger Entry</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>Script ID</td><td>The script ID which will be used when the trigger is executed.</td><td>uint16_t</td></tr>
<tr><td>Work Reference Value</td><td>The value that must be in the work in order for this trigger to execute.</td><td>uint16_t</td></tr>
<tr><td>Work</td><td>The variable that is being monitored for the value we want.</td><td>uint16_t</td></tr>
<tr><td>Unknown</td><td>The purpose of this field has yet to be discovered.</td><td>uint16_t</td></tr>
<tr><td>Unknown 2</td><td>The purpose of this field has yet to be discovered.</td><td>uint16_t</td></tr>
<tr><td>X</td><td>The world X position of the trigger.</td><td>uint16_t</td></tr>
<tr><td>Z</td><td>The world Z position of the trigger.</td><td>uint16_t</td></tr>
<tr><td>Width</td><td>The width of the trigger area.</td><td>uint16_t</td></tr>
<tr><td>Height</td><td>The height of the trigger area.</td><td>uint16_t</td></tr>
<tr><td>Y</td><td>The world Y position of the trigger.</td><td>int16_t</td></tr>
<tr><td>Unknown 3</td><td>The purpose of this field has yet to be discovered.</td><td>uint16_t</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="nintendo-nitro-binary---overview"><a class="header" href="#nintendo-nitro-binary---overview">Nintendo Nitro Binary - Overview</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a>, various</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    FS(File System)--&gt;N(Nitro);
    G2D(Graphics 2D)--&gt;N;
    G3D(Graphics 3D)--&gt;N;
    S(Sound)--&gt;N;
</pre>
<p>The Nintendo DS provides a set of data structures for fast memory access. These are used by the Pokemon main line games among others and can be grouped into different categories, see flowchart above. This documentation aims to provide information about the nitro system in an easily accessible way. Please note that the data is based on reverse engineering by various people and therefore mistakes can not be ruled out.</p>
<h2 id="table-of-contents-22"><a class="header" href="#table-of-contents-22">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/nitro_overview.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/nitro_overview.html#nitro-file-header">Nitro File Header</a></li>
<li><a href="universal/resources/nitro/nitro_overview.html#nitro-section-header">Nitro Section Header</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/nitro_overview.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/nitro_overview.html#file-system">File System</a></li>
<li><a href="universal/resources/nitro/nitro_overview.html#graphics-2d">Graphics 2D</a></li>
<li><a href="universal/resources/nitro/nitro_overview.html#graphics-3d">Graphics 3D</a></li>
<li><a href="universal/resources/nitro/nitro_overview.html#sound">Sound</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/nitro_overview.html#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-structure-3"><a class="header" href="#data-structure-3">Data Structure</a></h2>
<p>All nitro binaries follow a specific pattern and can be divided into two groups: files and sections. The data is defined in sections while files represent a collection of sections. This way the same type of data can be used by different files. All formats of one group share the same header.</p>
<h3 id="nitro-file-header"><a class="header" href="#nitro-file-header">Nitro File Header</a></h3>
<pre><code class="language-c">struct NitroFileHeader
{
    /* 0x0 */ uint8_t signature[4];
    /* 0x4 */ uint16_t byteOrderMark;
    /* 0x6 */ uint8_t versionMinor;
    /* 0x7 */ uint8_t versionMajor;
    /* 0x8 */ uint32_t lengthFile;
    /* 0xC */ uint16_t lengthHeader;
    /* 0xE */ uint16_t numberSections;
}; // entry size = 0x10
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>signature</td><td>Identify type of data content.</td><td>uint8_t[]</td></tr>
<tr><td>byteOrderMark</td><td>Defines the byte order as UTF-16 character.</td><td>uint16_t</td></tr>
<tr><td>versionMinor</td><td>Minor nitro version number (fraction of the number). <code>Major.Minor</code></td><td>uint8_t</td></tr>
<tr><td>versionMajor</td><td>Major nitro version number (integer of the number). <code>Major.Minor</code></td><td>uint8_t</td></tr>
<tr><td>lengthFile</td><td>Length of the nitro file, including all sections.</td><td>uint32_t</td></tr>
<tr><td>lengthHeader</td><td>Length of this header, always <code>0x10</code>.</td><td>uint16_t</td></tr>
<tr><td>numberSections</td><td>Number of sections within this file.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<h3 id="nitro-section-header"><a class="header" href="#nitro-section-header">Nitro Section Header</a></h3>
<pre><code class="language-c">struct NitroSectionHeader
{
    /* 0x0 */ uint8_t signature[4];
    /* 0x4 */ uint32_t lengthSection;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>signature</td><td>Identify type of data content.</td><td>uint8_t[]</td></tr>
<tr><td>lengthSection</td><td>Length of the nitro section.</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-3"><a class="header" href="#specification-3">Specification</a></h2>
<h3 id="file-system"><a class="header" href="#file-system">File System</a></h3>
<pre class="mermaid">flowchart BT;
    NARC(N. Archive)--&gt;FS(File System);
    TODO(...)--&gt;FS;
</pre>
<p>TODO: Some words about the file system.</p>
<ul>
<li><a href="universal/resources/nitro/file_system/file_narc.html">NARC - Nitro Archive</a></li>
</ul>
<h3 id="graphics-2d"><a class="header" href="#graphics-2d">Graphics 2D</a></h3>
<pre class="mermaid">flowchart BT;
    NCLR(N. Color R.)--&gt;G2D(Graphics 2D);
    NCGR(N. Character Graphic R.)--&gt;G2D;
    NSCR(N. Screen R.)--&gt;G2D;
    NCER(N. Cell R.)--&gt;G2D;
    NANR(N. Animation R.)--&gt;G2D;
    NMCR(N. Multi Cell R.)--&gt;G2D;
    NMAR(N. Multi Animation R.)--&gt;G2D;
</pre>
<p>Two-dimensional graphics are processed as tiles. These are squared bitmaps with a side length of eight pixels. Depending on the required behavior of a sprite there are several files involved. One file alone is not enough to display a graphic. The dependencies are as follows:</p>
<pre class="mermaid">flowchart RL;
    NCGR(N. Character Graphic R.)--&gt;NCLR(N. Color R.);
    NSCR(N. Screen R.)--&gt;NCLR;
    NSCR--&gt;NCGR;
    NCER(N. Cell R.)--&gt;NCGR;
    NCER--&gt;NCLR;
    NAMR(N. Animation R.)--&gt;NCER;
    NMCR(N. Multi Cell R.)--&gt;NAMR;
    NMAR(N. Multi Animation R.)--&gt;NMCR;
</pre>
<p>Unlike in other nitro formats the signatures of the 2D files and sections are reversed. I.e. instead of <code>&quot;NCLR&quot;</code>, <code>&quot;RLCN&quot;</code> is used.</p>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nclr.html">NCLR (&quot;RLCN&quot;) - Nitro Color Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_ncgr.html">NCGR (&quot;RGCN&quot;) - Nitro Character Graphic Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nscr.html">NSCR (&quot;RCSN&quot;) - Nitro Screen Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html">NCER (&quot;RECN&quot;) - Nitro Cell Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">NANR (&quot;RNAN&quot;) - Nitro Animation Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmcr.html">NMCR (&quot;RCMN&quot;) - Nitro Multi Cell Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html">NMAR (&quot;RAMN&quot;) - Nitro Multi Animation Runtime</a></li>
</ul>
<h3 id="graphics-3d"><a class="header" href="#graphics-3d">Graphics 3D</a></h3>
<pre class="mermaid">flowchart BT;
    BMD0(B. Model 0)--&gt;G3D(Graphics 3D);
    BTX0(B. Texture 0)--&gt;G3D;
    TODO(...)--&gt;G3D;
</pre>
<p>TODO: Some words about 3D graphics.</p>
<ul>
<li><a href="universal/resources/nitro/graphics_3d/file_bmd0.html">BMD0 - Binary Model 0</a></li>
<li><a href="universal/resources/nitro/graphics_3d/file_btx0.html">BTX0 - Binary Texture 0</a></li>
<li><a href="universal/resources/nitro/graphics_3d/file_.html">???? - TODO</a></li>
</ul>
<h3 id="sound"><a class="header" href="#sound">Sound</a></h3>
<pre class="mermaid">flowchart BT;
    TODO(...)--&gt;S(Sound);
</pre>
<p>TODO: Some words about the sound system.</p>
<ul>
<li><a href="universal/resources/nitro/sound/file_.html">???? - TODO</a></li>
</ul>
<hr />
<h2 id="todo-4"><a class="header" href="#todo-4">TODO</a></h2>
<ul>
<li>Edit <a href="universal/resources/nitro/nitro_overview.html#file-system">File System</a></li>
<li>Edit <a href="universal/resources/nitro/nitro_overview.html#graphics-3d">Graphics 3D</a></li>
<li>Edit <a href="universal/resources/nitro/nitro_overview.html#sound">Sound</a></li>
<li>Document other formats in the same or similar style as <code>Graphics 2D</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="narc---nitro-archive"><a class="header" href="#narc---nitro-archive">NARC - Nitro Archive</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NARC(N. Archive)--&gt;FS(File System);
    FATB(File Allocation Table)--&gt;NARC;
    FNTB(File Name Table)--&gt;NARC;
    FIMG(File Image)--&gt;NARC;
</pre>
<p>Nitro archives are virtual file systems (fs) nested into the fs of the ROM. They are often used to group related files at the final branches of the file tree.</p>
<h2 id="table-of-contents-23"><a class="header" href="#table-of-contents-23">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/file_system/file_narc.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/file_system/file_narc.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/file_system/file_narc.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/file_system/file_narc.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-4"><a class="header" href="#data-structure-4">Data Structure</a></h2>
<h3 id="file-container"><a class="header" href="#file-container">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNARC
{
    /* 0x00   */ struct NitroFileHeader fileHeader;
    /* 0x10   */ struct ContainerSectionFATB sectionDataFATB;
    /* append */ struct ContainerSectionFNTB sectionDataFNTB;
    /* append */ struct ContainerSectionFIMG sectionDataFIMG;
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;NARC&quot;</code>.</td><td><a href="universal/resources/nitro/file_system/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>sectionDataFATB</td><td>File allocation table. Stores offsets to all entries.</td><td><a href="universal/resources/nitro/file_system/section_fatb.html#section-container">ContainerSectionFATB</a></td></tr>
<tr><td>sectionDataFNTB</td><td>File name table. Can store names of all entries.</td><td><a href="universal/resources/nitro/file_system/section_fntb.html#section-container">ContainerSectionFNTB</a></td></tr>
<tr><td>sectionDataFIMG</td><td>File image. The data of all entries.</td><td><a href="universal/resources/nitro/file_system/section_fimg.html#section-container">ContainerSectionFIMG</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-4"><a class="header" href="#specification-4">Specification</a></h2>
<h3 id="sections"><a class="header" href="#sections">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/file_system/section_fatb.html">File Allocation Table</a></li>
<li><a href="universal/resources/nitro/file_system/section_fntb.html">File Name Table</a></li>
<li><a href="universal/resources/nitro/file_system/section_fimg.html">File Image</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fatb-btaf---file-allocation-table"><a class="header" href="#fatb-btaf---file-allocation-table">FATB (&quot;BTAF&quot;) - File Allocation Table</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NARC(N. Archive)--&gt;FS(File System);
    FATB(File Allocation Table)--&gt;NARC;
</pre>
<p>The file allocation table stores offsets to beginning and end of all entries within the file image.</p>
<h2 id="table-of-contents-24"><a class="header" href="#table-of-contents-24">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/file_system/section_fatb.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/file_system/section_fatb.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/file_system/section_fatb.html#fatb-container">FATB Container</a></li>
<li><a href="universal/resources/nitro/file_system/section_fatb.html#entry-offset">Entry Offset</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/file_system/section_fatb.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/file_system/section_fatb.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-5"><a class="header" href="#data-structure-5">Data Structure</a></h2>
<h3 id="section-container"><a class="header" href="#section-container">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionFATB
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerFATB sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;BTAF&quot;</code>.</td><td><a href="universal/resources/nitro/file_system/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/file_system/section_fatb.html#fatb-container">ContainerFATB</a></td></tr>
</tbody></table>
</div>
<h3 id="fatb-container"><a class="header" href="#fatb-container">FATB Container</a></h3>
<pre><code class="language-c">struct ContainerFATB
{
    // header
    /* 0x0 */ uint16_t numberFiles;
    /* 0x2 */ uint16_t reserved;
    
    // data
    /* 0x4 */ EntryOffset dataEntries[numberFiles];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberFiles</td><td>Number of files stored in this archive.</td><td>uint16_t</td></tr>
<tr><td>reserved</td><td>Always <code>0</code>.</td><td>uint16_t</td></tr>
<tr><td>dataEntries</td><td>Contains offsets to all files managed by this archive.</td><td><a href="universal/resources/nitro/file_system/section_fatb.html#entry-offset">EntryOffset[]</a></td></tr>
</tbody></table>
</div>
<h3 id="entry-offset"><a class="header" href="#entry-offset">Entry Offset</a></h3>
<pre><code class="language-c">struct EntryOffset
{
    /* 0x0 */ uint32_t offsetBeginning;
    /* 0x4 */ uint32_t offsetEnd;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>offsetBeginning</td><td>Offset to the file within the file image.</td><td>uint32_t</td></tr>
<tr><td>offsetEnd</td><td>Offset to the end of the file within the file image.</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-5"><a class="header" href="#specification-5">Specification</a></h2>
<h3 id="files"><a class="header" href="#files">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/file_system/file_narc.html">Nitro Archive</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="fimg-gmif---file-image"><a class="header" href="#fimg-gmif---file-image">FIMG (&quot;GMIF&quot;) - File Image</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NARC(N. Archive)--&gt;FS(File System);
    FIMG(File Image)--&gt;NARC;
</pre>
<p>A data buffer for all the files stored in this archive.</p>
<h2 id="table-of-contents-25"><a class="header" href="#table-of-contents-25">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/file_system/section_fimg.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/file_system/section_fimg.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/file_system/section_fimg.html#fimg-container">FIMG Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/file_system/section_fimg.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/file_system/section_fimg.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-6"><a class="header" href="#data-structure-6">Data Structure</a></h2>
<h3 id="section-container-1"><a class="header" href="#section-container-1">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionFIMG
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerFIMG sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;GMIF&quot;</code>.</td><td><a href="universal/resources/nitro/file_system/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/file_system/section_fimg.html#fimg-container">ContainerFIMG</a></td></tr>
</tbody></table>
</div>
<h3 id="fimg-container"><a class="header" href="#fimg-container">FIMG Container</a></h3>
<pre><code class="language-c">struct ContainerFIMG
{
    // header
    // empty
    
    // data
    /* 0x0 */ uint8_t data[sectionHeader.lengthSection - 0x8];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>data</td><td>Raw data. The allocation table is needed to separate the files.</td><td>uint8_t[]</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-6"><a class="header" href="#specification-6">Specification</a></h2>
<h3 id="files-1"><a class="header" href="#files-1">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/file_system/file_narc.html">Nitro Archive</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nanr-rnan---nitro-animation-runtime"><a class="header" href="#nanr-rnan---nitro-animation-runtime">NANR (&quot;RNAN&quot;) - Nitro Animation Runtime</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NANR(N. Animation R.)--&gt;G2D(Graphics 2D);
    ANBK(Animation Bank)--&gt;NANR;
    LABL(Label)--&gt;NANR;
    UEXT(Use Extension?)--&gt;NANR;
</pre>
<p>The animation runtime creates frame by frame animations using cells. Affine transformations can also be applied to frames.</p>
<h2 id="table-of-contents-26"><a class="header" href="#table-of-contents-26">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-7"><a class="header" href="#data-structure-7">Data Structure</a></h2>
<h3 id="file-container-1"><a class="header" href="#file-container-1">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNANR
{
    /* 0x00   */ struct NitroFileHeader fileHeader;
    /* 0x10   */ struct ContainerSectionABNK sectionDataABNK;
    /* append */ struct ContainerSectionLABL sectionDataLABL;
    /* append */ struct ContainerSectionUEXT sectionDataUEXT;
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;RNAN&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>sectionDataABNK</td><td>Cell animation data.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#section-container">ContainerSectionABNK</a></td></tr>
<tr><td>sectionDataLABL</td><td>Animation-name table.</td><td><a href="universal/resources/nitro/graphics_2d/section_labl.html#section-container">ContainerSectionLABL</a></td></tr>
<tr><td>sectionDataUEXT</td><td>Cluster flag.</td><td><a href="universal/resources/nitro/graphics_2d/section_uext.html#section-container">ContainerSectionUEXT</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-7"><a class="header" href="#specification-7">Specification</a></h2>
<h3 id="sections-1"><a class="header" href="#sections-1">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html">Animation Bank</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html">Label</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html">Use Extension?</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="abnk-knba---animation-bank"><a class="header" href="#abnk-knba---animation-bank">ABNK (&quot;KNBA&quot;) - Animation Bank</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a>, <a href="https://github.com/magical">magical</a>, <a href="https://github.com/Gonhex">Gonhex</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NANR(N. Animation R.)--&gt;G2D(Graphics 2D);
    NMAR(N. Multi Animation R.)--&gt;G2D;
    ABNK(Animation Bank)--&gt;NANR;
    ABNK--&gt;NMAR;
</pre>
<p>The animation bank is used to animate 2D graphics. It requires an object to work on, which can be either a cell bank or a multi cell bank. Internally it works like frame by frame animations. To achieve more dynamic results, affine transformations can be applied to selected frames.</p>
<h2 id="table-of-contents-27"><a class="header" href="#table-of-contents-27">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#abnk-container">ABNK Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#sequence">Sequence</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">Frame</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame-properties">FrameProperties</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#animation">Animation</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#loop-mode">Loop Mode</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#affine-transformation">Affine Transformation</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#files">Files</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-structure-8"><a class="header" href="#data-structure-8">Data Structure</a></h2>
<h3 id="section-container-2"><a class="header" href="#section-container-2">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionABNK
{
    /* 0x0    */ struct NitroSectionHeader sectionHeader;
    /* 0x8    */ struct ContainerABNK sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;KNBA&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#abnk-container">ContainerABNK</a></td></tr>
</tbody></table>
</div>
<h3 id="abnk-container"><a class="header" href="#abnk-container">ABNK Container</a></h3>
<pre><code class="language-c">struct ContainerABNK
{
    // header
    /* 0x00 */ uint16_t numberSequences;
    /* 0x02 */ uint16_t numberFrames;
    /* 0x04 */ uint32_t offsetDataSequences;
    /* 0x08 */ uint32_t offsetDataFrame
    /* 0x0C */ uint32_t offsetDataFrameProperties;
    /* 0x10 */ uint32_t unknown0;
    /* 0x14 */ uint32_t unknown1;
    
    // data
    /* offsetDataSequences       */ struct Sequence dataSequences[numberSequences];
    /* offsetDataFrame           */ struct Frame dataFrames[numberFrames];
    /* offsetDataFrameProperties */ struct FrameProperties dataFrameProperties[?];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberSequences</td><td>Number of sequences.</td><td>uint16_t</td></tr>
<tr><td>numberFrames</td><td>Number of frames.</td><td>uint16_t</td></tr>
<tr><td>offsetDataSequences</td><td>Offset to the sequence data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>offsetDataFrame</td><td>Offset to the frame data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>offsetDataFrameProperties</td><td>Offset to the frame property data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>unknown0</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>unknown1</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>dataSequences</td><td>Animated object data.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#sequence">Sequence[]</a></td></tr>
<tr><td>dataFrames</td><td>Frame configuration data. Duration in frames and an index to the properties.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">Frame[]</a></td></tr>
<tr><td>dataFrameProperties</td><td>Current (multi) cell index and affine transformation data, depends on the sequence.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame-properties">FrameProperties[]</a></td></tr>
</tbody></table>
</div>
<h3 id="sequence"><a class="header" href="#sequence">Sequence</a></h3>
<pre><code class="language-c">struct Sequence
{
    /* 0x0 */ uint32_t numberFrames;
    /* 0x4 */ uint16_t animationType;
    /* 0x6 */ uint16_t cellType;
    /* 0x8 */ uint32_t loopMode;
    /* 0xC */ uint32_t offsetFrame;
}; // entry size = 0x10
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberFrames</td><td>Refers to the count of <a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">frame-blocks</a> used in this sequence.</td><td>uint32_t</td></tr>
<tr><td>animationType</td><td><code>0x0</code> = sequence, <code>0x1</code> = affine transform, <code>0x2</code> = translation.</td><td>uint16_t</td></tr>
<tr><td>cellType</td><td><code>0x1</code> = unique cell, <code>0x2</code> = multi cell.</td><td>uint16_t</td></tr>
<tr><td>loopMode</td><td>Behaviour of the frame sequence, values are documented in <a href="universal/resources/nitro/graphics_2d/section_abnk.html#loop-mode">Loop Mode</a>.</td><td>uint32_t</td></tr>
<tr><td>offsetFrame</td><td>Offset to the first used frame, relative to <code>offsetDataFrame</code>.</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<h3 id="frame"><a class="header" href="#frame">Frame</a></h3>
<pre><code class="language-c">struct Frame
{
    /* 0x0 */ uint32_t offsetProperties;
    /* 0x4 */ uint16_t durationInFrames;
    /* 0x6 */ int16_t unknown0;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>offsetProperties</td><td>Offset to the first used frame property, relative to <code>offsetDataFrameProperties</code>.</td><td>uint32_t</td></tr>
<tr><td>durationInFrames</td><td>Number of frames remaining in this state, 60 frames per second.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Always <code>0xBEEF</code>.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<h3 id="frame-properties"><a class="header" href="#frame-properties">Frame Properties</a></h3>
<pre><code class="language-c">// if animationType == 0
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
}; // entry size = 0x2

// if animationType == 1
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
    /* 0x2 */ uint16_t rotate;
    /* 0x4 */ fx&lt;1.19.12&gt; scaleW;
    /* 0x8 */ fx&lt;1.19.12&gt; scaleH;
    /* 0xC */ int16_t translateX;
    /* 0xE */ int16_t translateY;
}; // entry size = 0x10

// if animationType == 2
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
    /* 0x2 */ uint16_t unknown0;
    /* 0x4 */ int16_t translateX;
    /* 0x6 */ int16_t translateY;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>cellIndex</td><td>Index of the displayed cell or multi cell block.</td><td>uint16_t</td></tr>
<tr><td>rotate</td><td>Rotation angle, using the full range of uint16_t for one turn.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Unused, <code>0x0</code> or <code>0xBEEF</code>.</td><td>uint16_t</td></tr>
<tr><td>scaleW</td><td>Width scaling factor.</td><td><a href="universal/resources/nitro/graphics_2d/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>scaleH</td><td>Height scaling factor.</td><td><a href="universal/resources/nitro/graphics_2d/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>translateX</td><td>X position adjustment.</td><td>int16_t</td></tr>
<tr><td>translateY</td><td>Y position adjustment.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<p><strong>Important:</strong> The structs for <code>animationType &gt; 0</code> must be DWORD aligned. If there is a region with an odd number of type-0 properties, a dummy entry is appended as padding.</p>
<hr />
<h2 id="specification-8"><a class="header" href="#specification-8">Specification</a></h2>
<h3 id="animation"><a class="header" href="#animation">Animation</a></h3>
<p>To animate a sprite, three data blocks are required.</p>
<ol>
<li>The entry point is the <a href="universal/resources/nitro/graphics_2d/section_abnk.html#sequence">sequence data</a>. This defines the gereral properties of a sequence. How many different frames are involved? Are transformations applied or does the animation only rely on changing images? This decision is applyed to all frames, which are part of the sequence.</li>
<li>The <a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">frame data</a> tells, how long the image remains in this state. On a 60 fps system, setting it to 60 frames (<code>0x3C</code>) makes it last one second before switching to the next frame. It also points to an offset in the frame property data. To save memory, multiple frames can point to the same property offset.</li>
<li>The structure of the <a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame-properties">frame properties</a> depends on the <code>animationType</code> setting from the sequence data. If it is <code>== 0</code>, all it does is displaying the selected cell. If it is <code>== 2</code>, the position can also be changed. <code>animationType == 1</code> also adds scaling and rotation.</li>
</ol>
<p>If the animation is applied to a normal cell bank, the image in each frame is static, meaning if one frame is set to remain for one second and the transformation is rotate 180°, the image will be displayed upside down for one second. If the animation is applied to multi cells, which already have animated parts, it will loop through the animations of the multi cell, while &quot;being upside down&quot;.</p>
<h3 id="loop-mode"><a class="header" href="#loop-mode">Loop Mode</a></h3>
<p>The loop mode defines what to do, after the animation reached its last frame. There are four values, which can be used:</p>
<ol>
<li>Stop animation at last frame.</li>
<li>Repeat animation after last frame.</li>
<li>Play frames backwards after reaching the last frame and stop at first frame.</li>
<li>Ping pong mode, repeat alternately forward and backward.</li>
</ol>
<p>Other values are not supported and end up in the behavior of <code>1</code>.</p>
<h3 id="affine-transformation"><a class="header" href="#affine-transformation">Affine Transformation</a></h3>
<p>The transformation matrices are applied in the following order:</p>
<ol>
<li>Scaling</li>
</ol>
<p>$$
\begin{bmatrix}
\textbf{scaleW} &amp; 0               &amp; 0 \
0               &amp; \textbf{scaleH} &amp; 0 \
0               &amp; 0               &amp; 1 \
\end{bmatrix}
$$</p>
<ol start="2">
<li>Rotatating (adjust <code>rotate</code> first)</li>
</ol>
<p>$$
\begin{bmatrix}
cos(\textbf{rotate}) &amp; -sin(\textbf{rotate}) &amp; 0 \
sin(\textbf{rotate}) &amp; cos(\textbf{rotate})  &amp; 0 \
0                    &amp; 0                     &amp; 1 \
\end{bmatrix}
$$</p>
<ol start="3">
<li>Translating</li>
</ol>
<p>$$
\begin{bmatrix}
1 &amp; 0 &amp; \textbf{translateX} \
0 &amp; 1 &amp; \textbf{translateY} \
0 &amp; 0 &amp; 1                   \
\end{bmatrix}
$$</p>
<h3 id="files-2"><a class="header" href="#files-2">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html">Nitro Multi Animation Runtime</a></li>
</ul>
<hr />
<h2 id="todo-5"><a class="header" href="#todo-5">TODO</a></h2>
<ul>
<li>Link fixed point definition</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="labl-lbal---label"><a class="header" href="#labl-lbal---label">LABL (&quot;LBAL&quot;) - Label</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCER(N. Cell R.)--&gt;G2D(Graphics 2D);
    NANR(N. Animation R.)--&gt;G2D;
    NMAR(N. Multi Animation R.)--&gt;G2D;
    LABL(Label)--&gt;NCER;
    LABL--&gt;NANR;
    LABL--&gt;NMAR;
</pre>
<p>Gives names to all cells or objects.</p>
<h2 id="table-of-contents-28"><a class="header" href="#table-of-contents-28">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#labl-container">LABL Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-9"><a class="header" href="#data-structure-9">Data Structure</a></h2>
<h3 id="section-container-3"><a class="header" href="#section-container-3">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionLABL
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerLABL sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;LBAL&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_labl.html#labl-container">ContainerLABL</a></td></tr>
</tbody></table>
</div>
<h3 id="labl-container"><a class="header" href="#labl-container">LABL Container</a></h3>
<pre><code class="language-c">struct ContainerLABL
{
    // header
    // ...empty
    
    // data
    /* 0x0    */ uint32_t dataOffsetTable[numberLabels];
    /* append */ uint8_t* dataLabel[numberLabels];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>dataOffsetTable</td><td>Offset to the start of a string. Relative to <code>dataLabel</code>.</td><td>uint32_t[]</td></tr>
<tr><td>dataLabel</td><td>UTF-8 text-string, zero-terminated.</td><td>uint8_t*[]</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-9"><a class="header" href="#specification-9">Specification</a></h2>
<h3 id="files-3"><a class="header" href="#files-3">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html">Nitro Multi Animation Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="uext-txeu---use-extension"><a class="header" href="#uext-txeu---use-extension">UEXT (&quot;TXEU&quot;) - (Use Extension?)</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCER(N. Cell R.)--&gt;G2D(Graphics 2D);
    NANR(N. Animation R.)--&gt;G2D;
    UEXT(Use Extension?)--&gt;NCER;
    UEXT--&gt;NANR;
</pre>
<p>Holds a value which tells, if a &quot;multi-version&quot; of the cell or animation runtime will be applied.</p>
<h2 id="table-of-contents-29"><a class="header" href="#table-of-contents-29">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#uext-container">UEXT Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-10"><a class="header" href="#data-structure-10">Data Structure</a></h2>
<h3 id="section-container-4"><a class="header" href="#section-container-4">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionUEXT
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerUEXT sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;TXEU&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_uext.html#uext-container">ContainerUEXT</a></td></tr>
</tbody></table>
</div>
<h3 id="uext-container"><a class="header" href="#uext-container">UEXT Container</a></h3>
<pre><code class="language-c">struct ContainerUEXT
{
    // header
    // ...empty
    
    // data
    /* 0x0 */ uint32_t extended; // or is it one byte + padding?
}; // entry size = 0x4
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>extended</td><td>Enable multicell?</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-10"><a class="header" href="#specification-10">Specification</a></h2>
<h3 id="files-4"><a class="header" href="#files-4">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nclr-rlcn---nitro-color-runtime"><a class="header" href="#nclr-rlcn---nitro-color-runtime">NCLR (&quot;RLCN&quot;) - Nitro Color Runtime</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCLR(N. Color R.)--&gt;G2D(Graphics 2D);
    PLTT(Palette)--&gt;NCLR;
    PCMP(Palette Count Map)-.-&gt;NCLR;
</pre>
<p>The color runtime serves as base for all other 2D graphics components. It provides color palettes which are accessed via indexing. The count map (PCMP) is optional and sometimes used to limit the number of individual palettes. One palette can have either 16 or 256 colors. The number of colors is the same in all palettes of one file. </p>
<h2 id="table-of-contents-30"><a class="header" href="#table-of-contents-30">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nclr.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nclr.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/file_nclr.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nclr.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-11"><a class="header" href="#data-structure-11">Data Structure</a></h2>
<h3 id="file-container-2"><a class="header" href="#file-container-2">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNCLR
{
    /* 0x00   */ struct NitroFileHeader fileHeader;
    /* 0x10   */ struct ContainerSectionPLTT palette;
    /* append */ struct ContainerSectionPCMP countMap; // optional
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;RLCN&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>palette</td><td>Palette color data.</td><td><a href="universal/resources/nitro/graphics_2d/section_pltt.html#section-container">ContainerSectionPLTT</a></td></tr>
<tr><td>countMap</td><td>Palette count limiter. Does only exist if <code>fileHeader.numberSections == 2</code>.</td><td><a href="universal/resources/nitro/graphics_2d/section_pcmp.html#section-container">ContainerSectionPCMP</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-11"><a class="header" href="#specification-11">Specification</a></h2>
<h3 id="sections-2"><a class="header" href="#sections-2">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html">Palette</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_pcmp.html">Palette Count Map</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pltt-ttlp---palette"><a class="header" href="#pltt-ttlp---palette">PLTT (&quot;TTLP&quot;) - Palette</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a>, <a href="https://github.com/Gonhex">Gonhex</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCLR(N. Color R.)--&gt;G2D(Graphics 2D);
    PLTT(Palette)--&gt;NCLR;
</pre>
<p>The palette section holds a table with all colors used in the sprite(s). The color information is squeezed into one WORD resulting in five bits per component (r, g, b) and one unused bit.</p>
<h2 id="table-of-contents-31"><a class="header" href="#table-of-contents-31">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#pltt-container">PLTT Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#palette">Palette</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#color-rgb5">Color RGB5</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#palette-dimension-configuration">Palette Dimension Configuration</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_pltt.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-12"><a class="header" href="#data-structure-12">Data Structure</a></h2>
<h3 id="section-container-5"><a class="header" href="#section-container-5">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionPLTT
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerPLTT sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;TTLP&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_pltt.html#pltt-container">ContainerPLTT</a></td></tr>
</tbody></table>
</div>
<h3 id="pltt-container"><a class="header" href="#pltt-container">PLTT Container</a></h3>
<pre><code class="language-c">struct ContainerPLTT
{
    // header
    /* 0x0 */ uint64_t dimensions;
    /* 0x8 */ uint32_t lengthDataColor;
    /* 0xC */ uint32_t offsetDataColor;
    
    // data
    /* offsetDataColor */ struct Palette dataPalette[numberPalettes];
}; // entry size = lengthDataColor + offsetDataColor
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>dimensions</td><td>Palette configuration. Defines the max number of palettes and colors per palette.</td><td><a href="universal/resources/nitro/graphics_2d/section_pltt.html#palette-dimension-configuration">uint64_t</a></td></tr>
<tr><td>lengthDataColor</td><td>Length of the color data section in bytes.</td><td>uint32_t</td></tr>
<tr><td>offsetDataColor</td><td>Offset to the color data section relative to <code>ContainerPLTT</code>.</td><td>uint32_t</td></tr>
<tr><td>dataPalette</td><td>Array of palettes holding the colors. <code>numberPalettes</code> can be everything from <code>1</code> to <code>16</code>.</td><td><a href="universal/resources/nitro/graphics_2d/section_pltt.html#palette">Palette[]</a></td></tr>
</tbody></table>
</div>
<h3 id="palette"><a class="header" href="#palette">Palette</a></h3>
<pre><code class="language-c">struct Palette
{
    /* 0x0 */ struct ColorRGB5 color[numberColors];
}; // entry size = numberColors * 2
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>color</td><td>Array of compressed RGB colors. <code>numberColors</code> is either <code>0x10 = 16</code>, or <code>0x100 = 256</code>.</td><td><a href="universal/resources/nitro/graphics_2d/section_pltt.html#color-rgb5">ColorRGB5[]</a></td></tr>
</tbody></table>
</div>
<h3 id="color-rgb5"><a class="header" href="#color-rgb5">Color RGB5</a></h3>
<pre><code class="language-c">struct ColorRGB5
{
    /* 0x00 */ uint16_t red : 5;   // 0b00000000'00011111
               uint16_t green : 5; // 0b00000011'11100000
               uint16_t blue : 5;  // 0b01111100'00000000
}; // entry size = 0x2
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>red</td><td>Red color component, <code>uint8_t displayRed = red &lt;&lt; 3;</code>.</td><td>uint16_t : 5</td></tr>
<tr><td>green</td><td>Green color component, <code>uint8_t displayGreen = green &lt;&lt; 3;</code>.</td><td>uint16_t : 5</td></tr>
<tr><td>blue</td><td>Blue color component, <code>uint8_t displayBlue = blue &lt;&lt; 3;</code>.</td><td>uint16_t : 5</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-12"><a class="header" href="#specification-12">Specification</a></h2>
<h3 id="palette-dimension-configuration"><a class="header" href="#palette-dimension-configuration">Palette Dimension Configuration</a></h3>
<p>The first eight bytes in <a href="universal/resources/nitro/graphics_2d/section_pltt.html#pltt-container">ContainerPLTT</a> are marked as <code>dimensions</code>. This is related to the number and size of the palettes within this PLTT section. Since the result of reading the raw value is not clear, an enumeration type has been defined:</p>
<pre><code class="language-c">enum DimensionPalette : uint64_t
{
    PALETTE1_COLOR16 = 0x00000000'000A0004ULL,  // 1 palette, 16 colors
    PALETTE1_COLOR256 = 0x00000000'00000004ULL, // 1 palette, 256 colors
    PALETTE16_COLOR16 = 0x00000000'00000003ULL, // max. 16 palettes, 16 colors
    PALETTE16_COLOR256 = 0x00000001'00000004ULL // max. 16 palettes, 256 colors
};
</code></pre>
<p>This serves as a lookup table with four possible values. The number of colors per palette is set to either 16 or 256. The number of palettes can be limited to a lower value by the <a href="universal/resources/nitro/graphics_2d/section_pcmp.html">count map</a>, if it is set to 16.</p>
<h3 id="files-5"><a class="header" href="#files-5">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nclr.html">Nitro Color Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pcmp-pmcp---palette-compression"><a class="header" href="#pcmp-pmcp---palette-compression">PCMP (&quot;PMCP&quot;) - Palette Compression</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCLR(N. Color R.)--&gt;G2D(Graphics 2D);
    PCMP(Palette Count Map)-.-&gt;NCLR;
</pre>
<p>The palette compression is an optional component for the color runtime. It reduces the number of palettes, if the palette section allows 16 of them. Useful to save memory but not often used.</p>
<h2 id="table-of-contents-32"><a class="header" href="#table-of-contents-32">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_pcmp.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_pcmp.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_pcmp.html#pcmp-container">PCMP Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_pcmp.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_pcmp.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-13"><a class="header" href="#data-structure-13">Data Structure</a></h2>
<h3 id="section-container-6"><a class="header" href="#section-container-6">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionPCMP
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerPCMP sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;PMCP&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_pcmp.html#pcmp-container">ContainerPCMP</a></td></tr>
</tbody></table>
</div>
<h3 id="pcmp-container"><a class="header" href="#pcmp-container">PCMP Container</a></h3>
<pre><code class="language-c">struct ContainerPCMP
{
    // header
    /* 0x0 */ uint16_t numberPalettes;
    /* 0x2 */ uint16_t unknown0;
    /* 0x4 */ uint32_t offsetDataIndices;
    
    // data
    /* offsetDataIndices */ uint16_t dataIndices[numberPalettes];
}; // entry size = numberPalettes * 2 + offsetDataIndices
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberPalettes</td><td>Limits the number of palettes used in the <a href="universal/resources/nitro/graphics_2d/section_pltt.html">PLTT section</a>.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Always <code>0xBEEF</code>.</td><td>uint16_t</td></tr>
<tr><td>offsetDataIndices</td><td>Offset to the index table relative to <code>ContainerPCMP</code>.</td><td>uint32_t</td></tr>
<tr><td>dataIndices</td><td>Index table, incrementing from <code>0</code>. The data may have no effect on the palettes.</td><td>uint16_t[]</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-13"><a class="header" href="#specification-13">Specification</a></h2>
<h3 id="files-6"><a class="header" href="#files-6">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nclr.html">Nitro Color Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ncer-recn---nitro-cell-runtime"><a class="header" href="#ncer-recn---nitro-cell-runtime">NCER (&quot;RECN&quot;) - Nitro Cell Runtime</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCER(N. Cell R.)--&gt;G2D(Graphics 2D);
    CEBK(Cell Bank)--&gt;NCER;
    LABL(Label)--&gt;NCER;
    UEXT(Use Extension?)--&gt;NCER;
</pre>
<p>The cell runtime creates groups of tiles which will be displayed as small images. The cells can serve as base for frame animations.</p>
<h2 id="table-of-contents-33"><a class="header" href="#table-of-contents-33">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-14"><a class="header" href="#data-structure-14">Data Structure</a></h2>
<h3 id="file-container-3"><a class="header" href="#file-container-3">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNCER
{
    /* 0x00   */ struct NitroFileHeader fileHeader;
    /* 0x10   */ struct ContainerSectionCEBK sectionDataCEBK;
    /* append */ struct ContainerSectionLABL sectionDataLABL;
    /* append */ struct ContainerSectionLABL sectionDataUEXT;
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;RECN&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>sectionDataCEBK</td><td>Cell image data.</td><td><a href="universal/resources/nitro/graphics_2d/section_cebk.html#section-container">ContainerSectionCEBK</a></td></tr>
<tr><td>sectionDataLABL</td><td>Cell-name table.</td><td><a href="universal/resources/nitro/graphics_2d/section_labl.html#section-container">ContainerSectionLABL</a></td></tr>
<tr><td>sectionDataUEXT</td><td>Cluster flag.</td><td><a href="universal/resources/nitro/graphics_2d/section_uext.html#section-container">ContainerSectionUEXT</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-14"><a class="header" href="#specification-14">Specification</a></h2>
<h3 id="sections-3"><a class="header" href="#sections-3">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html">Cell Bank</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html">Label</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html">Use Extension?</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cebk-kbec---cell-bank"><a class="header" href="#cebk-kbec---cell-bank">CEBK (&quot;KBEC&quot;) - Cell Bank</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a>, <a href="https://github.com/Gonhex">Gonhex</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCER(N. Cell R.)--&gt;G2D(Graphics 2D);
    CEBK(Cell Bank)--&gt;NCER;
</pre>
<p>The cell bank creates a number of cells by combining tiles and selecting a palette for each cell. It usually operates on dimensionless (1D mapped) character graphics and is used in combination with the animation runtime to display dynamic objects.</p>
<h2 id="table-of-contents-34"><a class="header" href="#table-of-contents-34">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#cebk-container">CEBK Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#cell">Cell</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#object-attributes">Object Attributes</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#dimension-keys">Dimension Keys</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#files">Files</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_cebk.html#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-structure-15"><a class="header" href="#data-structure-15">Data Structure</a></h2>
<h3 id="section-container-7"><a class="header" href="#section-container-7">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionCEBK
{
    /* 0x0    */ struct NitroSectionHeader sectionHeader;
    /* 0x8    */ struct ContainerCEBK sectionData;
    /* append */ uint8_t paddingDWORD[?];
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;KBEC&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_cebk.html#cebk-container">ContainerCEBK</a></td></tr>
<tr><td>paddingDWORD</td><td>Padding for DWORD alignment, if <a href="universal/resources/nitro/graphics_2d/section_labl.html">LABL-section</a> follows.</td><td>uint8_t[]</td></tr>
</tbody></table>
</div>
<h3 id="cebk-container"><a class="header" href="#cebk-container">CEBK Container</a></h3>
<pre><code class="language-c">struct ContainerCEBK
{
    // header
    /* 0x00 */ uint16_t numberCells;
    /* 0x02 */ uint16_t useBounds;      // rename?
    /* 0x04 */ uint32_t offsetDataCell;
    /* 0x08 */ uint32_t sizeBoundary;
    /* 0x0C */ uint32_t unknown0;
    /* 0x10 */ uint32_t unknown1;
    /* 0x14 */ uint32_t unknown2;
    
    // data
    /* offsetDataCell */ struct Cell dataCell[numberCells];
    /* offsetDataCell + numberCells * (8 &lt;&lt; useBounds) */ struct ObjectAttribute dataAttributes[?];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberCells</td><td>Number of cells.</td><td>uint16_t</td></tr>
<tr><td>useBounds</td><td>Extended <a href="universal/resources/nitro/graphics_2d/section_cebk.html#cell">cell struct</a>, if <code>== 1</code>.</td><td>uint16_t</td></tr>
<tr><td>offsetDataCell</td><td>Offset to the cell table data section relative to <code>ContainerCEBK</code>.</td><td>uint32_t</td></tr>
<tr><td>sizeBoundary</td><td>Size boundary, <code>result = sizeBoundary &lt;&lt; 6</code>.</td><td>uint32_t</td></tr>
<tr><td>unknown0</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>unknown1</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>unknown2</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>dataCell</td><td>Cell configuration table.</td><td><a href="universal/resources/nitro/graphics_2d/section_cebk.html#cell">Cell[]</a></td></tr>
<tr><td>dataAttributes</td><td>Object attributes.</td><td><a href="universal/resources/nitro/graphics_2d/section_cebk.html#object-attributes">ObjectAttribute[]</a></td></tr>
</tbody></table>
</div>
<h3 id="cell"><a class="header" href="#cell">Cell</a></h3>
<pre><code class="language-c">struct Cell
{
    // header
    /* 0x0 */ uint16_t numberObjects;
    /* 0x2 */ uint8_t unknown0;
    /* 0x3 */ uint8_t unknown1;
    /* 0x4 */ uint32_t offsetObject;
// }; // entry size = 0x8, if useBounds == 0
    
    // optional. Are they redundant even if used?
    /* 0x8 */ int16_t boundRight;
    /* 0xA */ int16_t boundBottom;
    /* 0xC */ int16_t boundLeft;
    /* 0xE */ int16_t boundTop;
}; // entry size = 0x10, if useBounds == 1
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberObjects</td><td>Number of objects building this cell.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>What is this?</td><td>uint8_t</td></tr>
<tr><td>unknown1</td><td>What is this?</td><td>uint8_t</td></tr>
<tr><td>offsetObject</td><td>Offset within object attribute data.</td><td>uint32_t</td></tr>
<tr><td>boundRight</td><td>Right border of the cell.</td><td>int16_t</td></tr>
<tr><td>boundBottom</td><td>Bottom border of the cell.</td><td>int16_t</td></tr>
<tr><td>boundLeft</td><td>Left border of the cell.</td><td>int16_t</td></tr>
<tr><td>boundTop</td><td>Top border of the cell.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<h3 id="object-attributes"><a class="header" href="#object-attributes">Object Attributes</a></h3>
<pre><code class="language-c">struct ObjectAttribute
{
    /* 0x0 */ uint16_t positionY : 8;          // 0b00000000'11111111
              uint16_t transformable : 1;      // 0b00000001'00000000
              uint16_t doubleSized : 1;        // 0b00000010'00000000
              uint16_t objectMode : 2;         // 0b00001100'00000000
              uint16_t mosaic : 1;             // 0b00010000'00000000
              uint16_t paletteMode : 1;        // 0b00100000'00000000
              uint16_t keyShape : 2;           // 0b11000000'00000000
    
    /* 0x2 */ uint16_t positionX : 9;          // 0b00000001'11111111
              uint16_t transformParameter : 3; // 0b00001110'00000000
              uint16_t horizontalFlip : 1;     // 0b00010000'00000000
              uint16_t verticalFlip : 1;       // 0b00100000'00000000
              uint16_t keySize : 2;            // 0b11000000'00000000
    
    /* 0x4 */ uint16_t tileIndex : 10;         // 0b00000011'11111111
              uint16_t priority : 2;           // 0b00001100'00000000
              uint16_t paletteIndex : 4;       // 0b11110000'00000000
}; // entry size = 0x6
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>positionY</td><td>Y position, cast to a signed value.</td><td>uint16_t : 8</td></tr>
<tr><td>transformable</td><td>Enable flag for affine transformations.</td><td>uint16_t : 1</td></tr>
<tr><td>doubleSized</td><td>Double the size transformable. Not displayed if this flag is used without transformable.</td><td>uint16_t : 1</td></tr>
<tr><td>objectMode</td><td><code>0</code> = normal, <code>1</code> = semi-transparent, <code>2</code> = OBJ window, <code>3</code> is not allowed.</td><td>uint16_t : 2</td></tr>
<tr><td>mosaic</td><td>Enable mosaic.</td><td>uint16_t : 1</td></tr>
<tr><td>paletteMode</td><td>Select type of the palette. <code>0</code>= 16 colors, <code>1</code> = 256 colors per palette.</td><td>uint16_t : 1</td></tr>
<tr><td>keyShape</td><td>Shape: <code>0</code> = square, <code>1</code> = horizontal, <code>2</code> = vertical, <code>3</code> is not allowed. See <a href="universal/resources/nitro/graphics_2d/section_cebk.html#dimension-keys">Dimension Keys</a>.</td><td>uint16_t : 2</td></tr>
<tr><td>positionX</td><td>X position, cast to a signed value.</td><td>uint16_t : 9</td></tr>
<tr><td>transformParameter</td><td>(TODO) Currently not documented here. Read about it on <a href="https://problemkaputt.de/gbatek.htm#lcdobjoamattributes">GBATEK</a>.</td><td>uint16_t : 3</td></tr>
<tr><td>horizontalFlip</td><td>Flip horizontally, if enabled.</td><td>uint16_t : 1</td></tr>
<tr><td>verticalFlip</td><td>Flip vertically, if enabled.</td><td>uint16_t : 1</td></tr>
<tr><td>keySize</td><td>Used to get the size of the OAM cell, see <a href="universal/resources/nitro/graphics_2d/section_cebk.html#dimension-keys">Dimension Keys</a>.</td><td>uint16_t : 2</td></tr>
<tr><td>tileIndex</td><td>Index of the tile selecten from the <a href="universal/resources/nitro/graphics_2d/file_ncgr.html">character graphic</a>.</td><td>uint16_t : 10</td></tr>
<tr><td>priority</td><td>Display priority if overlapping. Lower value = higher priority.</td><td>uint16_t : 2</td></tr>
<tr><td>paletteIndex</td><td>Index of the palette used for this OAM cell.</td><td>uint16_t : 4</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-15"><a class="header" href="#specification-15">Specification</a></h2>
<h3 id="dimension-keys"><a class="header" href="#dimension-keys">Dimension Keys</a></h3>
<p>The width and height of an object isn't defined directly. Instead it uses key values, which allow to reconstruct the size. For example if <code>keyShape == 0</code>, the cell will be a square which size depends on <code>keySize</code>. The dimenions can be converted using lookup tables.</p>
<h4 id="read-dimensions"><a class="header" href="#read-dimensions">Read dimensions</a></h4>
<pre><code class="language-c">const uint16_t tableSizeInTiles[4][4] = // [keyShape][keySize]
{
    { 1, 2, 4, 8 },
    { 2, 4, 4, 8 },
    { 1, 1, 2, 4 },
    { 1, 2, 4, 8 } // copy of row 0 for reversed index (3 - shape)
};

uint16_t getWidthInTiles()
{
    return tableSizeInTiles[keyShape][keySize];
}

uint16_t getHeightInTiles()
{
    return tableSizeInTiles[3 - keyShape][keySize];
}
</code></pre>
<h4 id="write-dimensions"><a class="header" href="#write-dimensions">Write dimensions</a></h4>
<pre><code class="language-c">const uint16_t tableShape[4][4] = // [width][height]
{   //h1 h2 h4 h8
    { 0, 2, 2, 0 },//w1
    { 1, 0, 2, 0 },//w2
    { 1, 1, 0, 2 },//w4
    { 0, 0, 1, 0 } //w8
};

const uint16_t tableSize[4][4] = // [width][height]
{   //h1 h2 h4 h8
    { 0, 0, 1, 0 },//w1
    { 0, 1, 2, 0 },//w2
    { 1, 2, 2, 3 },//w4
    { 0, 0, 3, 3 } //w8
};

void setSizeInTiles(uint16_t widthInTiles, uint16_t heightInTiles)
{
    const uint16_t width = (widthInTiles &gt;= 8) ? 3 : (widthInTiles &gt;&gt; 1);
    const uint16_t height = (heightInTiles &gt;= 8) ? 3 : (heightInTiles &gt;&gt; 1);
    
    keySize = tableSize[width][height];
    keyShape = tableShape[width][height];
}
</code></pre>
<h3 id="files-7"><a class="header" href="#files-7">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime</a></li>
</ul>
<hr />
<h2 id="todo-6"><a class="header" href="#todo-6">TODO</a></h2>
<ul>
<li>Document the <a href="universal/resources/nitro/graphics_2d/section_cebk.html#object-attributes">transform parameters</a>. <code>transformParameter</code> may also need to be fused with <code>horizontalFlip</code> and <code>verticalFlip</code>, from <code>uint16_t : 3</code> to <code>uint16_t : 5</code>.</li>
<li>Research <code>unknown0</code> and <code>unknown1</code> in <a href="universal/resources/nitro/graphics_2d/section_cebk.html#cell">cell</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="labl-lbal---label-1"><a class="header" href="#labl-lbal---label-1">LABL (&quot;LBAL&quot;) - Label</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCER(N. Cell R.)--&gt;G2D(Graphics 2D);
    NANR(N. Animation R.)--&gt;G2D;
    NMAR(N. Multi Animation R.)--&gt;G2D;
    LABL(Label)--&gt;NCER;
    LABL--&gt;NANR;
    LABL--&gt;NMAR;
</pre>
<p>Gives names to all cells or objects.</p>
<h2 id="table-of-contents-35"><a class="header" href="#table-of-contents-35">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#labl-container">LABL Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-16"><a class="header" href="#data-structure-16">Data Structure</a></h2>
<h3 id="section-container-8"><a class="header" href="#section-container-8">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionLABL
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerLABL sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;LBAL&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_labl.html#labl-container">ContainerLABL</a></td></tr>
</tbody></table>
</div>
<h3 id="labl-container-1"><a class="header" href="#labl-container-1">LABL Container</a></h3>
<pre><code class="language-c">struct ContainerLABL
{
    // header
    // ...empty
    
    // data
    /* 0x0    */ uint32_t dataOffsetTable[numberLabels];
    /* append */ uint8_t* dataLabel[numberLabels];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>dataOffsetTable</td><td>Offset to the start of a string. Relative to <code>dataLabel</code>.</td><td>uint32_t[]</td></tr>
<tr><td>dataLabel</td><td>UTF-8 text-string, zero-terminated.</td><td>uint8_t*[]</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-16"><a class="header" href="#specification-16">Specification</a></h2>
<h3 id="files-8"><a class="header" href="#files-8">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html">Nitro Multi Animation Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="uext-txeu---use-extension-1"><a class="header" href="#uext-txeu---use-extension-1">UEXT (&quot;TXEU&quot;) - (Use Extension?)</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCER(N. Cell R.)--&gt;G2D(Graphics 2D);
    NANR(N. Animation R.)--&gt;G2D;
    UEXT(Use Extension?)--&gt;NCER;
    UEXT--&gt;NANR;
</pre>
<p>Holds a value which tells, if a &quot;multi-version&quot; of the cell or animation runtime will be applied.</p>
<h2 id="table-of-contents-36"><a class="header" href="#table-of-contents-36">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#uext-container">UEXT Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_uext.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-17"><a class="header" href="#data-structure-17">Data Structure</a></h2>
<h3 id="section-container-9"><a class="header" href="#section-container-9">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionUEXT
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerUEXT sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;TXEU&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_uext.html#uext-container">ContainerUEXT</a></td></tr>
</tbody></table>
</div>
<h3 id="uext-container-1"><a class="header" href="#uext-container-1">UEXT Container</a></h3>
<pre><code class="language-c">struct ContainerUEXT
{
    // header
    // ...empty
    
    // data
    /* 0x0 */ uint32_t extended; // or is it one byte + padding?
}; // entry size = 0x4
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>extended</td><td>Enable multicell?</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-17"><a class="header" href="#specification-17">Specification</a></h2>
<h3 id="files-9"><a class="header" href="#files-9">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ncgr-rgcn---nitro-character-graphic-runtime"><a class="header" href="#ncgr-rgcn---nitro-character-graphic-runtime">NCGR (&quot;RGCN&quot;) - Nitro Character Graphic Runtime</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCGR(N. Character Graphic R.)--&gt;G2D(Graphics 2D);
    CHAR(Character)--&gt;NCGR;
    CPOS(Caracter Position?)-.-&gt;NCGR;
</pre>
<p>The character graphic runtime holds the image data, usually in form of tiles. The image can be displayed directly or used as tile buffer for further processing as <a href="universal/resources/nitro/graphics_2d/file_nscr.html">screen map</a> or <a href="universal/resources/nitro/graphics_2d/file_ncer.html">cells</a>.</p>
<h2 id="table-of-contents-37"><a class="header" href="#table-of-contents-37">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncgr.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncgr.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/file_ncgr.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncgr.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-18"><a class="header" href="#data-structure-18">Data Structure</a></h2>
<h3 id="file-container-4"><a class="header" href="#file-container-4">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNCGR
{
    /* 0x00   */ struct NitroFileHeader fileHeader;
    /* 0x10   */ struct ContainerSectionCHAR sectionDataCHAR;
    /* append */ struct ContainerSectionCPOS sectionDataCPOS; // optional
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;RGCN&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>sectionDataCHAR</td><td>Image data.</td><td><a href="universal/resources/nitro/graphics_2d/section_char.html#section-container">ContainerSectionCHAR</a></td></tr>
<tr><td>sectionDataCPOS</td><td>Dimension related. Does only exist if <code>fileHeader.numberSections == 2</code>.</td><td><a href="universal/resources/nitro/graphics_2d/section_cpos.html#section-container">ContainerSectionCPOS</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-18"><a class="header" href="#specification-18">Specification</a></h2>
<h3 id="sections-4"><a class="header" href="#sections-4">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html">Character</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_cpos.html">Character Position?</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="char-rhac---character"><a class="header" href="#char-rhac---character">CHAR (&quot;RHAC&quot;) - Character</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a>, <a href="https://github.com/Gonhex">Gonhex</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCGR(N. Character Graphic R.)--&gt;G2D(Graphics 2D);
    CHAR(Character)--&gt;NCGR;
</pre>
<p>The character section stores the sprite-image in form of indices to colors within a palette. The array layout is usually a tile map where each tile has a size of <code>8 * 8 pixels</code>, but can also be a line buffer which maps the image directly to the target.</p>
<h2 id="table-of-contents-38"><a class="header" href="#table-of-contents-38">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#char-container">CHAR Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#pixel-data">Pixel Data</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#dimensions">Dimensions</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#mapping-type">Mapping Type</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#flags">Flags</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#special-case">Special Case</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#files">Files</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_char.html#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-structure-19"><a class="header" href="#data-structure-19">Data Structure</a></h2>
<h3 id="section-container-10"><a class="header" href="#section-container-10">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionCHAR
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerCHAR sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;RAHC&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_char.html#char-container">ContainerCHAR</a></td></tr>
</tbody></table>
</div>
<h3 id="char-container"><a class="header" href="#char-container">CHAR Container</a></h3>
<pre><code class="language-c">struct ContainerCHAR
{
    // header
    /* 0x00 */ int16_t heightInTiles;
    /* 0x02 */ int16_t widthInTiles;
    /* 0x04 */ uint32_t pixelFormat;
    /* 0x08 */ uint16_t mappingType0;
    /* 0x0A */ uint16_t mappingType1;
    /* 0x0C */ uint32_t flags;
    /* 0x10 */ uint32_t lengthDataImage;
    /* 0x14 */ uint32_t offsetDataImage;
    
    // data
    /* offsetDataImage */ uint8_t dataImage[lengthDataImage];
}; // entry size = offsetDataImage + lengthDataImage
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>heightInTiles</td><td>Height of the sprite or <code>-1</code>, see <a href="universal/resources/nitro/graphics_2d/section_char.html#dimensions">Dimensions</a>.</td><td>int16_t</td></tr>
<tr><td>widthInTiles</td><td>Width of the sprite or <code>-1</code>, see <a href="universal/resources/nitro/graphics_2d/section_char.html#dimensions">Dimensions</a>.</td><td>int16_t</td></tr>
<tr><td>pixelFormat</td><td><code>== 3</code>: 4 bits per pixel. <code>== 4</code>: 8 bits per pixel.</td><td>uint32_t</td></tr>
<tr><td>mappingType0</td><td><code>== 0</code>: 2D mapping, else: 1D mapping(?).</td><td>uint16_t</td></tr>
<tr><td>mappingType1</td><td>Sometimes used in combination with <code>mappingType0</code>(?).</td><td>uint16_t</td></tr>
<tr><td>flags</td><td>Binary flags for different purposes. See <a href="universal/resources/nitro/graphics_2d/section_char.html#flags">Flags</a>.</td><td>uint32_t</td></tr>
<tr><td>lengthDataImage</td><td>Length of the image data section in bytes.</td><td>uint32_t</td></tr>
<tr><td>offsetDataImage</td><td>Offset to the image data section relative to <code>ContainerCHAR</code>.</td><td>uint32_t</td></tr>
<tr><td>dataImage</td><td>Array holding all color indices to create an image, see <a href="universal/resources/nitro/graphics_2d/section_char.html#pixel-data">Pixel Data</a>.</td><td>uint8_t[]</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-19"><a class="header" href="#specification-19">Specification</a></h2>
<h3 id="pixel-data"><a class="header" href="#pixel-data">Pixel Data</a></h3>
<h4 id="color"><a class="header" href="#color">Color</a></h4>
<p>The character graphic stores indices to colors on a <a href="universal/resources/nitro/graphics_2d/section_pltt.html">palette</a>. This palette provides either 16 or 256 colors. The density of indices depends on the palette size. For a value of <code>0...15</code> only 4 bits (1 nibble) are needed. This allows to squeeze two indices into one byte, reducing the overall size by half.</p>
<ul>
<li><code>pixelFormat == 3</code>: use 16 colors </li>
<li><code>pixelFormat == 4</code>: use 256 colors</li>
</ul>
<h4 id="layout"><a class="header" href="#layout">Layout</a></h4>
<p>The 2D engine uses a tile based system. The pixel layout in the file represents this and can be imagined as a box with a width of 8 pixels and an infinite length. The data is written line by line into this box. Each tile can now be accessed at <code>y * 8</code>. Now we have 1D mapped tiles. For 2D mapping these tiles are also layed out row by row.</p>
<p>If the image is to be used by the 3D engine, the &quot;infinite length box&quot; from before becomes a bitmap which has the dimensions of the image. There are no tiles in this case. </p>
<h3 id="dimensions"><a class="header" href="#dimensions">Dimensions</a></h3>
<p>The first two entries of <a href="universal/resources/nitro/graphics_2d/section_char.html#char-container">ContainerCHAR</a> define the size of the sprite in tiles. To get the pixel values, multiply them with the side length of a tile (which is 8).</p>
<p>$$
\begin{align}
height_{pixel} &amp;= heigh_{tiles}\cdot 8\
width_{pixel} &amp;= width_{tiles}\cdot 8
\end{align}
$$</p>
<p>Sometimes the width and height values are both set to <code>-1</code>. In this case the image itself has no size and the <a href="universal/resources/nitro/graphics_2d/section_cpos.html">CPOS section</a> is not part of the file. To display the sprite anyway, a width of four tiles often makes the image recognizable. The real image is constructed by the <a href="universal/resources/nitro/graphics_2d/file_ncer.html">cell runtime</a>, which picks the needed tiles and positions them.</p>
<h3 id="mapping-type"><a class="header" href="#mapping-type">Mapping Type</a></h3>
<p>These values are <code>0</code>, if the image uses 2D mapping (positive values in <code>heightInTiles</code> an <code>widhtInTiles</code>). Both dimension values <code>== -1</code> indicate 1D mapping. In this case <code>mappingType0</code> usually has a value like <code>0x10</code>. In the most cases, the <a href="universal/resources/nitro/graphics_2d/file_ncer.html">cell runtime</a> indexes 1D mapped tiles.</p>
<h3 id="flags"><a class="header" href="#flags">Flags</a></h3>
<p>Apply properties to the sprite.</p>
<ul>
<li><code>(flags &amp; 0x00000001) &gt; 0</code>: Use a line buffer instead of tiles.</li>
<li><code>(flags &amp; 0x00000100) &gt; 0</code>: Unknown. Maybe related to <a href="universal/resources/nitro/graphics_2d/section_char.html#mapping-type">Mapping Type</a>?</li>
</ul>
<h3 id="special-case"><a class="header" href="#special-case">Special Case</a></h3>
<p>There are sprites, which seem to breake some rules of the format. It looks like it applies to images with a width, that is not a power of two. Examples are the trainer and pokemon preview sprites in generation V games, which have a size of <code>10 * 10 tiles</code> for trainers and <code>12 * 12 tiles</code> for pokemon. There are three issues with these sprites:</p>
<h4 id="1-file-length"><a class="header" href="#1-file-length">1. File length</a></h4>
<p>The length specified in the <a href="universal/resources/nitro/graphics_2d/../nitro_overview.html">headers (both, file and section)</a> of the file/section does not match the actual length of the file/section. Instead, it assumes the image had side lengths of the next higher power-of-two-values.</p>
<h4 id="2-missing-cpos-section"><a class="header" href="#2-missing-cpos-section">2. Missing CPOS section</a></h4>
<p>Normally, if the image has a size, there should also be a <a href="universal/resources/nitro/graphics_2d/section_cpos.html">CPOS section</a> available within the file. Here this is not the case. Might be related to the wrong file length.</p>
<h4 id="3-image-layout"><a class="header" href="#3-image-layout">3. Image layout</a></h4>
<p>The tiles are not places line by line. Instead, it looks like the the largest square with power-of-two side lengths that fits into the image constrains is calculated and placed at the top left corner. Then, this process repeats with the remaining size making the comming squares smaller. Following figure illustrates this whith one <code>10 * 10 tiles</code> example (top) and one <code>12 * 12 tiles</code> (bottom):</p>
<p><img src="universal/resources/nitro/graphics_2d/resources/section_char/sprite_layout.png" alt="" /></p>
<h3 id="files-10"><a class="header" href="#files-10">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncgr.html">Nitro Character Graphic Runtime</a></li>
</ul>
<hr />
<h2 id="todo-7"><a class="header" href="#todo-7">TODO</a></h2>
<ul>
<li>Research and document &quot;mappingType&quot;</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cpos-sopc---character-position"><a class="header" href="#cpos-sopc---character-position">CPOS (&quot;SOPC&quot;) - (Character Position?)</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCGR(N. Character Graphic R.)--&gt;G2D(Graphics 2D);
    CPOS(Character Position?)-.-&gt;NCGR;
</pre>
<p>This section does only exist, if the character image has a specified size. The purpose is not clear.</p>
<h2 id="table-of-contents-39"><a class="header" href="#table-of-contents-39">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_cpos.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_cpos.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_cpos.html#cpos-container">CPOS Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_cpos.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_cpos.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-20"><a class="header" href="#data-structure-20">Data Structure</a></h2>
<h3 id="section-container-11"><a class="header" href="#section-container-11">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionCPOS
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerCPOS sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;SOPC&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_cpos.html#cpos-container">ContainerCPOS</a></td></tr>
</tbody></table>
</div>
<h3 id="cpos-container"><a class="header" href="#cpos-container">CPOS Container</a></h3>
<pre><code class="language-c">struct ContainerCPOS
{
    // header
    /* 0x0 */ uint32_t padding0;
    /* 0x4 */ uint16_t widthInTiles;
    /* 0x6 */ uint16_t heightInTiles;
    
    // data
    // ...empty
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>padding0</td><td>Always <code>0</code>.</td><td>uint32_t</td></tr>
<tr><td>widthInTiles</td><td>Same as <a href="universal/resources/nitro/graphics_2d/section_char.html#char-container">ContainerCHAR::widthInTiles</a> or next higher base-2 value. Size boundaries?</td><td>uint16_t</td></tr>
<tr><td>heightInTiles</td><td>Same as <a href="universal/resources/nitro/graphics_2d/section_char.html#char-container">ContainerCHAR::heightInTiles</a> or next higher base-2 value. Size boundaries?</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-20"><a class="header" href="#specification-20">Specification</a></h2>
<h3 id="files-11"><a class="header" href="#files-11">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncgr.html">Nitro Character Graphic Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nmar-ramn---nitro-multi-animation-runtime"><a class="header" href="#nmar-ramn---nitro-multi-animation-runtime">NMAR (&quot;RAMN&quot;) - Nitro Multi Animation Runtime</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NMAR(N. Multi Animation R.)--&gt;G2D(Graphics 2D);
    ANBK(Animation Bank)--&gt;NMAR;
    LABL(Label)--&gt;NMAR;
</pre>
<p>The multi animation runtime works in the same way as the animation runtime does, but on multi cells. The animations on the individual cells are not effected.</p>
<h2 id="table-of-contents-40"><a class="header" href="#table-of-contents-40">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-21"><a class="header" href="#data-structure-21">Data Structure</a></h2>
<h3 id="file-container-5"><a class="header" href="#file-container-5">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNMAR
{
    /* 0x00   */ struct NitroFileHeader fileHeader;
    /* 0x10   */ struct ContainerSectionABNK sectionDataABNK;
    /* append */ struct ContainerSectionLABL sectionDataLABL;
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;RAMN&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>sectionDataABNK</td><td>Cell animation data.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#section-container">ContainerSectionABNK</a></td></tr>
<tr><td>sectionDataLABL</td><td>Cell-name table.</td><td><a href="universal/resources/nitro/graphics_2d/section_labl.html#section-container">ContainerSectionLABL</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-21"><a class="header" href="#specification-21">Specification</a></h2>
<h3 id="sections-5"><a class="header" href="#sections-5">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html">Animation Bank</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html">Label</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="abnk-knba---animation-bank-1"><a class="header" href="#abnk-knba---animation-bank-1">ABNK (&quot;KNBA&quot;) - Animation Bank</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a>, <a href="https://github.com/magical">magical</a>, <a href="https://github.com/Gonhex">Gonhex</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NANR(N. Animation R.)--&gt;G2D(Graphics 2D);
    NMAR(N. Multi Animation R.)--&gt;G2D;
    ABNK(Animation Bank)--&gt;NANR;
    ABNK--&gt;NMAR;
</pre>
<p>The animation bank is used to animate 2D graphics. It requires an object to work on, which can be either a cell bank or a multi cell bank. Internally it works like frame by frame animations. To achieve more dynamic results, affine transformations can be applied to selected frames.</p>
<h2 id="table-of-contents-41"><a class="header" href="#table-of-contents-41">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#abnk-container">ABNK Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#sequence">Sequence</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">Frame</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame-properties">FrameProperties</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#animation">Animation</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#loop-mode">Loop Mode</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#affine-transformation">Affine Transformation</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#files">Files</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_abnk.html#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-structure-22"><a class="header" href="#data-structure-22">Data Structure</a></h2>
<h3 id="section-container-12"><a class="header" href="#section-container-12">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionABNK
{
    /* 0x0    */ struct NitroSectionHeader sectionHeader;
    /* 0x8    */ struct ContainerABNK sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;KNBA&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#abnk-container">ContainerABNK</a></td></tr>
</tbody></table>
</div>
<h3 id="abnk-container-1"><a class="header" href="#abnk-container-1">ABNK Container</a></h3>
<pre><code class="language-c">struct ContainerABNK
{
    // header
    /* 0x00 */ uint16_t numberSequences;
    /* 0x02 */ uint16_t numberFrames;
    /* 0x04 */ uint32_t offsetDataSequences;
    /* 0x08 */ uint32_t offsetDataFrame
    /* 0x0C */ uint32_t offsetDataFrameProperties;
    /* 0x10 */ uint32_t unknown0;
    /* 0x14 */ uint32_t unknown1;
    
    // data
    /* offsetDataSequences       */ struct Sequence dataSequences[numberSequences];
    /* offsetDataFrame           */ struct Frame dataFrames[numberFrames];
    /* offsetDataFrameProperties */ struct FrameProperties dataFrameProperties[?];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberSequences</td><td>Number of sequences.</td><td>uint16_t</td></tr>
<tr><td>numberFrames</td><td>Number of frames.</td><td>uint16_t</td></tr>
<tr><td>offsetDataSequences</td><td>Offset to the sequence data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>offsetDataFrame</td><td>Offset to the frame data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>offsetDataFrameProperties</td><td>Offset to the frame property data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>unknown0</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>unknown1</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>dataSequences</td><td>Animated object data.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#sequence">Sequence[]</a></td></tr>
<tr><td>dataFrames</td><td>Frame configuration data. Duration in frames and an index to the properties.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">Frame[]</a></td></tr>
<tr><td>dataFrameProperties</td><td>Current (multi) cell index and affine transformation data, depends on the sequence.</td><td><a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame-properties">FrameProperties[]</a></td></tr>
</tbody></table>
</div>
<h3 id="sequence-1"><a class="header" href="#sequence-1">Sequence</a></h3>
<pre><code class="language-c">struct Sequence
{
    /* 0x0 */ uint32_t numberFrames;
    /* 0x4 */ uint16_t animationType;
    /* 0x6 */ uint16_t cellType;
    /* 0x8 */ uint32_t loopMode;
    /* 0xC */ uint32_t offsetFrame;
}; // entry size = 0x10
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberFrames</td><td>Refers to the count of <a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">frame-blocks</a> used in this sequence.</td><td>uint32_t</td></tr>
<tr><td>animationType</td><td><code>0x0</code> = sequence, <code>0x1</code> = affine transform, <code>0x2</code> = translation.</td><td>uint16_t</td></tr>
<tr><td>cellType</td><td><code>0x1</code> = unique cell, <code>0x2</code> = multi cell.</td><td>uint16_t</td></tr>
<tr><td>loopMode</td><td>Behaviour of the frame sequence, values are documented in <a href="universal/resources/nitro/graphics_2d/section_abnk.html#loop-mode">Loop Mode</a>.</td><td>uint32_t</td></tr>
<tr><td>offsetFrame</td><td>Offset to the first used frame, relative to <code>offsetDataFrame</code>.</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<h3 id="frame-1"><a class="header" href="#frame-1">Frame</a></h3>
<pre><code class="language-c">struct Frame
{
    /* 0x0 */ uint32_t offsetProperties;
    /* 0x4 */ uint16_t durationInFrames;
    /* 0x6 */ int16_t unknown0;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>offsetProperties</td><td>Offset to the first used frame property, relative to <code>offsetDataFrameProperties</code>.</td><td>uint32_t</td></tr>
<tr><td>durationInFrames</td><td>Number of frames remaining in this state, 60 frames per second.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Always <code>0xBEEF</code>.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<h3 id="frame-properties-1"><a class="header" href="#frame-properties-1">Frame Properties</a></h3>
<pre><code class="language-c">// if animationType == 0
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
}; // entry size = 0x2

// if animationType == 1
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
    /* 0x2 */ uint16_t rotate;
    /* 0x4 */ fx&lt;1.19.12&gt; scaleW;
    /* 0x8 */ fx&lt;1.19.12&gt; scaleH;
    /* 0xC */ int16_t translateX;
    /* 0xE */ int16_t translateY;
}; // entry size = 0x10

// if animationType == 2
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
    /* 0x2 */ uint16_t unknown0;
    /* 0x4 */ int16_t translateX;
    /* 0x6 */ int16_t translateY;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>cellIndex</td><td>Index of the displayed cell or multi cell block.</td><td>uint16_t</td></tr>
<tr><td>rotate</td><td>Rotation angle, using the full range of uint16_t for one turn.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Unused, <code>0x0</code> or <code>0xBEEF</code>.</td><td>uint16_t</td></tr>
<tr><td>scaleW</td><td>Width scaling factor.</td><td><a href="universal/resources/nitro/graphics_2d/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>scaleH</td><td>Height scaling factor.</td><td><a href="universal/resources/nitro/graphics_2d/">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>translateX</td><td>X position adjustment.</td><td>int16_t</td></tr>
<tr><td>translateY</td><td>Y position adjustment.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<p><strong>Important:</strong> The structs for <code>animationType &gt; 0</code> must be DWORD aligned. If there is a region with an odd number of type-0 properties, a dummy entry is appended as padding.</p>
<hr />
<h2 id="specification-22"><a class="header" href="#specification-22">Specification</a></h2>
<h3 id="animation-1"><a class="header" href="#animation-1">Animation</a></h3>
<p>To animate a sprite, three data blocks are required.</p>
<ol>
<li>The entry point is the <a href="universal/resources/nitro/graphics_2d/section_abnk.html#sequence">sequence data</a>. This defines the gereral properties of a sequence. How many different frames are involved? Are transformations applied or does the animation only rely on changing images? This decision is applyed to all frames, which are part of the sequence.</li>
<li>The <a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame">frame data</a> tells, how long the image remains in this state. On a 60 fps system, setting it to 60 frames (<code>0x3C</code>) makes it last one second before switching to the next frame. It also points to an offset in the frame property data. To save memory, multiple frames can point to the same property offset.</li>
<li>The structure of the <a href="universal/resources/nitro/graphics_2d/section_abnk.html#frame-properties">frame properties</a> depends on the <code>animationType</code> setting from the sequence data. If it is <code>== 0</code>, all it does is displaying the selected cell. If it is <code>== 2</code>, the position can also be changed. <code>animationType == 1</code> also adds scaling and rotation.</li>
</ol>
<p>If the animation is applied to a normal cell bank, the image in each frame is static, meaning if one frame is set to remain for one second and the transformation is rotate 180°, the image will be displayed upside down for one second. If the animation is applied to multi cells, which already have animated parts, it will loop through the animations of the multi cell, while &quot;being upside down&quot;.</p>
<h3 id="loop-mode-1"><a class="header" href="#loop-mode-1">Loop Mode</a></h3>
<p>The loop mode defines what to do, after the animation reached its last frame. There are four values, which can be used:</p>
<ol>
<li>Stop animation at last frame.</li>
<li>Repeat animation after last frame.</li>
<li>Play frames backwards after reaching the last frame and stop at first frame.</li>
<li>Ping pong mode, repeat alternately forward and backward.</li>
</ol>
<p>Other values are not supported and end up in the behavior of <code>1</code>.</p>
<h3 id="affine-transformation-1"><a class="header" href="#affine-transformation-1">Affine Transformation</a></h3>
<p>The transformation matrices are applied in the following order:</p>
<ol>
<li>Scaling</li>
</ol>
<p>$$
\begin{bmatrix}
\textbf{scaleW} &amp; 0               &amp; 0 \
0               &amp; \textbf{scaleH} &amp; 0 \
0               &amp; 0               &amp; 1 \
\end{bmatrix}
$$</p>
<ol start="2">
<li>Rotatating (adjust <code>rotate</code> first)</li>
</ol>
<p>$$
\begin{bmatrix}
cos(\textbf{rotate}) &amp; -sin(\textbf{rotate}) &amp; 0 \
sin(\textbf{rotate}) &amp; cos(\textbf{rotate})  &amp; 0 \
0                    &amp; 0                     &amp; 1 \
\end{bmatrix}
$$</p>
<ol start="3">
<li>Translating</li>
</ol>
<p>$$
\begin{bmatrix}
1 &amp; 0 &amp; \textbf{translateX} \
0 &amp; 1 &amp; \textbf{translateY} \
0 &amp; 0 &amp; 1                   \
\end{bmatrix}
$$</p>
<h3 id="files-12"><a class="header" href="#files-12">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html">Nitro Multi Animation Runtime</a></li>
</ul>
<hr />
<h2 id="todo-8"><a class="header" href="#todo-8">TODO</a></h2>
<ul>
<li>Link fixed point definition</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="labl-lbal---label-2"><a class="header" href="#labl-lbal---label-2">LABL (&quot;LBAL&quot;) - Label</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NCER(N. Cell R.)--&gt;G2D(Graphics 2D);
    NANR(N. Animation R.)--&gt;G2D;
    NMAR(N. Multi Animation R.)--&gt;G2D;
    LABL(Label)--&gt;NCER;
    LABL--&gt;NANR;
    LABL--&gt;NMAR;
</pre>
<p>Gives names to all cells or objects.</p>
<h2 id="table-of-contents-42"><a class="header" href="#table-of-contents-42">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#labl-container">LABL Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_labl.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-23"><a class="header" href="#data-structure-23">Data Structure</a></h2>
<h3 id="section-container-13"><a class="header" href="#section-container-13">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionLABL
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerLABL sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;LBAL&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_labl.html#labl-container">ContainerLABL</a></td></tr>
</tbody></table>
</div>
<h3 id="labl-container-2"><a class="header" href="#labl-container-2">LABL Container</a></h3>
<pre><code class="language-c">struct ContainerLABL
{
    // header
    // ...empty
    
    // data
    /* 0x0    */ uint32_t dataOffsetTable[numberLabels];
    /* append */ uint8_t* dataLabel[numberLabels];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>dataOffsetTable</td><td>Offset to the start of a string. Relative to <code>dataLabel</code>.</td><td>uint32_t[]</td></tr>
<tr><td>dataLabel</td><td>UTF-8 text-string, zero-terminated.</td><td>uint8_t*[]</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-23"><a class="header" href="#specification-23">Specification</a></h2>
<h3 id="files-13"><a class="header" href="#files-13">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime</a></li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmar.html">Nitro Multi Animation Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nmcr-rcmn---nitro-multi-cell-runtime"><a class="header" href="#nmcr-rcmn---nitro-multi-cell-runtime">NMCR (&quot;RCMN&quot;) - Nitro Multi Cell Runtime</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NMCR(N. Multi Cell R.)--&gt;G2D(Graphics 2D);
    MCBK(Multi Cell Bank)--&gt;NMCR;
</pre>
<p>The multi cell runtime combines multiple animated cells into objects. These can be animated again to allow more complex animations.</p>
<h2 id="table-of-contents-43"><a class="header" href="#table-of-contents-43">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nmcr.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nmcr.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/file_nmcr.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nmcr.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-24"><a class="header" href="#data-structure-24">Data Structure</a></h2>
<h3 id="file-container-6"><a class="header" href="#file-container-6">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNMCR
{
    /* 0x00 */ struct NitroFileHeader fileHeader;
    /* 0x10 */ struct ContainerSectionMCBK sectionDataMCBK;
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;RCMN&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>sectionDataCEBK</td><td>Cell cluster data.</td><td><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#section-container">ContainerSectionMCBK</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-24"><a class="header" href="#specification-24">Specification</a></h2>
<h3 id="sections-6"><a class="header" href="#sections-6">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html">Multi Cell Bank</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mcbk-kbcm---multi-cell-bank"><a class="header" href="#mcbk-kbcm---multi-cell-bank">MCBK (&quot;KBCM&quot;) - Multi Cell Bank</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://github.com/Gonhex">Gonhex</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NMCR(N. Multi Cell R.)--&gt;G2D(Graphics 2D);
    MCBK(Multi Cell Bank)--&gt;NMCR;
</pre>
<p>The multi cell bank combines multiple animated cells into cluster. This allows more complex animations by grouping related sequences into one unit. </p>
<h2 id="table-of-contents-44"><a class="header" href="#table-of-contents-44">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#mcbk-container">MCBK Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#multi-cell">Multi Cell</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#multi-cell-properties">Multi Cell Properties</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#frame-mode">Frame Mode</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-25"><a class="header" href="#data-structure-25">Data Structure</a></h2>
<h3 id="section-container-14"><a class="header" href="#section-container-14">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionMCBK
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerMCBK sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;KBCM&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#mcbk-container">ContainerMCBK</a></td></tr>
</tbody></table>
</div>
<h3 id="mcbk-container"><a class="header" href="#mcbk-container">MCBK Container</a></h3>
<pre><code class="language-c">struct ContainerMCBK
{
    // header
    /* 0x00 */ uint16_t numberMultiCells;
    /* 0x02 */ uint16_t unknown0;
    /* 0x04 */ uint32_t offsetDataMultiCell;
    /* 0x08 */ uint32_t offsetDataMultiCellProperties;
    /* 0x0C */ uint32_t unknown1;
    /* 0x10 */ uint32_t unknown2;
    
    // data
    /* offsetMultiCell           */ struct MultiCell dataMultiCell[numberMultiCells];
    /* offsetMultiCellProperties */ struct MultiCellProperties dataMultiCellProperties[?];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberMultiCells</td><td>Number of multi cell objects.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Always <code>0xBEEF</code>.</td><td>uint16_t</td></tr>
<tr><td>offsetDataMultiCell</td><td>Offset to the multi cell data section relative to <code>ContainerMCBK</code>.</td><td>uint32_t</td></tr>
<tr><td>offsetDataMultiCellProperties</td><td>Offset to the multi cell property data section relative to <code>ContainerMCBK</code>.</td><td>uint32_t</td></tr>
<tr><td>unknown1</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>unknown2</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>dataMultiCell</td><td>Multi cell configuration table.</td><td><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#multi-cell">MultiCell</a></td></tr>
<tr><td>dataMultiCellProperties</td><td>Cell selection and placement data.</td><td><a href="universal/resources/nitro/graphics_2d/section_mcbk.html#multi-cell-properties">MultiCellProperties</a></td></tr>
</tbody></table>
</div>
<h3 id="multi-cell"><a class="header" href="#multi-cell">Multi Cell</a></h3>
<pre><code class="language-c">struct MultiCell
{
    /* 0x0 */ uint16_t numberDisplayedCells;
    /* 0x2 */ uint16_t numberLoadedCells;
    /* 0x4 */ uint32_t offsetData;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberDisplayedCells</td><td>Number of visible multi cells.</td><td>uint16_t</td></tr>
<tr><td>numberLoadedCells</td><td>Number of multi cells within the buffer.</td><td>uint16_t</td></tr>
<tr><td>offsetData</td><td>Offset of the multi cell relative to <a href="universal/resources/nitro/graphics_2d/section_mcbk.html#multi-cell">MultiCell</a>.</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<h3 id="multi-cell-properties"><a class="header" href="#multi-cell-properties">Multi Cell Properties</a></h3>
<pre><code class="language-c">struct MultiCellProperties
{
    /* 0x0 */ uint16_t indexSequence;
    /* 0x2 */ int16_t translateX;
    /* 0x4 */ int16_t translateY;
    /* 0x6 */ uint8_t frameMode;
    /* 0x7 */ uint8_t uniqueID;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>indexSequence</td><td>Selects a sequence from the animation runtime.</td><td>uint16_t</td></tr>
<tr><td>translateX</td><td>X translation of the animated base.</td><td>int16_t</td></tr>
<tr><td>translateY</td><td>Y translation of the animated base.</td><td>int16_t</td></tr>
<tr><td>frameMode</td><td>Behavior of the frame counter, if cell is temporary unloaded, see <a href="universal/resources/nitro/graphics_2d/section_mcbk.html#frame-mode">Frame Mode</a>.</td><td>uint8_t</td></tr>
<tr><td>uniqueID</td><td>Local multi cell index starting by <code>0</code>. No duplicates allowed.</td><td>uint8_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-25"><a class="header" href="#specification-25">Specification</a></h2>
<h3 id="frame-mode"><a class="header" href="#frame-mode">Frame Mode</a></h3>
<p>Defines the behavior of a sequence if the displayed multicell changes.</p>
<ul>
<li><code>0x20</code>: Reset the frame counter. The sequence will start from the beginning after the multicell regains focus.</li>
<li><code>0x21</code>: Continue counting. The sequence will continue counting frames even if the multicell lost focus, no restart after regaining it.</li>
</ul>
<p>This value is probably a bitfield. This would explain the leading <code>2</code> which implies an always enabled flag.</p>
<h3 id="files-14"><a class="header" href="#files-14">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nmcr.html">Nitro Multi Cell Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nscr-rcsn---nitro-screen-runtime"><a class="header" href="#nscr-rcsn---nitro-screen-runtime">NSCR (&quot;RCSN&quot;) - Nitro Screen Runtime</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: (see sections)</p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NSCR(N. Screen R.)--&gt;G2D(Graphics 2D);
    SCRN(Screen)--&gt;NSCR;
</pre>
<p>The screen runtime is used to rearrange the tiles of the character graphic on the screen. It also has the ability to flip tiles and change their palette index.</p>
<h2 id="table-of-contents-45"><a class="header" href="#table-of-contents-45">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nscr.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nscr.html#file-container">File Container</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/file_nscr.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nscr.html#sections">Sections</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-26"><a class="header" href="#data-structure-26">Data Structure</a></h2>
<h3 id="file-container-7"><a class="header" href="#file-container-7">File Container</a></h3>
<pre><code class="language-c">struct ContainerFileNSCR
{
    /* 0x00 */ struct NitroFileHeader fileHeader;
    /* 0x10 */ struct ContainerSectionCHAR sectionDataSCRN;
}; // entry size = fileHeader.lengthFile
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>fileHeader</td><td>Header of this file. <code>fileHeader.signature = &quot;RCSN&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-file-header">NitroFileHeader</a></td></tr>
<tr><td>sectionDataSCRN</td><td>Image data.</td><td><a href="universal/resources/nitro/graphics_2d/section_scrn.html#section-container">ContainerSectionSCRN</a></td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-26"><a class="header" href="#specification-26">Specification</a></h2>
<h3 id="sections-7"><a class="header" href="#sections-7">Sections</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_scrn.html">Screen</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scrn-nrcs---screen"><a class="header" href="#scrn-nrcs---screen">SCRN (&quot;NRCS&quot;) - Screen</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NSCR(N. Screen R.)--&gt;G2D(Graphics 2D);
    SCRN(Screen)--&gt;NSCR;
</pre>
<p>The screen section, also known as tile map, is used to create an image by rearranging and flipping tiles. Each position on the raster gets one. This can save a lot of memory since duplicated tiles can be avoided.</p>
<h2 id="table-of-contents-46"><a class="header" href="#table-of-contents-46">Table of Contents</a></h2>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_scrn.html#data-structure">Data Structure</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_scrn.html#section-container">Section Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_scrn.html#scrn-container">SCRN Container</a></li>
<li><a href="universal/resources/nitro/graphics_2d/section_scrn.html#tile-properties">Tile Properties</a></li>
</ul>
</li>
<li><a href="universal/resources/nitro/graphics_2d/section_scrn.html#specification">Specification</a>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/section_scrn.html#files">Files</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-structure-27"><a class="header" href="#data-structure-27">Data Structure</a></h2>
<h3 id="section-container-15"><a class="header" href="#section-container-15">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionSCRN
{
    /* 0x0 */ struct NitroSectionHeader sectionHeader;
    /* 0x8 */ struct ContainerSCRN sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;NRCS&quot;</code>.</td><td><a href="universal/resources/nitro/graphics_2d/../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="universal/resources/nitro/graphics_2d/section_scrn.html#scrn-container">ContainerSCRN</a></td></tr>
</tbody></table>
</div>
<h3 id="scrn-container"><a class="header" href="#scrn-container">SCRN Container</a></h3>
<pre><code class="language-c">struct ContainerSCRN
{
    // header
    /* 0x0 */ uint16_t widthInPixel;
    /* 0x2 */ uint16_t heightInPixel;
    /* 0x4 */ uint16_t unknown0;
    /* 0x6 */ uint16_t unknown1;
    /* 0x8 */ uint32_t lengthDataScreen;
    
    // data
    /* 0xC */ struct TileProperties dataScreen[widthInPixel &gt;&gt; 3][heightInPixel &gt;&gt; 3];
}; // entry size = 0xC + lengthDataScreen
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>widthInPixel</td><td>Width of the image in pixel.</td><td>uint16_t</td></tr>
<tr><td>heightInPixel</td><td>Height of the image in pixel.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Unused mode?</td><td>uint16_t</td></tr>
<tr><td>unknown1</td><td>Unused mode?</td><td>uint16_t</td></tr>
<tr><td>lengthDataScreen</td><td>Length of the screen data section in bytes.</td><td>uint32_t</td></tr>
<tr><td>dataScreen</td><td>Two-dimensional tile map to create an image by indexing and flipping tiles.</td><td><a href="universal/resources/nitro/graphics_2d/section_scrn.html#tile-properties">TileProperties[][]</a></td></tr>
</tbody></table>
</div>
<h3 id="tile-properties"><a class="header" href="#tile-properties">Tile Properties</a></h3>
<pre><code class="language-c">struct TileProperties
{
    /* 0x0 */ uint16_t tileIndex : 10;     // 0b00000011'11111111
              uint16_t horizontalFlip : 1; // 0b00000100'00000000
              uint16_t verticalFlip : 1;   // 0b00001000'00000000
              uint16_t paletteIndex : 4;   // 0b11110000'00000000
}; // entry size = 0x2
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>tileIndex</td><td>Index of the tile (8x8 pixel image) within the <a href="universal/resources/nitro/graphics_2d/file_ncgr.html">character graphic</a>.</td><td>uint16_t</td></tr>
<tr><td>horizontalFlip</td><td>Flip/mirror tile horizontally.</td><td>uint16_t</td></tr>
<tr><td>verticalFlip</td><td>Flip/mirror tile vertically.</td><td>uint16_t</td></tr>
<tr><td>paletteIndex</td><td>Index of the palette used for this tile.</td><td>uint16_t</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="specification-27"><a class="header" href="#specification-27">Specification</a></h2>
<h3 id="files-15"><a class="header" href="#files-15">Files</a></h3>
<ul>
<li><a href="universal/resources/nitro/graphics_2d/file_nscr.html">Nitro Screen Runtime</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="contribution-guide"><a class="header" href="#contribution-guide">Contribution Guide</a></h1>
<hr />
<h2 id="creating-a-fork"><a class="header" href="#creating-a-fork">Creating a Fork</a></h2>
<ol>
<li>If you don't have one already, you first need to create a <a href="https://github.com/signup">Github account</a></li>
<li>Go to the <a href="https://github.com/kingdom-of-ds-hacking/kingdom-of-ds-hacking.github.io">main repo</a> and click the Fork button in the top right. Check out <a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo#forking-a-repository">Github's official article</a> for more details.</li>
</ol>
<h2 id="creating-a-new-markdown-file"><a class="header" href="#creating-a-new-markdown-file">Creating a new Markdown File</a></h2>
<ol>
<li>Open <a href="https://github.com/kingdom-of-ds-hacking/kingdom-of-ds-hacking.github.io/blob/main/templates/guides/guides.md">guide.md</a> if you're making a guide, or <a href="https://github.com/kingdom-of-ds-hacking/kingdom-of-ds-hacking.github.io/blob/main/templates/resources/resources.md">resources.md</a> if you're making a resource, click the <em>Code</em> button and copy its contents.</li>
<li>In your repo, go to the appropriate folder:
<ul>
<li>If it's for either a gen 4 or 5 game(s), go to either <code>src/gen4/guides</code>/<code>src/gen5/guides</code> (or <code>src/gen4/resources</code>/<code>src/gen5/resources</code> for resources) and from there choose the right subfolder</li>
<li>If it applies to all games, go to <code>src/universal/guides</code> (or <code>src/universal/resources</code>)</li>
</ul>
</li>
<li>Once you're in the correct folder, click the <em>Add File</em>&gt;<em>Create New File</em>. You have to name it appropriately:
<ul>
<li>First part of the filename should be the games it applies (unless it's for every game in the generation): for example if it's only for Platinum and HGSS games, it should start with <code>pt_hgss</code></li>
<li>The second part of the filename should be what the guide is about: for example, the guide about setting a weather from a script is named <code>pt-hgss_weather_script</code></li>
<li>It must have the <code>.md</code> extension</li>
<li>In the <code>Universal</code> folder, you have to create a subfolder with the same name as the file first: you can do so by adding the folder name before the markdown filename; so for example the file address in the uploading screen will look like <code>guides/new_guide/new_guide.md</code> if you're adding a universal guide</li>
<li>Paste the text you copied from the <code>guides.md</code> or <code>resources.md</code> template in the body. Now you can start writing the markdown file.</li>
</ul>
</li>
</ol>
<h2 id="markdown-formatting-and-images"><a class="header" href="#markdown-formatting-and-images">Markdown Formatting and Images</a></h2>
<ol>
<li>The syntax used must follow the <a href="https://www.markdownguide.org/basic-syntax/">Markdown Format</a>, which is the same as discord uses.</li>
<li>Use the template you copypasted as a guideline. Remember that there is a preview button you can use!</li>
<li>If you wish to add images to your file, they must first be uploaded to the repo in the appropriate folder:
<ul>
<li>For either the gen4 or gen5 folder, go to the corresponding <code>resources</code> subfolder. Create an empty markdown file and create a new folder along with it, named the same as your markdown file name.</li>
<li>For the universal folder, create a new folder called <code>resources</code> inside the folder with the same name as your file.</li>
<li>In the folder you just created, upload your images. Keep the filename recognizable and short enough, and they should be in a png format. Once you've uploaded them, delete the empty markdown file.</li>
</ul>
</li>
<li>To link images, you can simply use <code>![Optional Description](filepath/image.png) </code>. With the <em>filepath</em> being relative to your guide's location
<ul>
<li>For example, in the indexing guide the image is linked with <code>![Indexed Image Example](resources/indexed_image_example.png)</code></li>
<li>In the Pokémarts guide it looks like <code>![](resources/pt_hgss-pokemarts/pokemart_script1.PNG)</code></li>
</ul>
</li>
</ol>
<h2 id="pull-requests"><a class="header" href="#pull-requests">Pull Requests</a></h2>
<ol>
<li>Once you've finished writing your markdown file, click the <em>Commit Changes</em> button and commit to your main branch.</li>
<li>In order for your file to show up on the wiki you need to edit <code>SUMMARY.md</code> and <code>README.md</code> in the <code>src</code> folder. Add an entry for your file to every game it applies (unless it's in the Universal section).</li>
<li>Make sure your branch is up to date before submitting a PR, you can do so by using the <em>Sync Fork</em> button in the main page of your repo.</li>
<li>In your repository, click the <em>Pull Requests</em> tab and then <em>New Pull Request</em>. Make sure you are comparing your branch and the main branch of the original repository.</li>
<li>Fill in the form and then submit the PR.</li>
</ol>
<h2 id="videos-and-local-clone"><a class="header" href="#videos-and-local-clone">Videos and Local Clone</a></h2>
<p>Videos can be to the repo along images if they're small enough, otherwise they can be embedded to your markdown file from an external hosting service like youtube. You can use html, css or javascript.</p>
<p>Check out the syntax used in <a href="https://github.com/kingdom-of-ds-hacking/kingdom-of-ds-hacking.github.io/blob/main/src/universal/guides/ncer_sprite_editing/ncer_sprite_editing.md">NCER Guide</a> or the <a href="https://github.com/kingdom-of-ds-hacking/kingdom-of-ds-hacking.github.io/blob/main/src/universal/guides/knarc/knarc.md">Knarc Guide</a> for examples of embedded videos.
However you can't check if the video will actually play on github's markdown viewer, so you need to host a local clone of the website.</p>
<p>In order to do so you first need to install Cargo and Rust and then build mdbook from source.You may want to check out <a href="https://rust-lang.github.io/mdBook/guide/installation.html">mdbook Installation Guide</a>, </p>
<p>If you're on Windows:</p>
<ol>
<li>Install <a href="https://www.rust-lang.org/tools/install">Rust</a></li>
<li>This should install all the tools at <code>C:\Users\user\.cargo\bin</code> and add this address to your PATH Environment Variable. Make sure it is actually present.</li>
<li>Now launch Windows PowerShell and run the command <code>cargo install mdbook</code></li>
<li>Go to the github homepage of your fork, click the green <code>&lt;&gt; Code </code> button and go to <em>Local</em>&gt;<em>Download Zip</em>, then unzip everything in a folder. Alternatively you can use github desktop to do the same.</li>
<li>Open the Windows PowerShell in the folder where you've downloaded the code. You can do so by <em>Shift+Right Click</em> in the folder &gt; <em>Open Windows PowerShell here</em></li>
<li>Run the command <code>mdbook serve</code>, then open your browser (without closing the PowerShell) and go to the address <code>http://localhost:3000</code>. If all goes well you should now be hosting a local clone of your repository.</li>
<li>You can now check if your video player is being displayed correctly, and also any edit you perform to the files in your folder will be automatically applied to the local website after saving and reloading the page. Closing the PowerShell will shut it down.</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
